import{d as E,g as _,x as O,y as J,Q as G,o as r,c as a,b as e,a as v,j as p,v as H,a1 as T,i as n,R as A,k as y,W as q,w as $,F as k,T as Z,r as K,V as X,m as j,a2 as L,t as d,n as U,a3 as Q,a4 as ee,Y as te,Z as se,a6 as oe}from"./main-5548143a.js";import{M as re}from"./Master-c8d301f4.js";import{_ as ae}from"./Paginator.vue_vue_type_script_setup_true_lang-d513ffa5.js";import{u as ne}from"./urlQueryManager-a6ec7c9d.js";import{i as le}from"./index.es-721e1c12.js";import{d as de}from"./datepickerPresets-afa0dfdf.js";import{s as ie}from"./multiselect-30de6652.js";import{_ as ce}from"./BarcodeScanner.vue_vue_type_script_setup_true_lang-45b89a9c.js";import{_ as ue}from"./BranchFilter.vue_vue_type_script_setup_true_lang-9c1eb286.js";import{P as B}from"./patientCallStatus-cce91589.js";import{O as W}from"./orderStatus-e3a3f9a7.js";import{_ as pe,R as Y}from"./ResultsReleaseModal.vue_vue_type_script_setup_true_lang-a6513014.js";import{A as he}from"./ActivityLogSidebar-c5c8518d.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./websocketPrint-65a486cc.js";import"./printTemplateManager-7d6de79b.js";import"./toggle-af3738b3.js";var C=(S=>(S.Pending="pending",S.Sent="sent",S.Failed="failed",S))(C||{});const ge={class:"ml-auto flex flex-wrap items-center gap-2"},be=["onKeyup"],_e=["onKeyup"],me=e("option",{value:""},"Message status",-1),ye=["value"],ve=["value"],fe=["value"],we=e("option",{value:""},"Call status",-1),xe=["value"],ke=["value"],Ce=["value"],Se=E({__name:"FollowupsFilter",emits:["change"],setup(S,{emit:N}){const c=new URLSearchParams(location.search),{hasPermissionTo:M}=Z(),f=_(""),u=_(""),h=_(""),g=_([null,null]),b=_(""),w=_(""),x=_(""),P=_([]);O(()=>{s(),F()});const z=J(()=>g.value[0]===null||g.value[1]===null?"":`${g.value[0]}~${g.value[1]}`),F=async()=>{if(!M("Partner.list"))return;const{data:l}=await G.get(`/api/partners/list?branchId=${f.value}`);P.value=l.data},I=l=>{b.value=l??"",i()},D=l=>{h.value=l,i()},s=()=>{f.value=c.get("branchId")??"",u.value=c.get("q")??"",h.value=c.get("visitNumber")??"",c.get("dateRange")&&(g.value=c.get("dateRange").split("~")),b.value=c.get("partnerId")??"",w.value=c.get("callStatus")??"",x.value=c.get("messageStatus")??""},m=()=>{const l=h.value;R(),h.value=l,i()},i=()=>{let l=`branchId=${f.value}&visitNumber=${h.value}&q=${u.value}&partnerId=${b.value}&messageStatus=${x.value}&callStatus=${w.value}&dateRange=${z.value}&page=1`;N("change",l)},R=()=>{f.value="",u.value="",h.value="",g.value=[null,null],b.value="",w.value="",x.value=""};return(l,o)=>(r(),a(k,null,[e("div",ge,[v(ue,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t),onChange:o[1]||(o[1]=t=>{i(),F()})},null,8,["modelValue"]),p(e("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>h.value=t),onKeyup:T(m,["enter"]),type:"text",placeholder:"Registration number",class:"w-40 rounded border border-gray-300 p-1.5 focus:border-blue-500"},null,40,be),[[H,h.value]]),p(e("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>u.value=t),onKeyup:T(i,["enter"]),type:"text",placeholder:"Name or phone number",class:"w-48 rounded border border-gray-300 p-1.5 focus:border-blue-500"},null,40,_e),[[H,u.value]]),n(M)("Partner.list")?(r(),A(n(ie),{key:0,"model-value":b.value,options:P.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,placeholder:"Select partner",onChange:I,class:"w-48 min-h-[38px] border border-gray-300 !rounded"},null,8,["model-value","options"])):y("",!0),p(e("select",{"onUpdate:modelValue":o[4]||(o[4]=t=>x.value=t),onChange:i,class:"px-2 h-[38px] border border-gray-300 !rounded"},[me,e("option",{value:n(C).Pending},"Pending",8,ye),e("option",{value:n(C).Sent},"Sent",8,ve),e("option",{value:n(C).Failed},"Failed",8,fe)],544),[[q,x.value]]),p(e("select",{"onUpdate:modelValue":o[5]||(o[5]=t=>w.value=t),onChange:i,class:"px-2 h-[38px] border border-gray-300 !rounded"},[we,e("option",{value:n(B).Pending},"Pending",8,xe),e("option",{value:n(B).Answered},"Answered",8,ke),e("option",{value:n(B).NoAnswer},"No Answer",8,Ce)],544),[[q,w.value]]),v(n(le),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:n(de),placeholder:"Select date range",value:g.value,"onUpdate:value":o[6]||(o[6]=t=>g.value=t),onChange:i,class:"!w-56 mr-2","input-class":"w-full rounded border border-gray-300 p-1.5 focus:border-blue-500"},{"icon-calendar":$(()=>[]),_:1},8,["shortcuts","value"])]),v(ce,{onScan:D})],64))}}),$e={class:"mb-5 flex items-center"},Be={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},Me={class:"w-full"},Pe={class:"sticky top-0 z-10 text-left"},Re=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},null,-1),Ve=e("th",{class:"whitespace-nowrap first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Phone Number",-1),Ne=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Names",-1),Fe=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Visits",-1),Le=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 text-center font-semibold text-white"},"Status",-1),Ae=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Notes",-1),ze=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Date",-1),Ie=e("th",{class:"whitespace-nowrap first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Previous Followup",-1),De=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Branch",-1),je={key:0,class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},Ue={class:"transition hover:bg-gray-100"},He=["onClick"],Te={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"mx-auto h-6 w-6"},qe=e("path",{"fill-rule":"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z","clip-rule":"evenodd"},null,-1),Ke=[qe],Qe={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"mx-auto h-6 w-6"},We=e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z","clip-rule":"evenodd"},null,-1),Ye=[We],Ee={class:"border border-gray-200 px-2 py-1"},Oe={class:"border border-gray-200 px-2 py-1"},Ge={class:"flex flex-wrap items-center gap-1"},Ze={class:"rounded bg-teal-500 p-1 text-xs font-bold text-white"},Je={class:"border border-gray-200 px-2 py-1 text-center"},Xe={class:"border border-gray-200 px-2 py-1 text-center"},et={class:"border border-gray-200 px-2 py-1 text-sm max-w-[10rem]"},tt={class:"whitespace-nowrap border border-gray-200 px-2 py-1"},st={class:"whitespace-nowrap border border-gray-200 px-2 py-1"},ot={class:"border border-gray-200 px-2 py-1"},rt={class:"border border-gray-200 px-2 py-1 text-center"},at={key:0,class:"flex justify-center gap-3"},nt={class:"h-6 w-6 cursor-pointer text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},lt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"},null,-1),dt=[lt],it=["onClick"],ct=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),ut=[ct],pt={key:0},ht={colspan:"100%",class:"border border-gray-200 p-2"},gt={class:"w-full"},bt=e("thead",null,[e("tr",{class:"sticky z-10 text-left top-[39px]"},[e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"No."),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"name"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Gender"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Age"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Phone Number"),e("th",{class:"whitespace-nowrap border border-gray-200 bg-gray-200 p-2 font-semibold"},"Contact Method"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Lab"),e("th",{class:"whitespace-nowrap border border-gray-200 bg-gray-200 p-2 font-semibold"},"Due Balance"),e("th",{class:"whitespace-nowrap border border-gray-200 bg-gray-200 p-2 font-semibold"},"Message Status"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Date"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"})])],-1),_t={class:"transition hover:bg-gray-50"},mt={class:"border border-gray-200 p-1"},yt={class:"whitespace-nowrap border border-gray-200 p-1"},vt={class:"border border-gray-200 p-1"},ft={class:"whitespace-nowrap border border-gray-200 p-1"},wt={class:"border border-gray-200 p-1"},xt={class:"whitespace-nowrap border border-gray-200 p-1"},kt={class:"whitespace-nowrap border border-gray-200 p-1"},Ct={key:1},St={class:"border border-gray-200 p-1"},$t={class:"flex flex-wrap items-center gap-1 max-w-[15rem]"},Bt={class:"whitespace-nowrap border border-gray-200 p-1"},Mt={class:"border border-gray-200 p-1 text-center"},Pt={class:"flex justify-center gap-1"},Rt={class:"h-6 w-6 cursor-pointer text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Vt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"},null,-1),Nt=[Vt],Ft=["onClick"],Lt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"},null,-1),At=[Lt],zt=["onClick"],It=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1),Dt=[It],jt=["href"],Ut={class:"h-6 w-6 cursor-pointer text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ht=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1),Tt=[Ht],ns=E({__name:"Followups",setup(S){const N=_([]),c=_(new Set),M=_({}),{updateUrlQuery:f}=ne(),{hasPermissionTo:u,hasAnyPermission:h}=Z();O(()=>b(location.search));const g=s=>te().data.whatsapp?.find(m=>m.branchId===s),b=async s=>{const m=await f(s),{data:i}=await G.get(`/api/followups?${m}`);N.value=i.data,M.value=i.meta},w=s=>!(!u("Result.print")||s.invoice.dueBalance>0&&!u("Result.printDue")),x=s=>!(s.patient.contactMethod!=="whatsapp"||!u("Result.send")||s.invoice.dueBalance>0&&!u("Result.sendDue")),P=async(s,m)=>{if(s.invoice.dueBalance>0){const{isConfirmed:i}=await se.fire({html:`Patient has due balance of ${s.invoice.dueBalance?.toLocaleString()}`});if(!i)return}Q.emit(oe.Show,{visit:s,orders:s.orders,releaseType:m})},z=s=>`https://api.whatsapp.com/send?phone=${s.patient.phoneNumber.replace("+","")}&text=${g(s.branchId)?.welcomeMessage??""}`,F=s=>{if(s.status===W.Rejected)return"bg-orange-500 text-white";if(s.test.bypass&&!s.selectedResult)return"bg-blue-500 text-white";if(s.selectedResult.messageStatus===C.Sent)return"bg-emerald-500 text-white";if(s.selectedResult.messageStatus===C.Pending)return"bg-gray-300 text-black";if(s.selectedResult.messageStatus===C.Failed)return"bg-red-500 text-white"},I=s=>s.status===W.Rejected?"rejected":s.test.bypass&&!s.selectedResult?"bypass":s.selectedResult.messageStatus,D=s=>{if(s===B.Pending)return"bg-gray-300 text-black";if(s===B.Answered)return"bg-emerald-500 text-white";if(s===B.NoAnswer)return"bg-red-500 text-white"};return(s,m)=>{const i=K("router-view"),R=K("router-link"),l=X("tip");return r(),a(k,null,[v(i,{onClose:b}),v(re,null,{header:$(()=>[j("Patients Followup")]),body:$(()=>[e("div",$e,[v(Se,{onChange:b})]),e("section",Be,[e("table",Me,[e("thead",null,[e("tr",Pe,[Re,Ve,Ne,Fe,Le,Ae,ze,Ie,De,n(h)("Followup.update","ActivityLog.list")?(r(),a("th",je)):y("",!0)])]),(r(!0),a(k,null,L(N.value,o=>(r(),a("tbody",null,[e("tr",Ue,[e("td",{class:"w-12 cursor-pointer border border-gray-200 py-1",onClick:t=>c.value.has(o.id)?c.value.delete(o.id):c.value.add(o.id)},[c.value.has(o.id)?(r(),a("svg",Qe,Ye)):(r(),a("svg",Te,Ke))],8,He),e("td",Ee,d(o.phoneNumber),1),e("td",Oe,[e("div",Ge,[(r(!0),a(k,null,L(o.patients,t=>(r(),a("span",Ze,d(t.name),1))),256))])]),e("td",Je,d(o.visits.length),1),e("td",Xe,[e("span",{class:U(["whitespace-nowrap rounded px-1 text-xs",D(o.callStatus)])},d(o.callStatus.startCase()),3)]),e("td",et,d(o.callNotes),1),e("td",tt,d(o.date),1),e("td",st,d(o.previousDate),1),e("td",ot,d(o.branch.name),1),e("td",rt,[n(h)("Followup.update","ActivityLog.list")?(r(),a("div",at,[n(u)("Followup.update")?(r(),A(R,{key:0,to:`/followups/${o.id}`},{default:$(()=>[p((r(),a("svg",nt,dt)),[[l,"Call"]])]),_:2},1032,["to"])):y("",!0),n(u)("ActivityLog.list")?p((r(),a("button",{key:1,onClick:t=>n(Q).emit(n(ee).Show,o.id),class:"cursor-pointer text-gray-600"},ut,8,it)),[[l,"View Activities"]]):y("",!0)])):y("",!0)])]),c.value.has(o.id)?(r(),a("tr",pt,[e("td",ht,[e("table",gt,[bt,e("tbody",null,[(r(!0),a(k,null,L(o.visits,t=>(r(),a("tr",_t,[e("td",mt,d(t.number),1),e("td",yt,d(t.patient.name),1),e("td",vt,d(t.patient.gender.capitalize()),1),e("td",ft,d(t.patient.age),1),e("td",wt,d(t.patient.phoneNumber),1),e("td",xt,d(t.patient.contactMethod),1),e("td",kt,d(t.lab?.name??"local"),1),e("td",{class:U(["border border-gray-200 p-1",{"font-semibold text-red-500":t.invoice.dueBalance>0}])},[n(u)("Invoice.pay")&&t.invoice.dueBalance>0?p((r(),A(R,{key:0,class:"underline",to:`/invoices/${t.invoice.id}/transactions/payment/create`},{default:$(()=>[j(d(t.invoice.dueBalance?.toLocaleString()),1)]),_:2},1032,["to"])),[[l,"Create Payment"]]):(r(),a("span",Ct,d(t.invoice.dueBalance?.toLocaleString()),1))],2),e("td",St,[e("div",$t,[(r(!0),a(k,null,L(t.orders,V=>p((r(),a("span",{class:U(["cursor-pointer rounded px-1 text-xs",F(V)])},[j(d(V.test.shortForm),1)],2)),[[l,I(V).capitalize()]])),256))])]),e("td",Bt,d(t.date),1),e("td",Mt,[e("div",Pt,[n(u)("ResultEntry.show")?(r(),A(R,{key:0,to:`/results-entry?visitId=${t.id}`},{default:$(()=>[p((r(),a("svg",Rt,Nt)),[[l,"View Results"]])]),_:2},1032,["to"])):y("",!0),w(t)?p((r(),a("svg",{key:1,class:"h-6 w-6 cursor-pointer text-blue-500",onClick:V=>P(t,n(Y).Print),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},At,8,Ft)),[[l,"Print"]]):y("",!0),x(t)?(r(),a(k,{key:2},[g(t.branchId)?.enabled?p((r(),a("svg",{key:0,class:"h-6 w-6 cursor-pointer text-blue-500",onClick:V=>P(t,n(Y).Send),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Dt,8,zt)),[[l,"Send"]]):(r(),a("a",{key:1,href:z(t),target:"_blank"},[p((r(),a("svg",Ut,Tt)),[[l,"Send"]])],8,jt))],64)):y("",!0)])])]))),256))])])])])):y("",!0)]))),256))])])]),_:1}),v(ae,{data:M.value,onChange:m[0]||(m[0]=o=>b(`page=${o}`)),class:"mt-3"},null,8,["data"]),v(pe,{onClose:b}),v(he)],64)}}});export{ns as default};
