import{d as S,e as l,y as $,U as f,x as B,A as d,o as b,C as M,w as u,k as y,t as _,g as E,b as s,a as h,n as F,c as z,i as D,h as I,v as U,f as A,_ as O,V as P,m as R,l as L,S as W}from"./main-c1f62c61.js";import{_ as j}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-0c3f56bb.js";import{F as r}from"./formMode-f60a729f.js";import{T as q}from"./transactionType-ff7c4360.js";const G=["onSubmit"],H={class:"flex flex-wrap items-center mb-3"},J=s("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Amount",-1),K={key:0,class:"w-full ml-24 text-red-500 text-sm"},Q={class:"flex flex-wrap items-center mb-3"},X=s("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Notes",-1),Y=["disabled"],oe=S({__name:"TransactionForm",emits:["close"],setup(Z,{emit:w}){const o=R(),g=L(),e=l({}),m=l({}),n=l(r.Create),i=l(!1),c=l([]),x=$(()=>{let t;return n.value===r.Create?t="Create New "+f.capitalize(o.params.type):n.value===r.Edit&&(t="Edit "+f.capitalize(e.value.type)),t});B(async()=>{e.value.type=o.params.type,o.path.endsWith("/edit")&&(n.value=r.Edit,C(o.params.id)),n.value===r.Create&&(await T(o.params.id),o.params.type!==q.Discount&&(e.value.amount=Math.abs(m.value.dueBalance)))});const C=async t=>{const{data:a}=await d.get(`/api/transactions/${t}`);e.value=a.data,m.value=a.data.invoice},T=async t=>{const{data:a}=await d.get(`/api/invoices/${t}`);m.value=a.data,e.value.invoiceId=a.data.id},V=async()=>{i.value=!0;try{n.value===r.Create?await k():await N(),W.fire()}catch(t){c.value=t.response.data.errors??{}}i.value=!1},k=async()=>{await d.post("/api/transactions",e.value),p()},N=async()=>{await d.patch(`/api/transactions/${e.value.id}`,e.value),p()},p=()=>{w("close"),g.back()};return(t,a)=>(b(),M(P,null,{header:u(()=>[y(_(E(x)),1)]),body:u(()=>[s("form",{id:"form",onSubmit:A(V,["prevent","stop"])},[s("div",H,[J,h(j,{modelValue:e.value.amount,"onUpdate:modelValue":a[0]||(a[0]=v=>e.value.amount=v),class:F(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":c.value.hasOwnProperty("amount")}])},null,8,["modelValue","class"]),c.value.hasOwnProperty("amount")?(b(),z("p",K,_(c.value.amount[0]),1)):D("",!0)]),s("div",Q,[X,I(s("input",{"onUpdate:modelValue":a[1]||(a[1]=v=>e.value.notes=v),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[U,e.value.notes]])])],40,G)]),footer:u(()=>[s("button",{class:"btn-blue mr-2",disabled:i.value,form:"form"},[h(O,{"is-loading":i.value},{default:u(()=>[y("Save")]),_:1},8,["is-loading"])],8,Y),s("button",{onClick:p,class:"btn-gray"},"Cancel")]),_:1}))}});export{oe as default};
