import{d as H,e as b,x as q,y as j,Q as V,r as K,o as r,c as i,a as x,h as N,v as F,b as e,T as R,g as o,R as W,i as u,w as $,U as Q,V as E,k as O,F as T,W as U,t as h,f as S,X as G,Y as J,Z as L}from"./main-6e47ceb6.js";import{M as X}from"./Master-c2e1e299.js";import{_ as Z}from"./Paginator.vue_vue_type_script_setup_true_lang-161ff6db.js";import{u as ee}from"./urlQueryManager-757a21bf.js";import{i as te}from"./index.es-2384e375.js";import{d as se}from"./datepickerPresets-82697600.js";import{_ as oe}from"./BranchFilter.vue_vue_type_script_setup_true_lang-d104a2b1.js";import{P as z}from"./partnerType-65f9f978.js";import{u as ae,P as M,p as A}from"./websocketPrint-f72594c6.js";import{u as re}from"./printTemplateManager-6e5fdf5a.js";import{A as ne}from"./ActivityLogSidebar-44a5ec42.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./multiselect-27b4da8b.js";const le={class:"flex gap-2 items-center ml-auto"},ie=["onKeyup"],de=["onKeyup"],ce=H({__name:"VisitsFilter",emits:["change"],setup(Y,{emit:D}){const f=new URLSearchParams(location.search),{hasPermissionTo:I}=Q(),_=b(""),v=b(""),n=b(""),p=b(""),l=b([null,null]),k=b([]);q(()=>{c(),C()});const B=j(()=>l.value[0]===null||l.value[1]===null?"":`${l.value[0]}~${l.value[1]}`),c=()=>{_.value=f.get("branchId")??"",v.value=f.get("q")??"",n.value=f.get("visitNumber")??"",p.value=f.get("partnerId")??"",f.get("dateRange")&&(l.value=f.get("dateRange").split("~"))},C=async()=>{if(!I("Partner.list"))return;const{data:a}=await V.get(`/api/partners/list?branchId=${_.value}&type=${z.Lab},${z.Doctor}`);k.value=a.data},w=a=>{p.value=a??"",y()},y=()=>{let a=`branchId=${_.value}&visitNumber=${n.value}&q=${v.value}&partnerId=${p.value}&dateRange=${B.value}&page=1`;D("change",a)},P=()=>{const a=n.value;m(),n.value=a,y()},m=()=>{_.value="",v.value="",n.value="",p.value="",l.value=[null,null]};return(a,s)=>{const g=K("multiselect");return r(),i("div",le,[x(oe,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=t=>_.value=t),onChange:y},null,8,["modelValue"]),N(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>n.value=t),onKeyup:R(P,["enter"]),type:"text",placeholder:"Registration Number",class:"w-56 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,ie),[[F,n.value]]),N(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>v.value=t),onKeyup:R(y,["enter"]),type:"text",placeholder:"Name or phone number",class:"w-56 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,de),[[F,v.value]]),o(I)("Partner.list")?(r(),W(g,{key:0,"model-value":p.value,options:k.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,placeholder:"Select partner",onChange:w,class:"w-56 min-h-[38px] border border-gray-300 !rounded"},null,8,["model-value","options"])):u("",!0),x(o(te),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:o(se),placeholder:"Select date range",value:l.value,"onUpdate:value":s[3]||(s[3]=t=>l.value=t),onChange:y,class:"!w-56","input-class":"w-full p-1.5 border border-gray-300 rounded focus:border-blue-500"},{"icon-calendar":$(()=>[]),_:1},8,["shortcuts","value"])])}}}),ue={class:"flex items-center mb-5"},pe=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"w-4 h-4 mr-1"},[e("path",{d:"M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"})],-1),me=e("span",{class:"font-semibold"},"Create New Visit",-1),he={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},be={class:"w-full"},fe={class:"sticky top-0 z-10 text-left"},_e=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"No.",-1),ye=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Name",-1),ve=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Gender",-1),ge=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Age",-1),we=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Phone",-1),xe=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Lab",-1),ke=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Orders",-1),Ce={key:0,class:"p-2 bg-gray-600 text-center text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},Ve=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Date",-1),$e=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Branch",-1),Ie={key:1,class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},Be={class:"transition even:bg-gray-100"},Pe={class:"p-1 border border-gray-200"},Se={class:"p-1 border border-gray-200 whitespace-nowrap"},Ne={class:"p-1 border border-gray-200"},De={class:"p-1 border border-gray-200 whitespace-nowrap"},Te={class:"p-1 border border-gray-200"},Le={class:"p-1 border border-gray-200 whitespace-nowrap"},Me={class:"p-1 border border-gray-200"},Ae={class:"flex flex-wrap items-center gap-1 max-w-[30rem]"},We={class:"inline-block px-1 bg-teal-500 text-xs text-white font-bold rounded"},Fe={key:0,class:"p-1 border border-gray-200"},Re={class:"flex flex-wrap items-center justify-center gap-1"},Ue=["onClick","onContextmenu","disabled"],ze=["onClick","onContextmenu","disabled"],He=["onClick","onContextmenu","disabled"],qe=["onClick","onContextmenu","disabled"],Ke={class:"p-1 border border-gray-200 whitespace-nowrap"},Qe={class:"p-1 border border-gray-200"},Ye={key:1,class:"py-1 px-2 border border-gray-200 text-center"},je={class:"flex justify-center gap-3"},Ee=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),Oe=["onClick"],Ge=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"w-5 h-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),Je=[Ge],ut=H({__name:"Visits",setup(Y){const{hasDefaultDepWiseBarcodeTemplate:D,hasDefaultSampleWiseBarcodeTemplate:f,hasDefaultInvoiceTemplate:I,hasDefaultVisitBarcodeTemplate:_}=re(),{updateUrlQuery:v}=ee(),{hasPermissionTo:n,hasAnyPermission:p}=Q(),l=ae(),k=b([]),B=b({}),c=b(!1);q(()=>C(location.search));const C=async m=>{const a=await v(m),{data:s}=await V.get(`/api/visits?${a}`);k.value=s.data,B.value=s.meta},w=async(m,a,s=!1)=>{c.value=!0;const{data:g}=await V.post("/api/samples/print",{type:a,visitId:m.id});l.isConnected&&!s?l.submit({type:M.Barcodes,url:"barcode.pdf",file_content:g}):A({printable:g,type:"pdf",base64:!0}),L.fire(),c.value=!1},y=async(m,a=!1)=>{c.value=!0;const{data:s}=await V.post("/api/visits/print-barcode",{visitId:m.id});l.isConnected&&!a?l.submit({type:M.Barcodes,url:"barcode.pdf",file_content:s}):A({printable:s,type:"pdf",base64:!0}),L.fire(),c.value=!1},P=async(m,a=!1)=>{c.value=!0;const{data:s}=await V.post("/api/invoices/print",{invoiceId:m.id});l.isConnected&&!a?l.submit({type:M.Invoices,url:"invoice.pdf",file_content:s}):A({printable:s,type:"pdf",base64:!0}),L.fire(),c.value=!1};return(m,a)=>{const s=K("router-link"),g=E("tip");return r(),i(T,null,[x(X,null,{header:$(()=>[O("Visits")]),body:$(()=>[e("div",ue,[o(n)("Visit.create")?(r(),W(s,{key:0,to:"/visits/create",class:"btn-blue inline-flex items-center"},{default:$(()=>[pe,me]),_:1})):u("",!0),x(ce,{onChange:C})]),e("section",he,[e("table",be,[e("thead",null,[e("tr",fe,[_e,ye,ve,ge,we,xe,ke,o(p)("Invoice.print","Sample.print","Visit.printBarcode")?(r(),i("th",Ce,"Print")):u("",!0),Ve,$e,o(p)("Visit.update","ActivityLog.list")?(r(),i("th",Ie)):u("",!0)])]),e("tbody",null,[(r(!0),i(T,null,U(k.value,t=>(r(),i("tr",Be,[e("td",Pe,h(t.number),1),e("td",Se,h(t.patient.name),1),e("td",Ne,h(t.patient.gender.capitalize()),1),e("td",De,h(t.patient.age),1),e("td",Te,h(t.patient.phoneNumber),1),e("td",Le,h(t.lab?.name??"local"),1),e("td",Me,[e("div",Ae,[(r(!0),i(T,null,U(t.invoice.invoiceItems.filter(d=>d.status!=="canceled"),d=>(r(),i("span",We,h(d.shortForm??d.name),1))),256))])]),o(p)("Invoice.print","Sample.print")?(r(),i("td",Fe,[e("div",Re,[o(n)("Visit.printBarcode")&&o(_)(t.branchId)?(r(),i("button",{key:0,onClick:d=>y(t),onContextmenu:S(d=>y(t,!0),["prevent"]),class:"btn-blue text-sm py-0 px-1 hover:shadow-none",disabled:c.value},"Visit barcode",40,Ue)):u("",!0),o(n)("Sample.print")&&o(D)(t.branchId)?(r(),i("button",{key:1,onClick:d=>w(t,"departmentWise"),onContextmenu:S(d=>w(t,"departmentWise",!0),["prevent"]),class:"btn-blue text-sm py-0 px-1 hover:shadow-none",disabled:c.value},"Dep. wise",40,ze)):u("",!0),o(n)("Sample.print")&&o(f)(t.branchId)?(r(),i("button",{key:2,onClick:d=>w(t,"sampleWise"),onContextmenu:S(d=>w(t,"sampleWise",!0),["prevent"]),class:"btn-blue text-sm py-0 px-1 hover:shadow-none",disabled:c.value},"Sample wise",40,He)):u("",!0),o(n)("Invoice.print")&&o(I)(t.branchId)?(r(),i("button",{key:3,onClick:d=>P(t.invoice),onContextmenu:S(d=>P(t.invoice,!0),["prevent"]),class:"btn-blue text-sm py-0 px-1 hover:shadow-none",disabled:c.value},"Invoice",40,qe)):u("",!0)])])):u("",!0),e("td",Ke,h(t.date),1),e("td",Qe,h(t.branch.name),1),o(p)("Visit.update","ActivityLog.list")?(r(),i("td",Ye,[e("div",je,[o(n)("Visit.update")?N((r(),W(s,{key:0,to:`/visits/${t.id}/edit`,class:"text-orange-500 cursor-pointer"},{default:$(()=>[Ee]),_:2},1032,["to"])),[[g,"Edit"]]):u("",!0),o(n)("ActivityLog.list")?N((r(),i("button",{key:1,onClick:d=>o(G).emit(o(J).Show,t.id),class:"text-gray-600 cursor-pointer"},Je,8,Oe)),[[g,"View Activities"]]):u("",!0)])])):u("",!0)]))),256))])])])]),_:1}),x(Z,{data:B.value,onChange:a[0]||(a[0]=t=>C(`page=${t}`)),class:"mt-3"},null,8,["data"]),x(ne)],64)}}});export{ut as default};
