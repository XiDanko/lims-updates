import{d as D,e as c,x as N,y as U,o as i,c as u,a as v,h as b,v as I,b as e,T as P,a0 as S,g as s,w as L,Q as M,r as z,V as H,t as a,i as f,F as A,W as F,k as Q,R as Y,X as j,Y as E,U as K,a3 as q,Z as W}from"./main-6e47ceb6.js";import{M as O}from"./Master-c2e1e299.js";import{_ as X}from"./Paginator.vue_vue_type_script_setup_true_lang-161ff6db.js";import{u as Z}from"./urlQueryManager-757a21bf.js";import{i as G}from"./index.es-2384e375.js";import{d as J}from"./datepickerPresets-82697600.js";import{_ as ee}from"./BranchFilter.vue_vue_type_script_setup_true_lang-d104a2b1.js";import{T as R}from"./transactionType-ff7c4360.js";import{A as te}from"./ActivityLogSidebar-44a5ec42.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./multiselect-27b4da8b.js";var $=(w=>(w.Received="received",w.Canceled="canceled",w))($||{});const oe={class:"flex gap-2 items-center ml-auto"},se=["onKeyup"],ae=e("option",{value:"",selected:""},"Select type",-1),re=["value"],ne=["value"],le=["value"],ie=e("option",{value:"",selected:""},"Select status",-1),ce=["value"],de=["value"],ue=D({__name:"TransactionsFilter",emits:["change"],setup(w,{emit:k}){const p=new URLSearchParams(location.search),_=c(""),d=c(""),n=c([null,null]),h=c(""),y=c("");N(()=>C());const T=U(()=>n.value[0]===null||n.value[1]===null?"":`${n.value[0]}~${n.value[1]}`),C=()=>{_.value=p.get("branchId")??"",d.value=p.get("invoiceNumber")??"",p.get("dateRange")&&(n.value=p.get("dateRange").split("~")),h.value=p.get("status")??"",y.value=p.get("type")??""},m=()=>{const l=d.value;x(),d.value=l,g()},g=()=>{let l=`branchId=${_.value}&invoiceNumber=${d.value}&type=${y.value}&status=${h.value}&dateRange=${T.value}&page=1`;k("change",l)},x=()=>{_.value="",d.value="",n.value=[null,null],h.value="",y.value=""};return(l,o)=>(i(),u("div",oe,[v(ee,{modelValue:_.value,"onUpdate:modelValue":o[0]||(o[0]=r=>_.value=r),onChange:g},null,8,["modelValue"]),b(e("input",{"onUpdate:modelValue":o[1]||(o[1]=r=>d.value=r),onKeyup:P(m,["enter"]),type:"text",placeholder:"Invoice number",class:"w-56 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,se),[[I,d.value]]),b(e("select",{"onUpdate:modelValue":o[2]||(o[2]=r=>y.value=r),onChange:g,class:"px-2 h-[38px] border border-gray-300 !rounded"},[ae,e("option",{value:s(R).Payment},"Payment",8,re),e("option",{value:s(R).Discount},"Discount",8,ne),e("option",{value:s(R).Refund},"Refund",8,le)],544),[[S,y.value]]),b(e("select",{"onUpdate:modelValue":o[3]||(o[3]=r=>h.value=r),onChange:g,class:"px-2 h-[38px] border border-gray-300 !rounded"},[ie,e("option",{value:s($).Received},"Received",8,ce),e("option",{value:s($).Canceled},"Canceled",8,de)],544),[[S,h.value]]),v(s(G),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:s(J),placeholder:"Select date range",value:n.value,"onUpdate:value":o[4]||(o[4]=r=>n.value=r),onChange:g,class:"!w-56","input-class":"w-full p-1.5 border border-gray-300 rounded focus:border-blue-500"},{"icon-calendar":L(()=>[]),_:1},8,["shortcuts","value"])]))}}),pe={class:"flex justify-between"},_e=e("h1",null,"Transactions",-1),he={class:"text-xl"},ve={class:"text-xl"},ye={class:"text-xl"},me={class:"text-xl"},ge={class:"flex items-center mb-5"},fe={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},be={class:"w-full"},xe={class:"sticky top-0 z-10 text-left"},we=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"User",-1),Ce=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr whitespace-nowrap"},"Invoice No.",-1),Le=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Amount",-1),$e=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Register",-1),ke=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Type",-1),Te=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Status",-1),Ve=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Notes",-1),Re=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Date",-1),Se=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Branch",-1),Me={key:0,class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},ze={class:"transition even:bg-gray-100"},Ae={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},De={class:"py-1 px-2 border border-gray-200"},Ne={class:"py-1 px-2 border border-gray-200"},Be={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},Ue={class:"py-1 px-2 border border-gray-200"},Ie={class:"py-1 px-2 border border-gray-200"},Pe={class:"py-1 px-2 border border-gray-200"},He={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},Fe={class:"py-1 px-2 border border-gray-200"},Qe={key:0,class:"py-1 px-2 border border-gray-200 text-center"},Ye={class:"flex justify-center items-center gap-3"},je=["onClick"],Ee={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512",fill:"currentColor",class:"w-5 h-5 mx-auto text-blue-500 cursor-pointer"},Ke=e("path",{d:"M568.2 336.3c-13.12-17.81-38.14-21.66-55.93-8.469l-119.7 88.17h-120.6c-8.748 0-15.1-7.25-15.1-15.99c0-8.75 7.25-16 15.1-16h78.25c15.1 0 30.75-10.88 33.37-26.62c3.25-20-12.12-37.38-31.62-37.38H191.1c-26.1 0-53.12 9.25-74.12 26.25l-46.5 37.74L15.1 383.1C7.251 383.1 0 391.3 0 400v95.98C0 504.8 7.251 512 15.1 512h346.1c22.03 0 43.92-7.188 61.7-20.27l135.1-99.52C577.5 379.1 581.3 354.1 568.2 336.3zM279.3 175C271.7 173.9 261.7 170.3 252.9 167.1L248 165.4C235.5 160.1 221.8 167.5 217.4 179.1s2.121 26.2 14.59 30.64l4.655 1.656c8.486 3.061 17.88 6.095 27.39 8.312V232c0 13.25 10.73 24 23.98 24s24-10.75 24-24V221.6c25.27-5.723 42.88-21.85 46.1-45.72c8.688-50.05-38.89-63.66-64.42-70.95L288.4 103.1C262.1 95.64 263.6 92.42 264.3 88.31c1.156-6.766 15.3-10.06 32.21-7.391c4.938 .7813 11.37 2.547 19.65 5.422c12.53 4.281 26.21-2.312 30.52-14.84s-2.309-26.19-14.84-30.53c-7.602-2.627-13.92-4.358-19.82-5.721V24c0-13.25-10.75-24-24-24s-23.98 10.75-23.98 24v10.52C238.8 40.23 221.1 56.25 216.1 80.13C208.4 129.6 256.7 143.8 274.9 149.2l6.498 1.875c31.66 9.062 31.15 11.89 30.34 16.64C310.6 174.5 296.5 177.8 279.3 175z"},null,-1),qe=[Ke],We={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"w-5 h-5 mx-auto text-blue-500 cursor-pointer"},Oe=e("path",{d:"M144.6 24.88C137.5 14.24 145.1 0 157.9 0H354.1C366.9 0 374.5 14.24 367.4 24.88L320 96H192L144.6 24.88zM332.1 136.4C389.7 172.7 512 250.9 512 416C512 469 469 512 416 512H96C42.98 512 0 469 0 416C0 250.9 122.3 172.7 179 136.4C183.9 133.3 188.2 130.5 192 128H320C323.8 130.5 328.1 133.3 332.1 136.4V136.4zM336.1 288.1C346.3 279.6 346.3 264.4 336.1 255C327.6 245.7 312.4 245.7 303 255L256 302.1L208.1 255C199.6 245.7 184.4 245.7 175 255C165.7 264.4 165.7 279.6 175 288.1L222.1 336L175 383C165.7 392.4 165.7 407.6 175 416.1C184.4 426.3 199.6 426.3 208.1 416.1L256 369.9L303 416.1C312.4 426.3 327.6 426.3 336.1 416.1C346.3 407.6 346.3 392.4 336.1 383L289.9 336L336.1 288.1z"},null,-1),Xe=[Oe],Ze=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),Ge=["onClick"],Je=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"w-5 h-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),et=[Je],pt=D({__name:"Transactions",setup(w){const k=c([]),p=c({}),_=c(),d=c(),n=c(),h=c(),{updateUrlQuery:y}=Z(),{hasPermissionTo:T,hasAnyPermission:C}=K();N(()=>m(location.search));const m=async x=>{const l=await y(x),{data:o}=await M.get(`/api/transactions?${l}`);k.value=o.data,p.value=o.meta,_.value=o.totalPayments,d.value=o.totalDiscounts,n.value=o.totalRefunds,h.value=o.totalAmount},g=async x=>{const{isConfirmed:l}=await q.fire();l&&(await M.post(`/api/transactions/${x}/toggle-cancellation`),W.fire(),await m(location.search))};return(x,l)=>{const o=z("router-view"),r=z("router-link"),V=H("tip");return i(),u(A,null,[v(o,{onClose:m}),v(O,null,{header:L(()=>[e("div",pe,[_e,e("p",he,"Total: "+a(h.value?.toLocaleString()),1),e("p",ve,"Total Payments: "+a(_.value?.toLocaleString()),1),e("p",ye,"Total Discounts: "+a(d.value?.toLocaleString()),1),e("p",me,"Total Refunds: "+a(n.value?.toLocaleString()),1)])]),body:L(()=>[e("div",ge,[v(ue,{onChange:m})]),e("section",fe,[e("table",be,[e("thead",null,[e("tr",xe,[we,Ce,Le,$e,ke,Te,Ve,Re,Se,s(C)("Transaction.update","Transaction.delete","ActivityLog.list")?(i(),u("th",Me)):f("",!0)])]),e("tbody",null,[(i(!0),u(A,null,F(k.value,t=>(i(),u("tr",ze,[e("td",Ae,a(t.creator?.name),1),e("td",De,[v(r,{class:"text-blue-500 underline",to:`/invoices?branchId=${t.branchId}&number=${t.invoice.number}`},{default:L(()=>[Q(a(t.invoice.number),1)]),_:2},1032,["to"])]),e("td",Ne,a(t.amount.toLocaleString()),1),e("td",Be,a(t.register?t.register.user.name:t.income.register.user.name),1),e("td",Ue,a(t.type.capitalize()),1),e("td",Ie,a(t.status.capitalize()),1),e("td",Pe,a(t.notes),1),e("td",He,a(t.date),1),e("td",Fe,a(t.branch.name),1),s(C)("Transaction.update","Transaction.delete","ActivityLog.list")?(i(),u("td",Qe,[e("div",Ye,[s(T)("Transaction.cancel")?(i(),u("button",{key:0,onClick:B=>g(t.id)},[t.status===s($).Canceled?b((i(),u("svg",Ee,qe)),[[V,"Receive"]]):f("",!0),t.status===s($).Received?b((i(),u("svg",We,Xe)),[[V,"Cancel"]]):f("",!0)],8,je)):f("",!0),s(C)("Transaction.update")?b((i(),Y(r,{key:1,to:`/transactions/${t.id}/edit`,class:"text-orange-500 cursor-pointer"},{default:L(()=>[Ze]),_:2},1032,["to"])),[[V,"Edit"]]):f("",!0),s(T)("ActivityLog.list")?b((i(),u("button",{key:2,onClick:B=>s(j).emit(s(E).Show,t.id),class:"text-gray-600 cursor-pointer"},et,8,Ge)),[[V,"View Activities"]]):f("",!0)])])):f("",!0)]))),256))])])])]),_:1}),v(X,{data:p.value,onChange:l[0]||(l[0]=t=>m(`page=${t}`)),class:"mt-3"},null,8,["data"]),v(te)],64)}}});export{pt as default};
