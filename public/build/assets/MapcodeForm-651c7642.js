import{d as A,u as z,e as d,x as L,Q as u,o as n,R as Q,w as y,k as F,t as i,g as l,b as r,c as p,a as c,n as v,i as m,h as W,v as Z,f as j,_ as G,a9 as H,m as J,l as K,Z as X}from"./main-56f58ed8.js";import{s as _}from"./multiselect-167e14f5.js";import{b as O}from"./toggle-876d3de4.js";import{F as g}from"./formMode-f60a729f.js";const Y=["onSubmit"],ee={class:"grid grid-cols-2 gap-3"},ae={key:0,class:"col-span-2 flex flex-wrap items-start"},re=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),se={key:0,class:"ml-24 w-full text-red-500 text-sm"},te={class:"col-span-2 flex flex-wrap items-start"},oe=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Machine",-1),le={key:0,class:"ml-24 w-full text-red-500 text-sm"},de={class:"col-span-2 flex flex-wrap items-start"},ne=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Test",-1),ce={key:0,class:"ml-24 w-full text-red-500 text-sm"},ue={class:"col-span-2 flex flex-wrap items-start"},ie=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Parameter",-1),pe={key:0,class:"ml-24 w-full text-red-500 text-sm"},me={class:"col-span-2 flex flex-wrap items-center"},be=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Code",-1),ve={key:0,class:"w-full ml-24 text-red-500 text-sm"},he={class:"flex flex-wrap items-start"},fe=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Send",-1),ye={class:"flex flex-wrap items-start"},_e=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Receive",-1),ge=["disabled"],Ce=A({__name:"MapcodeForm",emits:["close"],setup(we,{emit:M}){const b=J(),S=K(),h=z().user.branches,e=d({send:!0,receive:!0}),x=d([]),V=d([]),k=d([]),w=d(g.Create),f=d(!1),s=d({});L(()=>{U(),h.length===1&&(e.value.branchId=h[0].id,I()),b.path.endsWith("/edit")&&(w.value=g.Edit,$(b.params.id))});const U=()=>{e.value.branchId=b.query.branchId,e.value.machineId=b.query.machineId,e.value.code=b.query.code},I=()=>{N(),T()},B=()=>{e.value.machineId=null,e.value.testId=null,e.value.parameterId=null},$=async o=>{const{data:a}=await u.get(`/api/mapcodes/${o}`);e.value=a.data,I(),C(a.data.testId)},N=async()=>{const{data:o}=await u.get(`/api/machines/list?branchId=${e.value.branchId}`);x.value=o.data},T=async()=>{const{data:o}=await u.get(`/api/tests/list?branchId=${e.value.branchId}`);V.value=o.data},C=async o=>{const{data:a}=await u.get(`/api/parameters/list?testId=${o}`);k.value=a.data},D=async()=>{f.value=!0;try{w.value===g.Create?await R():await q(),X.fire()}catch(o){s.value=o.response.data.errors??{}}f.value=!1},R=async()=>{await u.post("/api/mapcodes",e.value),E()},q=async()=>{await u.patch(`/api/mapcodes/${e.value.id}`,e.value),P()},E=()=>{e.value={branchId:e.value.branchId,machineId:e.value.machineId,testId:e.value.testId,send:!0,receive:!0},s.value=[]},P=()=>{M("close"),S.back()};return(o,a)=>(n(),Q(H,null,{header:y(()=>[F(i(w.value===l(g).Create?"Create New Mapcode":"Edit Mapcode"),1)]),body:y(()=>[r("form",{id:"form",onSubmit:j(D,["prevent","stop"])},[r("div",ee,[l(h).length>1?(n(),p("div",ae,[re,c(l(_),{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.branchId=t),options:l(h),onSelect:I,onChange:B,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:v(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),s.value.hasOwnProperty("branchId")?(n(),p("p",se,i(s.value.branchId[0]),1)):m("",!0)])):m("",!0),r("div",te,[oe,c(l(_),{modelValue:e.value.machineId,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.machineId=t),options:x.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-clear":!1,"can-deselect":!1,class:v(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.value.hasOwnProperty("machineId")}])},null,8,["modelValue","options","class"]),s.value.hasOwnProperty("machineId")?(n(),p("p",le,i(s.value.machineId[0]),1)):m("",!0)]),r("div",de,[ne,c(l(_),{modelValue:e.value.testId,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.testId=t),options:V.value,onSelect:C,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm","can-clear":!1,"can-deselect":!1,class:v(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.value.hasOwnProperty("testId")}])},null,8,["modelValue","options","class"]),s.value.hasOwnProperty("testId")?(n(),p("p",ce,i(s.value.testId[0]),1)):m("",!0)]),r("div",ue,[ie,c(l(_),{modelValue:e.value.parameterId,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.parameterId=t),options:k.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm",class:v(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.value.hasOwnProperty("parameterId")}])},null,8,["modelValue","options","class"]),s.value.hasOwnProperty("parameterId")?(n(),p("p",pe,i(s.value.parameterId[0]),1)):m("",!0)]),r("div",me,[be,W(r("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.code=t),class:v(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.value.hasOwnProperty("code")}])},null,2),[[Z,e.value.code]]),s.value.hasOwnProperty("code")?(n(),p("p",ve,i(s.value.code[0]),1)):m("",!0)]),r("div",he,[fe,c(l(O),{modelValue:e.value.send,"onUpdate:modelValue":a[5]||(a[5]=t=>e.value.send=t),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])]),r("div",ye,[_e,c(l(O),{modelValue:e.value.receive,"onUpdate:modelValue":a[6]||(a[6]=t=>e.value.receive=t),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])])])],40,Y)]),footer:y(()=>[r("button",{class:"btn-blue mr-2",disabled:f.value,form:"form"},[c(G,{"is-loading":f.value},{default:y(()=>[F("Save")]),_:1},8,["is-loading"])],8,ge),r("button",{onClick:P,class:"btn-gray"},"Cancel")]),_:1}))}});export{Ce as default};
