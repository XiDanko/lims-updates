import{d as E,e as u,u as A,x as R,Q as h,o,R as k,w as f,k as C,t as c,g as l,b as t,c as i,a as g,n as y,i as d,h as I,v as M,f as T,_ as j,a9 as q,m as z,l as L,Z as Q}from"./main-6e47ceb6.js";import{b as W}from"./toggle-b1a111c5.js";import{s as O}from"./multiselect-27b4da8b.js";import{F as m}from"./formMode-f60a729f.js";const Z=["onSubmit"],G={key:0,class:"flex flex-wrap items-center mb-3"},H=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),J={key:0,class:"ml-28 w-full text-red-500 text-sm"},K={class:"flex flex-wrap items-center mb-3"},X=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Code",-1),Y={key:0,class:"w-full ml-28 text-red-500 text-sm"},ee={class:"flex flex-wrap items-center mb-3"},ae=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Name",-1),re={key:0,class:"w-full ml-28 text-red-500 text-sm"},te={class:"flex flex-wrap items-start"},se=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Departments",-1),oe={key:0,class:"ml-28 w-full text-red-500 text-sm"},le=["disabled"],me=E({__name:"MachineForm",emits:["close"],setup(ne,{emit:P}){const w=z(),F=L(),e=u({}),x=u([]),p=A().user.branches,b=u(m.Create),v=u(!1),a=u({});R(()=>{p.length===1&&(e.value.branchId=p[0].id,_()),w.path.endsWith("/edit")&&(b.value=m.Edit,N(w.params.id)),S()});const S=()=>{e.value.code=w.query.code??""},_=async()=>{const{data:n}=await h.get(`/api/departments/list?branchId=${e.value.branchId}`);x.value=n.data},N=async n=>{const{data:r}=await h.get(`/api/machines/${n}`);e.value=r.data,_()},U=async()=>{v.value=!0;try{b.value===m.Create?await $():await B(),Q.fire()}catch(n){a.value=n.response.data.errors??{}}v.value=!1},$=async()=>{await h.post("/api/machines",e.value),D()},B=async()=>{await h.patch(`/api/machines/${e.value.id}`,e.value),V()},D=()=>{e.value={branchId:e.value.branchId},a.value=[]},V=()=>{P("close"),F.back()};return(n,r)=>(o(),k(q,null,{header:f(()=>[C(c(b.value===l(m).Create?"Create New Machine":"Edit Machine"),1)]),body:f(()=>[t("form",{id:"form",onSubmit:T(U,["prevent","stop"])},[l(p).length>1?(o(),i("div",G,[H,g(l(O),{modelValue:e.value.branchId,"onUpdate:modelValue":r[0]||(r[0]=s=>e.value.branchId=s),options:l(p),onSelect:_,onChange:r[1]||(r[1]=s=>e.value.departments=[]),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-clear":!1,"can-deselect":!1,class:y(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("branchId")?(o(),i("p",J,c(a.value.branchId[0]),1)):d("",!0)])):d("",!0),t("div",K,[X,I(t("input",{"onUpdate:modelValue":r[2]||(r[2]=s=>e.value.code=s),class:y(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("code")}])},null,2),[[M,e.value.code]]),a.value.hasOwnProperty("code")?(o(),i("p",Y,c(a.value.code[0]),1)):d("",!0)]),t("div",ee,[ae,I(t("input",{"onUpdate:modelValue":r[3]||(r[3]=s=>e.value.name=s),class:y(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("name")}])},null,2),[[M,e.value.name]]),a.value.hasOwnProperty("name")?(o(),i("p",re,c(a.value.name[0]),1)):d("",!0)]),t("div",te,[se,g(l(O),{modelValue:e.value.departments,"onUpdate:modelValue":r[4]||(r[4]=s=>e.value.departments=s),mode:"tags",options:x.value,searchable:!0,object:!0,"value-prop":"id","track-by":"searchableForm",label:"name",class:y(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("departments")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("departments")?(o(),i("p",oe,c(a.value.departments[0]),1)):d("",!0)])],40,Z)]),footer:f(()=>[t("button",{class:"btn-blue mr-2",disabled:v.value,form:"form"},[g(j,{"is-loading":v.value},{default:f(()=>[C("Save")]),_:1},8,["is-loading"])],8,le),t("button",{onClick:V,class:"btn-gray"},"Cancel"),b.value===l(m).Edit?(o(),k(l(W),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":r[5]||(r[5]=s=>e.value.isActive=s),class:"ml-auto toggle:off:red"},null,8,["modelValue"])):d("",!0)]),_:1}))}});export{me as default};
