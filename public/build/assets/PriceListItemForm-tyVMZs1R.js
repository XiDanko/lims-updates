import{d as M,u as R,e as n,x as A,Q as u,o as c,R as j,w as p,k as g,t as i,g as I,b as s,c as m,a as d,i as v,n as o,f as z,_ as H,a4 as Q,m as W,l as q,$ as G}from"./main-BgbWFIXK.js";import{s as k}from"./multiselect-DeMhawmc.js";import{_ as C}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-CacBtO8k.js";import{F as b}from"./formMode-Bz--3d4P.js";import{_ as J}from"./BranchSelect.vue_vue_type_script_setup_true_lang-ChkyAztq.js";const K={key:0,class:"relative"},X={class:"relative"},Y={key:0,class:"text-sm text-red-500"},Z={class:"relative"},ee={class:"flex w-full items-center justify-between"},te={class:"rounded bg-teal-500 px-2 text-sm text-white"},ae={key:0,class:"text-sm text-red-500"},se={class:"relative"},le={key:0,class:"text-sm text-red-500"},re={class:"relative"},oe={key:0,class:"text-sm text-red-500"},ie=["disabled"],ve=M({__name:"PriceListItemForm",emits:["close"],setup(ne,{emit:O}){const $=O,V=W(),S=q(),_=R().user.branches,e=n({discount:0}),h=n([]),f=n(b.Create),y=n(!1),t=n({}),P=n([]);A(()=>{_.length===1&&(e.value.branchId=_[0].id,w()),V.path.endsWith("/edit")&&(f.value=b.Edit,T(V.params.id))});const w=async()=>{const{data:r}=await u.get(`/api/price-lists/list?branchId=${e.value.branchId}`);P.value=r.data},x=async()=>{let r=`/api/items/list?branchId=${e.value.branchId}`;f.value===b.Create&&(r+=`&doesntHavePrice=${e.value.priceListId}`);const{data:a}=await u.get(r);h.value=a.data},T=async r=>{const{data:a}=await u.get(`/api/price-list-items/${r}`);e.value=a.data,w(),x()},B=()=>{e.value.priceListId=null,e.value.itemId=null,h.value=[]},N=r=>{e.value.itemType=h.value.find(a=>a.id===r).type},U=async()=>{y.value=!0;try{f.value===b.Create?await F():await D(),t.value={},G.fire()}catch(r){t.value=r.response.data.errors??{}}y.value=!1},F=async()=>{await u.post("/api/price-list-items",e.value),E()},D=async()=>{await u.patch(`/api/price-list-items/${e.value.id}`,e.value),L()},E=()=>{e.value={branchId:e.value.branchId,priceListId:e.value.priceListId,itemType:e.value.itemType,discount:0},x(),t.value=[]},L=()=>{$("close"),S.back()};return(r,a)=>(c(),j(Q,null,{header:p(()=>[g(i(f.value===I(b).Create?"Create New Item":"Edit Item"),1)]),body:p(()=>[s("form",{id:"form",onSubmit:z(U,["prevent","stop"]),class:"grid grid-cols-1 gap-4"},[I(_).length>1?(c(),m("div",K,[d(J,{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.branchId=l),error:t.value.branchId,onSelect:w,onChange:B},null,8,["modelValue","error"])])):v("",!0),s("div",X,[d(I(k),{modelValue:e.value.priceListId,"onUpdate:modelValue":a[1]||(a[1]=l=>e.value.priceListId=l),onSelect:x,options:P.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:o(["input peer",{"border-red-500":t.value.hasOwnProperty("priceListId")}])},null,8,["modelValue","options","class"]),s("label",{class:o(["label",{"text-red-500":t.value.hasOwnProperty("priceListId")}])},"Price List",2),t.value.hasOwnProperty("priceListId")?(c(),m("p",Y,i(t.value.priceListId[0]),1)):v("",!0)]),s("div",Z,[d(I(k),{modelValue:e.value.itemId,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.itemId=l),options:h.value,onSelect:N,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"label",class:o(["input peer",{"border-red-500":t.value.hasOwnProperty("itemId")}])},{option:p(({option:l})=>[s("div",ee,[s("span",null,i(l.label),1),s("span",te,i(l.type),1)])]),_:1},8,["modelValue","options","class"]),s("label",{class:o(["label",{"text-red-500":t.value.hasOwnProperty("itemId")}])},"Item",2),t.value.hasOwnProperty("itemId")?(c(),m("p",ae,i(t.value.itemId[0]),1)):v("",!0)]),s("div",se,[d(C,{modelValue:e.value.price,"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.price=l),class:o(["input peer",{"border-red-500":t.value.hasOwnProperty("price")}])},null,8,["modelValue","class"]),s("label",{class:o(["label",{"text-red-500":t.value.hasOwnProperty("price")}])},"Price",2),t.value.hasOwnProperty("price")?(c(),m("p",le,i(t.value.price[0]),1)):v("",!0)]),s("div",re,[d(C,{modelValue:e.value.discount,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.discount=l),class:o(["input peer",{"border-red-500":t.value.hasOwnProperty("discount")}])},null,8,["modelValue","class"]),s("label",{class:o(["label",{"text-red-500":t.value.hasOwnProperty("discount")}])},"Discount",2),t.value.hasOwnProperty("discount")?(c(),m("p",oe,i(t.value.discount[0]),1)):v("",!0)])],32)]),footer:p(()=>[s("button",{class:"me-2 btn-blue",disabled:y.value,form:"form"},[d(H,{"is-loading":y.value},{default:p(()=>[g("Save")]),_:1},8,["is-loading"])],8,ie),s("button",{onClick:L,class:"btn-gray"},"Cancel")]),_:1}))}});export{ve as default};
