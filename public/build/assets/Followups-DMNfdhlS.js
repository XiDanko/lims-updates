import{d as K,e as g,x as O,y as Z,Q as G,o,c as r,b as e,a as y,h as p,v as T,a0 as H,g as d,i as v,V as q,F as k,a1 as V,w as R,T as X,t as l,r as Q,U as J,k as I,n as j,R as U,a2 as Y,a3 as ee,X as te,Y as se,a5 as ae}from"./main-DmoZ1fz4.js";import{M as oe}from"./Master-ql31p3jM.js";import{_ as re}from"./Paginator.vue_vue_type_script_setup_true_lang-B5QeFegy.js";import{u as ne}from"./urlQueryManager-DRfC3SWK.js";import{i as le}from"./index.es-CV7LqIVy.js";import{d as de}from"./datepickerPresets-DxjH1h4T.js";import{s as ie}from"./multiselect-DAhRltj6.js";import{_ as ce}from"./BarcodeScanner.vue_vue_type_script_setup_true_lang-Bp73aGqL.js";import{_ as ue}from"./BranchFilter.vue_vue_type_script_setup_true_lang-DPeXwSCL.js";import{P}from"./patientCallStatus-BmrBIbQr.js";import{O as E}from"./orderStatus-Cdywi7Or.js";import{_ as pe,R as W}from"./ResultsReleaseModal.vue_vue_type_script_setup_true_lang-J-WMZ1g6.js";import{A as he}from"./ActivityLogSidebar-BgD4pgwD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./printService-Dt_6MRJ2.js";import"./toggle-DyRQkDOQ.js";import"./printTemplateType-BiK7zB0k.js";var B=($=>($.Pending="pending",$.Trying="trying",$.Succeeded="succeeded",$.Failed="failed",$))(B||{});const _e={class:"flex flex-wrap items-center gap-2 ms-auto"},ge={class:"relative flex-1 min-w-[10rem]"},be=e("label",{class:"label"},"Registration Number",-1),me={class:"relative flex-1 min-w-[11rem]"},ye=e("label",{class:"label"},"Name / Phone Number",-1),ve={key:0,class:"relative flex-1 min-w-[10rem]"},fe=e("label",{class:"label"},"Partner",-1),we={class:"relative flex-1 min-w-[10rem]"},xe=e("option",{value:""},"All",-1),ke=["value"],$e=e("label",{class:"label"},"Message Status",-1),Ce={class:"relative flex-1 min-w-[10rem]"},Se=e("option",{value:""},"All",-1),Me=["value"],Re=["value"],Be=["value"],Pe=e("label",{class:"label"},"Call Status",-1),Ve={class:"relative flex-1 min-w-[14rem]"},Ne=e("label",{class:"label"},"Date",-1),Fe=K({__name:"FollowupsFilter",emits:["change"],setup($,{emit:N}){const C=N,h=new URLSearchParams(location.search),{hasPermissionTo:F}=X(),i=g(""),f=g(""),_=g(""),c=g([null,null]),S=g(""),M=g(""),w=g(""),A=g([]);O(()=>{b(),L()});const z=Z(()=>c.value[0]===null||c.value[1]===null?"":`${c.value[0]}~${c.value[1]}`),L=async()=>{if(!F("Partner.list"))return;const{data:a}=await G.get(`/api/partners/list?branchId=${i.value}`);A.value=a.data},D=a=>{S.value=a??"",u()},s=a=>{_.value=a,u()},b=()=>{i.value=h.get("branchId")??"",f.value=h.get("q")??"",_.value=h.get("visitNumber")??"",h.get("dateRange")&&(c.value=h.get("dateRange").split("~")),S.value=h.get("partnerId")??"",M.value=h.get("callStatus")??"",w.value=h.get("messageStatus")??""},x=()=>{const a=_.value;m(),_.value=a,u()},u=()=>{let a=`branchId=${i.value}&visitNumber=${_.value}&q=${f.value}&partnerId=${S.value}&messageStatus=${w.value}&callStatus=${M.value}&dateRange=${z.value}&page=1`;C("change",a)},m=()=>{i.value="",f.value="",_.value="",c.value=[null,null],S.value="",M.value="",w.value=""};return(a,t)=>(o(),r(k,null,[e("div",_e,[y(ue,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=n=>i.value=n),onChange:t[1]||(t[1]=n=>{u(),L()})},null,8,["modelValue"]),e("div",ge,[p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>_.value=n),onKeyup:H(x,["enter"]),type:"text",class:"input-sm peer"},null,544),[[T,_.value]]),be]),e("div",me,[p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>f.value=n),onKeyup:H(u,["enter"]),type:"text",class:"input-sm peer"},null,544),[[T,f.value]]),ye]),d(F)("Partner.list")?(o(),r("div",ve,[y(d(ie),{"model-value":S.value,options:A.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,onChange:D,class:"input-sm peer"},null,8,["model-value","options"]),fe])):v("",!0),e("div",we,[p(e("select",{"onUpdate:modelValue":t[4]||(t[4]=n=>w.value=n),onChange:u,class:"input-sm peer"},[xe,(o(!0),r(k,null,V(d(B),n=>(o(),r("option",{value:n},l(n.startCase()),9,ke))),256))],544),[[q,w.value]]),$e]),e("div",Ce,[p(e("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>M.value=n),onChange:u,class:"input-sm peer"},[Se,e("option",{value:d(P).Pending},"Pending",8,Me),e("option",{value:d(P).Answered},"Answered",8,Re),e("option",{value:d(P).NoAnswer},"No Answer",8,Be)],544),[[q,M.value]]),Pe]),e("div",Ve,[y(d(le),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:d(de),value:c.value,"onUpdate:value":t[6]||(t[6]=n=>c.value=n),onChange:u,class:"w-full peer","input-class":"input-sm pt-0.5"},{"icon-calendar":R(()=>[]),_:1},8,["shortcuts","value"]),Ne])]),y(ce,{onScan:s})],64))}}),Ae={class:"mb-5 flex items-start gap-1"},Le={class:"pe-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},ze={class:"w-full"},De={class:"sticky top-0 z-10 text-left"},Ie=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},null,-1),je=e("th",{class:"whitespace-nowrap bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Phone Number",-1),Ue=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Names",-1),Te=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Visits",-1),He=e("th",{class:"bg-gray-600 p-2 text-center font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Status",-1),qe=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Notes",-1),Qe=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Date",-1),Ye=e("th",{class:"whitespace-nowrap bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Previous Followup",-1),Ee=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Branch",-1),We={key:0,class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},Ke={class:"transition hover:bg-gray-100"},Oe=["onClick"],Ge={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"mx-auto h-6 w-6"},Xe=e("path",{"fill-rule":"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z","clip-rule":"evenodd"},null,-1),Ze=[Xe],Je={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"mx-auto h-6 w-6"},et=e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z","clip-rule":"evenodd"},null,-1),tt=[et],st={class:"border border-gray-200 px-2 py-1"},at={class:"border border-gray-200 px-2 py-1"},ot={class:"flex flex-wrap items-center gap-1"},rt={class:"rounded bg-teal-500 p-1 text-xs font-bold text-white"},nt={class:"border border-gray-200 px-2 py-1 text-center"},lt={class:"border border-gray-200 px-2 py-1 text-center"},dt={class:"border border-gray-200 px-2 py-1 text-sm max-w-[10rem]"},it={class:"whitespace-nowrap border border-gray-200 px-2 py-1"},ct={class:"whitespace-nowrap border border-gray-200 px-2 py-1"},ut={class:"border border-gray-200 px-2 py-1"},pt={class:"border border-gray-200 px-2 py-1 text-center"},ht={key:0,class:"flex justify-center gap-3"},_t={class:"h-6 w-6 cursor-pointer text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},gt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"},null,-1),bt=[gt],mt=["onClick"],yt=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),vt=[yt],ft={key:0},wt={colspan:"100%",class:"border border-gray-200 p-2"},xt={class:"w-full"},kt=e("thead",null,[e("tr",{class:"sticky z-10 text-left top-[39px]"},[e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"No."),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"name"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Gender"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Age"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Phone Number"),e("th",{class:"whitespace-nowrap border border-gray-200 bg-gray-200 p-2 font-semibold"},"Contact Method"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Lab"),e("th",{class:"whitespace-nowrap border border-gray-200 bg-gray-200 p-2 font-semibold"},"Due Balance"),e("th",{class:"whitespace-nowrap border border-gray-200 bg-gray-200 p-2 font-semibold"},"Message Status"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"},"Date"),e("th",{class:"border border-gray-200 bg-gray-200 p-2 font-semibold"})])],-1),$t={class:"transition hover:bg-gray-50"},Ct={class:"border border-gray-200 p-1"},St={class:"whitespace-nowrap border border-gray-200 p-1"},Mt={class:"border border-gray-200 p-1"},Rt={class:"whitespace-nowrap border border-gray-200 p-1"},Bt={class:"border border-gray-200 p-1"},Pt={class:"whitespace-nowrap border border-gray-200 p-1"},Vt={class:"whitespace-nowrap border border-gray-200 p-1"},Nt={key:1},Ft={class:"border border-gray-200 p-1"},At={class:"flex flex-wrap items-center gap-1 max-w-[15rem]"},Lt={class:"whitespace-nowrap border border-gray-200 p-1"},zt={class:"border border-gray-200 p-1 text-center"},Dt={class:"flex justify-center gap-1"},It={class:"h-6 w-6 cursor-pointer text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},jt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"},null,-1),Ut=[jt],Tt=["onClick"],Ht=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"},null,-1),qt=[Ht],Qt=["onClick"],Yt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1),Et=[Yt],Wt=["href"],Kt={class:"h-6 w-6 cursor-pointer text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ot=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1),Gt=[Ot],_s=K({__name:"Followups",setup($){const N=g([]),C=g(new Set),h=g({}),{updateUrlQuery:F}=ne(),{hasPermissionTo:i,hasAnyPermission:f}=X();O(()=>c(location.search));const _=s=>te().data.whatsapp?.find(b=>b.branchId===s),c=async s=>{const b=await F(s),{data:x}=await G.get(`/api/followups?${b}`);N.value=x.data,h.value=x.meta},S=s=>!(!i("Result.print")||s.invoice.dueBalance>0&&!i("Result.printDue")),M=s=>!(s.patient.contactMethod!=="whatsapp"||!i("Result.send")||s.invoice.dueBalance>0&&!i("Result.sendDue")),w=async(s,b)=>{if(s.invoice.dueBalance>0){const{isConfirmed:x}=await se.fire({html:`Patient has due balance of ${s.invoice.dueBalance?.toLocaleString()}`});if(!x)return}Y.emit(ae.Show,{visit:s,orders:s.orders,releaseType:b})},A=s=>`https://api.whatsapp.com/send?phone=${s.patient.phoneNumber.replace("0","964")}&text=${_(s.branchId)?.welcomeMessage??""}`,z=s=>{if(s.status===E.Rejected)return"bg-orange-500 text-white";if(s.test.bypass&&!s.selectedResult)return"bg-blue-500 text-white";if(s.selectedResult.messageStatus===B.Succeeded)return"bg-emerald-500 text-white";if(s.selectedResult.messageStatus===B.Trying)return"bg-amber-500 text-black";if(s.selectedResult.messageStatus===B.Pending)return"bg-gray-300 text-black";if(s.selectedResult.messageStatus===B.Failed)return"bg-red-500 text-white"},L=s=>s.status===E.Rejected?"rejected":s.test.bypass&&!s.selectedResult?"bypass":s.selectedResult.messageStatus,D=s=>{if(s===P.Pending)return"bg-gray-300 text-black";if(s===P.Answered)return"bg-emerald-500 text-white";if(s===P.NoAnswer)return"bg-red-500 text-white"};return(s,b)=>{const x=Q("router-view"),u=Q("router-link"),m=J("tip");return o(),r(k,null,[y(x,{onClose:c}),y(oe,null,{header:R(()=>[I("Patients Followup")]),body:R(()=>[e("div",Ae,[y(Fe,{onChange:c})]),e("section",Le,[e("table",ze,[e("thead",null,[e("tr",De,[Ie,je,Ue,Te,He,qe,Qe,Ye,Ee,d(f)("Followup.update","ActivityLog.list")?(o(),r("th",We)):v("",!0)])]),(o(!0),r(k,null,V(N.value,a=>(o(),r("tbody",null,[e("tr",Ke,[e("td",{class:"w-12 cursor-pointer border border-gray-200 py-1",onClick:t=>C.value.has(a.id)?C.value.delete(a.id):C.value.add(a.id)},[C.value.has(a.id)?(o(),r("svg",Je,tt)):(o(),r("svg",Ge,Ze))],8,Oe),e("td",st,l(a.phoneNumber),1),e("td",at,[e("div",ot,[(o(!0),r(k,null,V(a.patients,t=>(o(),r("span",rt,l(t.name),1))),256))])]),e("td",nt,l(a.visits.length),1),e("td",lt,[e("span",{class:j(["whitespace-nowrap rounded px-1 text-xs",D(a.callStatus)])},l(a.callStatus.startCase()),3)]),e("td",dt,l(a.callNotes),1),e("td",it,l(a.date),1),e("td",ct,l(a.previousDate),1),e("td",ut,l(a.branch.name),1),e("td",pt,[d(f)("Followup.update","ActivityLog.list")?(o(),r("div",ht,[d(i)("Followup.update")?(o(),U(u,{key:0,to:`/followups/${a.id}`},{default:R(()=>[p((o(),r("svg",_t,bt)),[[m,"Call"]])]),_:2},1032,["to"])):v("",!0),d(i)("ActivityLog.list")?p((o(),r("button",{key:1,onClick:t=>d(Y).emit(d(ee).Show,a.id),class:"cursor-pointer text-gray-600"},vt,8,mt)),[[m,"View Activities"]]):v("",!0)])):v("",!0)])]),C.value.has(a.id)?(o(),r("tr",ft,[e("td",wt,[e("table",xt,[kt,e("tbody",null,[(o(!0),r(k,null,V(a.visits,t=>(o(),r("tr",$t,[e("td",Ct,l(t.number),1),e("td",St,l(t.patient.name),1),e("td",Mt,l(t.patient.gender.capitalize()),1),e("td",Rt,l(t.patient.age),1),e("td",Bt,l(t.patient.phoneNumber),1),e("td",Pt,l(t.patient.contactMethod),1),e("td",Vt,l(t.lab?.name??"local"),1),e("td",{class:j(["border border-gray-200 p-1",{"font-semibold text-red-500":t.invoice.dueBalance>0}])},[d(i)("Invoice.pay")&&t.invoice.dueBalance>0?p((o(),U(u,{key:0,class:"underline",to:`/invoices/${t.invoice.id}/transactions/payment/create`},{default:R(()=>[I(l(t.invoice.dueBalance?.toLocaleString()),1)]),_:2},1032,["to"])),[[m,"Create Payment"]]):(o(),r("span",Nt,l(t.invoice.dueBalance?.toLocaleString()),1))],2),e("td",Ft,[e("div",At,[(o(!0),r(k,null,V(t.orders,n=>p((o(),r("span",{class:j(["cursor-pointer rounded px-1 text-xs",z(n)])},[I(l(n.test.shortForm),1)],2)),[[m,L(n).capitalize()]])),256))])]),e("td",Lt,l(t.date),1),e("td",zt,[e("div",Dt,[d(i)("ResultEntry.show")?(o(),U(u,{key:0,to:`/results-entry?visitId=${t.id}`},{default:R(()=>[p((o(),r("svg",It,Ut)),[[m,"View Results"]])]),_:2},1032,["to"])):v("",!0),S(t)?p((o(),r("svg",{key:1,class:"h-6 w-6 cursor-pointer text-blue-500",onClick:n=>w(t,d(W).Print),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},qt,8,Tt)),[[m,"Print"]]):v("",!0),M(t)?(o(),r(k,{key:2},[_(t.branchId)?.enabled?p((o(),r("svg",{key:0,class:"h-6 w-6 cursor-pointer text-blue-500",onClick:n=>w(t,d(W).Send),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Et,8,Qt)),[[m,"Send"]]):(o(),r("a",{key:1,href:A(t),target:"_blank"},[p((o(),r("svg",Kt,Gt)),[[m,"Send"]])],8,Wt))],64)):v("",!0)])])]))),256))])])])])):v("",!0)]))),256))])])]),_:1}),y(re,{data:h.value,onChange:b[0]||(b[0]=a=>c(`page=${a}`)),class:"mt-3"},null,8,["data"]),y(pe,{onClose:c}),y(he)],64)}}});export{_s as default};
