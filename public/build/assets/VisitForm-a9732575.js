import{d as S,y as R,e as I,I as q,o as p,c as m,b as e,a as V,g as r,n as C,t as _,i as h,A as k,H as j,B as J,h as b,J as Y,v as y,K as H,L as se,u as oe,x as le,q as ne,C as E,w as B,k as W,_ as de,m as ie,l as ue,M as ce,T as be,S as G}from"./main-c1f62c61.js";import{M as pe}from"./Master-77a73046.js";import{s as F}from"./multiselect-ffe70d49.js";import{b as K}from"./toggle-b89396fa.js";import{_ as me}from"./Autocomplete.vue_vue_type_script_setup_true_lang-4df21e04.js";import{F as N}from"./formMode-f60a729f.js";import{G as A}from"./gender-fe0bd233.js";import{_ as fe,u as ve}from"./Invoice.vue_vue_type_script_setup_true_lang-6a0e73d3.js";import{I as L}from"./invoiceStatus-af715b0d.js";import{_ as he}from"./VisitPrintToggles.vue_vue_type_script_setup_true_lang-0c32b58d.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./CurrencyInput.vue_vue_type_script_setup_true_lang-0c3f56bb.js";import"./itemType-8f96b3f7.js";import"./orderStatus-e3a3f9a7.js";import"./printTemplateManager-4195074d.js";import"./websocketPrint-85d5f8b4.js";const ge={class:"grid grid-cols-3 gap-2"},ye=e("h1",{class:"col-span-3 font-bold underline text-lg"},"Reference Information",-1),xe={class:"flex flex-wrap items-start"},Ie=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Lab",-1),Ve={key:0,class:"w-full text-red-500 text-sm"},we={class:"flex flex-wrap items-start"},_e=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Center",-1),$e={key:0,class:"w-full text-red-500 text-sm"},Ce={class:"flex flex-wrap items-start"},Me=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Doctor",-1),ke={key:0,class:"w-full text-red-500 text-sm"},Ue={class:"flex flex-wrap items-start"},Pe=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Home Visit",-1),Ne={key:0,class:"w-full text-red-500 text-sm"},De={key:0,class:"flex flex-wrap items-start"},Oe=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Collector",-1),ze={key:0,class:"w-full text-red-500 text-sm"},Se=S({__name:"ReferenceInfo",props:{modelValue:null,errors:null},emits:["update:modelValue"],setup(s,{emit:w}){const $=s,{hasPermissionTo:t}=j(),n=R({get:()=>$.modelValue,set:g=>w("update:modelValue",g)}),o=I([]),a=I([]),l=I([]),i=I([]),x=()=>{u(),D(),T(),M()},u=async()=>{const{data:g}=await k.get(`/api/labs/list?branchId=${n.value.branchId}`);o.value=g.data},D=async()=>{const{data:g}=await k.get(`/api/reference-centers/list?branchId=${n.value.branchId}`);a.value=g.data},T=async()=>{const{data:g}=await k.get(`/api/reference-doctors/list?branchId=${n.value.branchId}`);l.value=g.data},M=async()=>{const{data:g}=await k.get(`/api/reference-doctors/list?branchId=${n.value.branchId}`);i.value=g.data},z=async({name:g})=>{const{data:f}=await k.post("/api/labs",{branchId:n.value.branchId,name:g});return o.value.push(f.data),f.data},U=async({name:g})=>{const{data:f}=await k.post("/api/reference-centers",{branchId:n.value.branchId,name:g});return a.value.push(f.data),f.data},O=async({name:g})=>{const{data:f}=await k.post("/api/reference-doctors",{branchId:n.value.branchId,name:g,referenceCenterId:n.value.referenceCenterId});return l.value.push(f.data),f.data};return q(()=>n.value.branchId,()=>{x()}),(g,f)=>(p(),m("div",ge,[ye,e("div",xe,[Ie,V(r(F),{modelValue:r(n).labId,"onUpdate:modelValue":f[0]||(f[0]=P=>r(n).labId=P),options:o.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(t)("Lab.create"),"on-create":z,class:C(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("labId")}])},null,8,["modelValue","options","create-option","class"]),s.errors.hasOwnProperty("labId")?(p(),m("p",Ve,_(s.errors.labId[0]),1)):h("",!0)]),e("div",we,[_e,V(r(F),{modelValue:r(n).referenceCenterId,"onUpdate:modelValue":f[1]||(f[1]=P=>r(n).referenceCenterId=P),options:a.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(t)("ReferenceCenter.create"),"on-create":U,class:C(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("referenceCenterId")}])},null,8,["modelValue","options","create-option","class"]),s.errors.hasOwnProperty("referenceCenterId")?(p(),m("p",$e,_(s.errors.referenceCenterId[0]),1)):h("",!0)]),e("div",Ce,[Me,V(r(F),{modelValue:r(n).referenceDoctorId,"onUpdate:modelValue":f[2]||(f[2]=P=>r(n).referenceDoctorId=P),options:l.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(t)("ReferenceDoctor.create"),"on-create":O,class:C(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("referenceDoctorId")}])},null,8,["modelValue","options","create-option","class"]),s.errors.hasOwnProperty("referenceDoctorId")?(p(),m("p",ke,_(s.errors.referenceDoctorId[0]),1)):h("",!0)]),e("div",Ue,[Pe,V(r(K),{modelValue:r(n).isHomeVisit,"onUpdate:modelValue":f[3]||(f[3]=P=>r(n).isHomeVisit=P),"on-label":"Yes","off-label":"No",class:C(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("isHomeVisit")}])},null,8,["modelValue","class"]),s.errors.hasOwnProperty("isHomeVisit")?(p(),m("p",Ne,_(s.errors.isHomeVisit[0]),1)):h("",!0)]),r(n).isHomeVisit?(p(),m("div",De,[Oe,V(r(F),{modelValue:r(n).collectorId,"onUpdate:modelValue":f[4]||(f[4]=P=>r(n).collectorId=P),options:i.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name",class:C(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("collectorId")}])},null,8,["modelValue","options","class"]),s.errors.hasOwnProperty("collectorId")?(p(),m("p",ze,_(s.errors.collectorId[0]),1)):h("",!0)])):h("",!0)]))}}),He={class:"grid grid-cols-12 gap-2"},Fe=e("h1",{class:"col-span-12 font-bold underline text-lg"},"Patient Information",-1),Re={class:"col-span-4 flex flex-wrap items-start"},Te=e("option",{value:"Mr."},"Mr.",-1),Be=e("option",{value:"Ms."},"Ms.",-1),Le=[Te,Be],Ye={key:0,class:"w-full text-red-500 text-sm"},Ae={class:"col-span-3 flex flex-wrap items-start"},Ee=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Gender",-1),We=e("option",{value:"male"},"Male",-1),Ge=e("option",{value:"female"},"Female",-1),qe=[We,Ge],je={class:"col-span-5 flex flex-wrap items-start"},Je=e("span",{class:"p-1 bg-gray-100 border border-gray-300 border-r-0 rounded-l"},"Year",-1),Ke=e("span",{class:"p-1 border-y border-gray-300 bg-gray-100"},"Month",-1),Qe=e("span",{class:"p-1 border-y border-gray-300 bg-gray-100"},"Day",-1),Xe={key:0,class:"w-full text-red-500 text-sm"},Ze={class:"col-span-4 flex flex-wrap items-start"},er=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Number",-1),rr={key:0,class:"w-full text-red-500 text-sm"},tr={class:"col-span-4 flex flex-wrap items-start"},ar=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Email",-1),sr={class:"col-span-4 flex flex-wrap items-start"},or=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Address",-1),lr=S({__name:"PatientInfo",props:{modelValue:null,branchId:null,errors:null,mode:null},emits:["update:modelValue"],setup(s,{emit:w}){const $=s,t=R({get:()=>$.modelValue,set:l=>w("update:modelValue",l)}),n=l=>{l==="Mr."&&(t.value.gender="male"),["Mrs.","Ms.","Miss"].includes(l)&&(t.value.gender="female")},o=l=>{l===A.Male?t.value.initials="Mr.":t.value.initials="Ms."},a=async l=>{t.value=l};return(l,i)=>{const x=J("maska");return p(),m("div",He,[Fe,e("div",Re,[b(e("select",{"onUpdate:modelValue":i[0]||(i[0]=u=>r(t).initials=u),onChange:i[1]||(i[1]=u=>n(u.target.value)),class:"h-[34px] px-1 border border-r-0 border-gray-300 rounded-l bg-gray-100"},Le,544),[[Y,r(t).initials]]),V(me,{disabled:s.mode===r(N).Edit,placeholder:"Patient's Name",size:"1","parent-classes":"flex-1",class:C(["w-full p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("patient.name")}]),onSelect:a,endpoint:`/api/patients/list?branchId=${$.branchId}&limit=5`,query:"name",label:"name",modelValue:r(t).name,"onUpdate:modelValue":i[2]||(i[2]=u=>r(t).name=u)},null,8,["disabled","class","endpoint","modelValue"]),s.errors.hasOwnProperty("patient.name")?(p(),m("p",Ye,_(s.errors["patient.name"][0]),1)):h("",!0)]),e("div",Ae,[Ee,b(e("select",{"onUpdate:modelValue":i[3]||(i[3]=u=>r(t).gender=u),onChange:i[4]||(i[4]=u=>o(u.target.value)),class:"flex-1 h-[34px] px-1 border border-gray-300 rounded-r"},qe,544),[[Y,r(t).gender]])]),e("div",je,[Je,b(e("input",{"onUpdate:modelValue":i[5]||(i[5]=u=>r(t).birthdateYear=u),"data-maska":"####",size:"1",class:C(["flex-1 p-1 border border-gray-300 focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("patient.birthdateYear")}])},null,2),[[y,r(t).birthdateYear],[x]]),Ke,b(e("input",{"onUpdate:modelValue":i[6]||(i[6]=u=>r(t).birthdateMonth=u),"data-maska":"##",size:"1",class:"flex-1 p-1 border border-gray-300 focus:border-blue-500"},null,512),[[y,r(t).birthdateMonth],[x]]),Qe,b(e("input",{"onUpdate:modelValue":i[7]||(i[7]=u=>r(t).birthdateDay=u),"data-maska":"##",size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).birthdateDay],[x]]),s.errors.hasOwnProperty("patient.birthdateYear")?(p(),m("p",Xe,_(s.errors["patient.birthdateYear"][0]),1)):h("",!0)]),e("div",Ze,[er,b(e("input",{"onUpdate:modelValue":i[8]||(i[8]=u=>r(t).phoneNumber=u),"data-maska":"+0","data-maska-tokens":"0:[0-9]:multiple",size:"1",class:C(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("patient.phoneNumber")}])},null,2),[[y,r(t).phoneNumber],[x]]),s.errors.hasOwnProperty("patient.phoneNumber")?(p(),m("p",rr,_(s.errors["patient.phoneNumber"][0]),1)):h("",!0)]),e("div",tr,[ar,b(e("input",{"onUpdate:modelValue":i[9]||(i[9]=u=>r(t).email=u),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).email]])]),e("div",sr,[or,b(e("input",{"onUpdate:modelValue":i[10]||(i[10]=u=>r(t).address=u),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).address]])])])}}}),nr={class:"grid grid-cols-12 gap-2"},dr=e("h1",{class:"col-span-12 font-bold underline text-lg"},"Health Information",-1),ir={class:"col-span-3 flex flex-wrap items-start"},ur=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Weight",-1),cr={class:"col-span-3 flex flex-wrap items-start"},br=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Height",-1),pr={class:"col-span-6 flex flex-wrap items-start"},mr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Symptoms",-1),fr={class:"col-span-6 flex flex-wrap items-start"},vr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Diseases",-1),hr={class:"col-span-6 flex flex-wrap items-start"},gr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Therapy",-1),yr={key:0,class:"col-span-4 flex flex-wrap items-start"},xr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Menses Duration",-1),Ir=e("option",{value:"before"},"Before",-1),Vr=e("option",{value:"during"},"During",-1),wr=e("option",{value:"after"},"After",-1),_r=[Ir,Vr,wr],$r={key:0,class:"w-full text-red-500 text-sm"},Cr={key:1,class:"col-span-2 flex flex-wrap items-start"},Mr=e("span",{class:"p-1 border border-gray-300 border-l-0 rounded-r bg-gray-100"},"Days",-1),kr={key:0,class:"w-full text-red-500 text-sm"},Ur={class:"col-span-2 flex flex-wrap items-start"},Pr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Fasting",-1),Nr={key:0,class:"w-full text-red-500 text-sm"},Dr={key:2,class:"col-span-2 flex flex-wrap items-start"},Or=e("span",{class:"p-1 border border-gray-300 border-l-0 rounded-r bg-gray-100"},"Hours",-1),zr={key:0,class:"w-full text-red-500 text-sm"},Sr={class:"col-span-12"},Hr=e("p",{class:""},"Notes",-1),Fr=S({__name:"HealthInfo",props:{modelValue:null,patient:null,errors:null},emits:["update:modelValue"],setup(s,{emit:w}){const $=s,t=R({get:()=>$.modelValue,set:n=>w("update:modelValue",n)});return(n,o)=>{const a=J("maska");return p(),m("div",nr,[dr,e("div",ir,[ur,b(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>r(t).weight=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).weight]])]),e("div",cr,[br,b(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>r(t).height=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).height]])]),e("div",pr,[mr,b(e("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>r(t).symptoms=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).symptoms]])]),e("div",fr,[vr,b(e("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>r(t).diseases=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).diseases]])]),e("div",hr,[gr,b(e("input",{"onUpdate:modelValue":o[4]||(o[4]=l=>r(t).therapy=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).therapy]])]),s.patient.gender===r(A).Female?(p(),m("div",yr,[xr,b(e("select",{"onUpdate:modelValue":o[5]||(o[5]=l=>r(t).mensesDuration=l),class:C(["flex-1 px-1 h-[34px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("mensesDuration")}])},_r,2),[[Y,r(t).mensesDuration]]),s.errors.hasOwnProperty("mensesDuration")?(p(),m("p",$r,_(s.errors.mensesDuration[0]),1)):h("",!0)])):h("",!0),s.patient.gender===r(A).Female?(p(),m("div",Cr,[b(e("input",{"onUpdate:modelValue":o[6]||(o[6]=l=>r(t).mesnesDays=l),size:"1","data-maska":"##",class:C(["flex-1 p-1 rounded-l border border-gray-300 focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("mensesDays")}])},null,2),[[y,r(t).mesnesDays],[a]]),Mr,s.errors.hasOwnProperty("mensesDays")?(p(),m("p",kr,_(s.errors.mensesDays[0]),1)):h("",!0)])):h("",!0),e("div",Ur,[Pr,V(r(K),{modelValue:r(t).isFasting,"onUpdate:modelValue":o[7]||(o[7]=l=>r(t).isFasting=l),"on-label":"Yes","off-label":"No",class:C(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("isFasting")}])},null,8,["modelValue","class"]),s.errors.hasOwnProperty("isFasting")?(p(),m("p",Nr,_(s.errors.isFasting[0]),1)):h("",!0)]),r(t).isFasting?(p(),m("div",Dr,[b(e("input",{"onUpdate:modelValue":o[8]||(o[8]=l=>r(t).fastingHours=l),size:"1","data-maska":"##",class:C(["flex-1 p-1 border border-gray-300 rounded-l focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("mensesTo")}])},null,2),[[y,r(t).fastingHours],[a]]),Or,s.errors.hasOwnProperty("fastingHours")?(p(),m("p",zr,_(s.errors.fastingHours[0]),1)):h("",!0)])):h("",!0),e("div",Sr,[Hr,b(e("textarea",{"onUpdate:modelValue":o[9]||(o[9]=l=>r(t).notes=l),class:"w-full border border-gray-300 rounded p-2 focus:border-blue-500"},null,512),[[y,r(t).notes]])])])}}}),Rr={class:"grid grid-cols-2 gap-2"},Tr=e("h1",{class:"col-span-2 font-bold underline text-lg"},"Other Information",-1),Br={class:"flex flex-wrap items-start"},Lr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"National ID Number",-1),Yr={class:"flex flex-wrap items-start"},Ar=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Passport Number",-1),Er={class:"flex flex-wrap items-start"},Wr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Travel Certificate Number",-1),Gr={class:"flex flex-wrap items-start"},qr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Lab Card Number",-1),jr=S({__name:"OtherInfo",props:{modelValue:null},emits:["update:modelValue"],setup(s,{emit:w}){const $=s,t=R({get:()=>$.modelValue,set:n=>w("update:modelValue",n)});return(n,o)=>(p(),m("div",Rr,[Tr,e("div",Br,[Lr,b(e("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>r(t).nationalIdNumber=a),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).nationalIdNumber]])]),e("div",Yr,[Ar,b(e("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>r(t).passportNumber=a),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).passportNumber]])]),e("div",Er,[Wr,b(e("input",{"onUpdate:modelValue":o[2]||(o[2]=a=>r(t).travelCertificateNumber=a),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).travelCertificateNumber]])]),e("div",Gr,[qr,b(e("input",{"onUpdate:modelValue":o[3]||(o[3]=a=>r(t).labCardNumber=a),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).labCardNumber]])])]))}}),Jr=e("h1",{class:"col-span-2 font-bold underline text-lg"},"Contact Method",-1),Kr={class:"flex items-center"},Qr={class:"flex items-center mr-5"},Xr=e("span",{class:"ml-1"},"None",-1),Zr={class:"flex items-center mr-5"},et=e("span",{class:"ml-1"},"SMS",-1),rt={class:"flex items-center mr-5"},tt=e("span",{class:"ml-1"},"Whatsapp",-1),at={class:"flex items-center mr-5"},st=e("span",{class:"ml-1"},"Telegram",-1),ot={class:"flex items-center mr-5"},lt=e("span",{class:"ml-1"},"Viber",-1),nt=S({__name:"ContactMethod",props:{modelValue:null},emits:["update:modelValue"],setup(s,{emit:w}){const $=s,t=R({get:()=>$.modelValue,set:n=>w("update:modelValue",n)});return(n,o)=>(p(),m("div",null,[Jr,e("div",Kr,[e("label",Qr,[b(e("input",{type:"radio",value:"none","onUpdate:modelValue":o[0]||(o[0]=a=>r(t).contactMethod=a)},null,512),[[H,r(t).contactMethod]]),Xr]),e("label",Zr,[b(e("input",{type:"radio",value:"sms","onUpdate:modelValue":o[1]||(o[1]=a=>r(t).contactMethod=a)},null,512),[[H,r(t).contactMethod]]),et]),e("label",rt,[b(e("input",{type:"radio",value:"whatsapp","onUpdate:modelValue":o[2]||(o[2]=a=>r(t).contactMethod=a)},null,512),[[H,r(t).contactMethod]]),tt]),e("label",at,[b(e("input",{type:"radio",value:"telegram","onUpdate:modelValue":o[3]||(o[3]=a=>r(t).contactMethod=a)},null,512),[[H,r(t).contactMethod]]),st]),e("label",ot,[b(e("input",{type:"radio",value:"viber","onUpdate:modelValue":o[4]||(o[4]=a=>r(t).contactMethod=a)},null,512),[[H,r(t).contactMethod]]),lt])])]))}}),dt={class:"h-[calc(100vh-8.6rem)] overflow-y-auto flex flex-col justify-between"},it={class:"grid grid-cols-2 gap-2"},ut={key:0,class:"flex flex-wrap items-center mb-2"},ct=e("span",{class:"w-20 p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),bt={key:0,class:"ml-20 w-full text-red-500 text-sm"},pt={class:"border-l-2 border-gray-200 pl-2"},mt=e("h1",{class:"font-bold underline text-lg"},"Orders",-1),ft={class:"mt-3 border-t-2 border-gray-200"},vt={class:"flex items-center mt-3"},ht=["disabled"],zt=S({__name:"VisitForm",setup(s){const w=se(),$=ie(),t=ue(),{hasPermissionTo:n}=j(),o=I(null),a=I({}),l=I({initials:"Mr.",gender:"male",contactMethod:"none"}),i=I({}),x=I({discount:0,extraCharges:0,status:L.Closed}),u=I([]),D=I({amount:0,notes:""}),T=I({}),M=I({}),z=I(!1),U=I(N.Create),O=oe().user.branches,g=ve();le(()=>{O.length===1&&(a.value.branchId=O[0].id,l.value.phoneNumber=w.data.general?.find(c=>c.branchId===O[0].id).patientPhoneNumber),$.path.endsWith("/edit")&&(U.value=N.Edit,P($.params.id))});const f=async()=>{const{data:c}=await k.get(`/api/get-eligible-price-list?branchId=${a.value.branchId}&labId=${a.value.labId??""}&referenceCenterId=${a.value.referenceCenterId??""}&referenceDoctorId=${a.value.referenceDoctorId??""}`);T.value=c.data},P=async c=>{const{data:d}=await k.get(`/api/visits/${c}`);a.value=d.data,l.value=d.data.patient,i.value=d.data.healthInformation,x.value=d.data.invoice,u.value=d.data.invoice.items,D.value.amount=d.data.invoice.paidAmount,l.value.age=Math.floor(ne().diff(l.value.birthdate,"years"))},Q=async()=>{if(U.value==="edit"){const{isConfirmed:c}=await ce.fire();if(!c)return}if(g.total(x.value,u.value)<0){be.fire({icon:"error",title:"Invoice can't have negative total."});return}z.value=!0;try{const c=U.value===N.Create?await ee():await re();o.value.print(c),X(c)&&Z(c),U.value===N.Edit&&await t.back()}catch(c){M.value=c.response.data.errors??{}}z.value=!1},X=c=>{const d=w.data.whatsapp?.find(v=>v.branchId===c.branchId);return n("Invoice.send")&&U.value===N.Create&&d?.enabled&&(d?.sendInvoice||d?.sendWelcomeMessage)&&c.patient.contactMethod==="whatsapp"},Z=async c=>{await k.post(`/api/visits/${c.id}/send-welcome-message`)},ee=async()=>{const{data:c}=await k.post("/api/visits",{visit:a.value,patient:l.value,healthInformation:i.value,invoice:x.value,invoiceItems:u.value,payment:D.value});return G.fire(),ae(),c.data},re=async()=>{const{data:c}=await k.patch(`/api/visits/${a.value.id}`,{visit:a.value,patient:l.value,healthInformation:i.value,invoice:x.value,invoiceItems:u.value,payment:D.value});return G.fire(),c.data},te=c=>{l.value.phoneNumber=w.data.general?.find(d=>d.branchId===c).patientPhoneNumber,a.value={branchId:c},x.value={discount:0,extraCharges:0,status:L.Closed},u.value=[]},ae=()=>{const c=w.data.general?.find(d=>d.branchId===a.value.branchId).patientPhoneNumber;l.value={initials:"Mr.",gender:"male",phoneNumber:c,contactMethod:"none"},i.value={isFasting:!1},a.value={branchId:a.value.branchId,labId:a.value.labId},x.value={discount:0,extraCharges:0,status:L.Closed},u.value=[],M.value={}};return q(()=>[a.value.branchId,a.value.labId,a.value.referenceCenterId,a.value.referenceDoctorId],()=>{f()},{deep:!0}),(c,d)=>(p(),E(pe,null,{header:B(()=>[W(_(U.value===r(N).Create?"New Visit":"Edit Visit"),1)]),body:B(()=>[e("div",dt,[e("div",it,[e("div",null,[U.value===r(N).Create&&r(O).length>1?(p(),m("div",ut,[ct,V(r(F),{modelValue:a.value.branchId,"onUpdate:modelValue":d[0]||(d[0]=v=>a.value.branchId=v),options:r(O),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,onChange:te,class:C(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":M.value.hasOwnProperty("visit.branchId")}])},null,8,["modelValue","options","class"]),M.value.hasOwnProperty("visit.branchId")?(p(),m("p",bt,_(M.value["visit.branchId"][0]),1)):h("",!0)])):h("",!0),V(lr,{errors:M.value,mode:U.value,modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=v=>l.value=v),"branch-id":a.value.branchId},null,8,["errors","mode","modelValue","branch-id"]),V(Fr,{errors:M.value,patient:l.value,modelValue:i.value,"onUpdate:modelValue":d[2]||(d[2]=v=>i.value=v),class:"mt-2"},null,8,["errors","patient","modelValue"]),V(Se,{errors:M.value,modelValue:a.value,"onUpdate:modelValue":d[3]||(d[3]=v=>a.value=v),class:"mt-2"},null,8,["errors","modelValue"]),V(jr,{errors:M.value,modelValue:l.value,"onUpdate:modelValue":d[4]||(d[4]=v=>l.value=v),class:"mt-2"},null,8,["errors","modelValue"]),V(nt,{modelValue:l.value,"onUpdate:modelValue":d[5]||(d[5]=v=>l.value=v),class:"mt-2"},null,8,["modelValue"])]),e("div",pt,[mt,a.value.branchId?(p(),E(fe,{key:0,"price-list":T.value,"branch-id":a.value.branchId,invoice:x.value,"onUpdate:invoice":d[6]||(d[6]=v=>x.value=v),invoiceItems:u.value,"onUpdate:invoiceItems":d[7]||(d[7]=v=>u.value=v),payment:D.value,"onUpdate:payment":d[8]||(d[8]=v=>D.value=v),errors:M.value,mode:U.value},null,8,["price-list","branch-id","invoice","invoiceItems","payment","errors","mode"])):h("",!0)])]),e("footer",ft,[e("div",vt,[e("button",{class:"btn-blue mr-auto",disabled:z.value,onClick:Q},[V(de,{"is-loading":z.value},{default:B(()=>[W("Save")]),_:1},8,["is-loading"])],8,ht),V(he,{"branch-id":a.value.branchId,ref_key:"printToggles",ref:o},null,8,["branch-id"])])])])]),_:1}))}});export{zt as default};
