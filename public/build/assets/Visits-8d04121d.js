import{d as U,g as f,x as H,y as Q,Q as V,o as r,c as i,a as x,j as N,v as R,b as e,a1 as W,i as o,R as F,k as p,w as $,T as q,r as j,V as Y,m as E,F as M,a2 as z,t as b,h as P,a3 as O,a4 as G,a0 as T}from"./main-0c5e983d.js";import{M as J}from"./Master-2413594e.js";import{_ as X}from"./Paginator.vue_vue_type_script_setup_true_lang-8b2657b0.js";import{u as Z}from"./urlQueryManager-bb9ba2ef.js";import{i as ee}from"./index.es-30919fd7.js";import{d as te}from"./datepickerPresets-887d9912.js";import{_ as se}from"./BranchFilter.vue_vue_type_script_setup_true_lang-d78112e2.js";import{s as oe}from"./multiselect-f0516a60.js";import{u as ae,P as L,p as A}from"./websocketPrint-fe953d11.js";import{u as re}from"./printTemplateManager-5302f870.js";import{A as ne}from"./ActivityLogSidebar-5a366e2e.js";import"./_plugin-vue_export-helper-c27b6911.js";const le={class:"ml-auto flex items-center gap-2"},ie=["onKeyup"],de=["onKeyup"],ce=U({__name:"VisitsFilter",emits:["change"],setup(K,{emit:D}){const v=new URLSearchParams(location.search),{hasPermissionTo:I}=q(),_=f(""),g=f(""),n=f(""),m=f(""),l=f([null,null]),k=f([]);H(()=>{u(),C()});const B=Q(()=>l.value[0]===null||l.value[1]===null?"":`${l.value[0]}~${l.value[1]}`),u=()=>{_.value=v.get("branchId")??"",g.value=v.get("q")??"",n.value=v.get("visitNumber")??"",m.value=v.get("partnerId")??"",v.get("dateRange")&&(l.value=v.get("dateRange").split("~"))},C=async()=>{if(!I("Partner.list"))return;const{data:a}=await V.get(`/api/partners/list?branchId=${_.value}`);k.value=a.data},w=a=>{m.value=a??"",y()},y=()=>{let a=`branchId=${_.value}&visitNumber=${n.value}&q=${g.value}&partnerId=${m.value}&dateRange=${B.value}&page=1`;D("change",a)},S=()=>{const a=n.value;h(),n.value=a,y()},h=()=>{_.value="",g.value="",n.value="",m.value="",l.value=[null,null]};return(a,s)=>(r(),i("div",le,[x(se,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=d=>_.value=d),onChange:y},null,8,["modelValue"]),N(e("input",{"onUpdate:modelValue":s[1]||(s[1]=d=>n.value=d),onKeyup:W(S,["enter"]),type:"text",placeholder:"Registration Number",class:"w-56 rounded border border-gray-300 p-1.5 focus:border-blue-500"},null,40,ie),[[R,n.value]]),N(e("input",{"onUpdate:modelValue":s[2]||(s[2]=d=>g.value=d),onKeyup:W(y,["enter"]),type:"text",placeholder:"Name or phone number",class:"w-56 rounded border border-gray-300 p-1.5 focus:border-blue-500"},null,40,de),[[R,g.value]]),o(I)("Partner.list")?(r(),F(o(oe),{key:0,"model-value":m.value,options:k.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,placeholder:"Select partner",onChange:w,class:"w-56 min-h-[38px] border border-gray-300 !rounded"},null,8,["model-value","options"])):p("",!0),x(o(ee),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:o(te),placeholder:"Select date range",value:l.value,"onUpdate:value":s[3]||(s[3]=d=>l.value=d),onChange:y,class:"!w-56","input-class":"w-full rounded border border-gray-300 p-1.5 focus:border-blue-500"},{"icon-calendar":$(()=>[]),_:1},8,["shortcuts","value"])]))}}),ue={class:"mb-5 flex items-center"},pe=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"mr-1 h-4 w-4"},[e("path",{d:"M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"})],-1),me=e("span",{class:"font-semibold"},"Create New Visit",-1),he={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},be={class:"w-full"},fe={class:"sticky top-0 z-10 text-left"},ve=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"No.",-1),_e=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Name",-1),ye=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Gender",-1),ge=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Age",-1),we=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Phone",-1),xe=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Lab",-1),ke=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Orders",-1),Ce={key:0,class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 text-center font-semibold text-white"},Ve=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Date",-1),$e=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Branch",-1),Ie={key:1,class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},Be={class:"transition even:bg-gray-100"},Se={class:"border border-gray-200 p-1"},Pe={class:"whitespace-nowrap border border-gray-200 p-1"},Ne={class:"border border-gray-200 p-1"},De={class:"whitespace-nowrap border border-gray-200 p-1"},Me={class:"border border-gray-200 p-1"},Te={class:"whitespace-nowrap border border-gray-200 p-1"},Le={class:"border border-gray-200 p-1"},Ae={class:"flex flex-wrap items-center gap-1 max-w-[30rem]"},Fe={class:"inline-block rounded bg-teal-500 px-1 text-xs font-bold text-white"},Re={key:0,class:"border border-gray-200 p-1"},We={class:"flex flex-wrap items-center justify-center gap-1"},ze=["onClick","onContextmenu","disabled"],Ue=["onClick","onContextmenu","disabled"],He=["onClick","onContextmenu","disabled"],qe=["onClick","onContextmenu","disabled"],Ke={class:"whitespace-nowrap border border-gray-200 p-1"},Qe={class:"border border-gray-200 p-1"},je={key:1,class:"border border-gray-200 px-2 py-1 text-center"},Ye={class:"flex justify-center gap-3"},Ee=e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),Oe=["onClick"],Ge=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),Je=[Ge],ct=U({__name:"Visits",setup(K){const{hasDefaultDepWiseBarcodeTemplate:D,hasDefaultSampleWiseBarcodeTemplate:v,hasDefaultInvoiceTemplate:I,hasDefaultVisitBarcodeTemplate:_}=re(),{updateUrlQuery:g}=Z(),{hasPermissionTo:n,hasAnyPermission:m}=q(),l=ae(),k=f([]),B=f({}),u=f(!1);H(()=>C(location.search));const C=async h=>{const a=await g(h),{data:s}=await V.get(`/api/visits?${a}`);k.value=s.data,B.value=s.meta},w=async(h,a,s=!1)=>{u.value=!0;const{data:d}=await V.post("/api/samples/print",{type:a,visitId:h.id});l.isConnected&&!s?l.submit({type:L.Barcodes,url:"barcode.pdf",file_content:d}):A({printable:d,type:"pdf",base64:!0}),T.fire(),u.value=!1},y=async(h,a=!1)=>{u.value=!0;const{data:s}=await V.post("/api/visits/print-barcode",{visitId:h.id});l.isConnected&&!a?l.submit({type:L.Barcodes,url:"barcode.pdf",file_content:s}):A({printable:s,type:"pdf",base64:!0}),T.fire(),u.value=!1},S=async(h,a=!1)=>{u.value=!0;const{data:s}=await V.post("/api/invoices/print",{invoiceId:h.id});l.isConnected&&!a?l.submit({type:L.Invoices,url:"invoice.pdf",file_content:s}):A({printable:s,type:"pdf",base64:!0}),T.fire(),u.value=!1};return(h,a)=>{const s=j("router-link"),d=Y("tip");return r(),i(M,null,[x(J,null,{header:$(()=>[E("Visits")]),body:$(()=>[e("div",ue,[o(n)("Visit.create")?(r(),F(s,{key:0,to:"/visits/create",class:"inline-flex items-center btn-blue"},{default:$(()=>[pe,me]),_:1})):p("",!0),x(ce,{onChange:C})]),e("section",he,[e("table",be,[e("thead",null,[e("tr",fe,[ve,_e,ye,ge,we,xe,ke,o(m)("Invoice.print","Sample.print","Visit.printBarcode")?(r(),i("th",Ce,"Print")):p("",!0),Ve,$e,o(m)("Visit.update","ActivityLog.list")?(r(),i("th",Ie)):p("",!0)])]),e("tbody",null,[(r(!0),i(M,null,z(k.value,t=>(r(),i("tr",Be,[e("td",Se,b(t.number),1),e("td",Pe,b(t.patient.name),1),e("td",Ne,b(t.patient.gender.capitalize()),1),e("td",De,b(t.patient.age),1),e("td",Me,b(t.patient.phoneNumber),1),e("td",Te,b(t.lab?.name??"local"),1),e("td",Le,[e("div",Ae,[(r(!0),i(M,null,z(t.invoice.invoiceItems.filter(c=>c.status!=="canceled"),c=>(r(),i("span",Fe,b(c.shortForm??c.name),1))),256))])]),o(m)("Invoice.print","Sample.print")?(r(),i("td",Re,[e("div",We,[o(n)("Visit.printBarcode")&&o(_)(t.branchId)?(r(),i("button",{key:0,onClick:c=>y(t),onContextmenu:P(c=>y(t,!0),["prevent"]),class:"px-1 py-0 text-sm btn-blue hover:shadow-none",disabled:u.value},"Visit barcode",40,ze)):p("",!0),o(n)("Sample.print")&&o(D)(t.branchId)?(r(),i("button",{key:1,onClick:c=>w(t,"departmentWise"),onContextmenu:P(c=>w(t,"departmentWise",!0),["prevent"]),class:"px-1 py-0 text-sm btn-blue hover:shadow-none",disabled:u.value},"Dep. wise",40,Ue)):p("",!0),o(n)("Sample.print")&&o(v)(t.branchId)?(r(),i("button",{key:2,onClick:c=>w(t,"sampleWise"),onContextmenu:P(c=>w(t,"sampleWise",!0),["prevent"]),class:"px-1 py-0 text-sm btn-blue hover:shadow-none",disabled:u.value},"Sample wise",40,He)):p("",!0),o(n)("Invoice.print")&&o(I)(t.branchId)?(r(),i("button",{key:3,onClick:c=>S(t.invoice),onContextmenu:P(c=>S(t.invoice,!0),["prevent"]),class:"px-1 py-0 text-sm btn-blue hover:shadow-none",disabled:u.value},"Invoice",40,qe)):p("",!0)])])):p("",!0),e("td",Ke,b(t.date),1),e("td",Qe,b(t.branch.name),1),o(m)("Visit.update","ActivityLog.list")?(r(),i("td",je,[e("div",Ye,[o(n)("Visit.update")?N((r(),F(s,{key:0,to:`/visits/${t.id}/edit`,class:"cursor-pointer text-orange-500"},{default:$(()=>[Ee]),_:2},1032,["to"])),[[d,"Edit"]]):p("",!0),o(n)("ActivityLog.list")?N((r(),i("button",{key:1,onClick:c=>o(O).emit(o(G).Show,t.id),class:"cursor-pointer text-gray-600"},Je,8,Oe)),[[d,"View Activities"]]):p("",!0)])])):p("",!0)]))),256))])])])]),_:1}),x(X,{data:B.value,onChange:a[0]||(a[0]=t=>C(`page=${t}`)),class:"mt-3"},null,8,["data"]),x(ne)],64)}}});export{ct as default};
