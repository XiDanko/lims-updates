import{d as O,e as _,x as G,y as Z,Q as X,o as r,c as a,b as e,a as f,h as p,v as T,T as H,g as n,R as A,i as y,a0 as q,w as $,F as k,U as J,r as K,V as ee,k as j,W as L,t as d,n as U,X as Q,Y as te,a2 as se,a3 as oe,ac as re}from"./main-6e47ceb6.js";import{M as ae}from"./Master-c2e1e299.js";import{_ as ne}from"./Paginator.vue_vue_type_script_setup_true_lang-161ff6db.js";import{u as le}from"./urlQueryManager-757a21bf.js";import{i as de}from"./index.es-2384e375.js";import{d as ie}from"./datepickerPresets-82697600.js";import{s as ce}from"./multiselect-27b4da8b.js";import{_ as ue}from"./BarcodeScanner.vue_vue_type_script_setup_true_lang-d25da639.js";import{_ as pe}from"./BranchFilter.vue_vue_type_script_setup_true_lang-d104a2b1.js";import{P}from"./patientCallStatus-cce91589.js";import{P as W}from"./partnerType-65f9f978.js";import{O as Y}from"./orderStatus-e3a3f9a7.js";import{_ as he,R as E}from"./ResultsReleaseModal.vue_vue_type_script_setup_true_lang-51ee8690.js";import{A as ge}from"./ActivityLogSidebar-44a5ec42.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./websocketPrint-f72594c6.js";import"./printTemplateManager-6e5fdf5a.js";var C=(S=>(S.Pending="pending",S.Sent="sent",S.Failed="failed",S))(C||{});const be={class:"flex flex-wrap gap-2 items-center ml-auto"},_e=["onKeyup"],me=["onKeyup"],ye=e("option",{value:""},"Message status",-1),fe=["value"],ve=["value"],we=["value"],xe=e("option",{value:""},"Call status",-1),ke=["value"],Ce=["value"],Se=["value"],$e=O({__name:"FollowupsFilter",emits:["change"],setup(S,{emit:N}){const c=new URLSearchParams(location.search),{hasPermissionTo:B}=J(),v=_(""),u=_(""),h=_(""),g=_([null,null]),b=_(""),w=_(""),x=_(""),M=_([]);G(()=>{s(),F()});const z=Z(()=>g.value[0]===null||g.value[1]===null?"":`${g.value[0]}~${g.value[1]}`),F=async()=>{if(!B("Partner.list"))return;const{data:l}=await X.get(`/api/partners/list?branchId=${v.value}&type=${W.Doctor},${W.Lab}`);M.value=l.data},D=l=>{b.value=l??"",i()},I=l=>{h.value=l,i()},s=()=>{v.value=c.get("branchId")??"",u.value=c.get("q")??"",h.value=c.get("visitNumber")??"",c.get("dateRange")&&(g.value=c.get("dateRange").split("~")),b.value=c.get("partnerId")??"",w.value=c.get("callStatus")??"",x.value=c.get("messageStatus")??""},m=()=>{const l=h.value;R(),h.value=l,i()},i=()=>{let l=`branchId=${v.value}&visitNumber=${h.value}&q=${u.value}&partnerId=${b.value}&messageStatus=${x.value}&callStatus=${w.value}&dateRange=${z.value}&page=1`;N("change",l)},R=()=>{v.value="",u.value="",h.value="",g.value=[null,null],b.value="",w.value="",x.value=""};return(l,o)=>(r(),a(k,null,[e("div",be,[f(pe,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=t=>v.value=t),onChange:o[1]||(o[1]=t=>{i(),F()})},null,8,["modelValue"]),p(e("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>h.value=t),onKeyup:H(m,["enter"]),type:"text",placeholder:"Registration number",class:"w-40 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,_e),[[T,h.value]]),p(e("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>u.value=t),onKeyup:H(i,["enter"]),type:"text",placeholder:"Name or phone number",class:"w-48 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,me),[[T,u.value]]),n(B)("Partner.list")?(r(),A(n(ce),{key:0,"model-value":b.value,options:M.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,placeholder:"Select partner",onChange:D,class:"w-48 min-h-[38px] border border-gray-300 !rounded"},null,8,["model-value","options"])):y("",!0),p(e("select",{"onUpdate:modelValue":o[4]||(o[4]=t=>x.value=t),onChange:i,class:"px-2 h-[38px] border border-gray-300 !rounded"},[ye,e("option",{value:n(C).Pending},"Pending",8,fe),e("option",{value:n(C).Sent},"Sent",8,ve),e("option",{value:n(C).Failed},"Failed",8,we)],544),[[q,x.value]]),p(e("select",{"onUpdate:modelValue":o[5]||(o[5]=t=>w.value=t),onChange:i,class:"px-2 h-[38px] border border-gray-300 !rounded"},[xe,e("option",{value:n(P).Pending},"Pending",8,ke),e("option",{value:n(P).Answered},"Answered",8,Ce),e("option",{value:n(P).NoAnswer},"No Answer",8,Se)],544),[[q,w.value]]),f(n(de),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:n(ie),placeholder:"Select date range",value:g.value,"onUpdate:value":o[6]||(o[6]=t=>g.value=t),onChange:i,class:"!w-56 mr-2","input-class":"w-full p-1.5 border border-gray-300 rounded focus:border-blue-500"},{"icon-calendar":$(()=>[]),_:1},8,["shortcuts","value"])]),f(ue,{onScan:I})],64))}}),Pe={class:"flex items-center mb-5"},Be={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},Me={class:"w-full"},Re={class:"sticky top-0 z-10 text-left"},Ve=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},null,-1),Ne=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr whitespace-nowrap"},"Phone Number",-1),Fe=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Names",-1),Le=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Visits",-1),Ae=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr text-center"},"Status",-1),ze=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Notes",-1),De=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Date",-1),Ie=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr whitespace-nowrap"},"Previous Followup",-1),je=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Branch",-1),Ue={key:0,class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},Te={class:"transition hover:bg-gray-100"},He=["onClick"],qe={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-6 h-6 mx-auto"},Ke=e("path",{"fill-rule":"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z","clip-rule":"evenodd"},null,-1),Qe=[Ke],We={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-6 h-6 mx-auto"},Ye=e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z","clip-rule":"evenodd"},null,-1),Ee=[Ye],Oe={class:"py-1 px-2 border border-gray-200"},Ge={class:"py-1 px-2 border border-gray-200"},Xe={class:"flex flex-wrap items-center gap-1"},Je={class:"p-1 bg-teal-500 text-xs text-white font-bold rounded"},Ze={class:"py-1 px-2 border border-gray-200 text-center"},et={class:"py-1 px-2 border border-gray-200 text-center"},tt={class:"py-1 px-2 border border-gray-200 max-w-[10rem] text-sm"},st={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},ot={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},rt={class:"py-1 px-2 border border-gray-200"},at={class:"py-1 px-2 border border-gray-200 text-center"},nt={key:0,class:"flex justify-center gap-3"},lt={class:"w-6 h-6 text-blue-500 cursor-pointer",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},dt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"},null,-1),it=[dt],ct=["onClick"],ut=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"w-5 h-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),pt=[ut],ht={key:0},gt={colspan:"100%",class:"border border-gray-200 p-2"},bt={class:"w-full"},_t=e("thead",null,[e("tr",{class:"sticky top-[39px] z-10 text-left"},[e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"No."),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"name"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Gender"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Age"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Phone Number"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold whitespace-nowrap"},"Contact Method"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Lab"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold whitespace-nowrap"},"Due Balance"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold whitespace-nowrap"},"Message Status"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Date"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"})])],-1),mt={class:"transition hover:bg-gray-50"},yt={class:"p-1 border border-gray-200"},ft={class:"p-1 border border-gray-200 whitespace-nowrap"},vt={class:"p-1 border border-gray-200"},wt={class:"p-1 border border-gray-200 whitespace-nowrap"},xt={class:"p-1 border border-gray-200"},kt={class:"p-1 border border-gray-200 whitespace-nowrap"},Ct={class:"p-1 border border-gray-200 whitespace-nowrap"},St={key:1},$t={class:"p-1 border border-gray-200"},Pt={class:"flex flex-wrap items-center gap-1 max-w-[15rem]"},Bt={class:"p-1 border border-gray-200 whitespace-nowrap"},Mt={class:"p-1 border border-gray-200 text-center"},Rt={class:"flex justify-center gap-1"},Vt={class:"w-6 h-6 text-blue-500 cursor-pointer",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Nt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"},null,-1),Ft=[Nt],Lt=["onClick"],At=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"},null,-1),zt=[At],Dt=["onClick"],It=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1),jt=[It],Ut=["href"],Tt={class:"w-6 h-6 text-blue-500 cursor-pointer",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ht=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1),qt=[Ht],ls=O({__name:"Followups",setup(S){const N=_([]),c=_(new Set),B=_({}),{updateUrlQuery:v}=le(),{hasPermissionTo:u,hasAnyPermission:h}=J();G(()=>b(location.search));const g=s=>se().data.whatsapp?.find(m=>m.branchId===s),b=async s=>{const m=await v(s),{data:i}=await X.get(`/api/followups?${m}`);N.value=i.data,B.value=i.meta},w=s=>!(!u("Result.print")||s.invoice.dueBalance>0&&!u("Result.printDue")),x=s=>!(s.patient.contactMethod!=="whatsapp"||!u("Result.send")||s.invoice.dueBalance>0&&!u("Result.sendDue")),M=async(s,m)=>{if(s.invoice.dueBalance>0){const{isConfirmed:i}=await oe.fire({html:`Patient has due balance of ${s.invoice.dueBalance.toLocaleString()}`});if(!i)return}Q.emit(re.Show,{visit:s,orders:s.orders,releaseType:m})},z=s=>`https://api.whatsapp.com/send?phone=${s.patient.phoneNumber.replace("+","")}&text=${g(s.branchId)?.welcomeMessage??""}`,F=s=>{if(s.status===Y.Rejected)return"bg-orange-500 text-white";if(s.test.bypass&&!s.selectedResult)return"bg-blue-500 text-white";if(s.selectedResult.messageStatus===C.Sent)return"bg-emerald-500 text-white";if(s.selectedResult.messageStatus===C.Pending)return"bg-gray-300 text-black";if(s.selectedResult.messageStatus===C.Failed)return"bg-red-500 text-white"},D=s=>s.status===Y.Rejected?"rejected":s.test.bypass&&!s.selectedResult?"bypass":s.selectedResult.messageStatus,I=s=>{if(s===P.Pending)return"bg-gray-300 text-black";if(s===P.Answered)return"bg-emerald-500 text-white";if(s===P.NoAnswer)return"bg-red-500 text-white"};return(s,m)=>{const i=K("router-view"),R=K("router-link"),l=ee("tip");return r(),a(k,null,[f(i,{onClose:b}),f(ae,null,{header:$(()=>[j("Patients Followup")]),body:$(()=>[e("div",Pe,[f($e,{onChange:b})]),e("section",Be,[e("table",Me,[e("thead",null,[e("tr",Re,[Ve,Ne,Fe,Le,Ae,ze,De,Ie,je,n(h)("Followup.update","ActivityLog.list")?(r(),a("th",Ue)):y("",!0)])]),(r(!0),a(k,null,L(N.value,o=>(r(),a("tbody",null,[e("tr",Te,[e("td",{class:"py-1 w-12 border border-gray-200 cursor-pointer",onClick:t=>c.value.has(o.id)?c.value.delete(o.id):c.value.add(o.id)},[c.value.has(o.id)?(r(),a("svg",We,Ee)):(r(),a("svg",qe,Qe))],8,He),e("td",Oe,d(o.phoneNumber),1),e("td",Ge,[e("div",Xe,[(r(!0),a(k,null,L(o.patients,t=>(r(),a("span",Je,d(t.name),1))),256))])]),e("td",Ze,d(o.visits.length),1),e("td",et,[e("span",{class:U(["px-1 rounded text-xs whitespace-nowrap",I(o.callStatus)])},d(o.callStatus.startCase()),3)]),e("td",tt,d(o.callNotes),1),e("td",st,d(o.date),1),e("td",ot,d(o.previousDate),1),e("td",rt,d(o.branch.name),1),e("td",at,[n(h)("Followup.update","ActivityLog.list")?(r(),a("div",nt,[n(u)("Followup.update")?(r(),A(R,{key:0,to:`/followups/${o.id}`},{default:$(()=>[p((r(),a("svg",lt,it)),[[l,"Call"]])]),_:2},1032,["to"])):y("",!0),n(u)("ActivityLog.list")?p((r(),a("button",{key:1,onClick:t=>n(Q).emit(n(te).Show,o.id),class:"text-gray-600 cursor-pointer"},pt,8,ct)),[[l,"View Activities"]]):y("",!0)])):y("",!0)])]),c.value.has(o.id)?(r(),a("tr",ht,[e("td",gt,[e("table",bt,[_t,e("tbody",null,[(r(!0),a(k,null,L(o.visits,t=>(r(),a("tr",mt,[e("td",yt,d(t.number),1),e("td",ft,d(t.patient.name),1),e("td",vt,d(t.patient.gender.capitalize()),1),e("td",wt,d(t.patient.age),1),e("td",xt,d(t.patient.phoneNumber),1),e("td",kt,d(t.patient.contactMethod),1),e("td",Ct,d(t.lab?.name??"local"),1),e("td",{class:U(["p-1 border border-gray-200",{"font-semibold text-red-500":t.invoice.dueBalance>0}])},[n(u)("Transaction.create")&&t.invoice.dueBalance>0?p((r(),A(R,{key:0,class:"underline",to:`/invoices/${t.invoice.id}/transactions/payment/create`},{default:$(()=>[j(d(t.invoice.dueBalance.toLocaleString()),1)]),_:2},1032,["to"])),[[l,"Create Payment"]]):(r(),a("span",St,d(t.invoice.dueBalance.toLocaleString()),1))],2),e("td",$t,[e("div",Pt,[(r(!0),a(k,null,L(t.orders,V=>p((r(),a("span",{class:U(["px-1 rounded text-xs cursor-pointer",F(V)])},[j(d(V.test.shortForm),1)],2)),[[l,D(V).capitalize()]])),256))])]),e("td",Bt,d(t.date),1),e("td",Mt,[e("div",Rt,[n(u)("ResultEntry.show")?(r(),A(R,{key:0,to:`/results-entry?visitId=${t.id}`},{default:$(()=>[p((r(),a("svg",Vt,Ft)),[[l,"View Results"]])]),_:2},1032,["to"])):y("",!0),w(t)?p((r(),a("svg",{key:1,class:"w-6 h-6 text-blue-500 cursor-pointer",onClick:V=>M(t,n(E).Print),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},zt,8,Lt)),[[l,"Print"]]):y("",!0),x(t)?(r(),a(k,{key:2},[g(t.branchId)?.enabled?p((r(),a("svg",{key:0,class:"w-6 h-6 text-blue-500 cursor-pointer",onClick:V=>M(t,n(E).Send),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},jt,8,Dt)),[[l,"Send"]]):(r(),a("a",{key:1,href:z(t),target:"_blank"},[p((r(),a("svg",Tt,qt)),[[l,"Send"]])],8,Ut))],64)):y("",!0)])])]))),256))])])])])):y("",!0)]))),256))])])]),_:1}),f(ne,{data:B.value,onChange:m[0]||(m[0]=o=>b(`page=${o}`)),class:"mt-3"},null,8,["data"]),f(he,{onClose:b}),f(ge)],64)}}});export{ls as default};
