import{d as Y,e as r,y as Z,x as ee,a2 as z,a5 as A,a8 as C,s as te,o as i,R as se,w as S,k as F,t as o,g as n,b as l,h as D,V as ae,n as I,c,a1 as V,F as T,i as y,a as L,f as M,_ as le,a4 as oe,Q as ne,$ as ie,p as u,j as W}from"./main-DNdNUUJ7.js";import{u as re,a as ce,P as de}from"./printService-Bcj_RmEK.js";import{O as j}from"./orderStatus-Cdywi7Or.js";import{b as ue}from"./toggle-B4ffD-ge.js";import{P as O}from"./printTemplateType-BiK7zB0k.js";var q=(f=>(f.Print="print",f.Send="send",f))(q||{});const pe={class:"mb-3 grid grid-cols-4 gap-3"},me={class:"relative col-span-3"},ve=["value"],he={key:0,class:"text-sm text-red-500"},fe={class:"relative"},be={class:"label"},_e=l("hr",{class:"mt-2"},null,-1),ge={class:"overflow-auto py-1 max-h-[30rem]"},Se={class:"select-none"},ye={class:"flex items-center text-xl font-bold"},xe=["onUpdate:modelValue","onChange"],ke={class:"ms-1"},we={class:"border-gray-200 border-s-2 ps-5"},Pe=["onUpdate:modelValue","disabled"],Ce={class:"ms-1"},De={key:0,class:"inline-block ms-2"},Ie={key:0,class:"mt-3 rounded border-red-500 bg-red-50 p-2 text-red-500 border-s-4"},Ve=["disabled"],Ne=Y({__name:"ResultsReleaseModal",emits:["close"],setup(f,{emit:Q}){const G=Q,b=r(!1),x=r(!1),k=r(localStorage.getItem("printWithDesign")!=="no"),_=r(),p=r({}),m=r([]),g=r([]),H=Z(()=>m.value.filter(e=>e.isSelected)),{getPrintTemplates:R,getDefaultTemplate:J}=re(),v=r(null),d=r({}),E=ce();ee(()=>{z.on(A.Show,({visit:e,orders:t,releaseType:s})=>{x.value=!0,_.value=s,p.value=C.cloneDeep(e),m.value=C.cloneDeep(t),g.value=C.uniqBy(m.value.flatMap(a=>a.test.department),"id"),v.value=J(O.Results,p.value.branchId)?.id,U(),N()})}),te(()=>z.off(A.Show));const h=e=>[j.Authorized,j.Released].includes(e.status)&&e.test.isPrintable,w=e=>m.value.filter(t=>t.test.department.id===e.id),K=e=>{e.isSelected?w(e).filter(t=>h(t)).forEach(t=>t.isSelected=!0):w(e).forEach(t=>t.isSelected=!1)},N=()=>{g.value.forEach(e=>e.isSelected=!0),m.value.filter(e=>h(e)).forEach(e=>e.isSelected=!0)},U=()=>{g.value.forEach(e=>e.isSelected=!1),m.value.forEach(e=>e.isSelected=!1)},X=e=>{localStorage.setItem("printWithDesign",e?"yes":"no")},B=async e=>{b.value=!0;const t=H.value.map(a=>a.id),s={visitId:p.value.id,ordersIds:t,templateId:v.value,withDesign:k.value};try{if(_.value===q.Print){const a=R(O.Results,p.value.branchId).find(P=>P.id===v.value).printer;await E.results(s,{printMode:e,printer:a,fileName:`${p.value.patient.name}-results`})}else await ne.post("/api/results/send",s);ie.fire(),d.value={},$()}catch(a){d.value=a.response.data.errors??{}}b.value=!1},$=()=>{x.value=!1,d.value={},G("close")};return(e,t)=>x.value?(i(),se(oe,{key:0},{header:S(()=>[F(o(n(u)(":releaseType Results of :patientName",{releaseType:n(u)(_.value),patientName:p.value.patient.name})),1)]),body:S(()=>[l("form",{id:"form",onSubmit:t[2]||(t[2]=M(s=>B(n(de).Direct),["prevent","stop"]))},[l("div",pe,[l("div",me,[D(l("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>v.value=s),class:I(["input peer",{"border-red-500":d.value.hasOwnProperty("templateId")}])},[(i(!0),c(T,null,V(n(R)(n(O).Results,p.value.branchId),s=>(i(),c("option",{value:s.id},o(s.name),9,ve))),256))],2),[[ae,v.value]]),l("label",{class:I(["label",{"text-red-500":d.value.hasOwnProperty("templateId")}])},o(n(u)("Template")),3),d.value.hasOwnProperty("templateId")?(i(),c("p",he,o(d.value.templateId[0]),1)):y("",!0)]),l("div",fe,[L(n(ue),{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=s=>k.value=s),onChange:X,class:"input peer pt-2.5"},null,8,["modelValue"]),l("label",be,o(n(u)("With Design")),1)])]),l("div",null,[l("button",{class:"text-sm me-2 btn-blue",onClick:M(N,["prevent"])},o(n(u)("Select All")),1),l("button",{class:"text-sm btn-gray",onClick:M(U,["prevent"])},o(n(u)("Clear")),1)]),_e,l("div",ge,[(i(!0),c(T,null,V(g.value,s=>(i(),c("div",Se,[l("label",ye,[D(l("input",{type:"checkbox","onUpdate:modelValue":a=>s.isSelected=a,onChange:a=>K(s),class:"h-4 w-4 rounded checked:accent-blue-500"},null,40,xe),[[W,s.isSelected]]),l("span",ke,o(s.name),1)]),l("div",we,[(i(!0),c(T,null,V(w(s),a=>(i(),c("label",{class:I(["flex items-center",{"text-gray-400":!h(a)}])},[D(l("input",{type:"checkbox","onUpdate:modelValue":P=>a.isSelected=P,disabled:!h(a),class:"h-4 w-4 rounded checked:accent-blue-500"},null,8,Pe),[[W,a.isSelected]]),l("span",Ce,o(a.test.shortForm),1),h(a)?y("",!0):(i(),c("span",De," ("+o(a.status.capitalize())+" "+o(a.test.bypass?"-bypass":"")+" "+o(a.test.isPrintable?"":"-disabled")+") ",1))],2))),256))])]))),256))]),d.value.hasOwnProperty("orders")?(i(),c("p",Ie,"Select at least one order to continue.")):y("",!0)],32)]),footer:S(()=>[l("button",{class:"me-2 btn-blue",disabled:b.value,form:"form",onClick:t[3]||(t[3]=s=>B(n(E).detectPrintMode(s)))},[L(le,{"is-loading":b.value},{default:S(()=>[F(o(n(u)(_.value.capitalize())),1)]),_:1},8,["is-loading"])],8,Ve),l("button",{onClick:$,class:"btn-gray"},o(n(u)("Cancel")),1)]),_:1})):y("",!0)}});export{q as R,Ne as _};
