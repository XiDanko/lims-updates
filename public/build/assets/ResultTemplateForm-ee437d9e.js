import{d as N,f as $,e as U,g as n,u as A,x as D,Q as b,Y as W,o as d,R as k,w as v,m as C,t as h,i as o,b as r,c as f,a as y,n as w,k as u,j,v as z,h as H,_ as L,a5 as Q,a0 as Y}from"./main-cee2eb24.js";import{b as q}from"./toggle-afba85dd.js";import{s as S}from"./multiselect-97a39018.js";import{F as i}from"./formMode-f60a729f.js";import{_ as G}from"./Tinymce.vue_vue_type_script_setup_true_lang-9b681c5c.js";const J=["onSubmit"],K={key:0,class:"mb-3 flex flex-wrap items-center"},X=r("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Branch",-1),Z={key:0,class:"ml-24 w-full text-sm text-red-500"},ee={class:"mb-3 flex flex-wrap items-center"},ae=r("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Name",-1),te={key:0,class:"ml-24 w-full text-sm text-red-500"},re={class:"mb-3 flex flex-wrap items-center"},se=r("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Parameter",-1),le={key:0,class:"ml-24 w-full text-sm text-red-500"},oe={class:"flex flex-wrap items-center"},ne=["disabled"],be=N({__name:"ResultTemplateForm",emits:["close"],setup(de,{emit:P}){const x=$(),T=U(),e=n({}),c=A().user.branches,I=n([]),m=n(i.Create),p=n(!1),t=n([]),_=n({});D(()=>{c.length===1&&(e.value.branchId=c[0].id,g()),x.path.endsWith("/edit")&&(m.value=i.Edit,O(x.params.id))});const O=async l=>{const{data:a}=await b.get(`/api/result-templates/${l}`);e.value=a.data,g()},g=async()=>{R(),_.value=W().data.general?.find(l=>l.branchId===e.value.branchId)},R=async()=>{const{data:l}=await b.get(`/api/parameters/list?branchId=${e.value.branchId}`);I.value=l.data},B=async()=>{p.value=!0;try{m.value===i.Create?await E():await F(),Y.fire()}catch(l){t.value=l.response.data.errors??{}}p.value=!1},E=async()=>{await b.post("/api/result-templates",e.value),M()},F=async()=>{await b.patch(`/api/result-templates/${e.value.id}`,e.value),V()},M=()=>{e.value={branchId:e.value.branchId,content:""},t.value=[]},V=()=>{P("close"),T.back()};return(l,a)=>(d(),k(Q,{"modal-class":"!w-[56rem]"},{header:v(()=>[C(h(m.value===o(i).Create?"Create New Result Template":"Edit Result Template"),1)]),body:v(()=>[r("form",{id:"form",onSubmit:H(B,["prevent","stop"])},[o(c).length>1?(d(),f("div",K,[X,y(o(S),{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value.branchId=s),onSelect:g,options:o(c),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:w(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("branchId")?(d(),f("p",Z,h(t.value.branchId[0]),1)):u("",!0)])):u("",!0),r("div",ee,[ae,j(r("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>e.value.name=s),class:w(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("name")}])},null,2),[[z,e.value.name]]),t.value.hasOwnProperty("name")?(d(),f("p",te,h(t.value.name[0]),1)):u("",!0)]),r("div",re,[se,y(o(S),{modelValue:e.value.parameterId,"onUpdate:modelValue":a[2]||(a[2]=s=>e.value.parameterId=s),options:I.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm",class:w(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("parameterId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("parameterId")?(d(),f("p",le,h(t.value.parameterId[0]),1)):u("",!0)]),r("div",oe,[y(G,{modelValue:e.value.content,"onUpdate:modelValue":a[3]||(a[3]=s=>e.value.content=s),"limit-width":_.value?.resultEditorMaxWidth,"limit-height":_.value?.resultEditorMaxHeight},null,8,["modelValue","limit-width","limit-height"])])],40,J)]),footer:v(()=>[r("button",{class:"mr-2 btn-blue",disabled:p.value,form:"form"},[y(L,{"is-loading":p.value},{default:v(()=>[C("Save")]),_:1},8,["is-loading"])],8,ne),r("button",{onClick:V,class:"btn-gray"},"Cancel"),m.value===o(i).Edit?(d(),k(o(q),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":a[4]||(a[4]=s=>e.value.isActive=s),class:"toggle:off:red ml-auto"},null,8,["modelValue"])):u("",!0)]),_:1}))}});export{be as default};
