import{d as T,e as i,u as L,x as Q,Q as m,o as u,R as F,w as V,k as N,t as c,g as o,b as t,c as p,a as v,n,i as d,h as k,v as O,f as W,_ as q,a4 as G,m as H,l as J,$ as K}from"./main-BgbWFIXK.js";import{s as g}from"./multiselect-DeMhawmc.js";import{b as R}from"./toggle-CP_W0i88.js";import{F as b}from"./formMode-Bz--3d4P.js";const X={key:0,class:"relative col-span-2"},Y={key:0,class:"text-sm text-red-500"},Z={class:"relative"},ee={key:0,class:"text-sm text-red-500"},ae={class:"relative"},se={key:0,class:"text-sm text-red-500"},te={class:"relative"},le={key:0,class:"text-sm text-red-500"},re={class:"relative"},oe={key:0,class:"text-sm text-red-500"},ne={class:"relative"},ue=t("label",{class:"label"},"Partner",-1),de={class:"relative"},ie=t("label",{class:"label"},"Signature",-1),ce={class:"relative"},pe=t("label",{class:"label"},"View Dep.",-1),ve={class:"relative"},me=t("label",{class:"label"},"Auth Dep.",-1),be=["disabled"],xe=T({__name:"UserForm",emits:["close"],setup(he,{emit:$}){const S=$,U=H(),j=J(),e=i({}),P=i([]),h=L().user.branches,w=i([]),y=i(b.Create),f=i(!1),l=i({});Q(async()=>{h.length===1&&(e.value={branches:[h[0]]},_(),x()),U.path.endsWith("/edit")&&(y.value=b.Edit,await A(U.params.id))});const A=async r=>{const{data:a}=await m.get(`/api/users/${r}`);e.value=a.data,_(),x()},_=async()=>{const r=e.value.branches.flatMap(s=>s.id),{data:a}=await m.get(`/api/roles/list?branchId=${r.join(",")}`);P.value=a.data},x=async()=>{const r=e.value.branches.flatMap(s=>s.id),{data:a}=await m.get(`/api/departments/list?branchId=${r.join(",")}`);w.value=a.data},D=async()=>{P.value=[],w.value=[],e.value.roles=[],e.value.viewableDepartments=[],e.value.authorizableDepartments=[],x(),_()},I=r=>{const a=r.target.files[0],s=new FileReader;s.readAsDataURL(a),s.onload=()=>e.value.signature=s.result},M=async()=>{f.value=!0;try{y.value===b.Create?await B():await z(),l.value={},K.fire()}catch(r){l.value=r.response.data.errors??{}}f.value=!1},B=async()=>{await m.post("/api/users",e.value),E()},z=async()=>{await m.patch(`/api/users/${e.value.id}`,e.value),C()},E=()=>{e.value={branches:e.value.branches},l.value=[]},C=()=>{S("close"),j.back()};return(r,a)=>(u(),F(G,{"modal-class":"!w-[60rem]"},{header:V(()=>[N(c(y.value===o(b).Create?"Create New User":"Edit User"),1)]),body:V(()=>[t("form",{id:"form",onSubmit:W(M,["prevent","stop"]),class:"grid grid-cols-2 gap-4"},[o(h).length>1?(u(),p("div",X,[v(o(g),{modelValue:e.value.branches,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value.branches=s),mode:"tags",options:o(h),searchable:!0,object:!0,"value-prop":"id","track-by":"searchableForm",label:"name",onSelect:a[1]||(a[1]=s=>{_(),x()}),onDeselect:D,onClear:D,class:n(["px-0 input peer",{"border-red-500":l.value.hasOwnProperty("branches")}])},null,8,["modelValue","options","class"]),t("label",{class:n(["label",{"text-red-500":l.value.hasOwnProperty("branches")}])},"Branches",2),l.value.hasOwnProperty("branches")?(u(),p("p",Y,c(l.value.branches[0]),1)):d("",!0)])):d("",!0),t("div",Z,[k(t("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>e.value.name=s),class:n(["input peer",{"border-red-500":l.value.hasOwnProperty("name")}])},null,2),[[O,e.value.name]]),t("label",{class:n(["label",{"text-red-500":l.value.hasOwnProperty("name")}])},"Name",2),l.value.hasOwnProperty("name")?(u(),p("p",ee,c(l.value.name[0]),1)):d("",!0)]),t("div",ae,[k(t("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>e.value.username=s),class:n(["input peer",{"border-red-500":l.value.hasOwnProperty("username")}])},null,2),[[O,e.value.username]]),t("label",{class:n(["label",{"text-red-500":l.value.hasOwnProperty("username")}])},"Username",2),l.value.hasOwnProperty("username")?(u(),p("p",se,c(l.value.username[0]),1)):d("",!0)]),t("div",te,[k(t("input",{type:"password","onUpdate:modelValue":a[4]||(a[4]=s=>e.value.password=s),class:n(["input peer",{"border-red-500":l.value.hasOwnProperty("password")}])},null,2),[[O,e.value.password]]),t("label",{class:n(["label",{"text-red-500":l.value.hasOwnProperty("password")}])},"Password",2),l.value.hasOwnProperty("password")?(u(),p("p",le,c(l.value.password[0]),1)):d("",!0)]),t("div",re,[v(o(g),{modelValue:e.value.roles,"onUpdate:modelValue":a[5]||(a[5]=s=>e.value.roles=s),mode:"tags",options:P.value,searchable:!0,object:!0,"value-prop":"name",label:"displayName","track-by":"displayName",class:n(["px-0 input peer",{"border-red-500":l.value.hasOwnProperty("roles")}])},null,8,["modelValue","options","class"]),t("label",{class:n(["label",{"text-red-500":l.value.hasOwnProperty("roles")}])},"Roles",2),l.value.hasOwnProperty("roles")?(u(),p("p",oe,c(l.value.roles[0]),1)):d("",!0)]),t("div",ne,[v(o(R),{modelValue:e.value.isPartner,"onUpdate:modelValue":a[6]||(a[6]=s=>e.value.isPartner=s),class:"input peer pt-2.5"},null,8,["modelValue"]),ue]),t("div",de,[t("input",{type:"file",onChange:I,accept:"image/*",class:"file peer"},null,32),ie]),t("div",ce,[v(o(g),{modelValue:e.value.viewableDepartments,"onUpdate:modelValue":a[7]||(a[7]=s=>e.value.viewableDepartments=s),mode:"tags",options:w.value,searchable:!0,object:!0,"value-prop":"id","track-by":"searchableForm",label:"name",class:"px-0 input peer"},null,8,["modelValue","options"]),pe]),t("div",ve,[v(o(g),{modelValue:e.value.authorizableDepartments,"onUpdate:modelValue":a[8]||(a[8]=s=>e.value.authorizableDepartments=s),mode:"tags",options:w.value,searchable:!0,object:!0,"value-prop":"id","track-by":"searchableForm",label:"name",class:"px-0 input peer"},null,8,["modelValue","options"]),me])],32)]),footer:V(()=>[t("button",{class:"me-2 btn-blue",disabled:f.value,form:"form"},[v(q,{"is-loading":f.value},{default:V(()=>[N("Save")]),_:1},8,["is-loading"])],8,be),t("button",{onClick:C,class:"btn-gray"},"Cancel"),y.value===o(b).Edit?(u(),F(o(R),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":a[9]||(a[9]=s=>e.value.isActive=s),class:"toggle:off:red ms-auto"},null,8,["modelValue"])):d("",!0)]),_:1}))}});export{xe as default};
