import{d as O,e as l,u as $,x as F,Q as y,o as r,R as x,w as c,k as g,t as m,g as p,b as s,c as b,a as k,n as N,i as n,h as M,v as D,f as E,_ as U,a9 as z,m as A,l as L,Z as Q}from"./main-56f58ed8.js";import{u as W,_ as Z}from"./permissionsTree-62eea85c.js";import{s as j}from"./multiselect-167e14f5.js";import{F as v}from"./formMode-f60a729f.js";const q=["onSubmit"],G={key:0,class:"flex flex-wrap items-center mb-3"},H=s("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),J={key:0,class:"ml-24 w-full text-red-500 text-sm"},K={class:"flex flex-wrap items-center mb-3"},X=s("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Name",-1),Y={key:0,class:"w-full ml-24 text-red-500 text-sm"},ee=s("p",{class:"mb-1 pr-2"},"Permissions",-1),ae={key:0,class:"mb-1 text-sm text-red-500"},se=["disabled"],de=O({__name:"RoleForm",emits:["close"],setup(oe,{emit:V}){const _=A(),C=L(),e=l({}),{getPermissionsTree:P}=W(),f=l(v.Create),d=l(!1),a=l({}),h=l(null),i=$().user.branches;F(async()=>{i.length===1&&(e.value.branchId=i[0].id),_.path.endsWith("/edit")&&(f.value=v.Edit,await I(_.params.id)),h.value=await P()});const I=async u=>{const{data:o}=await y.get(`/api/roles/${u}`);e.value=o.data},R=async()=>{d.value=!0;try{f.value===v.Create?await S():await T(),Q.fire()}catch(u){a.value=u.response.data.errors??{}}d.value=!1},S=async()=>{await y.post("/api/roles",e.value),B()},T=async()=>{await y.patch(`/api/roles/${e.value.id}`,e.value),w()},B=()=>{e.value={},a.value=[]},w=()=>{V("close"),C.back()};return(u,o)=>(r(),x(z,null,{header:c(()=>[g(m(f.value===p(v).Create?"Create New Role":"Edit Role"),1)]),body:c(()=>[s("form",{id:"form",onSubmit:E(R,["prevent","stop"])},[p(i).length>1?(r(),b("div",G,[H,k(p(j),{modelValue:e.value.branchId,"onUpdate:modelValue":o[0]||(o[0]=t=>e.value.branchId=t),options:p(i),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:N(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("branchId")?(r(),b("p",J,m(a.value.branchId[0]),1)):n("",!0)])):n("",!0),s("div",K,[X,M(s("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>e.value.displayName=t),class:N(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("displayName")}])},null,2),[[D,e.value.displayName]]),a.value.hasOwnProperty("displayName")?(r(),b("p",Y,m(a.value.displayName[0]),1)):n("",!0)]),s("div",null,[ee,a.value.hasOwnProperty("permissions")?(r(),b("p",ae,m(a.value.permissions[0]),1)):n("",!0),h.value?(r(),x(Z,{key:1,options:h.value,modelValue:e.value.permissions,"onUpdate:modelValue":o[2]||(o[2]=t=>e.value.permissions=t),class:"max-h-[250px] overflow-y-auto border border-gray-300 py-2 rounded"},null,8,["options","modelValue"])):n("",!0)])],40,q)]),footer:c(()=>[s("button",{class:"btn-blue mr-2",disabled:d.value,form:"form"},[k(U,{"is-loading":d.value},{default:c(()=>[g("Save")]),_:1},8,["is-loading"])],8,se),s("button",{onClick:w,class:"btn-gray"},"Cancel")]),_:1}))}});export{de as default};
