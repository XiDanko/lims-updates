import{d as L,g as v,x as U,y as H,Q as F,o as i,c as b,b as e,a as w,j as x,v as M,a1 as N,i as r,R as A,k as j,W,w as T,F as B,T as q,s as E,r as G,V as Z,m as D,a2 as O,t as l,n as Y,Z as J,a3 as X,a6 as ee,q as I}from"./main-5548143a.js";import{M as te}from"./Master-c8d301f4.js";import{_ as se}from"./Paginator.vue_vue_type_script_setup_true_lang-d513ffa5.js";import{u as ae}from"./urlQueryManager-a6ec7c9d.js";import{i as oe}from"./index.es-721e1c12.js";import{d as ne}from"./datepickerPresets-afa0dfdf.js";import{s as re}from"./multiselect-30de6652.js";import{_ as le}from"./BarcodeScanner.vue_vue_type_script_setup_true_lang-45b89a9c.js";import{_ as de}from"./BranchFilter.vue_vue_type_script_setup_true_lang-9c1eb286.js";import{O as a}from"./orderStatus-e3a3f9a7.js";import{b as ie}from"./toggle-af3738b3.js";import{_ as ue,R as ce}from"./ResultsReleaseModal.vue_vue_type_script_setup_true_lang-a6513014.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./websocketPrint-65a486cc.js";import"./printTemplateManager-7d6de79b.js";const pe={class:"ml-auto flex flex-wrap items-center gap-2"},fe=["onKeyup"],he=["onKeyup"],me=e("option",{value:""},"Select status",-1),ge=["value"],be=["value"],ve=["value"],ye=["value"],_e=["value"],xe=["value"],we=["value"],$e=["value"],Re=["value"],Ce=["value"],ke={class:"flex items-center"},Pe=e("span",{class:"rounded-l border border-r-0 border-gray-300 p-1.5"},"Overdue",-1),Te=L({__name:"ResultsFilter",emits:["change"],setup(K,{emit:S}){const c=new URLSearchParams(location.search),{hasPermissionTo:z}=q(),$=ne,y=v(""),p=v(""),m=v(""),R=v(""),C=v(""),k=v(!1),f=v([null,null]),V=v([]);U(()=>{o(),s()});const t=H(()=>f.value[0]===null||f.value[1]===null?"":`${f.value[0]}~${f.value[1]}`),s=async()=>{if(!z("Partner.list"))return;const{data:h}=await F.get(`/api/partners/list?branchId=${y.value}`);V.value=h.data},n=h=>{R.value=h??"",_()},g=h=>{m.value=h,_()},o=()=>{y.value=c.get("branchId")??"",p.value=c.get("q")??"",m.value=c.get("visitNumber")??"",c.get("dateRange")&&(f.value=c.get("dateRange").split("~")),R.value=c.get("partnerId")??"",C.value=c.get("orderStatus")??"",k.value=!!c.get("onlyOverdueOrders")},P=()=>{const h=m.value;Q(),m.value=h,_()},_=()=>{let h=`branchId=${y.value}&visitNumber=${m.value}&q=${p.value}&partnerId=${R.value}&orderStatus=${C.value}&onlyOverdueOrders=${k.value}&dateRange=${t.value}&page=1`;S("change",h)},Q=()=>{y.value="",p.value="",m.value="",f.value=[null,null],R.value="",C.value=""};return(h,d)=>(i(),b(B,null,[e("div",pe,[w(de,{modelValue:y.value,"onUpdate:modelValue":d[0]||(d[0]=u=>y.value=u),onChange:d[1]||(d[1]=u=>{_(),h.fetchOptions()})},null,8,["modelValue"]),x(e("input",{"onUpdate:modelValue":d[2]||(d[2]=u=>m.value=u),onKeyup:N(P,["enter"]),type:"text",placeholder:"Registration number",class:"w-56 rounded border border-gray-300 p-1.5 focus:border-blue-500"},null,40,fe),[[M,m.value]]),x(e("input",{"onUpdate:modelValue":d[3]||(d[3]=u=>p.value=u),onKeyup:N(_,["enter"]),type:"text",placeholder:"Name or phone number",class:"w-56 rounded border border-gray-300 p-1.5 focus:border-blue-500"},null,40,he),[[M,p.value]]),r(z)("Partner.list")?(i(),A(r(re),{key:0,"model-value":R.value,options:V.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,placeholder:"Select partner",onChange:n,class:"w-56 min-h-[38px] border border-gray-300 !rounded"},null,8,["model-value","options"])):j("",!0),x(e("select",{"onUpdate:modelValue":d[4]||(d[4]=u=>C.value=u),onChange:_,class:"px-2 h-[38px] border border-gray-300 !rounded"},[me,e("option",{value:r(a).Pending},"Pending",8,ge),e("option",{value:r(a).Pending},"Collected",8,be),e("option",{value:r(a).Accepted},"Accepted",8,ve),e("option",{value:r(a).InProgress},"In Progress",8,ye),e("option",{value:r(a).Received},"Received",8,_e),e("option",{value:r(a).Tested},"Tested",8,xe),e("option",{value:r(a).Authorized},"Authorized",8,we),e("option",{value:r(a).Released},"Released",8,$e),e("option",{value:r(a).Rejected},"Rejected",8,Re),e("option",{value:r(a).Canceled},"Canceled",8,Ce)],544),[[W,C.value]]),e("div",ke,[Pe,w(r(ie),{modelValue:k.value,"onUpdate:modelValue":d[5]||(d[5]=u=>k.value=u),onChange:_,class:"flex-1 rounded-r border border-gray-300 p-1.5"},null,8,["modelValue"])]),w(r(oe),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:r($),placeholder:"Select date range",value:f.value,"onUpdate:value":d[6]||(d[6]=u=>f.value=u),onChange:_,class:"!w-56 mr-2","input-class":"w-full rounded border border-gray-300 p-1.5 focus:border-blue-500"},{"icon-calendar":T(()=>[]),_:1},8,["shortcuts","value"])]),w(le,{onScan:g})],64))}}),De={class:"mb-5 flex items-center"},Se={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},ze={class:"w-full"},Ve=e("thead",null,[e("tr",{class:"sticky top-0 z-10 text-left"},[e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"No."),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Name"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Gender"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Age"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Phone Number"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Lab"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Tests"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Status"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Total Charges"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Paid Amount"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Due Balance"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Date"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Branch"),e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"})])],-1),Ae={class:"transition even:bg-gray-100"},Be={class:"border border-gray-200 p-1"},Ie={class:"whitespace-nowrap border border-gray-200 p-1"},Me={class:"border border-gray-200 p-1"},Ne={class:"whitespace-nowrap border border-gray-200 p-1"},Oe={class:"border border-gray-200 p-1"},Ye={class:"whitespace-nowrap border border-gray-200 p-1"},Le={class:"border border-gray-200 p-1"},Ue={class:"flex flex-wrap items-center gap-1 max-w-[18rem]"},Fe={class:"border border-gray-200 p-1"},je={class:"border border-gray-200 p-1"},qe={key:1},Ke={class:"border border-gray-200 p-1"},Qe={key:1},He={key:1},We={class:"whitespace-nowrap border border-gray-200 p-1"},Ee={class:"border border-gray-200 p-1"},Ge={class:"border border-gray-200 p-1 text-center"},Ze={class:"flex justify-center"},Je=["onClick"],Xe=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"},null,-1),et=[Xe],gt=L({__name:"Results",setup(K){const S=v([]),c=v({}),{updateUrlQuery:z}=ae(),{hasPermissionTo:$}=q(),y=setInterval(()=>p(location.search),15e3);U(()=>p(location.search)),E(()=>clearInterval(y));const p=async t=>{const s=await z(t),{data:n}=await F.get(`/api/results?${s}`);S.value=n.data,c.value=n.meta},m=t=>!(!$("Result.print")||t.orders.find(n=>![a.Authorized,a.Released,a.Canceled].includes(n.status)&&!n.test.bypass)||t.invoice.dueBalance>0&&!$("Result.printDue")),R=async t=>{if(t.invoice.dueBalance>0){const{isConfirmed:s}=await J.fire({html:`Patient has due balance of ${t.invoice.dueBalance?.toLocaleString()}`});if(!s)return}X.emit(ee.Show,{visit:t,orders:t.orders,releaseType:ce.Print})},C=t=>{const s=t.orders.flatMap(n=>n.status);if(s.includes(a.Rejected))return"rejected";if(s.includes(a.Pending))return"pending";if(s.includes(a.Collected))return"collected";if(s.includes(a.Accepted))return"accepted";if(s.includes(a.InProgress))return"in-progress";if(s.includes(a.Received))return"received";if(s.includes(a.Tested))return"tested";if(s.includes(a.Authorized))return"authorized";if(s.includes(a.Released))return"released";if(s.includes(a.Canceled))return"canceled"},k=t=>{let s="";return t.status===a.Pending?s="bg-gray-300 text-black":t.status===a.Collected?s="bg-yellow-400 text-black":t.status===a.Accepted?s="bg-orange-500 text-white":t.status===a.InProgress?s="bg-cyan-500 text-white":t.status===a.Received?s="bg-blue-500 text-white":t.status===a.Tested?s="bg-purple-500 text-white":t.status===a.Authorized?s="bg-emerald-500 text-white":t.status===a.Released?s="bg-gray-800 text-white":(t.status===a.Rejected||t.status===a.Canceled)&&(s="bg-red-500 text-white"),f(t)>0&&(s+=" border-2 border-red-600"),s},f=t=>{if(!t.overdueDate)return 0;const s=I(t.overdueDate,"YYYY-MM-DD hh:mm a");let n=I();return[a.Authorized,a.Released].includes(t.status)&&t.authorizationDate&&(n=I(t.authorizationDate,"YYYY-MM-DD hh:mm a")),n.diff(s,"minutes")},V=t=>{let s=null;t.status===a.Pending?s=t.date:t.status===a.Collected?s=t.collectionDate:t.status===a.Accepted?s=t.accessionDate:t.status===a.InProgress?s=t.inProgressDate:t.status===a.Received?s=t.receiveDate:t.status===a.Tested?s=t.testingDate:t.status===a.Authorized?s=t.authorizationDate:t.status===a.Released?s=t.releaseDate:s=null;const n=f(t);let g=n+" minutes";n/60>1&&(g=(n/60).toFixed(1)+" hours");let o=`<p>${t.status.capitalize()}`;return s&&(o+=` (${s}) </p>`),t.test.turnaroundTime&&(o+=`<p>TAT: ${t.test.turnaroundTime}</p>`),n>0&&(o+=`<p>Overdue: ${g}</p>`),o};return(t,s)=>{const n=G("router-link"),g=Z("tip");return i(),b(B,null,[w(te,null,{header:T(()=>[D("Results")]),body:T(()=>[e("div",De,[w(Te,{onChange:p})]),e("section",Se,[e("table",ze,[Ve,e("tbody",null,[(i(!0),b(B,null,O(S.value,o=>(i(),b("tr",Ae,[e("td",Be,l(o.number),1),e("td",Ie,l(o.patient.name),1),e("td",Me,l(o.patient.gender.capitalize()),1),e("td",Ne,l(o.patient.age),1),e("td",Oe,l(o.patient.phoneNumber),1),e("td",Ye,l(o.lab?.name??"local"),1),e("td",Le,[e("div",Ue,[(i(!0),b(B,null,O(o.orders,P=>x((i(),b("span",{class:Y(["inline-block cursor-pointer rounded px-1 text-xs",k(P)])},[D(l(P.test.shortForm),1)],2)),[[g,V(P)]])),256))])]),e("td",Fe,l(C(o).capitalize()),1),e("td",je,[r($)("Invoice.index")?x((i(),A(n,{key:0,to:`/invoices?number=${o.invoice.number}`,class:"text-blue-500 underline"},{default:T(()=>[D(l(o.invoice.total?.toLocaleString()),1)]),_:2},1032,["to"])),[[g,"View Invoice"]]):(i(),b("span",qe,l(o.invoice.total?.toLocaleString()),1))]),e("td",Ke,[r($)("Transaction.index")?x((i(),A(n,{key:0,to:`/transactions?invoiceNumber=${o.invoice.number}`,class:"text-blue-500 underline"},{default:T(()=>[D(l(o.invoice.paidAmount?.toLocaleString()),1)]),_:2},1032,["to"])),[[g,"View Transactions"]]):(i(),b("span",Qe,l(o.invoice.paidAmount?.toLocaleString()),1))]),e("td",{class:Y(["border border-gray-200 p-1",{"font-semibold text-red-500":o.invoice.dueBalance>0}])},[r($)("Invoice.pay")&&o.invoice.dueBalance>0?x((i(),A(n,{key:0,class:"underline",to:`/invoices/${o.invoice.id}/transactions/payment/create`},{default:T(()=>[D(l(o.invoice.dueBalance?.toLocaleString()),1)]),_:2},1032,["to"])),[[g,"Create Payment"]]):(i(),b("span",He,l(o.invoice.dueBalance?.toLocaleString()),1))],2),e("td",We,l(o.date),1),e("td",Ee,l(o.branch.name),1),e("td",Ge,[e("div",Ze,[m(o)?x((i(),b("svg",{key:0,class:"h-6 w-6 cursor-pointer text-blue-500",onClick:P=>R(o),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},et,8,Je)),[[g,"Print"]]):j("",!0)])])]))),256))])])])]),_:1}),w(se,{data:c.value,onChange:s[0]||(s[0]=o=>p(`page=${o}`)),class:"mt-3"},null,8,["data"]),w(ue,{onClose:p})],64)}}});export{gt as default};
