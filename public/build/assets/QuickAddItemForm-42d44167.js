import{d as U,u as D,e as i,x as R,A as c,B as z,o as d,C as V,w as m,k as C,t as n,g as o,b as t,c as p,a as g,n as y,i as u,h as S,J,v as L,f as Q,_ as W,V as j,m as G,l as H,S as K}from"./main-c1f62c61.js";import{s as O}from"./multiselect-ffe70d49.js";import{F as v}from"./formMode-f60a729f.js";import{I as w}from"./itemType-8f96b3f7.js";import{b as X}from"./toggle-b89396fa.js";const Y=["onSubmit"],Z={key:0,class:"flex flex-wrap items-start mb-3"},ee=t("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),ae={key:0,class:"ml-24 w-full text-red-500 text-sm"},te={class:"flex flex-wrap items-start mb-3"},re=t("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Type",-1),se=["value"],oe=["value"],le=["value"],de={key:0,class:"ml-24 w-full text-red-500 text-sm"},ne={class:"flex flex-wrap items-start mb-3"},ue=t("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Item",-1),ie={class:"truncate"},ce={key:0,class:"ml-24 w-full text-red-500 text-sm"},me={class:"flex flex-wrap items-center"},pe=t("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Order",-1),ve={key:0,class:"w-full ml-24 text-red-500 text-sm"},be=["disabled"],xe=U({__name:"QuickAddItemForm",emits:["close"],setup(he,{emit:P}){const x=G(),A=H(),b=D().user.branches,e=i({}),_=i([]),h=i(v.Create),f=i(!1),r=i({});R(()=>{b.length===1&&(e.value.branchId=b[0].id),x.path.endsWith("/edit")&&(h.value=v.Edit,B(x.params.id))});const I=async()=>{if(!e.value.branchId)return;const{data:l}=await c.get(`/api/${e.value.itemType}s/list?branchId=${e.value.branchId}`);l.data.forEach(a=>a.label=a.shortForm??a.name),_.value=l.data},B=async l=>{const{data:a}=await c.get(`/api/quick-add-items/${l}`);e.value=a.data,I()},k=async()=>{const{data:l}=await c.post("/api/quick-add-items/generate-order",{branchId:e.value.branchId});e.value.order=l},$=()=>{e.value.itemId=null,e.value.itemType=null,_.value=[]},F=async()=>{f.value=!0;try{h.value===v.Create?await q():await E(),K.fire()}catch(l){r.value=l.response.data.errors??{}}f.value=!1},q=async()=>{await c.post("/api/quick-add-items",e.value),M()},E=async()=>{await c.patch(`/api/quick-add-items/${e.value.id}`,e.value),T()},M=()=>{e.value={branchId:e.value.branchId,itemType:e.value.itemType},k(),r.value=[]},T=()=>{P("close"),A.back()};return(l,a)=>{const N=z("maska");return d(),V(j,null,{header:m(()=>[C(n(h.value===o(v).Create?"Create New Item":"Edit Item"),1)]),body:m(()=>[t("form",{id:"form",onSubmit:Q(F,["prevent","stop"])},[o(b).length>1?(d(),p("div",Z,[ee,g(o(O),{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value.branchId=s),options:o(b),onSelect:k,onChange:$,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:y(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":r.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),r.value.hasOwnProperty("branchId")?(d(),p("p",ae,n(r.value.branchId[0]),1)):u("",!0)])):u("",!0),t("div",te,[re,S(t("select",{"onUpdate:modelValue":a[1]||(a[1]=s=>e.value.itemType=s),onChange:a[2]||(a[2]=s=>{I(),e.value.itemId=null}),class:y(["flex-1 px-2 py-1 h-[42px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":r.value.hasOwnProperty("itemType")}])},[t("option",{value:o(w).Test},"Test",8,se),t("option",{value:o(w).Package},"Package",8,oe),t("option",{value:o(w).Service},"Service",8,le)],34),[[J,e.value.itemType]]),r.value.hasOwnProperty("itemType")?(d(),p("p",de,n(r.value.itemType[0]),1)):u("",!0)]),t("div",ne,[ue,g(o(O),{modelValue:e.value.itemId,"onUpdate:modelValue":a[3]||(a[3]=s=>e.value.itemId=s),options:_.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"label",class:y(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":r.value.hasOwnProperty("itemId")}])},{option:m(({option:s})=>[t("span",ie,n(s.label),1)]),_:1},8,["modelValue","options","class"]),r.value.hasOwnProperty("itemId")?(d(),p("p",ce,n(r.value.itemId[0]),1)):u("",!0)]),t("div",me,[pe,S(t("input",{"onUpdate:modelValue":a[4]||(a[4]=s=>e.value.order=s),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",class:y(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":r.value.hasOwnProperty("order")}])},null,2),[[L,e.value.order],[N]]),r.value.hasOwnProperty("order")?(d(),p("p",ve,n(r.value.order[0]),1)):u("",!0)])],40,Y)]),footer:m(()=>[t("button",{class:"btn-blue mr-2",disabled:f.value,form:"form"},[g(W,{"is-loading":f.value},{default:m(()=>[C("Save")]),_:1},8,["is-loading"])],8,be),t("button",{onClick:T,class:"btn-gray"},"Cancel"),h.value===o(v).Edit?(d(),V(o(X),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":a[5]||(a[5]=s=>e.value.isActive=s),class:"ml-auto toggle:off:red"},null,8,["modelValue"])):u("",!0)]),_:1})}}});export{xe as default};
