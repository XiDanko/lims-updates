import{d as F,f as E,e as M,g as p,u as U,y as z,aa as k,x as A,Q as y,o as l,R as D,w as h,m as V,t as m,b as r,i as f,c as d,a as g,n as _,k as c,j,v as L,h as Q,_ as W,a5 as q,a0 as G}from"./main-5548143a.js";import{_ as H}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-3ebc070d.js";import{F as i}from"./formMode-f60a729f.js";import{T as x}from"./transactionType-f4dd2750.js";import{s as O}from"./multiselect-30de6652.js";const J=["onSubmit"],K={key:0,class:"mb-3 flex flex-wrap items-center"},X=r("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Branch",-1),Y={key:0,class:"ml-24 w-full text-sm text-red-500"},Z={key:1,class:"mb-3 flex flex-wrap items-center"},ee=r("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"To Register",-1),ae={key:0,class:"ml-24 w-full text-sm text-red-500"},se={class:"mb-3 flex flex-wrap items-center"},te=r("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Amount",-1),re={key:0,class:"ml-24 w-full text-sm text-red-500"},oe={class:"flex flex-wrap items-center"},ne=r("span",{class:"w-full"},"Notes",-1),le={key:0,class:"w-full text-sm text-red-500"},de=["disabled"],be=F({__name:"RegisterTransactionForm",emits:["close"],setup(ce,{emit:R}){const o=E(),C=M(),I=p([]),b=U().user.branches,e=p({}),u=p(i.Create),v=p(!1),a=p([]),$=z(()=>{let s;return u.value===i.Create?s="Add "+k.capitalize(o.params.transactionType):u.value===i.Edit&&(s="Edit "+k.capitalize(e.value.transactionType)),s});A(async()=>{u.value===i.Create&&(e.value.type=o.params.transactionType==="transfer"?x.TransferOut:o.params.transactionType),b.length===1&&(e.value.branchId=b[0].id,T()),o.path.endsWith("/edit")&&(u.value=i.Edit,await P())});const P=async()=>{const{data:s}=await y.get(`/api/registers/${o.params.registerId}/transactions/${o.params.transactionId}/show`);e.value=s.data},T=async()=>{if(e.value.type!==x.TransferOut)return;const{data:s}=await y.get(`/api/registers/list?branchId=${e.value.branchId}`);I.value=s.data},N=async()=>{v.value=!0;try{u.value===i.Create?await S():await B(),a.value={},G.fire()}catch(s){a.value=s.response.data.errors??{}}v.value=!1},S=async()=>{await y.post(`/api/registers/${o.params.registerId}/transactions`,e.value),w()},B=async()=>{await y.patch(`/api/registers/${o.params.registerId}/transactions/${o.params.transactionId}`,e.value),w()},w=()=>{R("close"),C.back()};return(s,t)=>(l(),D(q,null,{header:h(()=>[V(m($.value),1)]),body:h(()=>[r("form",{id:"form",onSubmit:Q(N,["prevent","stop"])},[f(b).length>1?(l(),d("div",K,[X,g(f(O),{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=n=>e.value.branchId=n),options:f(b),onSelect:T,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-clear":!1,"can-deselect":!1,class:_(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("branchId")?(l(),d("p",Y,m(a.value.branchId[0]),1)):c("",!0)])):c("",!0),e.value.type===f(x).TransferOut?(l(),d("div",Z,[ee,g(f(O),{modelValue:e.value.referenceRegisterId,"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.referenceRegisterId=n),options:I.value,searchable:!0,"value-prop":"id","track-by":"userName",label:"userName","can-clear":!1,"can-deselect":!1,class:_(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("referenceRegisterId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("referenceRegisterId")?(l(),d("p",ae,m(a.value.referenceRegisterId[0]),1)):c("",!0)])):c("",!0),r("div",se,[te,g(H,{modelValue:e.value.amount,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.amount=n),class:_(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("amount")}])},null,8,["modelValue","class"]),a.value.hasOwnProperty("amount")?(l(),d("p",re,m(a.value.amount[0]),1)):c("",!0)]),r("div",oe,[ne,j(r("textarea",{"onUpdate:modelValue":t[3]||(t[3]=n=>e.value.notes=n),rows:"4",class:_(["flex-1 rounded border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("notes")}])},null,2),[[L,e.value.notes]]),a.value.hasOwnProperty("notes")?(l(),d("p",le,m(a.value.notes[0]),1)):c("",!0)])],40,J)]),footer:h(()=>[r("button",{class:"mr-2 btn-blue",disabled:v.value,form:"form"},[g(W,{"is-loading":v.value},{default:h(()=>[V("Save")]),_:1},8,["is-loading"])],8,de),r("button",{onClick:w,class:"btn-gray"},"Cancel")]),_:1}))}});export{be as default};
