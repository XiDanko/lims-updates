import{d as k,f as B,e as M,g as i,y as N,aa as f,x as S,Q as d,o as b,R as E,w as u,m as y,t as _,b as s,a as h,n as F,c as z,k as D,j as R,v as A,h as O,_ as P,a5 as U,a0 as j}from"./main-cee2eb24.js";import{_ as L}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-8eeeffea.js";import{F as n}from"./formMode-f60a729f.js";import{T as Q}from"./transactionType-f4dd2750.js";const W=["onSubmit"],q={class:"mb-3 flex flex-wrap items-center"},G=s("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Amount",-1),H={key:0,class:"ml-24 w-full text-sm text-red-500"},J={class:"flex flex-wrap items-center"},K=s("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Notes",-1),X=["disabled"],sa=k({__name:"InvoiceTransactionForm",emits:["close"],setup(Y,{emit:w}){const t=B(),g=M(),m=i({}),a=i({}),r=i(n.Create),c=i(!1),l=i([]),x=N(()=>{let e;return r.value===n.Create?e="Add "+f.capitalize(t.params.transactionType):r.value===n.Edit&&(e="Edit "+f.capitalize(a.value.transactionType)),e});S(async()=>{t.path.endsWith("/edit")&&(r.value=n.Edit,T()),r.value===n.Create&&(a.value.type=t.params.transactionType,await C(),a.value.type!==Q.Discount&&(a.value.amount=Math.abs(m.value.dueBalance)))});const T=async()=>{const{data:e}=await d.get(`/api/invoices/${t.params.invoiceId}/transactions/${t.params.transactionId}/show`);a.value=e.data,m.value=e.data.invoice},C=async()=>{const{data:e}=await d.get(`/api/invoices/${t.params.invoiceId}`);m.value=e.data,a.value.invoiceId=e.data.id},I=async()=>{c.value=!0;try{r.value===n.Create?await $():await V(),j.fire()}catch(e){l.value=e.response.data.errors??{}}c.value=!1},$=async()=>{await d.post(`/api/invoices/${t.params.invoiceId}/transactions`,a.value),p()},V=async()=>{await d.patch(`/api/invoices/${t.params.invoiceId}/transactions/${t.params.transactionId}`,a.value),p()},p=()=>{w("close"),g.back()};return(e,o)=>(b(),E(U,null,{header:u(()=>[y(_(x.value),1)]),body:u(()=>[s("form",{id:"form",onSubmit:O(I,["prevent","stop"])},[s("div",q,[G,h(L,{modelValue:a.value.amount,"onUpdate:modelValue":o[0]||(o[0]=v=>a.value.amount=v),class:F(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":l.value.hasOwnProperty("amount")}])},null,8,["modelValue","class"]),l.value.hasOwnProperty("amount")?(b(),z("p",H,_(l.value.amount[0]),1)):D("",!0)]),s("div",J,[K,R(s("input",{"onUpdate:modelValue":o[1]||(o[1]=v=>a.value.notes=v),class:"flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,512),[[A,a.value.notes]])])],40,W)]),footer:u(()=>[s("button",{class:"mr-2 btn-blue",disabled:c.value,form:"form"},[h(P,{"is-loading":c.value},{default:u(()=>[y("Save")]),_:1},8,["is-loading"])],8,X),s("button",{onClick:p,class:"btn-gray"},"Cancel")]),_:1}))}});export{sa as default};
