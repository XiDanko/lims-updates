import{d as M,e as l,y as N,x as E,Q as u,o as f,R as F,w as d,k as _,t as y,b as s,a as h,n as b,c as S,i as z,h as D,v as O,f as P,_ as R,a4 as A,m as U,l as L,a8 as w,$ as Q}from"./main-DmoZ1fz4.js";import{_ as W}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-DHwtVm0K.js";import{F as i}from"./formMode-Bz--3d4P.js";import{T as j}from"./transactionType-BTQWP0LV.js";const q={class:"grid grid-cols-1 gap-4"},G={class:"relative"},H={key:0,class:"text-sm text-red-500"},J={class:"relative"},K=s("label",{class:"label"},"Notes",-1),X=["disabled"],sa=M({__name:"InvoiceTransactionForm",emits:["close"],setup(Y,{emit:T}){const g=T,t=U(),x=L(),m=l({}),a=l({}),c=l(i.Create),r=l(!1),o=l({}),C=N(()=>{let e;return c.value===i.Create?e="Add "+w.capitalize(t.params.transactionType):c.value===i.Edit&&(e="Edit "+w.capitalize(a.value.transactionType)),e});E(async()=>{t.path.endsWith("/edit")&&(c.value=i.Edit,I()),c.value===i.Create&&(a.value.type=t.params.transactionType,await $(),a.value.type!==j.Discount&&(a.value.amount=Math.abs(m.value.dueBalance)))});const I=async()=>{const{data:e}=await u.get(`/api/invoices/${t.params.invoiceId}/transactions/${t.params.transactionId}/show`);a.value=e.data,m.value=e.data.invoice},$=async()=>{const{data:e}=await u.get(`/api/invoices/${t.params.invoiceId}`);m.value=e.data,a.value.invoiceId=e.data.id},V=async()=>{r.value=!0;try{c.value===i.Create?await k():await B(),o.value={},Q.fire()}catch(e){o.value=e.response.data.errors??{}}r.value=!1},k=async()=>{await u.post(`/api/invoices/${t.params.invoiceId}/transactions`,a.value),p()},B=async()=>{await u.patch(`/api/invoices/${t.params.invoiceId}/transactions/${t.params.transactionId}`,a.value),p()},p=()=>{g("close"),x.back()};return(e,n)=>(f(),F(A,null,{header:d(()=>[_(y(C.value),1)]),body:d(()=>[s("form",{id:"form",onSubmit:P(V,["prevent","stop"])},[s("div",q,[s("div",G,[h(W,{modelValue:a.value.amount,"onUpdate:modelValue":n[0]||(n[0]=v=>a.value.amount=v),class:b(["input peer",{"border-red-500":o.value.hasOwnProperty("amount")}])},null,8,["modelValue","class"]),s("label",{class:b(["label",{"text-red-500":o.value.hasOwnProperty("amount")}])},"Amount",2),o.value.hasOwnProperty("amount")?(f(),S("p",H,y(o.value.amount[0]),1)):z("",!0)]),s("div",J,[D(s("input",{"onUpdate:modelValue":n[1]||(n[1]=v=>a.value.notes=v),class:"input peer"},null,512),[[O,a.value.notes]]),K])])],32)]),footer:d(()=>[s("button",{class:"me-2 btn-blue",disabled:r.value,form:"form"},[h(R,{"is-loading":r.value},{default:d(()=>[_("Save")]),_:1},8,["is-loading"])],8,X),s("button",{onClick:p,class:"btn-gray"},"Cancel")]),_:1}))}});export{sa as default};
