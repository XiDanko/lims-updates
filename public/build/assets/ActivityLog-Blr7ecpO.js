import{d as U,e as d,x as I,y as V,Q as M,A as B,o,c as a,g as x,a as b,i as C,b as e,h as $,v as T,V as Q,w as j,T as z,k as N,F as w,a1 as k,m as Y,t as _}from"./main-DmoZ1fz4.js";import{M as E}from"./Master-ql31p3jM.js";import{_ as P}from"./Paginator.vue_vue_type_script_setup_true_lang-B5QeFegy.js";import{u as q}from"./urlQueryManager-DRfC3SWK.js";import{s as H}from"./multiselect-DAhRltj6.js";import{d as O}from"./datepickerPresets-DxjH1h4T.js";import{i as W}from"./index.es-CV7LqIVy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"flex flex-wrap items-center gap-2 ms-auto"},J={key:0,class:"relative flex-1 min-w-[10rem]"},K=e("label",{class:"label"},"User",-1),X={class:"relative flex-1 min-w-[10rem]"},Z=e("label",{class:"label"},"Subject Type",-1),ee={class:"relative flex-1 min-w-[10rem]"},te=e("label",{class:"label"},"Subject Id",-1),se={class:"relative flex-1 min-w-[10rem]"},oe=e("option",{value:""},"All",-1),ae=e("option",{value:"created"},"Created",-1),le=e("option",{value:"updated"},"Updated",-1),ne=e("option",{value:"deleted"},"Deleted",-1),re=[oe,ae,le,ne],de=e("label",{class:"label"},"Event",-1),ue={class:"relative flex-1 min-w-[14rem]"},ce=e("label",{class:"label"},"Date",-1),ie=U({__name:"ActivityLogFilter",emits:["change"],setup(L,{expose:i,emit:f}){const g=f,u=new URLSearchParams(location.search),{hasPermissionTo:v}=z(),m=d([]),l=d(""),t=d(""),s=d(""),r=d(""),n=d([null,null]);I(()=>{A(),F()});const D=V(()=>n.value[0]===null||n.value[1]===null?"":`${n.value[0]}~${n.value[1]}`),A=()=>{l.value=u.get("userId")??"",t.value=u.get("subjectType")??"",s.value=u.get("subjectId")??"",r.value=u.get("event")??"",u.get("dateRange")&&(n.value=u.get("dateRange").split("~"))},F=async()=>{if(!v("User.list"))return;const{data:h}=await M.get("/api/users/list");m.value=h.data},R=h=>{l.value=h??""},S=()=>{l.value="",t.value="",s.value="",r.value="",n.value=[null,null],y()},y=()=>{const h=`userId=${l.value}&subjectType=${t.value}&subjectId=${s.value}&event=${r.value}&dateRange=${D.value}&page=1`;g("change",h)};return B([l,t,s,r,n],()=>y()),i({userId:l,subjectType:t,subjectId:s,event:r,filter:y}),(h,c)=>(o(),a("div",G,[x(v)("User.list")?(o(),a("div",J,[b(x(H),{"model-value":l.value,options:m.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,onChange:R,class:"input-sm peer"},null,8,["model-value","options"]),K])):C("",!0),e("div",X,[$(e("input",{"onUpdate:modelValue":c[0]||(c[0]=p=>t.value=p),type:"text",class:"input-sm peer"},null,512),[[T,t.value]]),Z]),e("div",ee,[$(e("input",{"onUpdate:modelValue":c[1]||(c[1]=p=>s.value=p),type:"text",class:"input-sm peer"},null,512),[[T,s.value]]),te]),e("div",se,[$(e("select",{"onUpdate:modelValue":c[2]||(c[2]=p=>r.value=p),class:"input-sm peer"},re,512),[[Q,r.value]]),de]),e("div",ue,[b(x(W),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:x(O),value:n.value,"onUpdate:value":c[3]||(c[3]=p=>n.value=p),onChange:y,class:"w-full peer","input-class":"input-sm pt-0.5"},{"icon-calendar":j(()=>[]),_:1},8,["shortcuts","value"]),ce]),e("span",{class:"btn-gray",onClick:S},"Clear")]))}}),pe={class:"mb-5 flex items-start gap-1"},_e={class:"pe-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},ve={class:"w-full"},he=e("thead",null,[e("tr",{class:"sticky top-0 z-10 text-left"},[e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"}),e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"User"),e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Subject Type"),e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Subject ID"),e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Event"),e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Date")])],-1),me={class:"even:bg-gray-100"},be=["onClick"],fe={key:0},ge={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"mx-auto h-6 w-6"},ye=e("path",{"fill-rule":"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z","clip-rule":"evenodd"},null,-1),xe=[ye],we={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"mx-auto h-6 w-6"},$e=e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z","clip-rule":"evenodd"},null,-1),ke=[$e],Ce={class:"border border-gray-200 px-2 py-1"},je=["onClick"],Te={class:"border border-gray-200 px-2 py-1"},Ue=["onClick"],Ie={class:"border border-gray-200 px-2 py-1"},Me=["onClick"],Le={class:"border border-gray-200 px-2 py-1"},De=["onClick"],Ae={class:"border border-gray-200 px-2 py-1"},Fe={key:0,class:"bg-white"},Re={colspan:"100%",class:"border border-gray-200 p-2"},Se={class:"w-full border-separate border-spacing-y-1.5"},Ve={class:"whitespace-nowrap rounded-l bg-blue-500 px-1 text-white"},Be={key:0,class:"w-full border border-gray-200 px-1 rounded-e"},Qe={class:"flex flex-wrap items-center gap-1"},ze={class:"rounded bg-teal-500 px-1 text-xs font-bold text-white"},Ne=["innerHTML"],Je=U({__name:"ActivityLog",setup(L){const i=d(null),f=d([]),g=d({}),{updateUrlQuery:u}=q();Y(),I(()=>v(location.search));const v=async m=>{const l=await u(m),{data:t}=await M.get(`/api/activity-log?${l}`);f.value=t.data,g.value=t.meta};return(m,l)=>(o(),a(w,null,[b(E,null,{header:j(()=>[N("Activity Log")]),body:j(()=>[e("div",pe,[b(ie,{ref_key:"logFilter",ref:i,onChange:v},null,512)]),e("section",_e,[e("table",ve,[he,(o(!0),a(w,null,k(f.value,t=>(o(),a("tbody",me,[e("tr",null,[e("td",{class:"w-12 cursor-pointer border border-gray-200 py-1",onClick:s=>t.expanded=!t.expanded},[t.data?(o(),a("div",fe,[t.expanded?(o(),a("svg",we,ke)):(o(),a("svg",ge,xe))])):C("",!0)],8,be),e("td",Ce,[e("span",{class:"cursor-pointer hover:text-blue-500 hover:underline",onClick:s=>i.value.userId=t.causer.id},_(t.causer.name),9,je)]),e("td",Te,[e("span",{class:"cursor-pointer hover:text-blue-500 hover:underline",onClick:s=>i.value.subjectType=t.subjectType},_(t.subjectType.startCase()),9,Ue)]),e("td",Ie,[e("span",{class:"cursor-pointer hover:text-blue-500 hover:underline",onClick:s=>i.value.subjectId=t.subjectId},_(t.subjectId),9,Me)]),e("td",Le,[e("span",{class:"cursor-pointer hover:text-blue-500 hover:underline",onClick:s=>i.value.event=t.event},_(t.event.startCase()),9,De)]),e("td",Ae,_(t.date),1)]),t.expanded?(o(),a("tr",Fe,[e("td",Re,[e("table",Se,[(o(!0),a(w,null,k(t.data,(s,r)=>(o(),a("tr",null,[e("td",Ve,_(r.startCase()),1),s instanceof Array?(o(),a("td",Be,[e("div",Qe,[(o(!0),a(w,null,k(s,n=>(o(),a("span",ze,_(n),1))),256))])])):(o(),a("td",{key:1,class:"w-full break-all border border-gray-200 px-1 rounded-e",innerHTML:s},null,8,Ne))]))),256))])])])):C("",!0)]))),256))])])]),_:1}),b(P,{data:g.value,onChange:l[0]||(l[0]=t=>v(`page=${t}`)),class:"mt-3"},null,8,["data"])],64))}});export{Je as default};
