import{d as Z,e as n,am as ae,x as ee,y as j,Q as D,o as c,c as p,b as e,a as x,h as B,v as Q,a0 as G,g as a,i as f,w as A,t as y,n as z,V as re,ad as ye,F as q,T as ne,a2 as F,an as xe,ao as J,a8 as $e,s as ce,R as ie,k as Y,f as we,_ as Ce,a4 as ke,$ as X,r as Se,U as Ie,a1 as oe,ae as Re,Y as le,ab as Pe,ac as Ae,a3 as Oe,a5 as Te}from"./main-DNdNUUJ7.js";import{M as Ve}from"./Master-b_S4sXaO.js";import{_ as Be}from"./Paginator.vue_vue_type_script_setup_true_lang-ByzTMpQ9.js";import{u as De}from"./urlQueryManager-rKHuCRUp.js";import{i as Me}from"./index.es-CdvJf4Rl.js";import{_ as Ne}from"./BarcodeScanner.vue_vue_type_script_setup_true_lang-C0wcZ2Vb.js";import{s as E}from"./multiselect-K4eUN8Nz.js";import{O as s}from"./orderStatus-Cdywi7Or.js";import{_ as ze}from"./BranchFilter.vue_vue_type_script_setup_true_lang-CgUfq7jM.js";import{d as Fe}from"./datepickerPresets-BpsxgrFD.js";import{_ as Le,R as Ue}from"./ResultsReleaseModal.vue_vue_type_script_setup_true_lang-CsmVYvlJ.js";import{u as je}from"./bulkSelection-CKbX3o6g.js";import{A as Ee}from"./ActivityLogSidebar-DQgEnTl4.js";import{_ as Qe}from"./OrdersPrint.vue_vue_type_script_setup_true_lang-ySqUrjaR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./printService-Bcj_RmEK.js";import"./toggle-B4ffD-ge.js";import"./printTemplateType-BiK7zB0k.js";const qe={class:"relative flex-1 min-w-[10rem]"},Ye=e("label",{class:"label"},"Registration Number",-1),Ke={class:"relative flex-1 min-w-[10rem]"},He=e("label",{class:"label"},"Barcode",-1),We={class:"relative flex-1 min-w-[11rem]"},Ge=e("label",{class:"label"},"Name / Phone Number",-1),Je={key:0,class:"relative flex-1 min-w-[10rem]"},Xe=e("label",{class:"label"},"Departments",-1),Ze={key:1,class:"relative flex-1 min-w-[10rem]"},et={class:"truncate"},tt={class:"truncate max-w-[7rem]"},st=["onClick"],at=e("span",{class:"multiselect-tag-remove-icon"},null,-1),ot=[at],lt=e("label",{class:"label"},"Tests",-1),rt={key:2,class:"relative flex-1 min-w-[10rem]"},nt=e("label",{class:"label"},"Partner",-1),ct={class:"relative flex-1 min-w-[10rem]"},it=e("label",{class:"label"},"Status",-1),dt={class:"relative flex-1 min-w-[14rem]"},ut=e("label",{class:"label"},"Date",-1),pt={class:"relative flex-1 min-w-[5rem]"},vt=e("option",{value:"desc"},"Desc",-1),mt=e("option",{value:"asc"},"Asc",-1),ht=[vt,mt],_t=e("label",{class:"label"},"Sort",-1),gt=Z({__name:"OrdersFilter",emits:["change"],setup(te,{emit:O}){const M=O,i=new URLSearchParams(location.search),{hasPermissionTo:C}=ne(),$=n([]),R=n([]),S=n([]),m=n(""),u=n(""),b=n(""),_=n(""),v=n([]),k=n([]),T=n(""),V=n([]),N=n(localStorage.getItem(ae.OrdersSortDirection)??"desc"),K=n([{name:"Focused",value:"focused"},{name:"Pending",value:s.Pending},{name:"Collected",value:s.Collected},{name:"Accepted",value:s.Accepted},{name:"In Progress",value:s.InProgress},{name:"Received",value:s.Received},{name:"Tested",value:s.Tested},{name:"Authorized",value:s.Authorized},{name:"Released",value:s.Released},{name:"Rejected",value:s.Rejected},{name:"Canceled",value:s.Canceled}]),P=n([null,null]);ee(async()=>{U(),w()});const H=j(()=>P.value[0]===null||P.value[1]===null?"":`${P.value[0]}~${P.value[1]}`),t=j(()=>v.value.join(",")),l=j(()=>k.value.join(",")),w=()=>{L(),o(),d()},L=async()=>{if(!C("Department.list"))return;const{data:r}=await D.get(`/api/departments/list?branchId=${m.value}`);$.value=r.data},o=async()=>{if(!C("Test.list"))return;const{data:r}=await D.get(`/api/tests/list?branchId=${m.value}`);R.value=r.data},d=async()=>{if(!C("Partner.list"))return;const{data:r}=await D.get(`/api/partners/list?branchId=${m.value}`);S.value=r.data},U=()=>{m.value=i.get("branchId")??"",u.value=i.get("visitNumber")??"",b.value=i.get("barcode")??"",_.value=i.get("q")??"",T.value=i.get("partnerId")??"",i.get("testIds")&&(k.value=i.get("testIds").split(",")),i.get("statuses")&&(V.value=i.get("statuses").split(",")),i.get("departmentIds")&&(v.value=i.get("departmentIds").split(",")),i.get("dateRange")&&(P.value=i.get("dateRange").split("~"))},de=r=>{v.value=r,I()},ue=r=>{k.value=r,I()},pe=r=>{T.value=r??"",I()},ve=r=>{V.value=r,I()},me=()=>{const r=u.value;W(),u.value=r,I()},he=()=>{const r=b.value;W(),b.value=r,I()},I=()=>{let r=`branchId=${m.value}&visitNumber=${u.value}&barcode=${b.value}&q=${_.value}&departmentIds=${t.value}&testIds=${l.value}&partnerId=${T.value}&statuses=${V.value}&dateRange=${H.value}&sort=${N.value}&page=1`;M("change",r)},_e=r=>{W(),b.value=r,I()},W=()=>{m.value="",u.value="",b.value="",_.value="",T.value="",v.value=[],k.value=[],V.value=[],P.value=[null,null]},ge=()=>{localStorage.setItem(ae.OrdersSortDirection,N.value),F.emit(xe.Changed)};return(r,g)=>(c(),p(q,null,[e("div",ye({class:"flex flex-wrap items-center gap-2 ms-auto"},r.$attrs),[x(ze,{modelValue:m.value,"onUpdate:modelValue":g[0]||(g[0]=h=>m.value=h),onChange:g[1]||(g[1]=h=>{I(),w()})},null,8,["modelValue"]),e("div",qe,[B(e("input",{"onUpdate:modelValue":g[2]||(g[2]=h=>u.value=h),onKeyup:G(me,["enter"]),type:"text",class:"input-sm peer"},null,544),[[Q,u.value]]),Ye]),e("div",Ke,[B(e("input",{"onUpdate:modelValue":g[3]||(g[3]=h=>b.value=h),onKeyup:G(he,["enter"]),type:"text",class:"input-sm peer"},null,544),[[Q,b.value]]),He]),e("div",We,[B(e("input",{"onUpdate:modelValue":g[4]||(g[4]=h=>_.value=h),onKeyup:G(I,["enter"]),type:"text",class:"input-sm peer"},null,544),[[Q,_.value]]),Ge]),a(C)("Department.list")?(c(),p("div",Je,[x(a(E),{mode:"tags","model-value":v.value,options:$.value,"value-prop":"id","track-by":"searchableForm",label:"name",searchable:!0,onChange:de,class:"px-0 input-sm peer"},null,8,["model-value","options"]),Xe])):f("",!0),a(C)("Test.list")?(c(),p("div",Ze,[x(a(E),{mode:"tags","model-value":k.value,options:R.value,"value-prop":"id","track-by":"searchableForm",label:"shortForm",searchable:!0,onChange:ue,class:"px-0 input-sm peer"},{option:A(({option:h})=>[e("span",et,y(h.shortForm),1)]),tag:A(({option:h,handleTagRemove:fe,disabled:se})=>[e("div",{class:z(["multiselect-tag is-user",{"is-disabled":se}])},[e("span",tt,y(h.shortForm),1),se?f("",!0):(c(),p("span",{key:0,class:"multiselect-tag-remove",onClick:be=>fe(h,be)},ot,8,st))],2)]),_:1},8,["model-value","options"]),lt])):f("",!0),a(C)("Partner.list")?(c(),p("div",rt,[x(a(E),{"model-value":T.value,options:S.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,onChange:pe,class:"input-sm peer"},null,8,["model-value","options"]),nt])):f("",!0),e("div",ct,[x(a(E),{"model-value":V.value,mode:"tags",options:K.value,"value-prop":"value","track-by":"value",label:"name",searchable:!0,onChange:ve,class:"px-0 input-sm peer"},null,8,["model-value","options"]),it]),e("div",dt,[x(a(Me),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:a(Fe),value:P.value,"onUpdate:value":g[5]||(g[5]=h=>P.value=h),onChange:I,class:"w-full peer","input-class":"input-sm pt-0.5"},{"icon-calendar":A(()=>[]),_:1},8,["shortcuts","value"]),ut]),e("div",pt,[B(e("select",{"onUpdate:modelValue":g[6]||(g[6]=h=>N.value=h),onChange:g[7]||(g[7]=h=>{I(),ge()}),class:"input-sm peer"},ht,544),[[re,N.value]]),_t])],16),x(Ne,{onScan:_e})],64))}}),ft={class:"grid grid-cols-1 gap-4"},bt={class:"relative"},yt=e("option",{value:""},"Select status",-1),xt=["value"],$t=["value"],wt=["value"],Ct=["value"],kt=["value"],St=["value"],It={key:0,class:"text-sm text-red-500"},Rt={class:"relative"},Pt=e("label",{class:"label"},"Notes",-1),At=["disabled"],Ot=Z({__name:"OrdersStatusModal",emits:["close"],setup(te,{emit:O}){const M=O,i=n(!1),C=n(!1),$=n([]),R=n(""),S=n(""),m=n({});ee(()=>{F.on(J.Show,_=>{C.value=!0,$.value=$e.cloneDeep(_)})}),ce(()=>F.off(J.Show));const u=async()=>{i.value=!0;try{await D.post("/api/orders/update-status",{orders:$.value,status:R.value,notes:S.value}),m.value={},X.fire(),b()}catch(_){m.value=_.response.data.errors??{}}i.value=!1},b=()=>{C.value=!1,S.value="",R.value="",m.value={},M("close")};return(_,v)=>C.value?(c(),ie(ke,{key:0},{header:A(()=>[Y("Change Orders Status")]),body:A(()=>[e("form",{id:"form",onSubmit:we(u,["prevent","stop"])},[e("div",ft,[e("div",bt,[B(e("select",{"onUpdate:modelValue":v[0]||(v[0]=k=>R.value=k),class:z(["input peer",{"border-red-500":m.value.hasOwnProperty("status")}])},[yt,e("option",{value:a(s).Pending},"Pending",8,xt),e("option",{value:a(s).Collected},"Collected",8,$t),e("option",{value:a(s).Accepted},"Accepted",8,wt),e("option",{value:a(s).InProgress},"In Progress",8,Ct),e("option",{value:a(s).Rejected},"Rejected",8,kt),e("option",{value:a(s).Canceled},"Canceled",8,St)],2),[[re,R.value]]),e("label",{class:z(["label",{"text-red-500":m.value.hasOwnProperty("status")}])},"Status",2),m.value.hasOwnProperty("status")?(c(),p("p",It,y(m.value.status[0]),1)):f("",!0)]),e("div",Rt,[B(e("input",{"onUpdate:modelValue":v[1]||(v[1]=k=>S.value=k),class:"input peer"},null,512),[[Q,S.value]]),Pt])])],32)]),footer:A(()=>[e("button",{class:"me-2 btn-blue",disabled:i.value,form:"form"},[x(Ce,{"is-loading":i.value},{default:A(()=>[Y("Save")]),_:1},8,["is-loading"])],8,At),e("button",{onClick:b,class:"btn-gray"},"Cancel")]),_:1})):f("",!0)}}),Tt={key:0,class:"mt-3 flex items-center gap-2"},Vt={class:"w-full"},Bt={class:"sticky top-0 z-10 text-left"},Dt={class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},Mt={class:"flex items-center justify-center"},Nt=["checked"],zt=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Test",-1),Ft=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Department",-1),Lt=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Sample Type",-1),Ut=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Barcode",-1),jt=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Status",-1),Et=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Notes",-1),Qt={key:0,class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},qt={class:"sticky z-10 bg-gray-200 text-lg font-semibold top-[39.5px]"},Yt={class:"border border-gray-200 px-2 py-1.5"},Kt={class:"flex items-center justify-center"},Ht=["checked","onChange"],Wt={class:"border border-gray-200 px-2 py-1.5",colspan:"100%"},Gt={class:"grid grid-cols-12"},Jt={class:"col-span-2"},Xt=["onClick"],Zt={class:"col-span-2"},es={class:"col-span-2"},ts={class:"col-span-2"},ss={class:"col-span-2"},as={class:"flex items-center justify-center"},os=["checked","onChange"],ls=["onClick"],rs={class:"border border-gray-200 px-2 py-1"},ns={class:"border border-gray-200 px-2 py-1"},cs={class:"border border-gray-200 px-2 py-1"},is={class:"border border-gray-200 px-2 py-1"},ds={class:"flex items-center"},us={key:0,class:"animate-pulse rounded bg-red-500 px-1 text-xs text-white ms-auto py-0.5 group-hover:bg-white group-hover:text-gray-600"},ps={class:"border border-gray-200 px-2 py-1"},vs={key:0,class:"border border-gray-200 px-2 py-1"},ms={class:"flex justify-center gap-3"},hs=["onClick"],_s=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),gs=[_s],fs=e("tr",{class:"h-3"},null,-1),Ns=Z({__name:"Orders",setup(te){const O=n([]),M=n({}),i=n(0),{updateUrlQuery:C}=De(),{hasPermissionTo:$,hasAnyPermission:R}=ne(),S=[s.Accepted,s.InProgress,s.Received,s.Tested,s.Authorized,s.Released],m=setInterval(()=>v(location.search),15e3),u=je(),b=j(()=>O.value.flatMap(t=>t.orders)),_=j(()=>b.value.filter(t=>u.selectedRecordsIds.value.has(t.id)));ee(()=>{i.value=document.getElementById("filter").offsetHeight,v(location.search)}),ce(()=>clearInterval(m));const v=async t=>{const l=await C(t),{data:w}=await D.get(`/api/orders?${l}`);O.value=w.data,M.value=w.meta},k=(t,l)=>t.orders.find(w=>l.includes(w.status)),T=async t=>{const{isConfirmed:l}=await le.fire();l&&(await D.post("/api/orders/progress",{orders:t}),X.fire(),v(location.search),u.clear())},V=async t=>{const{isConfirmed:l}=await Pe.fire({title:"Notes",input:"textarea",preConfirm:async w=>{try{await D.post("/api/orders/cancel",{orders:t,notes:w}),X.fire()}catch(L){Ae.showValidationMessage(L.response.data.message)}}});l&&(v(location.search),u.clear())},N=t=>{if(t===s.Pending)return"border-s-gray-300";if(t===s.Collected)return"border-s-yellow-400";if(t===s.Accepted)return"border-s-orange-500";if(t===s.InProgress)return"border-s-cyan-500";if(t===s.Received)return"border-s-blue-500";if(t===s.Tested)return"border-s-purple-500";if(t===s.Authorized)return"border-s-emerald-500";if(t===s.Released)return"border-s-gray-800";if(t===s.Rejected)return"border-s-red-500";if(t===s.Canceled)return"border-s-red-500"},K=t=>{if(t===s.Pending)return"hover:bg-gray-300 hover:text-black";if(t===s.Collected)return"hover:bg-yellow-400 hover:text-black";if(t===s.Accepted)return"hover:bg-orange-500 hover:text-white";if(t===s.InProgress)return"hover:bg-cyan-500 hover:text-white";if(t===s.Received)return"hover:bg-blue-500 hover:text-white";if(t===s.Tested)return"hover:bg-purple-500 hover:text-white";if(t===s.Authorized)return"hover:bg-emerald-500 hover:text-white";if(t===s.Released)return"hover:bg-gray-800 hover:text-white";if(t===s.Rejected)return"hover:bg-red-500 hover:text-white";if(t===s.Canceled)return"hover:bg-red-500 hover:text-white"},P=t=>!(!k(t,[s.Authorized,s.Released])||!$("Result.print")||t.invoice.dueBalance>0&&!$("Result.printDue")),H=async(t,l)=>{if(t.invoice.dueBalance>0){const{isConfirmed:w}=await le.fire({html:`Patient has due balance of ${t.invoice.dueBalance?.toLocaleString()}`});if(!w)return}F.emit(Te.Show,{visit:t,orders:t.orders,releaseType:l})};return(t,l)=>{const w=Se("router-link"),L=Ie("tip");return c(),p(q,null,[x(Ve,null,{header:A(()=>[Y("Orders")]),body:A(()=>[x(gt,{id:"filter",onChange:v}),_.value.length>0?(c(),p("div",Tt,[x(Qe,{selectedOrders:_.value},null,8,["selectedOrders"]),a($)("Order.updateStatus")?(c(),p("button",{key:0,onClick:l[0]||(l[0]=o=>a(F).emit(a(J).Show,_.value)),class:"btn-teal"},"Change Status")):f("",!0),a($)("Order.progress")?(c(),p("button",{key:1,onClick:l[1]||(l[1]=o=>T(_.value)),class:"btn-cyan"},"Progress")):f("",!0),a($)("Order.cancel")?(c(),p("button",{key:2,onClick:l[2]||(l[2]=o=>V(_.value)),class:"btn-red"},"Cancel")):f("",!0),e("button",{onClick:l[3]||(l[3]=o=>a(u).clear()),class:"btn-gray"},"Clear")])):f("",!0),e("section",{class:"mt-5 overflow-y-auto pe-1",style:Re(`height: calc(100vh - 13.3rem - ${i.value}px)`)},[e("table",Vt,[e("thead",null,[e("tr",Bt,[e("th",Dt,[e("label",Mt,[e("input",{type:"checkbox",checked:a(u).isAllSelected(b.value),onChange:l[4]||(l[4]=o=>a(u).toggleAll(b.value,o.target.checked)),class:"h-4 w-4 rounded checked:accent-blue-500"},null,40,Nt)])]),zt,Ft,Lt,Ut,jt,Et,a(R)("ActivityLog.list")?(c(),p("th",Qt)):f("",!0)])]),(c(!0),p(q,null,oe(O.value,o=>(c(),p("tbody",null,[e("tr",qt,[e("td",Yt,[e("label",Kt,[e("input",{type:"checkbox",checked:a(u).isAllSelected(o.orders),onChange:d=>a(u).toggleAll(o.orders,d.target.checked),class:"h-4 w-4 rounded checked:accent-blue-500"},null,40,Ht)])]),e("td",Wt,[e("div",Gt,[e("div",Jt,[a($)("ResultEntry.view")&&k(o,S)?(c(),ie(w,{key:0,to:`/results-entry?visitId=${o.id}`,class:"mr-2 py-1 text-base btn-teal hover:shadow-none"},{default:A(()=>[Y("Results")]),_:2},1032,["to"])):f("",!0),P(o)?(c(),p("button",{key:1,class:"py-1 text-base btn-blue hover:shadow-none",onClick:d=>H(o,a(Ue).Print)},"Print",8,Xt)):f("",!0)]),e("p",Zt,y(o.patient.name),1),e("p",null,y(o.number),1),e("p",es,y(o.lab?.name??"local"),1),e("p",ts,y(o.doctor?.name??"walk-in"),1),e("p",ss,y(o.date),1),e("p",null,y(o.branch.name),1)])])]),(c(!0),p(q,null,oe(o.orders,d=>(c(),p("tr",{class:z(["group",K(d.status)])},[e("td",{class:z(["border border-gray-200 px-2 py-1 border-s-[5px]",N(d.status)])},[e("label",as,[e("input",{type:"checkbox",checked:a(u).isSelected(d),onChange:U=>a(u).toggle(d,U.target.checked),class:"h-4 w-4 rounded checked:accent-blue-500"},null,40,os)])],2),e("td",{class:z(["border border-gray-200 px-2 py-1",{"cursor-pointer":S.includes(d.status)}]),onClick:U=>S.includes(d.status)?t.$router.push(`/results-entry?visitId=${o.id}&orderId=${d.id}`):""},y(d.test.name),11,ls),e("td",rs,y(d.test.department.name),1),e("td",ns,y(d.test.sampleType.name),1),e("td",cs,y(`${d.branch.code}${o.number}${d.test.sampleType.code}`),1),e("td",is,[e("div",ds,[e("span",null,y(d.status.capitalize()),1),d.isAddon?(c(),p("span",us,"Addon")):f("",!0)])]),e("td",ps,y(d.notes),1),a(R)("ActivityLog.list")?(c(),p("td",vs,[e("div",ms,[a($)("ActivityLog.list")?B((c(),p("button",{key:0,onClick:U=>a(F).emit(a(Oe).Show,d.id),class:"cursor-pointer text-gray-600 group-hover:text-white"},gs,8,hs)),[[L,"View Activities"]]):f("",!0)])])):f("",!0)],2))),256)),fs]))),256))])],4)]),_:1}),x(Be,{data:M.value,onChange:l[5]||(l[5]=o=>v(`page=${o}`)),class:"mt-3"},null,8,["data"]),x(Ot,{onClose:v}),x(Le,{onClose:v}),x(Ee)],64)}}});export{Ns as default};
