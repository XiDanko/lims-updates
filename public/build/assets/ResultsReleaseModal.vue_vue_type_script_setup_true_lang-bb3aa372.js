import{d as Z,e as c,y as G,x as H,W as R,ac as B,a8 as k,s as K,o,R as X,w as _,k as D,t as n,b as s,h as w,a0 as Y,n as U,c as r,V as C,g as ee,F as P,i as y,f as S,a as te,_ as se,a9 as ae,j as z,Z as le,Q as $}from"./main-56f58ed8.js";import{u as oe,P as ne,p as re}from"./websocketPrint-54028e1f.js";import{u as ce}from"./printTemplateManager-19d5b864.js";import{O as A}from"./orderStatus-e3a3f9a7.js";var N=(v=>(v.Print="print",v.Send="send",v))(N||{});const ie={class:"flex flex-wrap items-center mb-3"},de=s("span",{class:"w-20 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Template",-1),ue=["value"],pe={key:0,class:"ml-20 w-full text-red-500 text-sm"},me=["onClick"],ve=["onClick"],fe=s("hr",{class:"mt-2"},null,-1),be={class:"max-h-[30rem] py-1 overflow-auto"},he={class:"select-none"},_e={class:"flex items-center text-xl font-bold"},ye=["onUpdate:modelValue","onChange"],Se={class:"ml-1"},xe={class:"border-l-2 border-gray-200 pl-5"},ge=["onUpdate:modelValue","disabled"],ke={class:"ml-1"},we={key:0,class:"inline-block ml-2"},Ce={key:0,class:"mt-3 p-2 rounded bg-red-50 text-red-500 border-l-4 border-red-500"},Pe=["disabled"],Me=Z({__name:"ResultsReleaseModal",emits:["close"],setup(v,{emit:F}){const f=c(!1),x=c(!1),b=c(),i=c({}),d=c([]),h=c([]),I=G(()=>d.value.filter(e=>e.isSelected)),{resultsTemplates:L,defaultResultTemplate:W}=ce(),p=c(null),u=c({}),V=oe();H(()=>{R.on(B.Show,({visit:e,orders:t,releaseType:a})=>{x.value=!0,b.value=a,i.value=k.cloneDeep(e),d.value=k.cloneDeep(t),h.value=k.uniqBy(d.value.flatMap(l=>l.test.department),"id"),p.value=W(i.value.branchId)?.id,E(),T()})}),K(()=>R.off(B.Show));const m=e=>[A.Authorized,A.Released].includes(e.status)&&e.test.isPrintable,g=e=>d.value.filter(t=>t.test.department.id===e.id),j=e=>{e.isSelected?g(e).filter(t=>m(t)).forEach(t=>t.isSelected=!0):g(e).forEach(t=>t.isSelected=!1)},T=()=>{h.value.forEach(e=>e.isSelected=!0),d.value.filter(e=>m(e)).forEach(e=>e.isSelected=!0)},E=()=>{h.value.forEach(e=>e.isSelected=!1),d.value.forEach(e=>e.isSelected=!1)},M=async(e=!1)=>{f.value=!0;try{b.value===N.Print?await q(e):await J(),le.fire(),O()}catch(t){u.value=t.response.data.errors??{}}f.value=!1},q=async e=>{console.log(e);const{data:t}=await $.post("/api/results/print",{visitId:i.value.id,orders:I.value,templateId:p.value});V.isConnected&&!e?V.submit({type:ne.Results,url:"results.pdf",file_content:t}):re({printable:t,type:"pdf",base64:!0})},J=async()=>{await $.post("/api/results/send",{visitId:i.value.id,orders:I.value,templateId:p.value})},O=()=>{x.value=!1,u.value={},F("close")};return(e,t)=>x.value?(o(),X(ae,{key:0},{header:_(()=>[D(n(b.value.capitalize())+" Results of "+n(i.value.patient.name),1)]),body:_(()=>[s("form",{id:"form",onSubmit:t[1]||(t[1]=S(a=>M(),["prevent","stop"]))},[s("div",ie,[de,w(s("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),class:U(["flex-1 px-2 py-1 h-[42px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":u.value.hasOwnProperty("templateId")}])},[(o(!0),r(P,null,C(ee(L)(i.value.branchId),a=>(o(),r("option",{value:a.id},n(a.name),9,ue))),256))],2),[[Y,p.value]]),u.value.hasOwnProperty("templateId")?(o(),r("p",pe,n(u.value.templateId[0]),1)):y("",!0)]),s("div",null,[s("button",{class:"btn-blue text-sm mr-2",onClick:S(T,["prevent"])},"Select All",8,me),s("button",{class:"btn-gray text-sm",onClick:S(E,["prevent"])},"Clear",8,ve)]),fe,s("div",be,[(o(!0),r(P,null,C(h.value,a=>(o(),r("div",he,[s("label",_e,[w(s("input",{type:"checkbox","onUpdate:modelValue":l=>a.isSelected=l,onChange:l=>j(a),class:"w-4 h-4 rounded checked:accent-blue-500"},null,40,ye),[[z,a.isSelected]]),s("span",Se,n(a.name),1)]),s("div",xe,[(o(!0),r(P,null,C(g(a),l=>(o(),r("label",{class:U(["flex items-center",{"text-gray-400":!m(l)}])},[w(s("input",{type:"checkbox","onUpdate:modelValue":Q=>l.isSelected=Q,disabled:!m(l),class:"w-4 h-4 rounded checked:accent-blue-500"},null,8,ge),[[z,l.isSelected]]),s("span",ke,n(l.test.shortForm),1),m(l)?y("",!0):(o(),r("span",we," ("+n(l.status.capitalize())+" "+n(l.test.bypass?"-bypass":"")+" "+n(l.test.isPrintable?"":"-disabled")+") ",1))],2))),256))])]))),256))]),u.value.hasOwnProperty("orders")?(o(),r("p",Ce,"Select at least one order to continue.")):y("",!0)],32)]),footer:_(()=>[s("button",{class:"btn-blue mr-2",disabled:f.value,form:"form",onContextmenu:t[2]||(t[2]=S(a=>M(!0),["prevent"]))},[te(se,{"is-loading":f.value},{default:_(()=>[D(n(b.value.capitalize()),1)]),_:1},8,["is-loading"])],40,Pe),s("button",{onClick:O,class:"btn-gray"},"Cancel")]),_:1})):y("",!0)}});export{N as R,Me as _};
