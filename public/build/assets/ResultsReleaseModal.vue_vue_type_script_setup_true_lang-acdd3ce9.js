import{d as Y,g as r,y as Z,x as ee,a3 as R,a6 as U,aa as k,s as te,o,R as se,w as g,m as B,t as n,b as s,j as C,W as ae,n as z,c as i,a2 as D,i as W,F as I,a as $,k as y,h as S,_ as le,a5 as oe,l as A,a0 as ne,Q as N}from"./main-cee2eb24.js";import{u as re,P as ie,p as ce}from"./websocketPrint-f541b6bb.js";import{u as de}from"./printTemplateManager-b9018cee.js";import{O as F}from"./orderStatus-e3a3f9a7.js";import{b as ue}from"./toggle-afba85dd.js";var L=(v=>(v.Print="print",v.Send="send",v))(L||{});const pe={class:"mb-3 flex flex-wrap items-center"},me=s("span",{class:"w-20 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Template",-1),ve=["value"],be=s("span",{class:"w-28 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2 ms-3"},"With Design",-1),fe={key:0,class:"ml-20 w-full text-sm text-red-500"},he=["onClick"],_e=["onClick"],ge=s("hr",{class:"mt-2"},null,-1),ye={class:"overflow-auto py-1 max-h-[30rem]"},Se={class:"select-none"},xe={class:"flex items-center text-xl font-bold"},we=["onUpdate:modelValue","onChange"],ke={class:"ml-1"},Ce={class:"border-l-2 border-gray-200 pl-5"},De=["onUpdate:modelValue","disabled"],Ie={class:"ml-1"},Pe={key:0,class:"ml-2 inline-block"},Ve={key:0,class:"mt-3 rounded border-l-4 border-red-500 bg-red-50 p-2 text-red-500"},Te=["disabled"],Be=Y({__name:"ResultsReleaseModal",emits:["close"],setup(v,{emit:j}){const b=r(!1),x=r(!1),f=r(localStorage.getItem("printWithDesign")!=="no"),h=r(),c=r({}),d=r([]),_=r([]),P=Z(()=>d.value.filter(e=>e.isSelected)),{resultsTemplates:q,defaultResultTemplate:J}=de(),p=r(null),u=r({}),V=re();ee(()=>{R.on(U.Show,({visit:e,orders:t,releaseType:a})=>{x.value=!0,h.value=a,c.value=k.cloneDeep(e),d.value=k.cloneDeep(t),_.value=k.uniqBy(d.value.flatMap(l=>l.test.department),"id"),p.value=J(c.value.branchId)?.id,E(),T()})}),te(()=>R.off(U.Show));const m=e=>[F.Authorized,F.Released].includes(e.status)&&e.test.isPrintable,w=e=>d.value.filter(t=>t.test.department.id===e.id),Q=e=>{e.isSelected?w(e).filter(t=>m(t)).forEach(t=>t.isSelected=!0):w(e).forEach(t=>t.isSelected=!1)},T=()=>{_.value.forEach(e=>e.isSelected=!0),d.value.filter(e=>m(e)).forEach(e=>e.isSelected=!0)},E=()=>{_.value.forEach(e=>e.isSelected=!1),d.value.forEach(e=>e.isSelected=!1)},G=e=>{localStorage.setItem("printWithDesign",e?"yes":"no")},M=async(e=!1)=>{b.value=!0;try{h.value===L.Print?await H(e):await K(),ne.fire(),O()}catch(t){u.value=t.response.data.errors??{}}b.value=!1},H=async e=>{const{data:t}=await N.post("/api/results/print",{visitId:c.value.id,orders:P.value,templateId:p.value,withDesign:f.value});V.isConnected&&!e?V.submit({type:ie.Results,url:"results.pdf",file_content:t}):ce({printable:t,type:"pdf",base64:!0})},K=async()=>{await N.post("/api/results/send",{visitId:c.value.id,orders:P.value,templateId:p.value,withDesign:f.value})},O=()=>{x.value=!1,u.value={},j("close")};return(e,t)=>x.value?(o(),se(oe,{key:0},{header:g(()=>[B(n(h.value.capitalize())+" Results of "+n(c.value.patient.name),1)]),body:g(()=>[s("form",{id:"form",onSubmit:t[2]||(t[2]=S(a=>M(),["prevent","stop"]))},[s("div",pe,[me,C(s("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>p.value=a),class:z(["flex-1 rounded-r border border-gray-300 px-2 py-1 h-[42px] focus:border-blue-500",{"!border-red-500":u.value.hasOwnProperty("templateId")}])},[(o(!0),i(I,null,D(W(q)(c.value.branchId),a=>(o(),i("option",{value:a.id},n(a.name),9,ve))),256))],2),[[ae,p.value]]),be,$(W(ue),{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),onChange:G,class:"rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,8,["modelValue"]),u.value.hasOwnProperty("templateId")?(o(),i("p",fe,n(u.value.templateId[0]),1)):y("",!0)]),s("div",null,[s("button",{class:"mr-2 text-sm btn-blue",onClick:S(T,["prevent"])},"Select All",8,he),s("button",{class:"text-sm btn-gray",onClick:S(E,["prevent"])},"Clear",8,_e)]),ge,s("div",ye,[(o(!0),i(I,null,D(_.value,a=>(o(),i("div",Se,[s("label",xe,[C(s("input",{type:"checkbox","onUpdate:modelValue":l=>a.isSelected=l,onChange:l=>Q(a),class:"h-4 w-4 rounded checked:accent-blue-500"},null,40,we),[[A,a.isSelected]]),s("span",ke,n(a.name),1)]),s("div",Ce,[(o(!0),i(I,null,D(w(a),l=>(o(),i("label",{class:z(["flex items-center",{"text-gray-400":!m(l)}])},[C(s("input",{type:"checkbox","onUpdate:modelValue":X=>l.isSelected=X,disabled:!m(l),class:"h-4 w-4 rounded checked:accent-blue-500"},null,8,De),[[A,l.isSelected]]),s("span",Ie,n(l.test.shortForm),1),m(l)?y("",!0):(o(),i("span",Pe," ("+n(l.status.capitalize())+" "+n(l.test.bypass?"-bypass":"")+" "+n(l.test.isPrintable?"":"-disabled")+") ",1))],2))),256))])]))),256))]),u.value.hasOwnProperty("orders")?(o(),i("p",Ve,"Select at least one order to continue.")):y("",!0)],32)]),footer:g(()=>[s("button",{class:"mr-2 btn-blue",disabled:b.value,form:"form",onContextmenu:t[3]||(t[3]=S(a=>M(!0),["prevent"]))},[$(le,{"is-loading":b.value},{default:g(()=>[B(n(h.value.capitalize()),1)]),_:1},8,["is-loading"])],40,Te),s("button",{onClick:O,class:"btn-gray"},"Cancel")]),_:1})):y("",!0)}});export{L as R,Be as _};
