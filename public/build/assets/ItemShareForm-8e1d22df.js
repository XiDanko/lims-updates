import{d as M,u as A,e as u,x as D,Q as p,o as n,R,w as m,k as T,t as d,g as l,b as r,c,a as b,n as v,i,h as z,a0 as L,f as Q,_ as W,a9 as Z,m as j,l as q,Z as G}from"./main-6e47ceb6.js";import{s as I}from"./multiselect-27b4da8b.js";import{_ as H}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-1a19a39b.js";import{F as y}from"./formMode-f60a729f.js";import{I as x}from"./itemType-8f96b3f7.js";const J=["onSubmit"],K={class:"grid grid-cols-1 gap-3"},X={key:0,class:"flex flex-wrap"},Y=r("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),ee={key:0,class:"ml-28 w-full text-red-500 text-sm"},ae={class:"flex flex-wrap"},re=r("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Partner",-1),te={key:0,class:"ml-28 w-full text-red-500 text-sm"},se={class:"flex flex-wrap"},oe=r("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Type",-1),le=["value"],ne=["value"],de=["value"],ue={key:0,class:"ml-28 w-full text-red-500 text-sm"},ce={class:"flex flex-wrap"},ie=r("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Item",-1),pe={class:"truncate"},me={key:0,class:"ml-28 w-full text-red-500 text-sm"},be={class:"flex flex-wrap"},ve=r("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Amount",-1),he={key:0,class:"ml-28 w-full text-red-500 text-sm"},fe=["disabled"],ke=M({__name:"ItemShareForm",emits:["close"],setup(ye,{emit:C}){const k=j(),O=q(),h=A().user.branches,V=u([]),S=u([]),e=u({discount:0}),_=u(y.Create),f=u(!1),t=u({});D(()=>{h.length===1&&(e.value.branchId=h[0].id,g()),k.path.endsWith("/edit")&&(_.value=y.Edit,$(k.params.id))});const g=async()=>{const{data:o}=await p.get(`/api/partners/list?branchId=${e.value.branchId}`);V.value=o.data},w=async()=>{const{data:o}=await p.get(`/api/${e.value.itemType}s/list?branchId=${e.value.branchId}`);o.data.forEach(a=>a.label=a.shortForm??a.name),S.value=o.data},$=async o=>{const{data:a}=await p.get(`/api/item-shares/${o}`);e.value=a.data,g(),w()},B=()=>{e.value.partnerId=null,e.value.itemId=null},F=async()=>{f.value=!0;try{_.value===y.Create?await N():await U(),G.fire()}catch(o){t.value=o.response.data.errors??{}}f.value=!1},N=async()=>{await p.post("/api/item-shares",e.value),E()},U=async()=>{await p.patch(`/api/item-shares/${e.value.id}`,e.value),P()},E=()=>{e.value={branchId:e.value.branchId,partnerId:e.value.partnerId,itemType:e.value.itemType,amount:0},w(),t.value=[]},P=()=>{C("close"),O.back()};return(o,a)=>(n(),R(Z,null,{header:m(()=>[T(d(_.value===l(y).Create?"Create New Item Share":"Edit Item Share"),1)]),body:m(()=>[r("form",{id:"form",onSubmit:Q(F,["prevent","stop"])},[r("div",K,[l(h).length>1?(n(),c("div",X,[Y,b(l(I),{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value.branchId=s),options:l(h),onSelect:g,onChange:B,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:v(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("branchId")?(n(),c("p",ee,d(t.value.branchId[0]),1)):i("",!0)])):i("",!0),r("div",ae,[re,b(l(I),{modelValue:e.value.partnerId,"onUpdate:modelValue":a[1]||(a[1]=s=>e.value.partnerId=s),options:V.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:v(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("partnerId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("partnerId")?(n(),c("p",te,d(t.value.partnerId[0]),1)):i("",!0)]),r("div",se,[oe,z(r("select",{"onUpdate:modelValue":a[2]||(a[2]=s=>e.value.itemType=s),onChange:a[3]||(a[3]=s=>{w(),e.value.itemId=null}),class:v(["flex-1 px-2 py-1 h-[42px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("itemType")}])},[r("option",{value:l(x).Test},"Test",8,le),r("option",{value:l(x).Package},"Package",8,ne),r("option",{value:l(x).Service},"Service",8,de)],34),[[L,e.value.itemType]]),t.value.hasOwnProperty("itemType")?(n(),c("p",ue,d(t.value.itemType[0]),1)):i("",!0)]),r("div",ce,[ie,b(l(I),{modelValue:e.value.itemId,"onUpdate:modelValue":a[4]||(a[4]=s=>e.value.itemId=s),options:S.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"label",class:v(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("itemId")}])},{option:m(({option:s})=>[r("span",pe,d(s.label),1)]),_:1},8,["modelValue","options","class"]),t.value.hasOwnProperty("itemId")?(n(),c("p",me,d(t.value.itemId[0]),1)):i("",!0)]),r("div",be,[ve,b(H,{modelValue:e.value.amount,"onUpdate:modelValue":a[5]||(a[5]=s=>e.value.amount=s),size:"1",class:v(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("amount")}])},null,8,["modelValue","class"]),t.value.hasOwnProperty("amount")?(n(),c("p",he,d(t.value.amount[0]),1)):i("",!0)])])],40,J)]),footer:m(()=>[r("button",{class:"btn-blue mr-2",disabled:f.value,form:"form"},[b(W,{"is-loading":f.value},{default:m(()=>[T("Save")]),_:1},8,["is-loading"])],8,fe),r("button",{onClick:P,class:"btn-gray"},"Cancel")]),_:1}))}});export{ke as default};
