import{d as G,u as J,e as c,x as K,Q as v,U as S,o as n,R as X,w as m,k as P,t as M,g as _,b as e,c as d,a as f,n as b,i as O,h as i,v as V,a1 as B,F as z,f as Y,_ as Z,a4 as ee,m as te,l as se,V as ae,$ as oe,a8 as re}from"./main-DmoZ1fz4.js";import{s as ne}from"./multiselect-DAhRltj6.js";import{F as y}from"./formMode-Bz--3d4P.js";import{_ as le}from"./BranchSelect.vue_vue_type_script_setup_true_lang-D_pdW9WT.js";import{_ as de}from"./InventorySelect.vue_vue_type_script_setup_true_lang-BgS0vZy-.js";const ce={class:"relative col-span-2"},ie=e("label",{class:"label"},"Notes",-1),ue={class:"max-h-[calc(100vh-25rem)] col-span-2"},pe={key:0,class:"text-sm text-red-500"},he={class:"w-full"},ve={class:"z-10 text-left"},me=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Product",-1),_e=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Quantity",-1),fe=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Notes",-1),be={class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},ye=e("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z","clip-rule":"evenodd"},null,-1),we=[ye],ge={class:"transition even:bg-gray-100"},Ie={class:"w-96 border border-gray-200 px-2 py-1"},xe={class:"w-80 border border-gray-200 px-2 py-1"},Ve={class:"flex"},ke=["onUpdate:modelValue"],Ue=["onUpdate:modelValue"],Ce=["value"],$e={class:"border border-gray-200 px-2 py-1"},Se=["onUpdate:modelValue"],Pe={class:"border border-gray-200 px-2 py-1 text-center"},Me={class:"flex items-center justify-center gap-3"},Oe=["onClick"],Be=e("path",{"fill-rule":"evenodd",d:"M2.515 10.674a1.875 1.875 0 000 2.652L8.89 19.7c.352.351.829.549 1.326.549H19.5a3 3 0 003-3V6.75a3 3 0 00-3-3h-9.284c-.497 0-.974.198-1.326.55l-6.375 6.374zM12.53 9.22a.75.75 0 10-1.06 1.06L13.19 12l-1.72 1.72a.75.75 0 101.06 1.06l1.72-1.72 1.72 1.72a.75.75 0 101.06-1.06L15.31 12l1.72-1.72a.75.75 0 10-1.06-1.06l-1.72 1.72-1.72-1.72z","clip-rule":"evenodd"},null,-1),ze=[Be],Ne=["disabled"],He=G({__name:"PurchaseOrderForm",emits:["close"],setup(Re,{emit:N}){const R=N,k=te(),D=se(),u=J().user.branches,F=c([]),p=c([]),t=c({purchaseOrderItems:[]}),w=c(y.Create),h=c(!1),l=c({});K(()=>{u.length===1&&(t.value.branchId=u[0].id,g()),k.path.endsWith("/edit")?(w.value=y.Edit,L(k.params.id)):I()});const L=async s=>{const{data:o}=await v.get(`/api/purchase-orders/${s}`);t.value=o.data,g()},g=async()=>{const{data:s}=await v.get(`/api/products/list?branchId=${t.value.branchId}`);p.value=s.data},q=()=>{t.value.inventoryId=null,I(),g()},E=s=>{s.productUnitId=p.value.find(o=>o.id===s.productId).units.find(o=>o.quantity===1).id},I=()=>{t.value.purchaseOrderItems=[];for(let s=0;s<=10;s++)U()},U=()=>t.value.purchaseOrderItems.push({}),H=s=>t.value.purchaseOrderItems.splice(s,1),T=async()=>{h.value=!0;try{w.value===y.Create?await A():await Q(),l.value={},oe.fire()}catch(s){l.value=s.response.data.errors??{}}h.value=!1},A=async()=>{const s=re.cloneDeep(t.value);s.purchaseOrderItems=s.purchaseOrderItems.filter(o=>o.productId),await v.post("/api/purchase-orders",s),j()},Q=async()=>{await v.patch(`/api/purchase-orders/${t.value.id}`,t.value),C()},j=()=>{t.value={branchId:t.value.branchId,inventoryId:t.value.inventoryId},l.value=[],I()},C=()=>{R("close"),D.back()};return(s,o)=>{const $=S("tip"),W=S("maska");return n(),X(ee,{"modal-class":"!w-[90rem]"},{header:m(()=>[P(M(w.value===_(y).Create?"Create New Purchase Order":"Edit Purchase Order"),1)]),body:m(()=>[e("form",{id:"form",onSubmit:Y(T,["prevent","stop"]),class:"grid grid-cols-2 gap-4"},[_(u).length>1?(n(),d("div",{key:0,class:b(["relative",{"col-span-2":F.value.length===1}])},[f(le,{modelValue:t.value.branchId,"onUpdate:modelValue":o[0]||(o[0]=a=>t.value.branchId=a),error:l.value.branchId,onSelect:q},null,8,["modelValue","error"])],2)):O("",!0),e("div",{class:b(["relative",{"col-span-2":_(u).length===1}])},[f(de,{modelValue:t.value.inventoryId,"onUpdate:modelValue":o[1]||(o[1]=a=>t.value.inventoryId=a),branchId:t.value.branchId,error:l.value.inventoryId},null,8,["modelValue","branchId","error"])],2),e("div",ce,[i(e("input",{"onUpdate:modelValue":o[2]||(o[2]=a=>t.value.notes=a),class:"input peer"},null,512),[[V,t.value.notes]]),ie]),e("section",ue,[l.value.hasOwnProperty("purchaseOrderItems")?(n(),d("p",pe,"Select at least one product to continue.")):O("",!0),e("table",he,[e("thead",null,[e("tr",ve,[me,_e,fe,e("th",be,[i((n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"mx-auto h-6 w-6 cursor-pointer text-white",onClick:U},we)),[[$,"Add Row"]])])])]),e("tbody",null,[(n(!0),d(z,null,B(t.value.purchaseOrderItems,(a,x)=>(n(),d("tr",ge,[e("td",Ie,[f(_(ne),{modelValue:a.productId,"onUpdate:modelValue":r=>a.productId=r,options:p.value,onSelect:r=>E(a),searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:"input-sm"},null,8,["modelValue","onUpdate:modelValue","options","onSelect"])]),e("td",xe,[e("div",Ve,[i(e("input",{"data-maska":"0.0","data-maska-tokens":"0:[0-9]:multiple","onUpdate:modelValue":r=>a.quantity=r,class:b(["input-sm !rounded-e-none",{"border-red-500":l.value.hasOwnProperty(`purchaseOrderItems.${x}.quantity`)}])},null,10,ke),[[W],[V,a.quantity]]),i(e("select",{"onUpdate:modelValue":r=>a.productUnitId=r,class:b(["input-sm w-40 border-s-0 !rounded-s-none focus:!border-s-2",{"border-red-500":l.value.hasOwnProperty(`purchaseOrderItems.${x}.productUnitId`)}])},[(n(!0),d(z,null,B(p.value.find(r=>r.id===a.productId)?.units,r=>(n(),d("option",{value:r.id},M(r.name),9,Ce))),256))],10,Ue),[[ae,a.productUnitId]])])]),e("td",$e,[i(e("input",{"onUpdate:modelValue":r=>a.notes=r,class:"input-sm"},null,8,Se),[[V,a.notes]])]),e("td",Pe,[e("div",Me,[i((n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-6 w-6 cursor-pointer text-red-500",onClick:r=>H(x)},ze,8,Oe)),[[$,"Remove"]])])])]))),256))])])])],32)]),footer:m(()=>[e("button",{class:"me-2 btn-blue",disabled:h.value,form:"form"},[f(Z,{"is-loading":h.value},{default:m(()=>[P("Save")]),_:1},8,["is-loading"])],8,Ne),e("button",{onClick:C,class:"btn-gray"},"Cancel")]),_:1})}}});export{He as default};
