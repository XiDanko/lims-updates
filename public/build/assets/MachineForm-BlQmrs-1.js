import{d as E,e as d,u as A,x as R,Q as v,o as r,R as k,w as h,k as C,t as b,g as u,b as s,c as f,a as g,i,h as I,v as O,n,f as T,_ as j,a4 as q,m as z,l as L,$ as Q}from"./main-BgbWFIXK.js";import{b as W}from"./toggle-CP_W0i88.js";import{s as G}from"./multiselect-DeMhawmc.js";import{F as c}from"./formMode-Bz--3d4P.js";import{_ as H}from"./BranchSelect.vue_vue_type_script_setup_true_lang-ChkyAztq.js";const J={key:0,class:"relative"},K={class:"relative"},X={key:0,class:"text-sm text-red-500"},Y={class:"relative"},Z={key:0,class:"text-sm text-red-500"},ee={class:"relative"},ae={key:0,class:"text-sm text-red-500"},te=["disabled"],ue=E({__name:"MachineForm",emits:["close"],setup(se,{emit:P}){const M=P,y=z(),$=L(),e=d({}),x=d([]),_=A().user.branches,m=d(c.Create),p=d(!1),a=d({});R(()=>{_.length===1&&(e.value.branchId=_[0].id,w()),y.path.endsWith("/edit")&&(m.value=c.Edit,N(y.params.id)),F()});const F=()=>{e.value.code=y.query.code??""},w=async()=>{const{data:l}=await v.get(`/api/departments/list?branchId=${e.value.branchId}`);x.value=l.data},N=async l=>{const{data:t}=await v.get(`/api/machines/${l}`);e.value=t.data,w()},S=async()=>{p.value=!0;try{m.value===c.Create?await U():await B(),a.value={},Q.fire()}catch(l){a.value=l.response.data.errors??{}}p.value=!1},U=async()=>{await v.post("/api/machines",e.value),D()},B=async()=>{await v.patch(`/api/machines/${e.value.id}`,e.value),V()},D=()=>{e.value={branchId:e.value.branchId},a.value=[]},V=()=>{M("close"),$.back()};return(l,t)=>(r(),k(q,null,{header:h(()=>[C(b(m.value===u(c).Create?"Create New Machine":"Edit Machine"),1)]),body:h(()=>[s("form",{id:"form",onSubmit:T(S,["prevent","stop"]),class:"grid grid-cols-1 gap-4"},[u(_).length>1?(r(),f("div",J,[g(H,{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=o=>e.value.branchId=o),error:a.value.branchId,onSelect:w,onChange:t[1]||(t[1]=o=>e.value.departments=[])},null,8,["modelValue","error"])])):i("",!0),s("div",K,[I(s("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.name=o),class:n(["input peer",{"border-red-500":a.value.hasOwnProperty("name")}])},null,2),[[O,e.value.name]]),s("label",{class:n(["label",{"text-red-500":a.value.hasOwnProperty("name")}])},"Name",2),a.value.hasOwnProperty("name")?(r(),f("p",X,b(a.value.name[0]),1)):i("",!0)]),s("div",Y,[I(s("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>e.value.code=o),class:n(["input peer",{"border-red-500":a.value.hasOwnProperty("code")}])},null,2),[[O,e.value.code]]),s("label",{class:n(["label",{"text-red-500":a.value.hasOwnProperty("code")}])},"Code",2),a.value.hasOwnProperty("code")?(r(),f("p",Z,b(a.value.code[0]),1)):i("",!0)]),s("div",ee,[g(u(G),{modelValue:e.value.departments,"onUpdate:modelValue":t[4]||(t[4]=o=>e.value.departments=o),mode:"tags",options:x.value,searchable:!0,object:!0,"value-prop":"id","track-by":"searchableForm",label:"name",class:n(["px-0 input peer",{"border-red-500":a.value.hasOwnProperty("departments")}])},null,8,["modelValue","options","class"]),s("label",{class:n(["label",{"text-red-500":a.value.hasOwnProperty("departments")}])},"Departments",2),a.value.hasOwnProperty("departments")?(r(),f("p",ae,b(a.value.departments[0]),1)):i("",!0)])],32)]),footer:h(()=>[s("button",{class:"me-2 btn-blue",disabled:p.value,form:"form"},[g(j,{"is-loading":p.value},{default:h(()=>[C("Save")]),_:1},8,["is-loading"])],8,te),s("button",{onClick:V,class:"btn-gray"},"Cancel"),m.value===u(c).Edit?(r(),k(u(W),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":t[5]||(t[5]=o=>e.value.isActive=o),class:"toggle:off:red ms-auto"},null,8,["modelValue"])):i("",!0)]),_:1}))}});export{ue as default};
