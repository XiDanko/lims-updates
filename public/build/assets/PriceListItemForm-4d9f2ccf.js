import{d as E,u as M,e as u,x as z,Q as v,o as d,R,w as m,k as T,t as i,g as l,b as s,c,a as p,n as b,i as n,h as A,a0 as W,f as Q,_ as Z,a9 as j,m as q,l as G,Z as H}from"./main-56f58ed8.js";import{s as x}from"./multiselect-167e14f5.js";import{_ as C}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-5457422b.js";import{F as h}from"./formMode-f60a729f.js";import{I as P}from"./itemType-8f96b3f7.js";const J=["onSubmit"],K={class:"grid grid-cols-1 gap-3"},X={key:0,class:"flex flex-wrap"},Y=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),ee={key:0,class:"ml-28 w-full text-red-500 text-sm"},ae={class:"flex flex-wrap"},re=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Price List",-1),se={key:0,class:"ml-28 w-full text-red-500 text-sm"},te={class:"flex flex-wrap"},le=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Type",-1),oe=["value"],de=["value"],ie=["value"],ce={key:0,class:"ml-28 w-full text-red-500 text-sm"},ne={class:"flex flex-wrap"},ue=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Item",-1),pe={class:"truncate"},be={key:0,class:"ml-28 w-full text-red-500 text-sm"},ve={class:"flex flex-wrap"},me=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Price",-1),he={key:0,class:"ml-28 w-full text-red-500 text-sm"},fe={class:"flex flex-wrap"},ye=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Discount",-1),_e={key:0,class:"ml-28 w-full text-red-500 text-sm"},ge=["disabled"],Le=E({__name:"PriceListItemForm",emits:["close"],setup(we,{emit:O}){const V=q(),S=G(),f=M().user.branches,e=u({discount:0}),y=u([]),_=u(h.Create),g=u(!1),a=u({}),k=u([]);z(()=>{f.length===1&&(e.value.branchId=f[0].id,I()),V.path.endsWith("/edit")&&(_.value=h.Edit,$(V.params.id))});const I=async()=>{const{data:o}=await v.get(`/api/price-lists/list?branchId=${e.value.branchId}`);k.value=o.data},w=async()=>{if(_.value===h.Create&&(e.value.priceableId=null),y.value=[],!e.value.priceableType||!e.value.priceListId)return;const{data:o}=await v.get(`/api/${e.value.priceableType}s/list?branchId=${e.value.branchId}&withPriceListItemsForPriceListId=${e.value.priceListId}`),t=o.data.filter(r=>r.priceListItems.length===0||r.id===e.value.priceableId);t.forEach(r=>r.label=r.shortForm??r.name),y.value=t},$=async o=>{const{data:t}=await v.get(`/api/price-list-items/${o}`);e.value=t.data,I(),w()},F=()=>{e.value.priceListId=null,e.value.priceableId=null,y.value=[]},B=async()=>{g.value=!0;try{_.value===h.Create?await U():await N(),H.fire()}catch(o){a.value=o.response.data.errors??{}}g.value=!1},U=async()=>{await v.post("/api/price-list-items",e.value),D()},N=async()=>{await v.patch(`/api/price-list-items/${e.value.id}`,e.value),L()},D=()=>{e.value={branchId:e.value.branchId,priceListId:e.value.priceListId,priceableType:e.value.priceableType,discount:0},w(),a.value=[]},L=()=>{O("close"),S.back()};return(o,t)=>(d(),R(j,null,{header:m(()=>[T(i(_.value===l(h).Create?"Create New Item":"Edit Item"),1)]),body:m(()=>[s("form",{id:"form",onSubmit:Q(B,["prevent","stop"])},[s("div",K,[l(f).length>1?(d(),c("div",X,[Y,p(l(x),{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=r=>e.value.branchId=r),options:l(f),onSelect:I,onChange:F,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:b(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("branchId")?(d(),c("p",ee,i(a.value.branchId[0]),1)):n("",!0)])):n("",!0),s("div",ae,[re,p(l(x),{modelValue:e.value.priceListId,"onUpdate:modelValue":t[1]||(t[1]=r=>e.value.priceListId=r),onSelect:w,options:k.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:b(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("priceListId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("priceListId")?(d(),c("p",se,i(a.value.priceListId[0]),1)):n("",!0)]),s("div",te,[le,A(s("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>e.value.priceableType=r),onChange:w,class:b(["flex-1 px-2 py-1 h-[42px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("priceableType")}])},[s("option",{value:l(P).Test},"Test",8,oe),s("option",{value:l(P).Package},"Package",8,de),s("option",{value:l(P).Service},"Service",8,ie)],34),[[W,e.value.priceableType]]),a.value.hasOwnProperty("priceableType")?(d(),c("p",ce,i(a.value.priceableType[0]),1)):n("",!0)]),s("div",ne,[ue,p(l(x),{modelValue:e.value.priceableId,"onUpdate:modelValue":t[3]||(t[3]=r=>e.value.priceableId=r),options:y.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"label",class:b(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("priceableId")}])},{option:m(({option:r})=>[s("span",pe,i(r.label),1)]),_:1},8,["modelValue","options","class"]),a.value.hasOwnProperty("priceableId")?(d(),c("p",be,i(a.value.priceableId[0]),1)):n("",!0)]),s("div",ve,[me,p(C,{modelValue:e.value.price,"onUpdate:modelValue":t[4]||(t[4]=r=>e.value.price=r),size:"1",class:b(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("price")}])},null,8,["modelValue","class"]),a.value.hasOwnProperty("price")?(d(),c("p",he,i(a.value.price[0]),1)):n("",!0)]),s("div",fe,[ye,p(C,{modelValue:e.value.discount,"onUpdate:modelValue":t[5]||(t[5]=r=>e.value.discount=r),size:"1",class:b(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("discount")}])},null,8,["modelValue","class"]),a.value.hasOwnProperty("discount")?(d(),c("p",_e,i(a.value.discount[0]),1)):n("",!0)])])],40,J)]),footer:m(()=>[s("button",{class:"btn-blue mr-2",disabled:g.value,form:"form"},[p(Z,{"is-loading":g.value},{default:m(()=>[T("Save")]),_:1},8,["is-loading"])],8,ge),s("button",{onClick:L,class:"btn-gray"},"Cancel")]),_:1}))}});export{Le as default};
