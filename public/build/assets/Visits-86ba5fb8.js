import{d as R,e as x,x as U,y as K,o,c as r,a as k,h as N,v as z,b as e,z as F,w as $,g as s,A as I,r as E,B as Q,k as Y,C as W,i as c,F as M,D as H,t as h,f as S,E as j,G,H as O,S as A}from"./main-c1f62c61.js";import{M as J}from"./Master-77a73046.js";import{_ as X}from"./Paginator.vue_vue_type_script_setup_true_lang-ba67665d.js";import{u as Z}from"./urlQueryManager-3fafa3c6.js";import{i as ee}from"./index.es-2fd2791b.js";import{d as te}from"./datepickerPresets-7a436e47.js";import{_ as se}from"./BranchFilter.vue_vue_type_script_setup_true_lang-16fdce62.js";import{u as oe,P as L,p as P}from"./websocketPrint-85d5f8b4.js";import{u as ae}from"./printTemplateManager-4195074d.js";import{A as re}from"./ActivityLogSidebar-b98cd311.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./multiselect-ffe70d49.js";const ne={class:"flex gap-2 items-center ml-auto"},ie=["onKeyup"],le=["onKeyup"],de=R({__name:"VisitsFilter",emits:["change"],setup(q,{emit:D}){const y=new URLSearchParams(location.search),v=x(""),g=x(""),m=x(""),a=x([null,null]);U(()=>b());const C=K(()=>a.value[0]===null||a.value[1]===null?"":`${a.value[0]}~${a.value[1]}`),b=()=>{v.value=y.get("branchId")??"",g.value=y.get("q")??"",m.value=y.get("visitNumber")??"",y.get("dateRange")&&(a.value=y.get("dateRange").split("~"))},w=()=>{let f=`branchId=${v.value}&visitNumber=${m.value}&q=${g.value}&dateRange=${C.value}&page=1`;D("change",f)},B=()=>{const f=m.value;d(),m.value=f,w()},d=()=>{v.value="",g.value="",m.value="",a.value=[null,null]};return(f,n)=>(o(),r("div",ne,[k(se,{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=u=>v.value=u),onChange:w},null,8,["modelValue"]),N(e("input",{"onUpdate:modelValue":n[1]||(n[1]=u=>m.value=u),onKeyup:F(B,["enter"]),type:"text",placeholder:"Registration Number",class:"w-56 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,ie),[[z,m.value]]),N(e("input",{"onUpdate:modelValue":n[2]||(n[2]=u=>g.value=u),onKeyup:F(w,["enter"]),type:"text",placeholder:"Name or phone number",class:"w-56 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,le),[[z,g.value]]),k(s(ee),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:s(te),placeholder:"Select date range",value:a.value,"onUpdate:value":n[3]||(n[3]=u=>a.value=u),onChange:w,class:"!w-56","input-class":"w-full p-1.5 border border-gray-300 rounded focus:border-blue-500"},{"icon-calendar":$(()=>[]),_:1},8,["shortcuts","value"])]))}}),ce={class:"flex items-center mb-5"},ue=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"w-4 h-4 mr-1"},[e("path",{d:"M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"})],-1),pe=e("span",{class:"font-semibold"},"Create New Visit",-1),me={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},he={class:"w-full"},be={class:"sticky top-0 z-10 text-left"},fe=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"No.",-1),_e=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Name",-1),ye=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Gender",-1),ve=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Age",-1),ge=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Phone",-1),we=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Lab",-1),xe=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Orders",-1),Ce={key:0,class:"p-2 bg-gray-600 text-center text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},ke=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Date",-1),Ve=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Branch",-1),$e={key:1,class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},Be={class:"transition even:bg-gray-100"},Ie={class:"p-1 border border-gray-200"},Se={class:"p-1 border border-gray-200 whitespace-nowrap"},Ne={class:"p-1 border border-gray-200"},De={class:"p-1 border border-gray-200 whitespace-nowrap"},Me={class:"p-1 border border-gray-200"},Ae={class:"p-1 border border-gray-200 whitespace-nowrap"},Le={class:"p-1 border border-gray-200"},Pe={class:"flex flex-wrap items-center gap-1 max-w-[30rem]"},Te={class:"inline-block px-1 bg-teal-500 text-xs text-white font-bold rounded"},ze={key:0,class:"p-1 border border-gray-200"},Fe={class:"flex flex-wrap items-center justify-center gap-1"},We=["onClick","onContextmenu","disabled"],He=["onClick","onContextmenu","disabled"],Re=["onClick","onContextmenu","disabled"],Ue=["onClick","onContextmenu","disabled"],qe={class:"p-1 border border-gray-200 whitespace-nowrap"},Ke={class:"p-1 border border-gray-200"},Ee={key:1,class:"py-1 px-2 border border-gray-200 text-center"},Qe={class:"flex justify-center gap-3"},Ye=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),je=["onClick"],Ge=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"w-5 h-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),Oe=[Ge],dt=R({__name:"Visits",setup(q){const{hasDefaultDepWiseBarcodeTemplate:D,hasDefaultSampleWiseBarcodeTemplate:y,hasDefaultInvoiceTemplate:v,hasDefaultVisitBarcodeTemplate:g}=ae(),{updateUrlQuery:m}=Z(),{hasPermissionTo:a,hasAnyPermission:C}=O(),b=oe(),w=x([]),B=x({}),d=x(!1);U(()=>f(location.search));const f=async _=>{const p=await m(_),{data:i}=await I.get(`/api/visits?${p}`);w.value=i.data,B.value=i.meta},n=async(_,p,i=!1)=>{d.value=!0;const{data:V}=await I.post("/api/samples/print",{type:p,visitId:_.id});b.isConnected&&!i?b.submit({type:L.Barcodes,url:"barcode.pdf",file_content:V}):P({printable:V,type:"pdf",base64:!0}),A.fire(),d.value=!1},u=async(_,p=!1)=>{d.value=!0;const{data:i}=await I.post("/api/visits/print-barcode",{visitId:_.id});b.isConnected&&!p?b.submit({type:L.Barcodes,url:"barcode.pdf",file_content:i}):P({printable:i,type:"pdf",base64:!0}),A.fire(),d.value=!1},T=async(_,p=!1)=>{d.value=!0;const{data:i}=await I.post("/api/invoices/print",{invoiceId:_.id});b.isConnected&&!p?b.submit({type:L.Invoices,url:"invoice.pdf",file_content:i}):P({printable:i,type:"pdf",base64:!0}),A.fire(),d.value=!1};return(_,p)=>{const i=E("router-link"),V=Q("tip");return o(),r(M,null,[k(J,null,{header:$(()=>[Y("Visits")]),body:$(()=>[e("div",ce,[s(a)("Visit.create")?(o(),W(i,{key:0,to:"/visits/create",class:"btn-blue inline-flex items-center"},{default:$(()=>[ue,pe]),_:1})):c("",!0),k(de,{onChange:f})]),e("section",me,[e("table",he,[e("thead",null,[e("tr",be,[fe,_e,ye,ve,ge,we,xe,s(C)("Invoice.print","Sample.print","Visit.printBarcode")?(o(),r("th",Ce,"Print")):c("",!0),ke,Ve,s(C)("Visit.update","ActivityLog.list")?(o(),r("th",$e)):c("",!0)])]),e("tbody",null,[(o(!0),r(M,null,H(w.value,t=>(o(),r("tr",Be,[e("td",Ie,h(t.number),1),e("td",Se,h(t.patient.name),1),e("td",Ne,h(t.patient.gender.capitalize()),1),e("td",De,h(t.patient.age),1),e("td",Me,h(t.patient.phoneNumber),1),e("td",Ae,h(t.lab?.name??"local"),1),e("td",Le,[e("div",Pe,[(o(!0),r(M,null,H(t.invoice.items.filter(l=>l.status!=="canceled"),l=>(o(),r("span",Te,h(l.shortForm??l.name),1))),256))])]),s(C)("Invoice.print","Sample.print")?(o(),r("td",ze,[e("div",Fe,[s(a)("Visit.printBarcode")&&s(g)(t.branchId)?(o(),r("button",{key:0,onClick:l=>u(t),onContextmenu:S(l=>u(t,!0),["prevent"]),class:"btn-blue text-sm py-0 px-1 hover:shadow-none",disabled:d.value},"Visit barcode",40,We)):c("",!0),s(a)("Sample.print")&&s(D)(t.branchId)?(o(),r("button",{key:1,onClick:l=>n(t,"departmentWise"),onContextmenu:S(l=>n(t,"departmentWise",!0),["prevent"]),class:"btn-blue text-sm py-0 px-1 hover:shadow-none",disabled:d.value},"Dep. wise",40,He)):c("",!0),s(a)("Sample.print")&&s(y)(t.branchId)?(o(),r("button",{key:2,onClick:l=>n(t,"sampleWise"),onContextmenu:S(l=>n(t,"sampleWise",!0),["prevent"]),class:"btn-blue text-sm py-0 px-1 hover:shadow-none",disabled:d.value},"Sample wise",40,Re)):c("",!0),s(a)("Invoice.print")&&s(v)(t.branchId)?(o(),r("button",{key:3,onClick:l=>T(t.invoice),onContextmenu:S(l=>T(t.invoice,!0),["prevent"]),class:"btn-blue text-sm py-0 px-1 hover:shadow-none",disabled:d.value},"Invoice",40,Ue)):c("",!0)])])):c("",!0),e("td",qe,h(t.date),1),e("td",Ke,h(t.branch.name),1),s(C)("Visit.update","ActivityLog.list")?(o(),r("td",Ee,[e("div",Qe,[s(a)("Visit.update")?N((o(),W(i,{key:0,to:`/visits/${t.id}/edit`,class:"text-orange-500 cursor-pointer"},{default:$(()=>[Ye]),_:2},1032,["to"])),[[V,"Edit"]]):c("",!0),s(a)("ActivityLog.list")?N((o(),r("button",{key:1,onClick:l=>s(j).emit(s(G).Show,t.id),class:"text-gray-600 cursor-pointer"},Oe,8,je)),[[V,"View Activities"]]):c("",!0)])])):c("",!0)]))),256))])])])]),_:1}),k(X,{data:B.value,onChange:p[0]||(p[0]=t=>f(`page=${t}`)),class:"mt-3"},null,8,["data"]),k(re)],64)}}});export{dt as default};
