import{d as Q,e as k,y as P,ah as K,U as Z,o as d,c as u,b as e,h as b,v as _,n as i,t as n,g as l,i as m,V as T,a as y,w as Y,F as J,a1 as ee,ae as te,q as j,Q as M,p,ai as ae,f as se,aj as oe,T as X,X as re,u as ne,x as le,R as ie,k as L,_ as de,m as ue,l as ce,Y as pe,$ as z}from"./main-BgbWFIXK.js";import{M as me}from"./Master-Bb3753-s.js";import{F as D}from"./formMode-Bz--3d4P.js";import{_ as ve}from"./WebcamModal.vue_vue_type_script_setup_true_lang-BR3DwWZ2.js";import{s as he}from"./multiselect-DeMhawmc.js";import{i as be}from"./index.es-Bi00NAuK.js";import{A as g}from"./attachmentType-BPw9qDR8.js";import{u as fe}from"./phoneNumberValidation-C7c_pWlr.js";import{_ as _e}from"./VisitPrintToggles.vue_vue_type_script_setup_true_lang-Cbhnkqnv.js";import{_ as ge}from"./BranchSelect.vue_vue_type_script_setup_true_lang-ChkyAztq.js";import{b as q}from"./toggle-CP_W0i88.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./printTemplateManager-qiRkbBE7.js";import"./printTemplateType-BiK7zB0k.js";import"./printService-BW6jBw-w.js";const xe={class:"mt-2 grid grid-cols-12 gap-4"},Ne={class:"relative col-span-2"},ye={key:0,class:"text-sm text-red-500"},Ve={class:"relative col-span-2"},ke={key:0,class:"text-sm text-red-500"},we={class:"relative col-span-2"},De={key:0,class:"text-sm text-red-500"},Ie={class:"relative col-span-2"},$e={key:0,class:"text-sm text-red-500"},Fe={class:"relative col-span-2"},Me={key:0,class:"text-sm text-red-500"},Oe={class:"relative col-span-2"},Ue={key:0,class:"text-sm text-red-500"},Ce={class:"relative col-span-2"},Se={key:0,class:"text-sm text-red-500"},Pe={class:"relative col-span-2"},Ye={key:0,class:"text-sm text-red-500"},Re={class:"relative col-span-2"},Ae={key:0,class:"text-sm text-red-500"},Ee={class:"relative col-span-2"},We={key:0,class:"text-sm text-red-500"},Be={class:"relative col-span-4"},Te={key:0,class:"text-sm text-red-500"},Je={class:"relative col-span-2"},je=oe('<option value="امي">امي</option><option value="يقرا ويكتب">يقرا ويكتب</option><option value="ابتدائية">ابتدائية</option><option value="متوسطة">متوسطة</option><option value="اعدادية">اعدادية</option><option value="دبلوم">دبلوم</option><option value="بكالوريوس">بكالوريوس</option><option value="ماجستير">ماجستير</option><option value="دبلوم عالي">دبلوم عالي</option><option value="دكتوراه">دكتوراه</option>',10),Le=[je],ze={key:0,class:"text-sm text-red-500"},qe={class:"relative col-span-2"},He={key:0,class:"text-sm text-red-500"},Qe={key:0,class:"text-sm text-red-500"},Xe={key:0,class:"relative col-span-2"},Ge=e("option",{value:"ثانية"},"ثانية",-1),Ke=e("option",{value:"ثالثة"},"ثالثة",-1),Ze=e("option",{value:"ابعد"},"ابعد",-1),et=e("option",{value:"لا توجد قرابة"},"لا توجد قرابة",-1),tt=[Ge,Ke,Ze,et],at={key:0,class:"text-sm text-red-500"},st={key:1,class:"relative col-span-2"},ot={key:0,class:"text-sm text-red-500"},rt={key:2,class:"relative col-span-2"},nt={key:0,class:"text-sm text-red-500"},lt={class:"text-center"},it=["onClick","onContextmenu"],dt=["href"],ut=["src","alt"],ct={key:0,class:"mt-3"},pt={class:"text-center text-sm text-red-500"},H=Q({__name:"PersonalInformation",props:{modelValue:{},occupationOptions:{},errors:{},for:{}},emits:["update:modelValue","update:suggestions"],setup(B,{emit:R}){const O=R,{isValidPhoneNumber:C}=fe(),v=B,{hasPermissionTo:I}=X(),f=k([g.ProfilePicture,g.IdCardFront,g.IdCardBack,g.ResidenceCardFront,g.ResidenceCardBack,g.NationalityCertificate,g.DecisionOfJudge,g.TestsResults]),$=k(""),N=P({get:()=>v.modelValue,set:s=>O("update:modelValue",s)}),a=P({get:()=>v.modelValue[`${v.for}Information`],set:s=>O("update:modelValue",s)}),V=k(null),F=P(()=>a.value.birthdateYear&&a.value.birthdateMonth&&a.value.birthdateDay?j(`${a.value.birthdateYear}-${a.value.birthdateMonth}-${a.value.birthdateDay}`,"YYYY-MM-DD"):null),S=P(()=>v.for==="wife"&&j().diff(F.value,"years")<14),U=()=>{let s=6;return S.value&&(s+=1),a.value.isForeigner&&(s+=1),`grid-template-columns: repeat(${s}, minmax(0, 1fr))`},A=async({content:s})=>{if(!I("Suggestion.create"))return;const{data:t}=await M.post("/api/suggestions",{branchId:v.modelValue.branchId,type:"occupation",content:s});return v.occupationOptions.unshift(t.data),t.data},r=s=>v.errors.hasOwnProperty(`${v.for}Information.${s}`),h=s=>v.errors[`${v.for}Information.${s}`][0],E=s=>{$.value=s,V.value.open()},W=s=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=()=>{const x=t.files[0],o=new FileReader;o.readAsDataURL(x),o.onload=()=>c(s,o.result),t.remove()},t.click()},w=s=>a.value.attachments.find(t=>t.type===s),c=(s,t)=>{w(s)?w(s).path=t:a.value.attachments.push({type:s,path:t})};return K(()=>{const s=f.value.findIndex(x=>x===g.TestsResults);a.value.isForeigner?s===-1&&f.value.push(g.TestsResults):s!==-1&&f.value.splice(s,1);const t=f.value.findIndex(x=>x===g.DecisionOfJudge);S.value?t===-1&&f.value.push(g.DecisionOfJudge):t!==-1&&f.value.splice(t,1)}),(s,t)=>{const x=Z("maska");return d(),u(J,null,[e("div",xe,[e("div",Ne,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>a.value.firstName=o),class:i(["input peer",{"border-red-500":r("firstName")}])},null,2),[[_,a.value.firstName]]),e("label",{class:i(["label",{"text-red-500":r("firstName")}])},n(l(p)("First Name")),3),r("firstName")?(d(),u("p",ye,n(h("firstName")),1)):m("",!0)]),e("div",Ve,[b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>a.value.secondName=o),class:i(["input peer",{"border-red-500":r("secondName")}])},null,2),[[_,a.value.secondName]]),e("label",{class:i(["label",{"text-red-500":r("secondName")}])},n(l(p)("Second Name")),3),r("secondName")?(d(),u("p",ke,n(h("secondName")),1)):m("",!0)]),e("div",we,[b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>a.value.thirdName=o),class:i(["input peer",{"border-red-500":r("thirdName")}])},null,2),[[_,a.value.thirdName]]),e("label",{class:i(["label",{"text-red-500":r("thirdName")}])},n(l(p)("Third Name")),3),r("thirdName")?(d(),u("p",De,n(h("thirdName")),1)):m("",!0)]),e("div",Ie,[b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.fourthName=o),class:i(["input peer",{"border-red-500":r("fourthName")}])},null,2),[[_,a.value.fourthName]]),e("label",{class:i(["label",{"text-red-500":r("fourthName")}])},n(l(p)("Fourth Name")),3),r("fourthName")?(d(),u("p",$e,n(h("fourthName")),1)):m("",!0)]),e("div",Fe,[b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.motherFirstName=o),class:i(["input peer",{"border-red-500":r("motherFirstName")}])},null,2),[[_,a.value.motherFirstName]]),e("label",{class:i(["label",{"text-red-500":r("motherFirstName")}])},n(l(p)("Mother First Name")),3),r("motherFirstName")?(d(),u("p",Me,n(h("motherFirstName")),1)):m("",!0)]),e("div",Oe,[b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.motherSecondName=o),class:i(["input peer",{"border-red-500":r("motherSecondName")}])},null,2),[[_,a.value.motherSecondName]]),e("label",{class:i(["label",{"text-red-500":r("motherSecondName")}])},n(l(p)("Mother Second Name")),3),r("motherSecondName")?(d(),u("p",Ue,n(h("motherSecondName")),1)):m("",!0)]),e("div",Ce,[b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>a.value.phoneNumber=o),"data-maska":"###########",dir:"ltr",class:i(["input peer",{"!border-red-500":r("phoneNumber")||!l(C)(a.value.phoneNumber)}])},null,2),[[_,a.value.phoneNumber],[x]]),e("label",{class:i(["label",{"!text-red-500":r("phoneNumber")||!l(C)(a.value.phoneNumber)}])},n(l(p)("Phone Number")),3),r("phoneNumber")?(d(),u("p",Se,n(h("phoneNumber")),1)):m("",!0)]),e("div",Pe,[b(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>a.value.birthdateYear=o),"data-maska":"####",class:i(["input peer",{"border-red-500":r("birthdateYear")}])},null,2),[[_,a.value.birthdateYear],[x]]),e("label",{class:i(["label",{"text-red-500":r("birthdateYear")}])},n(l(p)("Year")),3),r("birthdateYear")?(d(),u("p",Ye,n(h("birthdateYear")),1)):m("",!0)]),e("div",Re,[b(e("input",{"onUpdate:modelValue":t[8]||(t[8]=o=>a.value.birthdateMonth=o),"data-maska":"##",class:i(["input peer",{"border-red-500":r("birthdateMonth")}])},null,2),[[_,a.value.birthdateMonth],[x]]),e("label",{class:i(["label",{"text-red-500":r("birthdateMonth")}])},n(l(p)("Month")),3),r("birthdateMonth")?(d(),u("p",Ae,n(h("birthdateMonth")),1)):m("",!0)]),e("div",Ee,[b(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>a.value.birthdateDay=o),"data-maska":"##",class:i(["input peer",{"border-red-500":r("birthdateDay")}])},null,2),[[_,a.value.birthdateDay],[x]]),e("label",{class:i(["label",{"text-red-500":r("birthdateDay")}])},n(l(p)("Day")),3),r("birthdateDay")?(d(),u("p",We,n(h("birthdateDay")),1)):m("",!0)]),e("div",Be,[b(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>a.value.nationalIdNumber=o),class:i(["input peer",{"border-red-500":r("nationalIdNumber")}])},null,2),[[_,a.value.nationalIdNumber]]),e("label",{class:i(["label",{"text-red-500":r("nationalIdNumber")}])},n(l(p)("National ID Number")),3),r("nationalIdNumber")?(d(),u("p",Te,n(h("nationalIdNumber")),1)):m("",!0)]),e("div",Je,[b(e("select",{"onUpdate:modelValue":t[11]||(t[11]=o=>a.value.educationDegree=o),class:i(["input peer",{"border-red-500":r("educationDegree")}])},Le,2),[[T,a.value.educationDegree]]),e("label",{class:i(["label",{"text-red-500":r("educationDegree")}])},n(l(p)("Education Degree")),3),r("educationDegree")?(d(),u("p",ze,n(h("educationDegree")),1)):m("",!0)]),e("div",qe,[y(l(he),{modelValue:a.value.occupation,"onUpdate:modelValue":t[12]||(t[12]=o=>a.value.occupation=o),options:s.occupationOptions,"value-prop":"content","track-by":"content",label:"content",searchable:!0,"create-option":l(I)("Suggestion.create"),"on-create":A,class:i(["input peer",{"border-red-500":r("occupation")}])},null,8,["modelValue","options","create-option","class"]),e("label",{class:i(["label",{"text-red-500":r("occupation")}])},n(l(p)("Occupation")),3),r("occupation")?(d(),u("p",He,n(h("occupation")),1)):m("",!0)]),e("div",{class:i(["relative col-span-2",{"col-span-8":v.for==="wife"}])},[b(e("input",{"onUpdate:modelValue":t[13]||(t[13]=o=>a.value.address=o),class:i(["input peer",{"border-red-500":r("address")}])},null,2),[[_,a.value.address]]),e("label",{class:i(["label",{"text-red-500":r("address")}])},n(l(p)("Address")),3),r("address")?(d(),u("p",Qe,n(h("address")),1)):m("",!0)],2),v.for==="husband"?(d(),u("div",Xe,[b(e("select",{"onUpdate:modelValue":t[14]||(t[14]=o=>N.value.relationDegree=o),class:i(["input peer",{"border-red-500":s.errors.hasOwnProperty("relationDegree")}])},tt,2),[[T,N.value.relationDegree]]),e("label",{class:i(["label",{"text-red-500":s.errors.hasOwnProperty("relationDegree")}])},n(l(p)("Relation Degree")),3),s.errors.hasOwnProperty("relationDegree")?(d(),u("p",at,n(s.errors.relationDegree[0]),1)):m("",!0)])):m("",!0),v.for==="husband"?(d(),u("div",st,[b(e("input",{"onUpdate:modelValue":t[15]||(t[15]=o=>N.value.receiptNumber=o),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",class:i(["input peer",{"border-red-500":s.errors.hasOwnProperty("receiptNumber")}])},null,2),[[_,N.value.receiptNumber],[x]]),e("label",{class:i(["label",{"text-red-500":s.errors.hasOwnProperty("receiptNumber")}])},n(l(p)("Receipt Number")),3),s.errors.hasOwnProperty("receiptNumber")?(d(),u("p",ot,n(s.errors.receiptNumber[0]),1)):m("",!0)])):m("",!0),v.for==="husband"?(d(),u("div",rt,[y(l(be),{value:N.value.receiptDate,"onUpdate:value":t[16]||(t[16]=o=>N.value.receiptDate=o),date:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",class:"w-full peer","input-class":["input",{"border-red-500":s.errors.hasOwnProperty("receiptDate")}]},{"icon-calendar":Y(()=>[]),_:1},8,["value","input-class"]),e("label",{class:i(["label",{"text-red-500":s.errors.hasOwnProperty("receiptDate")}])},n(l(p)("Receipt Date")),3),s.errors.hasOwnProperty("receiptDate")?(d(),u("p",nt,n(s.errors.receiptDate[0]),1)):m("",!0)])):m("",!0)]),e("div",{class:"mt-4 grid grid-cols-6 gap-4",style:te(U())},[(d(!0),u(J,null,ee(f.value,o=>b((d(),u("div",lt,[e("button",{class:"mb-1 rounded border border-transparent px-1 rtl:text-sm ltr:font-semibold transition hover:border-blue-500 hover:text-blue-500",onClick:G=>E(o),onContextmenu:se(G=>W(o),["prevent"])},n(l(p)(o.startCase())),41,it),e("a",{href:w(o)?.path,target:"_blank"},[w(o)?(d(),u("img",{key:0,src:w(o).path,alt:o,class:"mx-auto rounded-lg shadow-md"},null,8,ut)):m("",!0)],8,dt)],512)),[[ae,o!==l(g).DecisionOfJudge||v.for==="wife"]])),256))],4),r("attachments")?(d(),u("div",ct,[e("p",pt,n(h("attachments")),1)])):m("",!0),y(ve,{ref_key:"webcam",ref:V,onCapture:t[17]||(t[17]=o=>c($.value,o))},null,512)],64)}}}),mt={class:"h-[calc(100vh-8.6rem)] overflow-y-auto flex flex-col justify-between pe-2"},vt={key:0,class:"relative my-2"},ht={class:"flex items-start justify-between"},bt={class:"mb-4 text-xl font-bold underline"},ft={class:"flex items-center rounded border-2 border-gray-300"},_t={class:"border-gray-300 p-1 text-sm border-e-2"},gt=e("hr",{class:"my-4 border border-gray-300"},null,-1),xt={class:"flex items-start justify-between"},Nt={class:"mb-4 text-xl font-bold underline"},yt={class:"flex items-center rounded border-2 border-gray-300"},Vt={class:"border-gray-300 p-1 text-sm border-e-2"},kt={class:"mt-3 border-t-2 border-gray-200"},wt={class:"mt-3 flex items-center"},Dt=["disabled"],Tt=Q({__name:"PremaritalVisitForm",setup(B){const R=re(),O=ue(),C=ce(),{hasPermissionTo:v}=X(),I=k(null),f=k(D.Create),$=ne().user.branches,N=k([]),a=k({husbandInformation:{attachments:[]},wifeInformation:{attachments:[]}}),V=k({}),F=k(!1);le(()=>{$.length===1&&(a.value.branchId=$[0].id,U()),O.path.endsWith("/edit")&&(f.value=D.Edit,S(O.params.id))});const S=async c=>{const{data:s}=await M.get(`/api/premarital/visits/${c}`);a.value=s.data,U()},U=async()=>{const{data:c}=await M.get(`/api/suggestions/list?branchId=${a.value.branchId}&type=occupation`);N.value=c.data},A=async()=>{if(f.value==="edit"){const{isConfirmed:c}=await pe.fire();if(!c)return}F.value=!0;try{const c=f.value===D.Create?await E():await W();V.value={},I.value.print(c.husbandVisit),I.value.print(c.wifeVisit),r(c.husbandVisit)&&h(c.husbandVisit),f.value===D.Edit&&await C.back()}catch(c){V.value=c.response.data.errors??{}}F.value=!1},r=c=>{const s=R.data.whatsapp?.find(t=>t.branchId===c.branchId);return v("Invoice.send")&&f.value===D.Create&&s?.enabled&&(s?.sendInvoice||s?.sendWelcomeMessage)&&c.patient.contactMethod==="whatsapp"},h=async c=>{await M.post(`/api/visits/${c.id}/send-welcome-message`)},E=async()=>{const{data:c}=await M.post("/api/premarital/visits",a.value);return z.fire(),w(),c.data},W=async()=>{const{data:c}=await M.patch(`/api/premarital/visits/${a.value.id}`,a.value);return z.fire(),c.data},w=()=>{a.value={branchId:a.value.branchId,husbandInformation:{attachments:[]},wifeInformation:{attachments:[]}},V.value={}};return(c,s)=>(d(),ie(me,null,{header:Y(()=>[L(n(f.value===l(D).Create?l(p)("New Premarital Visit"):l(p)("Edit Premarital Visit")),1)]),body:Y(()=>[e("div",mt,[e("div",null,[f.value===l(D).Create&&l($).length>1?(d(),u("div",vt,[y(ge,{modelValue:a.value.branchId,"onUpdate:modelValue":s[0]||(s[0]=t=>a.value.branchId=t),onSelect:U,error:V.value.branchId},null,8,["modelValue","error"])])):m("",!0),e("div",null,[e("div",ht,[e("h1",bt,n(l(p)("Husband Information")),1),e("div",ft,[e("span",_t,n(l(p)("Foreigner")),1),y(l(q),{modelValue:a.value.husbandInformation.isForeigner,"onUpdate:modelValue":s[1]||(s[1]=t=>a.value.husbandInformation.isForeigner=t),class:"p-0.5"},null,8,["modelValue"])])]),y(H,{for:"husband","occupation-options":N.value,modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=t=>a.value=t),errors:V.value},null,8,["occupation-options","modelValue","errors"])]),gt,e("div",null,[e("div",xt,[e("h1",Nt,n(l(p)("Wife Information")),1),e("div",yt,[e("span",Vt,n(l(p)("Foreigner")),1),y(l(q),{modelValue:a.value.wifeInformation.isForeigner,"onUpdate:modelValue":s[3]||(s[3]=t=>a.value.wifeInformation.isForeigner=t),class:"p-0.5"},null,8,["modelValue"])])]),y(H,{for:"wife","occupation-options":N.value,modelValue:a.value,"onUpdate:modelValue":s[4]||(s[4]=t=>a.value=t),errors:V.value},null,8,["occupation-options","modelValue","errors"])])]),e("footer",kt,[e("div",wt,[e("button",{class:"me-auto btn-blue",disabled:F.value,onClick:A},[y(de,{"is-loading":F.value},{default:Y(()=>[L(n(l(p)("Save")),1)]),_:1},8,["is-loading"])],8,Dt),y(_e,{"branch-id":a.value.branchId,ref_key:"printToggles",ref:I},null,8,["branch-id"])])])])]),_:1}))}});export{Tt as default};
