import{d as F,e as i,u as U,x as A,Q as u,X as D,o as d,R as C,w as p,k,t as I,g as c,b as r,c as V,a as v,i as h,h as W,v as z,n as f,f as H,_ as L,a4 as Q,m as X,l as j,$ as q}from"./main-DmoZ1fz4.js";import{b as G}from"./toggle-DyRQkDOQ.js";import{s as J}from"./multiselect-DAhRltj6.js";import{F as o}from"./formMode-Bz--3d4P.js";import{_ as K}from"./Tinymce.vue_vue_type_script_setup_true_lang-DGYN-s2o.js";import{_ as Y}from"./BranchSelect.vue_vue_type_script_setup_true_lang-D_pdW9WT.js";const Z={key:0,class:"relative"},ee={class:"relative"},ae={key:0,class:"text-sm text-red-500"},te={class:"relative"},se={key:0,class:"text-sm text-red-500"},le={class:"relative"},re=["disabled"],pe=F({__name:"ResultTemplateForm",emits:["close"],setup(oe,{emit:$}){const S=$,b=X(),P=j(),e=i({}),_=U().user.branches,x=i([]),s=i(o.Create),m=i(!1),a=i({}),g=i({});A(()=>{_.length===1&&(e.value.branchId=_[0].id,w()),b.path.endsWith("/edit")&&(s.value=o.Edit),b.path.endsWith("/clone")&&(s.value=o.Clone),s.value!==o.Create&&O(b.params.id)});const O=async n=>{const{data:t}=await u.get(`/api/result-templates/${n}`);e.value=t.data,w()},w=async()=>{T(),g.value=D().data.general?.find(n=>n.branchId===e.value.branchId)},T=async()=>{const{data:n}=await u.get(`/api/parameters/list?branchId=${e.value.branchId}`);x.value=n.data},E=async()=>{m.value=!0;try{s.value===o.Create?await M():s.value===o.Clone?await N():s.value===o.Edit&&await R(),a.value={},q.fire()}catch(n){a.value=n.response.data.errors??{}}m.value=!1},M=async()=>{await u.post("/api/result-templates",e.value),B()},N=async()=>{await u.post("/api/result-templates",e.value),y()},R=async()=>{await u.patch(`/api/result-templates/${e.value.id}`,e.value),y()},B=()=>{e.value={branchId:e.value.branchId,content:""},a.value=[]},y=()=>{S("close"),P.back()};return(n,t)=>(d(),C(Q,{"modal-class":"!w-[56rem]"},{header:p(()=>[k(I(`${s.value.capitalize()} ${s.value===c(o).Create?"New":""} Result Template`),1)]),body:p(()=>[r("form",{id:"form",onSubmit:H(E,["prevent","stop"]),class:"grid grid-cols-1 gap-4"},[c(_).length>1?(d(),V("div",Z,[v(Y,{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.branchId=l),error:a.value.branchId,onSelect:w},null,8,["modelValue","error"])])):h("",!0),r("div",ee,[W(r("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.name=l),class:f(["input peer",{"border-red-500":a.value.hasOwnProperty("name")}])},null,2),[[z,e.value.name]]),r("label",{class:f(["label",{"text-red-500":a.value.hasOwnProperty("name")}])},"Name",2),a.value.hasOwnProperty("name")?(d(),V("p",ae,I(a.value.name[0]),1)):h("",!0)]),r("div",te,[v(c(J),{modelValue:e.value.parameterId,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.parameterId=l),options:x.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm",class:f(["input peer",{"border-red-500":a.value.hasOwnProperty("parameterId")}])},null,8,["modelValue","options","class"]),r("label",{class:f(["label",{"text-red-500":a.value.hasOwnProperty("parameterId")}])},"Parameter",2),a.value.hasOwnProperty("parameterId")?(d(),V("p",se,I(a.value.parameterId[0]),1)):h("",!0)]),r("div",le,[v(K,{modelValue:e.value.content,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.content=l),"limit-width":g.value?.resultEditorMaxWidth,"limit-height":g.value?.resultEditorMaxHeight},null,8,["modelValue","limit-width","limit-height"])])],32)]),footer:p(()=>[r("button",{class:"me-2 btn-blue",disabled:m.value,form:"form"},[v(L,{"is-loading":m.value},{default:p(()=>[k("Save")]),_:1},8,["is-loading"])],8,re),r("button",{onClick:y,class:"btn-gray"},"Cancel"),s.value===c(o).Edit?(d(),C(c(G),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.isActive=l),class:"toggle:off:red ms-auto"},null,8,["modelValue"])):h("",!0)]),_:1}))}});export{pe as default};
