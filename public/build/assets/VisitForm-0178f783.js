import{d as O,y as S,e as _,A as W,o as m,c as f,b as e,a as V,g as r,n as $,t as I,i as x,Q as N,U as G,$ as oe,V as q,h as p,a0 as E,v as y,a1 as F,a2 as le,u as ne,x as de,q as ie,R as Y,w as T,k as A,_ as ue,m as ce,l as be,a3 as pe,a4 as me,Z as L}from"./main-6e47ceb6.js";import{M as fe}from"./Master-c2e1e299.js";import{s as z}from"./multiselect-27b4da8b.js";import{b as j}from"./toggle-b1a111c5.js";import{P as C}from"./partnerType-65f9f978.js";import{_ as ve}from"./Autocomplete.vue_vue_type_script_setup_true_lang-fedd6baa.js";import{F as U}from"./formMode-f60a729f.js";import{G as R}from"./gender-fe0bd233.js";import{_ as he,u as ge}from"./Invoice.vue_vue_type_script_setup_true_lang-70620502.js";import{I as B}from"./invoiceStatus-af715b0d.js";import{_ as ye}from"./VisitPrintToggles.vue_vue_type_script_setup_true_lang-91c6e381.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./CurrencyInput.vue_vue_type_script_setup_true_lang-1a19a39b.js";import"./itemType-8f96b3f7.js";import"./orderStatus-e3a3f9a7.js";import"./printTemplateManager-6e5fdf5a.js";import"./websocketPrint-f72594c6.js";const xe={class:"grid grid-cols-3 gap-2"},Ve=e("h1",{class:"col-span-3 font-bold underline text-lg"},"Reference Information",-1),we={class:"flex flex-wrap items-start"},_e=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Center",-1),$e={key:0,class:"w-full text-red-500 text-sm"},Ie={class:"flex flex-wrap items-start"},ke=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Lab",-1),Pe={key:0,class:"w-full text-red-500 text-sm"},Me={class:"flex flex-wrap items-start"},Ue=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Doctor",-1),Ne={key:0,class:"w-full text-red-500 text-sm"},Ce={class:"flex flex-wrap items-start"},Oe=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Home Visit",-1),De={key:0,class:"w-full text-red-500 text-sm"},Fe={key:0,class:"flex flex-wrap items-start"},ze=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Collector",-1),Se={key:0,class:"w-full text-red-500 text-sm"},He=O({__name:"ReferenceInfo",props:{modelValue:null,errors:null},emits:["update:modelValue"],setup(o,{emit:w}){const k=o,{hasPermissionTo:t}=G(),i=S({get:()=>k.modelValue,set:h=>w("update:modelValue",h)}),a=_([]),s=_([]),l=()=>{P(),v()},P=async()=>{const{data:h}=await N.get(`/api/partners/list?branchId=${i.value.branchId}`);a.value=h.data},v=async()=>{const{data:h}=await N.get(`/api/users/list?branchId=${i.value.branchId}`);s.value=h.data},d=async(h,n)=>{const{data:u}=await N.post("/api/partners",{branchId:i.value.branchId,name:h,type:n});return a.value.push(u.data),u.data};return W(()=>i.value.branchId,()=>{l()}),(h,n)=>(m(),f("div",xe,[Ve,e("div",we,[_e,V(r(z),{modelValue:r(i).centerId,"onUpdate:modelValue":n[0]||(n[0]=u=>r(i).centerId=u),options:a.value.filter(u=>u.type===r(C).Center),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(t)("Partner.createViaSelect"),"on-create":({name:u})=>d(u,r(C).Center),class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":o.errors.hasOwnProperty("centerId")}])},null,8,["modelValue","options","create-option","on-create","class"]),o.errors.hasOwnProperty("centerId")?(m(),f("p",$e,I(o.errors.centerId[0]),1)):x("",!0)]),e("div",Ie,[ke,V(r(z),{modelValue:r(i).labId,"onUpdate:modelValue":n[1]||(n[1]=u=>r(i).labId=u),options:a.value.filter(u=>u.type===r(C).Lab),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(t)("Partner.createViaSelect"),"on-create":({name:u})=>d(u,r(C).Lab),class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":o.errors.hasOwnProperty("labId")}])},null,8,["modelValue","options","create-option","on-create","class"]),o.errors.hasOwnProperty("labId")?(m(),f("p",Pe,I(o.errors.labId[0]),1)):x("",!0)]),e("div",Me,[Ue,V(r(z),{modelValue:r(i).doctorId,"onUpdate:modelValue":n[2]||(n[2]=u=>r(i).doctorId=u),options:a.value.filter(u=>u.type===r(C).Doctor),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(t)("Partner.createViaSelect"),"on-create":({name:u})=>d(u,r(C).Doctor),class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":o.errors.hasOwnProperty("doctorId")}])},null,8,["modelValue","options","create-option","on-create","class"]),o.errors.hasOwnProperty("doctorId")?(m(),f("p",Ne,I(o.errors.doctorId[0]),1)):x("",!0)]),e("div",Ce,[Oe,V(r(j),{modelValue:r(i).isHomeVisit,"onUpdate:modelValue":n[3]||(n[3]=u=>r(i).isHomeVisit=u),"on-label":"Yes","off-label":"No",class:$(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("isHomeVisit")}])},null,8,["modelValue","class"]),o.errors.hasOwnProperty("isHomeVisit")?(m(),f("p",De,I(o.errors.isHomeVisit[0]),1)):x("",!0)]),r(i).isHomeVisit?(m(),f("div",Fe,[ze,V(r(z),{modelValue:r(i).collectorId,"onUpdate:modelValue":n[4]||(n[4]=u=>r(i).collectorId=u),options:s.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name",class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":o.errors.hasOwnProperty("collectorId")}])},null,8,["modelValue","options","class"]),o.errors.hasOwnProperty("collectorId")?(m(),f("p",Se,I(o.errors.collectorId[0]),1)):x("",!0)])):x("",!0)]))}}),Te={class:"grid grid-cols-12 gap-2"},Be=e("h1",{class:"col-span-12 font-bold underline text-lg"},"Patient Information",-1),Ee={class:"col-span-4 flex flex-wrap items-start"},Re=e("option",{value:"Mr."},"Mr.",-1),Ye=e("option",{value:"Ms."},"Ms.",-1),Ae=[Re,Ye],Le={key:0,class:"w-full text-red-500 text-sm"},We={class:"col-span-3 flex flex-wrap items-start"},Ge=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Gender",-1),qe=e("option",{value:"male"},"Male",-1),je=e("option",{value:"female"},"Female",-1),Qe=[qe,je],Ze={class:"col-span-5 flex flex-wrap items-start"},Je=e("span",{class:"p-1 bg-gray-100 border border-gray-300 border-r-0 rounded-l"},"Year",-1),Ke=e("span",{class:"p-1 border-y border-gray-300 bg-gray-100"},"Month",-1),Xe=e("span",{class:"p-1 border-y border-gray-300 bg-gray-100"},"Day",-1),er={key:0,class:"w-full text-red-500 text-sm"},rr={class:"col-span-4 flex flex-wrap items-start"},tr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Number",-1),ar={key:0,class:"w-full text-red-500 text-sm"},sr={class:"col-span-4 flex flex-wrap items-start"},or=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Email",-1),lr={class:"col-span-4 flex flex-wrap items-start"},nr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Address",-1),dr=O({__name:"PatientInfo",props:{modelValue:null,branchId:null,errors:null,mode:null},emits:["update:modelValue"],setup(o,{emit:w}){const k=o,t=S({get:()=>k.modelValue,set:v=>w("update:modelValue",v)}),i=_({countryCode:"",nationalForm:""}),a=()=>{t.value.phoneNumber=i.value.countryCode+i.value.nationalForm},s=v=>{v==="Mr."&&(t.value.gender="male"),["Mrs.","Ms.","Miss"].includes(v)&&(t.value.gender="female")},l=v=>{v===R.Male?t.value.initials="Mr.":t.value.initials="Ms."},P=async v=>{t.value=v};return oe(()=>{i.value.countryCode=t.value.phoneNumber?.slice(0,4),i.value.nationalForm=t.value.phoneNumber?.slice(4,14)}),(v,d)=>{const h=q("maska");return m(),f("div",Te,[Be,e("div",Ee,[p(e("select",{"onUpdate:modelValue":d[0]||(d[0]=n=>r(t).initials=n),onChange:d[1]||(d[1]=n=>s(n.target.value)),class:"h-[34px] px-1 border border-r-0 border-gray-300 rounded-l bg-gray-100"},Ae,544),[[E,r(t).initials]]),V(ve,{disabled:o.mode===r(U).Edit,placeholder:"Patient's Name",size:"1","parent-classes":"flex-1",class:$(["w-full p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("patient.name")}]),onSelect:P,endpoint:`/api/patients/list?branchId=${k.branchId}&limit=5`,query:"name",label:"name",modelValue:r(t).name,"onUpdate:modelValue":d[2]||(d[2]=n=>r(t).name=n)},null,8,["disabled","class","endpoint","modelValue"]),o.errors.hasOwnProperty("patient.name")?(m(),f("p",Le,I(o.errors["patient.name"][0]),1)):x("",!0)]),e("div",We,[Ge,p(e("select",{"onUpdate:modelValue":d[3]||(d[3]=n=>r(t).gender=n),onChange:d[4]||(d[4]=n=>l(n.target.value)),class:"flex-1 h-[34px] px-1 border border-gray-300 rounded-r"},Qe,544),[[E,r(t).gender]])]),e("div",Ze,[Je,p(e("input",{"onUpdate:modelValue":d[5]||(d[5]=n=>r(t).birthdateYear=n),"data-maska":"####",size:"1",class:$(["flex-1 p-1 border border-gray-300 focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("patient.birthdateYear")}])},null,2),[[y,r(t).birthdateYear],[h]]),Ke,p(e("input",{"onUpdate:modelValue":d[6]||(d[6]=n=>r(t).birthdateMonth=n),"data-maska":"##",size:"1",class:"flex-1 p-1 border border-gray-300 focus:border-blue-500"},null,512),[[y,r(t).birthdateMonth],[h]]),Xe,p(e("input",{"onUpdate:modelValue":d[7]||(d[7]=n=>r(t).birthdateDay=n),"data-maska":"##",size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).birthdateDay],[h]]),o.errors.hasOwnProperty("patient.birthdateYear")?(m(),f("p",er,I(o.errors["patient.birthdateYear"][0]),1)):x("",!0)]),e("div",rr,[tr,p(e("input",{"onUpdate:modelValue":d[8]||(d[8]=n=>i.value.countryCode=n),"data-maska":"+0","data-maska-tokens":"0:[0-9]:multiple",size:"1",tabindex:"-1",onFocusout:a,class:$(["w-12 p-1 border border-gray-300 border-r-0 focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("patient.phoneNumber")}])},null,34),[[y,i.value.countryCode],[h]]),p(e("input",{"onUpdate:modelValue":d[9]||(d[9]=n=>i.value.nationalForm=n),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",size:"1",onFocusout:a,class:$(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("patient.phoneNumber")}])},null,34),[[y,i.value.nationalForm],[h]]),o.errors.hasOwnProperty("patient.phoneNumber")?(m(),f("p",ar,I(o.errors["patient.phoneNumber"][0]),1)):x("",!0)]),e("div",sr,[or,p(e("input",{"onUpdate:modelValue":d[10]||(d[10]=n=>r(t).email=n),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).email]])]),e("div",lr,[nr,p(e("input",{"onUpdate:modelValue":d[11]||(d[11]=n=>r(t).address=n),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).address]])])])}}}),ir={class:"grid grid-cols-12 gap-2"},ur=e("h1",{class:"col-span-12 font-bold underline text-lg"},"Health Information",-1),cr={class:"col-span-3 flex flex-wrap items-start"},br=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Weight",-1),pr={class:"col-span-3 flex flex-wrap items-start"},mr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Height",-1),fr={class:"col-span-6 flex flex-wrap items-start"},vr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Symptoms",-1),hr={class:"col-span-6 flex flex-wrap items-start"},gr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Diseases",-1),yr={class:"col-span-6 flex flex-wrap items-start"},xr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Therapy",-1),Vr={key:0,class:"col-span-4 flex flex-wrap items-start"},wr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Menses Duration",-1),_r=e("option",{value:"before"},"Before",-1),$r=e("option",{value:"during"},"During",-1),Ir=e("option",{value:"after"},"After",-1),kr=[_r,$r,Ir],Pr={key:0,class:"w-full text-red-500 text-sm"},Mr={key:1,class:"col-span-2 flex flex-wrap items-start"},Ur=e("span",{class:"p-1 border border-gray-300 border-l-0 rounded-r bg-gray-100"},"Days",-1),Nr={key:0,class:"w-full text-red-500 text-sm"},Cr={class:"col-span-2 flex flex-wrap items-start"},Or=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Fasting",-1),Dr={key:0,class:"w-full text-red-500 text-sm"},Fr={key:2,class:"col-span-2 flex flex-wrap items-start"},zr=e("span",{class:"p-1 border border-gray-300 border-l-0 rounded-r bg-gray-100"},"Hours",-1),Sr={key:0,class:"w-full text-red-500 text-sm"},Hr={class:"col-span-12"},Tr=e("p",{class:""},"Notes",-1),Br=O({__name:"HealthInfo",props:{modelValue:null,patient:null,errors:null},emits:["update:modelValue"],setup(o,{emit:w}){const k=o,t=S({get:()=>k.modelValue,set:i=>w("update:modelValue",i)});return(i,a)=>{const s=q("maska");return m(),f("div",ir,[ur,e("div",cr,[br,p(e("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>r(t).weight=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).weight]])]),e("div",pr,[mr,p(e("input",{"onUpdate:modelValue":a[1]||(a[1]=l=>r(t).height=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).height]])]),e("div",fr,[vr,p(e("input",{"onUpdate:modelValue":a[2]||(a[2]=l=>r(t).symptoms=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).symptoms]])]),e("div",hr,[gr,p(e("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>r(t).diseases=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).diseases]])]),e("div",yr,[xr,p(e("input",{"onUpdate:modelValue":a[4]||(a[4]=l=>r(t).therapy=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).therapy]])]),o.patient.gender===r(R).Female?(m(),f("div",Vr,[wr,p(e("select",{"onUpdate:modelValue":a[5]||(a[5]=l=>r(t).mensesDuration=l),class:$(["flex-1 px-1 h-[34px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("mensesDuration")}])},kr,2),[[E,r(t).mensesDuration]]),o.errors.hasOwnProperty("mensesDuration")?(m(),f("p",Pr,I(o.errors.mensesDuration[0]),1)):x("",!0)])):x("",!0),o.patient.gender===r(R).Female?(m(),f("div",Mr,[p(e("input",{"onUpdate:modelValue":a[6]||(a[6]=l=>r(t).mesnesDays=l),size:"1","data-maska":"##",class:$(["flex-1 p-1 rounded-l border border-gray-300 focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("mensesDays")}])},null,2),[[y,r(t).mesnesDays],[s]]),Ur,o.errors.hasOwnProperty("mensesDays")?(m(),f("p",Nr,I(o.errors.mensesDays[0]),1)):x("",!0)])):x("",!0),e("div",Cr,[Or,V(r(j),{modelValue:r(t).isFasting,"onUpdate:modelValue":a[7]||(a[7]=l=>r(t).isFasting=l),"on-label":"Yes","off-label":"No",class:$(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("isFasting")}])},null,8,["modelValue","class"]),o.errors.hasOwnProperty("isFasting")?(m(),f("p",Dr,I(o.errors.isFasting[0]),1)):x("",!0)]),r(t).isFasting?(m(),f("div",Fr,[p(e("input",{"onUpdate:modelValue":a[8]||(a[8]=l=>r(t).fastingHours=l),size:"1","data-maska":"##",class:$(["flex-1 p-1 border border-gray-300 rounded-l focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("mensesTo")}])},null,2),[[y,r(t).fastingHours],[s]]),zr,o.errors.hasOwnProperty("fastingHours")?(m(),f("p",Sr,I(o.errors.fastingHours[0]),1)):x("",!0)])):x("",!0),e("div",Hr,[Tr,p(e("textarea",{"onUpdate:modelValue":a[9]||(a[9]=l=>r(t).notes=l),class:"w-full border border-gray-300 rounded p-2 focus:border-blue-500"},null,512),[[y,r(t).notes]])])])}}}),Er={class:"grid grid-cols-2 gap-2"},Rr=e("h1",{class:"col-span-2 font-bold underline text-lg"},"Other Information",-1),Yr={class:"flex flex-wrap items-start"},Ar=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"National ID Number",-1),Lr={class:"flex flex-wrap items-start"},Wr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Passport Number",-1),Gr={class:"flex flex-wrap items-start"},qr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Travel Certificate Number",-1),jr={class:"flex flex-wrap items-start"},Qr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Lab Card Number",-1),Zr=O({__name:"OtherInfo",props:{modelValue:null},emits:["update:modelValue"],setup(o,{emit:w}){const k=o,t=S({get:()=>k.modelValue,set:i=>w("update:modelValue",i)});return(i,a)=>(m(),f("div",Er,[Rr,e("div",Yr,[Ar,p(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>r(t).nationalIdNumber=s),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).nationalIdNumber]])]),e("div",Lr,[Wr,p(e("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>r(t).passportNumber=s),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).passportNumber]])]),e("div",Gr,[qr,p(e("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>r(t).travelCertificateNumber=s),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).travelCertificateNumber]])]),e("div",jr,[Qr,p(e("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>r(t).labCardNumber=s),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[y,r(t).labCardNumber]])])]))}}),Jr=e("h1",{class:"col-span-2 font-bold underline text-lg"},"Contact Method",-1),Kr={class:"flex items-center"},Xr={class:"flex items-center mr-5"},et=e("span",{class:"ml-1"},"None",-1),rt={class:"flex items-center mr-5"},tt=e("span",{class:"ml-1"},"SMS",-1),at={class:"flex items-center mr-5"},st=e("span",{class:"ml-1"},"Whatsapp",-1),ot={class:"flex items-center mr-5"},lt=e("span",{class:"ml-1"},"Telegram",-1),nt={class:"flex items-center mr-5"},dt=e("span",{class:"ml-1"},"Viber",-1),it=O({__name:"ContactMethod",props:{modelValue:null},emits:["update:modelValue"],setup(o,{emit:w}){const k=o,t=S({get:()=>k.modelValue,set:i=>w("update:modelValue",i)});return(i,a)=>(m(),f("div",null,[Jr,e("div",Kr,[e("label",Xr,[p(e("input",{type:"radio",value:"none","onUpdate:modelValue":a[0]||(a[0]=s=>r(t).contactMethod=s)},null,512),[[F,r(t).contactMethod]]),et]),e("label",rt,[p(e("input",{type:"radio",value:"sms","onUpdate:modelValue":a[1]||(a[1]=s=>r(t).contactMethod=s)},null,512),[[F,r(t).contactMethod]]),tt]),e("label",at,[p(e("input",{type:"radio",value:"whatsapp","onUpdate:modelValue":a[2]||(a[2]=s=>r(t).contactMethod=s)},null,512),[[F,r(t).contactMethod]]),st]),e("label",ot,[p(e("input",{type:"radio",value:"telegram","onUpdate:modelValue":a[3]||(a[3]=s=>r(t).contactMethod=s)},null,512),[[F,r(t).contactMethod]]),lt]),e("label",nt,[p(e("input",{type:"radio",value:"viber","onUpdate:modelValue":a[4]||(a[4]=s=>r(t).contactMethod=s)},null,512),[[F,r(t).contactMethod]]),dt])])]))}}),ut={class:"h-[calc(100vh-8.6rem)] overflow-y-auto flex flex-col justify-between"},ct={class:"grid grid-cols-2 gap-2"},bt={key:0,class:"flex flex-wrap items-center mb-2"},pt=e("span",{class:"w-20 p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),mt={key:0,class:"ml-20 w-full text-red-500 text-sm"},ft={class:"border-l-2 border-gray-200 pl-2"},vt=e("h1",{class:"font-bold underline text-lg"},"Orders",-1),ht={class:"mt-3 border-t-2 border-gray-200"},gt={class:"flex items-center mt-3"},yt=["disabled"],Ht=O({__name:"VisitForm",setup(o){const w=le(),k=ce(),t=be(),{hasPermissionTo:i}=G(),a=_(null),s=_({}),l=_({initials:"Mr.",gender:"male",contactMethod:"none"}),P=_({}),v=_({discount:0,extraCharges:0,status:B.Closed}),d=_([]),h=_({amount:0,notes:""}),n=_({}),u=_({}),H=_(!1),M=_(U.Create),D=ne().user.branches,Q=ge();de(()=>{D.length===1&&(s.value.branchId=D[0].id,l.value.phoneNumber=w.data.general?.find(b=>b.branchId===D[0].id).patientPhoneNumber),k.path.endsWith("/edit")&&(M.value=U.Edit,J(k.params.id))});const Z=async()=>{const{data:b}=await N.get(`/api/get-eligible-price-list?branchId=${s.value.branchId}&centerId=${s.value.centerId??""}&labId=${s.value.labId??""}&doctorId=${s.value.doctorId??""}`);n.value=b.data},J=async b=>{const{data:c}=await N.get(`/api/visits/${b}`);s.value=c.data,l.value=c.data.patient,P.value=c.data.healthInformation,v.value=c.data.invoice,d.value=c.data.invoice.invoiceItems,h.value.amount=c.data.invoice.paidAmount,l.value.age=Math.floor(ie().diff(l.value.birthdate,"years"))},K=async()=>{if(M.value==="edit"){const{isConfirmed:b}=await pe.fire();if(!b)return}if(Q.total(v.value,d.value)<0){me.fire({icon:"error",title:"Invoice can't have negative total."});return}H.value=!0;try{const b=M.value===U.Create?await re():await te();a.value.print(b),X(b)&&ee(b),M.value===U.Edit&&await t.back()}catch(b){u.value=b.response.data.errors??{}}H.value=!1},X=b=>{const c=w.data.whatsapp?.find(g=>g.branchId===b.branchId);return i("Invoice.send")&&M.value===U.Create&&c?.enabled&&(c?.sendInvoice||c?.sendWelcomeMessage)&&b.patient.contactMethod==="whatsapp"},ee=async b=>{await N.post(`/api/visits/${b.id}/send-welcome-message`)},re=async()=>{const{data:b}=await N.post("/api/visits",{visit:s.value,patient:l.value,healthInformation:P.value,invoice:v.value,invoiceItems:d.value,payment:h.value});return L.fire(),se(),b.data},te=async()=>{const{data:b}=await N.patch(`/api/visits/${s.value.id}`,{visit:s.value,patient:l.value,healthInformation:P.value,invoice:v.value,invoiceItems:d.value,payment:h.value});return L.fire(),b.data},ae=b=>{l.value.phoneNumber=w.data.general?.find(c=>c.branchId===b).patientPhoneNumber,s.value={branchId:b},v.value={discount:0,extraCharges:0,status:B.Closed},d.value=[]},se=()=>{const b=w.data.general?.find(c=>c.branchId===s.value.branchId).patientPhoneNumber;l.value={initials:"Mr.",gender:"male",phoneNumber:b,contactMethod:"none"},P.value={isFasting:!1},s.value={branchId:s.value.branchId,labId:s.value.labId},v.value={discount:0,extraCharges:0,status:B.Closed},d.value=[],u.value={}};return W(()=>[s.value.branchId,s.value.centerId,s.value.labId,s.value.doctorId],()=>{Z()},{deep:!0}),(b,c)=>(m(),Y(fe,null,{header:T(()=>[A(I(M.value===r(U).Create?"New Visit":"Edit Visit"),1)]),body:T(()=>[e("div",ut,[e("div",ct,[e("div",null,[M.value===r(U).Create&&r(D).length>1?(m(),f("div",bt,[pt,V(r(z),{modelValue:s.value.branchId,"onUpdate:modelValue":c[0]||(c[0]=g=>s.value.branchId=g),options:r(D),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,onChange:ae,class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":u.value.hasOwnProperty("visit.branchId")}])},null,8,["modelValue","options","class"]),u.value.hasOwnProperty("visit.branchId")?(m(),f("p",mt,I(u.value["visit.branchId"][0]),1)):x("",!0)])):x("",!0),V(dr,{errors:u.value,mode:M.value,modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=g=>l.value=g),"branch-id":s.value.branchId},null,8,["errors","mode","modelValue","branch-id"]),V(Br,{errors:u.value,patient:l.value,modelValue:P.value,"onUpdate:modelValue":c[2]||(c[2]=g=>P.value=g),class:"mt-2"},null,8,["errors","patient","modelValue"]),V(He,{errors:u.value,modelValue:s.value,"onUpdate:modelValue":c[3]||(c[3]=g=>s.value=g),class:"mt-2"},null,8,["errors","modelValue"]),V(Zr,{errors:u.value,modelValue:l.value,"onUpdate:modelValue":c[4]||(c[4]=g=>l.value=g),class:"mt-2"},null,8,["errors","modelValue"]),V(it,{modelValue:l.value,"onUpdate:modelValue":c[5]||(c[5]=g=>l.value=g),class:"mt-2"},null,8,["modelValue"])]),e("div",ft,[vt,s.value.branchId?(m(),Y(he,{key:0,"price-list":n.value,"branch-id":s.value.branchId,invoice:v.value,"onUpdate:invoice":c[6]||(c[6]=g=>v.value=g),invoiceItems:d.value,"onUpdate:invoiceItems":c[7]||(c[7]=g=>d.value=g),payment:h.value,"onUpdate:payment":c[8]||(c[8]=g=>h.value=g),errors:u.value,mode:M.value},null,8,["price-list","branch-id","invoice","invoiceItems","payment","errors","mode"])):x("",!0)])]),e("footer",ht,[e("div",gt,[e("button",{class:"btn-blue mr-auto",disabled:H.value,onClick:K},[V(ue,{"is-loading":H.value},{default:T(()=>[A("Save")]),_:1},8,["is-loading"])],8,yt),V(ye,{"branch-id":s.value.branchId,ref_key:"printToggles",ref:a},null,8,["branch-id"])])])])]),_:1}))}});export{Ht as default};
