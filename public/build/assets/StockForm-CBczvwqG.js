import{d as T,u as L,e as i,x as Q,Q as b,U as z,o as n,R as A,w as y,k as N,t as d,g as h,b as s,c as u,a as p,n as l,i as c,h as f,v as k,V as W,a1 as j,F as G,f as H,_ as J,a4 as K,m as X,l as Y,$ as Z}from"./main-BgbWFIXK.js";import{s as ee}from"./multiselect-DeMhawmc.js";import{F as _}from"./formMode-Bz--3d4P.js";import{_ as ae}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-CacBtO8k.js";import{_ as te}from"./BranchSelect.vue_vue_type_script_setup_true_lang-ChkyAztq.js";import{_ as se}from"./InventorySelect.vue_vue_type_script_setup_true_lang-De5tXJOb.js";const re={class:"relative col-span-2"},le={key:0,class:"text-sm text-red-500"},oe={class:"relative"},ne={class:"flex"},ue=["value"],de={key:0,class:"text-sm text-red-500"},ie={class:"relative"},ce={key:0,class:"text-sm text-red-500"},pe={class:"relative"},ve={key:0,class:"text-sm text-red-500"},me={class:"relative"},be={key:0,class:"text-sm text-red-500"},ye=["disabled"],Ve=T({__name:"StockForm",emits:["close"],setup(he,{emit:S}){const D=S,V=X(),U=Y(),v=L().user.branches,C=i([]),x=i([]),e=i({}),I=i(_.Create),m=i(!1),a=i({});Q(()=>{v.length===1&&(e.value.branchId=v[0].id,w()),V.path.endsWith("/edit")&&(I.value=_.Edit,$(V.params.id))});const $=async o=>{const{data:t}=await b.get(`/api/stock/${o}`);e.value=t.data,w()},w=async()=>{const{data:o}=await b.get(`/api/products/list?branchId=${e.value.branchId}`);x.value=o.data},P=o=>x.value.find(t=>t.id===o)?.units,q=o=>{e.value.unitId=P(o).find(t=>t.quantity===1).id},B=()=>{e.value.inventoryId=null,e.value.productId=null,w()},F=async()=>{m.value=!0;try{I.value===_.Create?await M():await E(),a.value={},Z.fire()}catch(o){a.value=o.response.data.errors??{}}m.value=!1},M=async()=>{await b.post("/api/stock",e.value),R()},E=async()=>{await b.patch(`/api/stock/${e.value.id}`,e.value),g()},R=()=>{e.value={branchId:e.value.branchId,inventoryId:e.value.inventoryId},a.value=[]},g=()=>{D("close"),U.back()};return(o,t)=>{const O=z("maska");return n(),A(K,{"modal-class":"!w-[50rem]"},{header:y(()=>[N(d(I.value===h(_).Create?"Create New Stock":"Edit Stock"),1)]),body:y(()=>[s("form",{id:"form",onSubmit:H(F,["prevent","stop"]),class:"grid grid-cols-2 gap-4"},[h(v).length>1?(n(),u("div",{key:0,class:l(["relative",{"col-span-2":C.value.length===1}])},[p(te,{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=r=>e.value.branchId=r),error:a.value.branchId,onSelect:B},null,8,["modelValue","error"])],2)):c("",!0),s("div",{class:l(["relative",{"col-span-2":h(v).length===1}])},[p(se,{modelValue:e.value.inventoryId,"onUpdate:modelValue":t[1]||(t[1]=r=>e.value.inventoryId=r),branchId:e.value.branchId,error:a.value.inventoryId},null,8,["modelValue","branchId","error"])],2),s("div",re,[p(h(ee),{modelValue:e.value.productId,"onUpdate:modelValue":t[2]||(t[2]=r=>e.value.productId=r),options:x.value,onSelect:q,searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:l(["input peer",{"border-red-500":a.value.hasOwnProperty("productId")}])},null,8,["modelValue","options","class"]),s("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("productId")}])},"Product",2),a.value.hasOwnProperty("productId")?(n(),u("p",le,d(a.value.productId[0]),1)):c("",!0)]),s("div",oe,[s("div",ne,[f(s("input",{"data-maska":"0.0","data-maska-tokens":"0:[0-9]:multiple","onUpdate:modelValue":t[3]||(t[3]=r=>e.value.quantity=r),class:l(["input peer !rounded-e-none",{"border-red-500":a.value.hasOwnProperty("quantity")}])},null,2),[[O],[k,e.value.quantity]]),s("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("quantity")}])},"Quantity",2),f(s("select",{"onUpdate:modelValue":t[4]||(t[4]=r=>e.value.unitId=r),class:l(["input w-auto border-s-0 !rounded-s-none focus:!border-s-2",{"border-red-500":a.value.hasOwnProperty("unitId")}])},[(n(!0),u(G,null,j(P(e.value.productId),r=>(n(),u("option",{value:r.id},d(r.name),9,ue))),256))],2),[[W,e.value.unitId]])]),a.value.hasOwnProperty("quantity")?(n(),u("p",de,d(a.value.quantity[0]),1)):c("",!0)]),s("div",ie,[p(ae,{modelValue:e.value.price,"onUpdate:modelValue":t[5]||(t[5]=r=>e.value.price=r),class:l(["input peer",{"border-red-500":a.value.hasOwnProperty("price")}])},null,8,["modelValue","class"]),s("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("price")}])},"Price",2),a.value.hasOwnProperty("price")?(n(),u("p",ce,d(a.value.price[0]),1)):c("",!0)]),s("div",pe,[f(s("input",{"onUpdate:modelValue":t[6]||(t[6]=r=>e.value.batchNumber=r),class:l(["input peer",{"border-red-500":a.value.hasOwnProperty("batchNumber")}])},null,2),[[k,e.value.batchNumber]]),s("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("batchNumber")}])},"Batch Number",2),a.value.hasOwnProperty("batchNumber")?(n(),u("p",ve,d(a.value.batchNumber[0]),1)):c("",!0)]),s("div",me,[f(s("input",{"onUpdate:modelValue":t[7]||(t[7]=r=>e.value.expiryDate=r),"data-maska":"####-##-##",class:l(["input peer",{"border-red-500":a.value.hasOwnProperty("expiryDate")}])},null,2),[[k,e.value.expiryDate],[O]]),s("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("expiryDate")}])},"Expiry Date",2),a.value.hasOwnProperty("expiryDate")?(n(),u("p",be,d(a.value.expiryDate[0]),1)):c("",!0)])],32)]),footer:y(()=>[s("button",{class:"me-2 btn-blue",disabled:m.value,form:"form"},[p(J,{"is-loading":m.value},{default:y(()=>[N("Save")]),_:1},8,["is-loading"])],8,ye),s("button",{onClick:g,class:"btn-gray"},"Cancel")]),_:1})}}});export{Ve as default};
