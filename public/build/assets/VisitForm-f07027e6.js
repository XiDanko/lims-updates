import{d as F,y as H,g as I,A as W,o as m,c as f,b as e,a as w,i as h,n as V,t as x,k as g,Q as C,T as G,U as te,V as j,j as b,W as B,v as y,X as z,Y as le,f as ne,e as de,u as ie,x as ue,q as pe,R,w as T,m as A,_ as ce,Z as be,$ as me,a0 as L}from"./main-5548143a.js";import{M as ve}from"./Master-c8d301f4.js";import{s as S}from"./multiselect-30de6652.js";import{b as q}from"./toggle-af3738b3.js";import{P as D}from"./partnerType-65f9f978.js";import{_ as fe}from"./Autocomplete.vue_vue_type_script_setup_true_lang-5341a578.js";import{F as U}from"./formMode-f60a729f.js";import{G as E}from"./gender-fe0bd233.js";import{_ as he,u as ge}from"./Invoice.vue_vue_type_script_setup_true_lang-6b3feaa9.js";import{I as Y}from"./invoiceStatus-af715b0d.js";import{_ as ye}from"./VisitPrintToggles.vue_vue_type_script_setup_true_lang-744be1b7.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./CurrencyInput.vue_vue_type_script_setup_true_lang-3ebc070d.js";import"./itemType-8f96b3f7.js";import"./orderStatus-e3a3f9a7.js";import"./printTemplateManager-7d6de79b.js";import"./websocketPrint-65a486cc.js";const _e={class:"grid grid-cols-3 gap-2"},Ve=e("h1",{class:"col-span-3 text-lg font-bold underline"},"Reference Information",-1),xe={class:"flex flex-wrap items-start"},we=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Center",-1),Ie={key:0,class:"w-full text-sm text-red-500"},$e={class:"flex flex-wrap items-start"},Pe=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Lab",-1),ke={key:0,class:"w-full text-sm text-red-500"},Me={class:"flex flex-wrap items-start"},Ne=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Doctor",-1),Ue={key:0,class:"w-full text-sm text-red-500"},Ce={class:"flex flex-wrap items-start"},Oe=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Home Visit",-1),De={key:0,class:"w-full text-sm text-red-500"},Fe={key:0,class:"flex flex-wrap items-start"},ze=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Collector",-1),Se={key:0,class:"w-full text-sm text-red-500"},He=F({__name:"ReferenceInfo",props:{modelValue:{},errors:{}},emits:["update:modelValue","changePatientNumber"],setup(k,{emit:_}){const $=k,{hasPermissionTo:r}=G(),t=H({get:()=>$.modelValue,set:s=>_("update:modelValue",s)}),o=I([]),a=I([]),l=()=>{M(),d()},M=async()=>{const{data:s}=await C.get(`/api/partners/list?branchId=${t.value.branchId}`);o.value=s.data},d=async()=>{const{data:s}=await C.get(`/api/users/list?branchId=${t.value.branchId}`);a.value=s.data},i=async(s,c)=>{const{data:u}=await C.post("/api/partners",{branchId:t.value.branchId,name:s,type:c});return o.value.push(u.data),u.data},P=s=>{const c=o.value.find(u=>u.id===s);c?.phoneNumber&&_("changePatientNumber",c.phoneNumber)};return W(()=>t.value.branchId,()=>{l()}),(s,c)=>(m(),f("div",_e,[Ve,e("div",xe,[we,w(h(S),{modelValue:t.value.centerId,"onUpdate:modelValue":c[0]||(c[0]=u=>t.value.centerId=u),options:o.value.filter(u=>u.type===h(D).Center),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":h(r)("Partner.createViaSelect"),"on-create":({name:u})=>i(u,h(D).Center),class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("centerId")}])},null,8,["modelValue","options","create-option","on-create","class"]),s.errors.hasOwnProperty("centerId")?(m(),f("p",Ie,x(s.errors.centerId[0]),1)):g("",!0)]),e("div",$e,[Pe,w(h(S),{modelValue:t.value.labId,"onUpdate:modelValue":c[1]||(c[1]=u=>t.value.labId=u),onSelect:P,options:o.value.filter(u=>u.type===h(D).Lab),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":h(r)("Partner.createViaSelect"),"on-create":({name:u})=>i(u,h(D).Lab),class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("labId")}])},null,8,["modelValue","options","create-option","on-create","class"]),s.errors.hasOwnProperty("labId")?(m(),f("p",ke,x(s.errors.labId[0]),1)):g("",!0)]),e("div",Me,[Ne,w(h(S),{modelValue:t.value.doctorId,"onUpdate:modelValue":c[2]||(c[2]=u=>t.value.doctorId=u),options:o.value.filter(u=>u.type===h(D).Doctor),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":h(r)("Partner.createViaSelect"),"on-create":({name:u})=>i(u,h(D).Doctor),class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("doctorId")}])},null,8,["modelValue","options","create-option","on-create","class"]),s.errors.hasOwnProperty("doctorId")?(m(),f("p",Ue,x(s.errors.doctorId[0]),1)):g("",!0)]),e("div",Ce,[Oe,w(h(q),{modelValue:t.value.isHomeVisit,"onUpdate:modelValue":c[3]||(c[3]=u=>t.value.isHomeVisit=u),"on-label":"Yes","off-label":"No",class:V(["flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("isHomeVisit")}])},null,8,["modelValue","class"]),s.errors.hasOwnProperty("isHomeVisit")?(m(),f("p",De,x(s.errors.isHomeVisit[0]),1)):g("",!0)]),t.value.isHomeVisit?(m(),f("div",Fe,[ze,w(h(S),{modelValue:t.value.collectorId,"onUpdate:modelValue":c[4]||(c[4]=u=>t.value.collectorId=u),options:a.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name",class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("collectorId")}])},null,8,["modelValue","options","class"]),s.errors.hasOwnProperty("collectorId")?(m(),f("p",Se,x(s.errors.collectorId[0]),1)):g("",!0)])):g("",!0)]))}}),Te={class:"grid grid-cols-12 gap-2"},Ye=e("h1",{class:"col-span-12 text-lg font-bold underline"},"Patient Information",-1),Be={class:"col-span-4 flex flex-wrap items-start"},Ee=e("option",{value:"Mr."},"Mr.",-1),Re=e("option",{value:"Ms."},"Ms.",-1),Ae=[Ee,Re],Le={key:0,class:"w-full text-sm text-red-500"},We={key:1,class:"w-full text-sm text-red-500"},Ge={class:"col-span-3 flex flex-wrap items-start"},je=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Gender",-1),qe=e("option",{value:"male"},"Male",-1),Qe=e("option",{value:"female"},"Female",-1),Xe=[qe,Qe],Ze={key:0,class:"w-full text-sm text-red-500"},Je={class:"col-span-5 flex flex-wrap items-start"},Ke=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Year",-1),er=e("span",{class:"border-y border-gray-300 bg-gray-100 p-1"},"Month",-1),rr=e("span",{class:"border-y border-gray-300 bg-gray-100 p-1"},"Day",-1),ar={key:0,class:"w-full text-sm text-red-500"},or={class:"col-span-4 flex flex-wrap items-start"},sr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Number",-1),tr={key:0,class:"w-full text-sm text-red-500"},lr={class:"col-span-4 flex flex-wrap items-start"},nr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Email",-1),dr={class:"col-span-4 flex flex-wrap items-start"},ir=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Address",-1),ur=F({__name:"PatientInfo",props:{modelValue:{},branchId:{},errors:{},mode:{}},emits:["update:modelValue"],setup(k,{emit:_}){const $=k,r=H({get:()=>$.modelValue,set:d=>_("update:modelValue",d)}),t=I({countryCode:"",nationalForm:""}),o=()=>{r.value.phoneNumber=t.value.countryCode+t.value.nationalForm},a=d=>{d==="Mr."&&(r.value.gender="male"),["Mrs.","Ms.","Miss"].includes(d)&&(r.value.gender="female")},l=d=>{d===E.Male?r.value.initials="Mr.":r.value.initials="Ms."},M=async d=>{r.value=d};return te(()=>{t.value.countryCode=r.value.phoneNumber?.slice(0,4),t.value.nationalForm=r.value.phoneNumber?.slice(4,14)}),(d,i)=>{const P=j("maska");return m(),f("div",Te,[Ye,e("div",Be,[b(e("select",{"onUpdate:modelValue":i[0]||(i[0]=s=>r.value.initials=s),onChange:i[1]||(i[1]=s=>a(s.target.value)),class:V(["rounded-l border border-r-0 border-gray-300 bg-gray-100 px-1 h-[34px]",{"!border border-red-500":d.errors.hasOwnProperty("patient.initials")}])},Ae,34),[[B,r.value.initials]]),w(fe,{disabled:d.mode===h(U).Edit,placeholder:"Patient's Name",size:"1","parent-classes":"flex-1",class:V(["w-full rounded-r border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":d.errors.hasOwnProperty("patient.name")}]),onSelect:M,endpoint:`/api/patients/list?branchId=${$.branchId}&limit=5`,query:"name",label:"name",modelValue:r.value.name,"onUpdate:modelValue":i[2]||(i[2]=s=>r.value.name=s)},null,8,["disabled","class","endpoint","modelValue"]),d.errors.hasOwnProperty("patient.initials")?(m(),f("p",Le,x(d.errors["patient.initials"][0]),1)):g("",!0),d.errors.hasOwnProperty("patient.name")?(m(),f("p",We,x(d.errors["patient.name"][0]),1)):g("",!0)]),e("div",Ge,[je,b(e("select",{"onUpdate:modelValue":i[3]||(i[3]=s=>r.value.gender=s),onChange:i[4]||(i[4]=s=>l(s.target.value)),class:V(["flex-1 rounded-r border border-gray-300 px-1 h-[34px]",{"!border border-red-500":d.errors.hasOwnProperty("patient.initials")}])},Xe,34),[[B,r.value.gender]]),d.errors.hasOwnProperty("patient.gender")?(m(),f("p",Ze,x(d.errors["patient.gender"][0]),1)):g("",!0)]),e("div",Je,[Ke,b(e("input",{"onUpdate:modelValue":i[5]||(i[5]=s=>r.value.birthdateYear=s),"data-maska":"####",size:"1",class:V(["flex-1 border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":d.errors.hasOwnProperty("patient.birthdateYear")}])},null,2),[[y,r.value.birthdateYear],[P]]),er,b(e("input",{"onUpdate:modelValue":i[6]||(i[6]=s=>r.value.birthdateMonth=s),"data-maska":"##",size:"1",class:"flex-1 border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.birthdateMonth],[P]]),rr,b(e("input",{"onUpdate:modelValue":i[7]||(i[7]=s=>r.value.birthdateDay=s),"data-maska":"##",size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.birthdateDay],[P]]),d.errors.hasOwnProperty("patient.birthdateYear")?(m(),f("p",ar,x(d.errors["patient.birthdateYear"][0]),1)):g("",!0)]),e("div",or,[sr,b(e("input",{"onUpdate:modelValue":i[8]||(i[8]=s=>t.value.countryCode=s),"data-maska":"+0","data-maska-tokens":"0:[0-9]:multiple",size:"1",tabindex:"-1",onFocusout:o,class:V(["w-12 border border-r-0 border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":d.errors.hasOwnProperty("patient.phoneNumber")}])},null,34),[[y,t.value.countryCode],[P]]),b(e("input",{"onUpdate:modelValue":i[9]||(i[9]=s=>t.value.nationalForm=s),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",size:"1",onFocusout:o,class:V(["flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":d.errors.hasOwnProperty("patient.phoneNumber")}])},null,34),[[y,t.value.nationalForm],[P]]),d.errors.hasOwnProperty("patient.phoneNumber")?(m(),f("p",tr,x(d.errors["patient.phoneNumber"][0]),1)):g("",!0)]),e("div",lr,[nr,b(e("input",{"onUpdate:modelValue":i[10]||(i[10]=s=>r.value.email=s),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.email]])]),e("div",dr,[ir,b(e("input",{"onUpdate:modelValue":i[11]||(i[11]=s=>r.value.address=s),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.address]])])])}}}),pr={class:"grid grid-cols-12 gap-2"},cr=e("h1",{class:"col-span-12 text-lg font-bold underline"},"Health Information",-1),br={class:"col-span-3 flex flex-wrap items-start"},mr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Weight",-1),vr={class:"col-span-3 flex flex-wrap items-start"},fr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Height",-1),hr={class:"col-span-6 flex flex-wrap items-start"},gr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Symptoms",-1),yr={class:"col-span-6 flex flex-wrap items-start"},_r=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Diseases",-1),Vr={class:"col-span-6 flex flex-wrap items-start"},xr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Therapy",-1),wr={key:0,class:"col-span-4 flex flex-wrap items-start"},Ir=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Menses Duration",-1),$r=e("option",{value:"before"},"Before",-1),Pr=e("option",{value:"during"},"During",-1),kr=e("option",{value:"after"},"After",-1),Mr=[$r,Pr,kr],Nr={key:0,class:"w-full text-sm text-red-500"},Ur={key:1,class:"col-span-2 flex flex-wrap items-start"},Cr=e("span",{class:"rounded-r border border-l-0 border-gray-300 bg-gray-100 p-1"},"Days",-1),Or={key:0,class:"w-full text-sm text-red-500"},Dr={class:"col-span-2 flex flex-wrap items-start"},Fr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Fasting",-1),zr={key:0,class:"w-full text-sm text-red-500"},Sr={key:2,class:"col-span-2 flex flex-wrap items-start"},Hr=e("span",{class:"rounded-r border border-l-0 border-gray-300 bg-gray-100 p-1"},"Hours",-1),Tr={key:0,class:"w-full text-sm text-red-500"},Yr={class:"col-span-12"},Br=e("p",{class:""},"Notes",-1),Er=F({__name:"HealthInfo",props:{modelValue:{},patient:{},errors:{}},emits:["update:modelValue"],setup(k,{emit:_}){const $=k,r=H({get:()=>$.modelValue,set:t=>_("update:modelValue",t)});return(t,o)=>{const a=j("maska");return m(),f("div",pr,[cr,e("div",br,[mr,b(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>r.value.weight=l),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.weight]])]),e("div",vr,[fr,b(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>r.value.height=l),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.height]])]),e("div",hr,[gr,b(e("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>r.value.symptoms=l),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.symptoms]])]),e("div",yr,[_r,b(e("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>r.value.diseases=l),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.diseases]])]),e("div",Vr,[xr,b(e("input",{"onUpdate:modelValue":o[4]||(o[4]=l=>r.value.therapy=l),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.therapy]])]),t.patient.gender===h(E).Female?(m(),f("div",wr,[Ir,b(e("select",{"onUpdate:modelValue":o[5]||(o[5]=l=>r.value.mensesDuration=l),class:V(["flex-1 rounded-r border border-gray-300 px-1 h-[34px] focus:border-blue-500",{"!border-red-500":t.errors.hasOwnProperty("mensesDuration")}])},Mr,2),[[B,r.value.mensesDuration]]),t.errors.hasOwnProperty("mensesDuration")?(m(),f("p",Nr,x(t.errors.mensesDuration[0]),1)):g("",!0)])):g("",!0),t.patient.gender===h(E).Female?(m(),f("div",Ur,[b(e("input",{"onUpdate:modelValue":o[6]||(o[6]=l=>r.value.mesnesDays=l),size:"1","data-maska":"##",class:V(["flex-1 rounded-l border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":t.errors.hasOwnProperty("mensesDays")}])},null,2),[[y,r.value.mesnesDays],[a]]),Cr,t.errors.hasOwnProperty("mensesDays")?(m(),f("p",Or,x(t.errors.mensesDays[0]),1)):g("",!0)])):g("",!0),e("div",Dr,[Fr,w(h(q),{modelValue:r.value.isFasting,"onUpdate:modelValue":o[7]||(o[7]=l=>r.value.isFasting=l),"on-label":"Yes","off-label":"No",class:V(["flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":t.errors.hasOwnProperty("isFasting")}])},null,8,["modelValue","class"]),t.errors.hasOwnProperty("isFasting")?(m(),f("p",zr,x(t.errors.isFasting[0]),1)):g("",!0)]),r.value.isFasting?(m(),f("div",Sr,[b(e("input",{"onUpdate:modelValue":o[8]||(o[8]=l=>r.value.fastingHours=l),size:"1","data-maska":"##",class:V(["flex-1 rounded-l border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":t.errors.hasOwnProperty("mensesTo")}])},null,2),[[y,r.value.fastingHours],[a]]),Hr,t.errors.hasOwnProperty("fastingHours")?(m(),f("p",Tr,x(t.errors.fastingHours[0]),1)):g("",!0)])):g("",!0),e("div",Yr,[Br,b(e("textarea",{"onUpdate:modelValue":o[9]||(o[9]=l=>r.value.notes=l),class:"w-full rounded border border-gray-300 p-2 focus:border-blue-500"},null,512),[[y,r.value.notes]])])])}}}),Rr={class:"grid grid-cols-2 gap-2"},Ar=e("h1",{class:"col-span-2 text-lg font-bold underline"},"Other Information",-1),Lr={class:"flex flex-wrap items-start"},Wr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"National ID Number",-1),Gr={class:"flex flex-wrap items-start"},jr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Passport Number",-1),qr={class:"flex flex-wrap items-start"},Qr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Travel Certificate Number",-1),Xr={class:"flex flex-wrap items-start"},Zr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Lab Card Number",-1),Jr=F({__name:"OtherInfo",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:_}){const $=k,r=H({get:()=>$.modelValue,set:t=>_("update:modelValue",t)});return(t,o)=>(m(),f("div",Rr,[Ar,e("div",Lr,[Wr,b(e("input",{"onUpdate:modelValue":o[0]||(o[0]=a=>r.value.nationalIdNumber=a),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.nationalIdNumber]])]),e("div",Gr,[jr,b(e("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>r.value.passportNumber=a),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.passportNumber]])]),e("div",qr,[Qr,b(e("input",{"onUpdate:modelValue":o[2]||(o[2]=a=>r.value.travelCertificateNumber=a),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.travelCertificateNumber]])]),e("div",Xr,[Zr,b(e("input",{"onUpdate:modelValue":o[3]||(o[3]=a=>r.value.labCardNumber=a),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.labCardNumber]])])]))}}),Kr=e("h1",{class:"col-span-2 text-lg font-bold underline"},"Contact Method",-1),ea={class:"flex items-center"},ra={class:"mr-5 flex items-center"},aa=e("span",{class:"ml-1"},"None",-1),oa={class:"mr-5 flex items-center"},sa=e("span",{class:"ml-1"},"SMS",-1),ta={class:"mr-5 flex items-center"},la=e("span",{class:"ml-1"},"Whatsapp",-1),na={class:"mr-5 flex items-center"},da=e("span",{class:"ml-1"},"Telegram",-1),ia={class:"mr-5 flex items-center"},ua=e("span",{class:"ml-1"},"Viber",-1),pa=F({__name:"ContactMethod",props:{modelValue:{}},emits:["update:modelValue"],setup(k,{emit:_}){const $=k,r=H({get:()=>$.modelValue,set:t=>_("update:modelValue",t)});return(t,o)=>(m(),f("div",null,[Kr,e("div",ea,[e("label",ra,[b(e("input",{type:"radio",value:"none","onUpdate:modelValue":o[0]||(o[0]=a=>r.value.contactMethod=a)},null,512),[[z,r.value.contactMethod]]),aa]),e("label",oa,[b(e("input",{type:"radio",value:"sms","onUpdate:modelValue":o[1]||(o[1]=a=>r.value.contactMethod=a)},null,512),[[z,r.value.contactMethod]]),sa]),e("label",ta,[b(e("input",{type:"radio",value:"whatsapp","onUpdate:modelValue":o[2]||(o[2]=a=>r.value.contactMethod=a)},null,512),[[z,r.value.contactMethod]]),la]),e("label",na,[b(e("input",{type:"radio",value:"telegram","onUpdate:modelValue":o[3]||(o[3]=a=>r.value.contactMethod=a)},null,512),[[z,r.value.contactMethod]]),da]),e("label",ia,[b(e("input",{type:"radio",value:"viber","onUpdate:modelValue":o[4]||(o[4]=a=>r.value.contactMethod=a)},null,512),[[z,r.value.contactMethod]]),ua])])]))}}),ca={class:"h-[calc(100vh-8.6rem)] overflow-y-auto flex flex-col justify-between"},ba={class:"grid grid-cols-2 gap-2"},ma={key:0,class:"mb-2 flex flex-wrap items-center"},va=e("span",{class:"w-20 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Branch",-1),fa={key:0,class:"ml-20 w-full text-sm text-red-500"},ha={class:"border-l-2 border-gray-200 pl-2"},ga=e("h1",{class:"text-lg font-bold underline"},"Orders",-1),ya={class:"mt-3 border-t-2 border-gray-200"},_a={class:"mt-3 flex items-center"},Va=["disabled"],Ya=F({__name:"VisitForm",setup(k){const _=le(),$=ne(),r=de(),{hasPermissionTo:t}=G(),o=I(null),a=I({}),l=I({contactMethod:"none"}),M=I({}),d=I({discount:0,extraCharges:0,status:Y.Closed}),i=I([]),P=I({amount:0,notes:""}),s=I({}),c=I({}),u=I(!1),N=I(U.Create),O=ie().user.branches,Q=ge();ue(()=>{O.length===1&&(a.value.branchId=O[0].id,l.value.phoneNumber=_.data.general?.find(p=>p.branchId===O[0].id).patientPhoneNumber,l.value.contactMethod=_.data.general?.find(p=>p.branchId===O[0].id).patientContactMethod),$.path.endsWith("/edit")&&(N.value=U.Edit,Z($.params.id))});const X=async()=>{const{data:p}=await C.get(`/api/price-lists/eligible?branchId=${a.value.branchId}&centerId=${a.value.centerId??""}&labId=${a.value.labId??""}&doctorId=${a.value.doctorId??""}`);s.value=p.data},Z=async p=>{const{data:n}=await C.get(`/api/visits/${p}`);a.value=n.data,l.value=n.data.patient,M.value=n.data.healthInformation,d.value=n.data.invoice,i.value=n.data.invoice.invoiceItems,P.value.amount=n.data.invoice.paidAmount,l.value.age=Math.floor(pe().diff(l.value.birthdate,"years"))},J=async()=>{if(N.value==="edit"){const{isConfirmed:p}=await be.fire();if(!p)return}if(Q.total(d.value,i.value)<0){me.fire({icon:"error",title:"Invoice can't have negative total."});return}u.value=!0;try{const p=N.value===U.Create?await re():await ae();o.value.print(p),K(p)&&ee(p),N.value===U.Edit&&await r.back(),c.value={}}catch(p){c.value=p.response.data.errors??{}}u.value=!1},K=p=>{const n=_.data.whatsapp?.find(v=>v.branchId===p.branchId);return t("Invoice.send")&&N.value===U.Create&&n?.enabled&&(n?.sendInvoice||n?.sendWelcomeMessage)&&p.patient.contactMethod==="whatsapp"},ee=async p=>{await C.post(`/api/visits/${p.id}/send-welcome-message`)},re=async()=>{const{data:p}=await C.post("/api/visits",{visit:a.value,patient:l.value,healthInformation:M.value,invoice:d.value,invoiceItems:i.value,payment:P.value});return L.fire(),se(),p.data},ae=async()=>{const{data:p}=await C.patch(`/api/visits/${a.value.id}`,{visit:a.value,patient:l.value,healthInformation:M.value,invoice:d.value,invoiceItems:i.value,payment:P.value});return L.fire(),p.data},oe=p=>{l.value.phoneNumber=_.data.general?.find(n=>n.branchId===p).patientPhoneNumber,l.value.contactMethod=_.data.general?.find(n=>n.branchId===p).patientContactMethod,a.value={branchId:p},d.value={discount:0,extraCharges:0,status:Y.Closed},i.value=[]},se=()=>{const p=_.data.general?.find(v=>v.branchId===a.value.branchId).patientContactMethod;let n=_.data.general?.find(v=>v.branchId===a.value.branchId).patientPhoneNumber;a.value.labId&&(n=l.value.phoneNumber),l.value={phoneNumber:n,contactMethod:p},a.value={branchId:a.value.branchId,labId:a.value.labId},M.value={isFasting:!1},d.value={discount:0,extraCharges:0,status:Y.Closed},i.value=[],c.value={}};return W(()=>[a.value.branchId,a.value.centerId,a.value.labId,a.value.doctorId],()=>{X()},{deep:!0}),(p,n)=>(m(),R(ve,null,{header:T(()=>[A(x(N.value===h(U).Create?"New Visit":"Edit Visit"),1)]),body:T(()=>[e("div",ca,[e("div",ba,[e("div",null,[N.value===h(U).Create&&h(O).length>1?(m(),f("div",ma,[va,w(h(S),{modelValue:a.value.branchId,"onUpdate:modelValue":n[0]||(n[0]=v=>a.value.branchId=v),options:h(O),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,onChange:oe,class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":c.value.hasOwnProperty("visit.branchId")}])},null,8,["modelValue","options","class"]),c.value.hasOwnProperty("visit.branchId")?(m(),f("p",fa,x(c.value["visit.branchId"][0]),1)):g("",!0)])):g("",!0),w(ur,{errors:c.value,mode:N.value,modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=v=>l.value=v),"branch-id":a.value.branchId},null,8,["errors","mode","modelValue","branch-id"]),w(Er,{errors:c.value,patient:l.value,modelValue:M.value,"onUpdate:modelValue":n[2]||(n[2]=v=>M.value=v),class:"mt-2"},null,8,["errors","patient","modelValue"]),w(He,{errors:c.value,modelValue:a.value,"onUpdate:modelValue":n[3]||(n[3]=v=>a.value=v),onChangePatientNumber:n[4]||(n[4]=v=>l.value.phoneNumber=v),class:"mt-2"},null,8,["errors","modelValue"]),w(Jr,{errors:c.value,modelValue:l.value,"onUpdate:modelValue":n[5]||(n[5]=v=>l.value=v),class:"mt-2"},null,8,["errors","modelValue"]),w(pa,{modelValue:l.value,"onUpdate:modelValue":n[6]||(n[6]=v=>l.value=v),class:"mt-2"},null,8,["modelValue"])]),e("div",ha,[ga,a.value.branchId?(m(),R(he,{key:0,"price-list":s.value,"branch-id":a.value.branchId,invoice:d.value,"onUpdate:invoice":n[7]||(n[7]=v=>d.value=v),invoiceItems:i.value,"onUpdate:invoiceItems":n[8]||(n[8]=v=>i.value=v),payment:P.value,"onUpdate:payment":n[9]||(n[9]=v=>P.value=v),errors:c.value,mode:N.value},null,8,["price-list","branch-id","invoice","invoiceItems","payment","errors","mode"])):g("",!0)])]),e("footer",ya,[e("div",_a,[e("button",{class:"mr-auto btn-blue",disabled:u.value,onClick:J},[w(ce,{"is-loading":u.value},{default:T(()=>[A("Save")]),_:1},8,["is-loading"])],8,Va),w(ye,{"branch-id":a.value.branchId,ref_key:"printToggles",ref:o},null,8,["branch-id"])])])])]),_:1}))}});export{Ya as default};
