import{d as Q,e as v,u as X,P as Y,x as Z,A as p,B as ee,o as u,C as M,w as S,k as q,t as c,g as o,b as r,c as b,a as d,n as m,i,h as f,v as g,J as ae,f as re,_ as se,V as te,m as le,l as oe,S as de}from"./main-c1f62c61.js";import{b as y}from"./toggle-b89396fa.js";import{s as w}from"./multiselect-ffe70d49.js";import{F as x}from"./formMode-f60a729f.js";import{_ as ne}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-0c3f56bb.js";const ue=["onSubmit"],ie={class:"grid grid-cols-2 gap-3"},pe={key:0,class:"col-span-2 flex flex-wrap items-start"},ce=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),be={key:0,class:"ml-40 w-full text-red-500 text-sm"},me={class:"flex flex-wrap items-start"},ve=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Department",-1),fe={key:0,class:"ml-40 w-full text-red-500 text-sm"},ye={class:"flex flex-wrap items-start"},ge=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Machine",-1),he={key:0,class:"ml-40 w-full text-red-500 text-sm"},we={class:"flex flex-wrap items-start"},xe=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Seq. No.",-1),_e={key:0,class:"ml-40 w-full text-red-500 text-sm"},Ve={class:"flex flex-wrap items-start"},Ie=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Code",-1),Se={key:0,class:"ml-40 w-full text-red-500 text-sm"},Ce={class:"flex flex-wrap items-start"},ke=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Name",-1),Pe={key:0,class:"ml-40 w-full text-red-500 text-sm"},Te={class:"flex flex-wrap items-start"},Ue=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Short Form",-1),Oe={key:0,class:"ml-40 w-full text-red-500 text-sm"},Be={class:"flex flex-wrap items-start"},Fe=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Sample Content",-1),Ne={key:0,class:"ml-40 w-full text-red-500 text-sm"},Me={class:"flex flex-wrap items-start"},qe=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Sample Type",-1),$e={key:0,class:"ml-40 w-full text-red-500 text-sm"},De={class:"flex flex-wrap items-start"},ze=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Affected By Fasting",-1),Ae={class:"flex flex-wrap items-start"},Ee=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Affected By Menses",-1),Re={class:"flex flex-wrap items-start"},He=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Bypass",-1),Je={class:"flex flex-wrap items-start"},Le=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Single Test",-1),We={class:"flex flex-wrap items-start"},je=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Printable",-1),Ge={class:"flex flex-wrap items-start"},Ke=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Print Separately",-1),Qe={class:"flex flex-wrap items-start"},Xe=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Turnaround Time",-1),Ye=r("option",{value:null},"Select",-1),Ze=r("option",{value:"minutes"},"Minutes",-1),ea=r("option",{value:"hours"},"Hours",-1),aa=r("option",{value:"days"},"Days",-1),ra=[Ye,Ze,ea,aa],sa={class:"flex flex-wrap items-start"},ta=r("span",{class:"w-40 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Cost",-1),la={class:"col-span-2 flex flex-wrap items-start"},oa=r("span",{class:"w-full"},"Notes",-1),da=["disabled"],ma=Q({__name:"TestForm",emits:["close"],setup(na,{emit:$}){const T=le(),D=oe(),e=v({isPrintable:!0}),C=v([]),_=X().user.branches,U=v([]),k=v([]),O=v([]),V=v(x.Create),I=v(!1),t=v({}),n=Y({value:null,unit:null});Z(()=>{_.length===1&&(e.value.branchId=_[0].id,P()),T.path.endsWith("/edit")&&(V.value=x.Edit,L(T.params.id))});const z=async()=>{const{data:l}=await p.get(`/api/suggestions/list?branchId=${e.value.branchId}&type=sampleContent`);k.value=l.data},A=async({content:l})=>{const{data:a}=await p.post("/api/suggestions",{branchId:e.value.branchId,type:"sampleContent",content:l});return k.value.push(a.data),a.data},B=async l=>{const{data:a}=await p.get(`/api/machines/list?departmentId=${l}`);O.value=a.data},E=async()=>{const{data:l}=await p.get(`/api/departments/list?branchId=${e.value.branchId}`);U.value=l.data},R=async()=>{const{data:l}=await p.get(`/api/sample-types/list?branchId=${e.value.branchId}`);C.value=l.data},H=async({name:l})=>{const{data:a}=await p.post("/api/sample-types",{branchId:e.value.branchId,name:l});return C.value.push(a.data),a.data},P=()=>{E(),R(),z()},J=()=>{e.value.departmentId=null,e.value.machineId=null,e.value.sampleContent=null,e.value.sampleTypeId=null,e.value.sequenceNumber=null},F=async()=>{const{data:l}=await p.post("/api/tests/generate-sequence",{branchId:e.value.branchId,departmentId:e.value.departmentId});e.value.sequenceNumber=l},L=async l=>{const{data:a}=await p.get(`/api/tests/${l}`);if(e.value=a.data,P(),B(a.data.departmentId),e.value.turnaroundTime){const h=e.value.turnaroundTime.split(" ");n.value=h[0],n.unit=h[1]}},W=async()=>{I.value=!0,n.unit&&n.value&&(e.value.turnaroundTime=n.value+" "+n.unit);try{V.value===x.Create?await j():await G(),de.fire()}catch(l){t.value=l.response.data.errors??{}}I.value=!1},j=async()=>{await p.post("/api/tests",e.value),K(),await F()},G=async()=>{await p.patch(`/api/tests/${e.value.id}`,e.value),N()},K=()=>{e.value={branchId:e.value.branchId,departmentId:e.value.departmentId,machineId:e.value.machineId,isPrintable:!0},n.unit=null,n.value=null,t.value=[]},N=()=>{$("close"),D.back()};return(l,a)=>{const h=ee("maska");return u(),M(te,{"modal-class":"!w-[60rem]"},{header:S(()=>[q(c(V.value===o(x).Create?"Create New Test":"Edit Test"),1)]),body:S(()=>[r("form",{id:"form",onSubmit:re(W,["prevent","stop"])},[r("div",ie,[o(_).length>1?(u(),b("div",pe,[ce,d(o(w),{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value.branchId=s),options:o(_),onSelect:P,onChange:J,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("branchId")?(u(),b("p",be,c(t.value.branchId[0]),1)):i("",!0)])):i("",!0),r("div",me,[ve,d(o(w),{modelValue:e.value.departmentId,"onUpdate:modelValue":a[1]||(a[1]=s=>e.value.departmentId=s),options:U.value,onSelect:a[2]||(a[2]=s=>{F(),B(s)}),onChange:a[3]||(a[3]=s=>e.value.machineId=null),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("departmentId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("departmentId")?(u(),b("p",fe,c(t.value.departmentId[0]),1)):i("",!0)]),r("div",ye,[ge,d(o(w),{modelValue:e.value.machineId,"onUpdate:modelValue":a[4]||(a[4]=s=>e.value.machineId=s),options:O.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("machineId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("machineId")?(u(),b("p",he,c(t.value.machineId[0]),1)):i("",!0)]),r("div",we,[xe,f(r("input",{"onUpdate:modelValue":a[5]||(a[5]=s=>e.value.sequenceNumber=s),"data-maska":"###",size:"1",class:m(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("sequenceNumber")}])},null,2),[[g,e.value.sequenceNumber],[h]]),t.value.hasOwnProperty("sequenceNumber")?(u(),b("p",_e,c(t.value.sequenceNumber[0]),1)):i("",!0)]),r("div",Ve,[Ie,f(r("input",{"onUpdate:modelValue":a[6]||(a[6]=s=>e.value.code=s),size:"1",class:m(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("code")}])},null,2),[[g,e.value.code]]),t.value.hasOwnProperty("code")?(u(),b("p",Se,c(t.value.code[0]),1)):i("",!0)]),r("div",Ce,[ke,f(r("input",{"onUpdate:modelValue":a[7]||(a[7]=s=>e.value.name=s),size:"1",class:m(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("name")}])},null,2),[[g,e.value.name]]),t.value.hasOwnProperty("name")?(u(),b("p",Pe,c(t.value.name[0]),1)):i("",!0)]),r("div",Te,[Ue,f(r("input",{"onUpdate:modelValue":a[8]||(a[8]=s=>e.value.shortForm=s),size:"1",class:m(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("shortForm")}])},null,2),[[g,e.value.shortForm]]),t.value.hasOwnProperty("shortForm")?(u(),b("p",Oe,c(t.value.shortForm[0]),1)):i("",!0)]),r("div",Be,[Fe,d(o(w),{modelValue:e.value.sampleContent,"onUpdate:modelValue":a[9]||(a[9]=s=>e.value.sampleContent=s),options:k.value,"value-prop":"content","track-by":"content",label:"content",searchable:!0,"create-option":!0,"on-create":A,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("sampleContent")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("sampleContent")?(u(),b("p",Ne,c(t.value.sampleContent[0]),1)):i("",!0)]),r("div",Me,[qe,d(o(w),{modelValue:e.value.sampleTypeId,"onUpdate:modelValue":a[10]||(a[10]=s=>e.value.sampleTypeId=s),options:C.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,"create-option":!0,"on-create":H,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("sampleTypeId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("sampleTypeId")?(u(),b("p",$e,c(t.value.sampleTypeId[0]),1)):i("",!0)]),r("div",De,[ze,d(o(y),{modelValue:e.value.affectedByFasting,"onUpdate:modelValue":a[11]||(a[11]=s=>e.value.affectedByFasting=s),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])]),r("div",Ae,[Ee,d(o(y),{modelValue:e.value.affectedByMenses,"onUpdate:modelValue":a[12]||(a[12]=s=>e.value.affectedByMenses=s),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])]),r("div",Re,[He,d(o(y),{modelValue:e.value.bypass,"onUpdate:modelValue":a[13]||(a[13]=s=>e.value.bypass=s),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])]),r("div",Je,[Le,d(o(y),{modelValue:e.value.isSingle,"onUpdate:modelValue":a[14]||(a[14]=s=>e.value.isSingle=s),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])]),r("div",We,[je,d(o(y),{modelValue:e.value.isPrintable,"onUpdate:modelValue":a[15]||(a[15]=s=>e.value.isPrintable=s),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])]),r("div",Ge,[Ke,d(o(y),{modelValue:e.value.printSeparately,"onUpdate:modelValue":a[16]||(a[16]=s=>e.value.printSeparately=s),class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])]),r("div",Qe,[Xe,f(r("input",{"onUpdate:modelValue":a[17]||(a[17]=s=>n.value=s),size:"1","data-maska":"##",class:"flex-1 p-2 border border-gray-300 focus:border-blue-500"},null,512),[[g,n.value],[h]]),f(r("select",{"onUpdate:modelValue":a[18]||(a[18]=s=>n.unit=s),class:"px-2 py-1 h-[42px] border border-gray-300 border-l-0 rounded-r"},ra,512),[[ae,n.unit]])]),r("div",sa,[ta,d(ne,{modelValue:e.value.cost,"onUpdate:modelValue":a[19]||(a[19]=s=>e.value.cost=s),size:"1",class:"flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500"},null,8,["modelValue"])]),r("div",la,[oa,f(r("textarea",{"onUpdate:modelValue":a[20]||(a[20]=s=>e.value.notes=s),rows:"4",class:"flex-1 p-2 border border-gray-300 rounded focus:border-blue-500"},null,512),[[g,e.value.notes]])])])],40,ue)]),footer:S(()=>[r("button",{class:"btn-blue mr-2",disabled:I.value,form:"form"},[d(se,{"is-loading":I.value},{default:S(()=>[q("Save")]),_:1},8,["is-loading"])],8,da),r("button",{onClick:N,class:"btn-gray"},"Cancel"),V.value===o(x).Edit?(u(),M(o(y),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":a[21]||(a[21]=s=>e.value.isActive=s),class:"ml-auto toggle:off:red"},null,8,["modelValue"])):i("",!0)]),_:1})}}});export{ma as default};
