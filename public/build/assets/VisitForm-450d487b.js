import{d as S,y as T,e as V,A as q,o as p,c as m,b as e,a as I,g as r,n as $,t as _,i as y,Q as U,Y as j,$ as se,U as Q,h as b,a0 as E,v as g,a1 as H,a2 as oe,u as le,x as ne,q as de,R as A,w as Y,k as W,_ as ie,m as ue,l as ce,a3 as be,a4 as pe,Z as G}from"./main-56f58ed8.js";import{M as me}from"./Master-fc459851.js";import{s as R}from"./multiselect-167e14f5.js";import{b as Z}from"./toggle-876d3de4.js";import{_ as fe}from"./Autocomplete.vue_vue_type_script_setup_true_lang-0d9115db.js";import{F as O}from"./formMode-f60a729f.js";import{G as L}from"./gender-fe0bd233.js";import{_ as ve,u as he}from"./Invoice.vue_vue_type_script_setup_true_lang-85f6e80c.js";import{I as B}from"./invoiceStatus-af715b0d.js";import{_ as ge}from"./VisitPrintToggles.vue_vue_type_script_setup_true_lang-cd1aee23.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./CurrencyInput.vue_vue_type_script_setup_true_lang-5457422b.js";import"./itemType-8f96b3f7.js";import"./orderStatus-e3a3f9a7.js";import"./printTemplateManager-19d5b864.js";import"./websocketPrint-54028e1f.js";const ye={class:"grid grid-cols-3 gap-2"},xe=e("h1",{class:"col-span-3 font-bold underline text-lg"},"Reference Information",-1),Ve={class:"flex flex-wrap items-start"},Ie=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Lab",-1),we={key:0,class:"w-full text-red-500 text-sm"},$e={class:"flex flex-wrap items-start"},_e=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Center",-1),Ce={key:0,class:"w-full text-red-500 text-sm"},ke={class:"flex flex-wrap items-start"},Me=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Doctor",-1),Ue={key:0,class:"w-full text-red-500 text-sm"},Ne={class:"flex flex-wrap items-start"},Pe=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Home Visit",-1),De={key:0,class:"w-full text-red-500 text-sm"},Oe={key:0,class:"flex flex-wrap items-start"},Fe=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Collector",-1),ze={key:0,class:"w-full text-red-500 text-sm"},Se=S({__name:"ReferenceInfo",props:{modelValue:null,errors:null},emits:["update:modelValue"],setup(s,{emit:w}){const C=s,{hasPermissionTo:a}=j(),n=T({get:()=>C.modelValue,set:x=>w("update:modelValue",x)}),o=V([]),t=V([]),l=V([]),N=V([]),v=()=>{d(),k(),u(),M()},d=async()=>{const{data:x}=await U.get(`/api/labs/list?branchId=${n.value.branchId}`);o.value=x.data},k=async()=>{const{data:x}=await U.get(`/api/reference-centers/list?branchId=${n.value.branchId}`);t.value=x.data},u=async()=>{const{data:x}=await U.get(`/api/reference-doctors/list?branchId=${n.value.branchId}`);l.value=x.data},M=async()=>{const{data:x}=await U.get(`/api/reference-doctors/list?branchId=${n.value.branchId}`);N.value=x.data},z=async({name:x})=>{const{data:f}=await U.post("/api/labs",{branchId:n.value.branchId,name:x});return o.value.push(f.data),f.data},P=async({name:x})=>{const{data:f}=await U.post("/api/reference-centers",{branchId:n.value.branchId,name:x});return t.value.push(f.data),f.data},F=async({name:x})=>{const{data:f}=await U.post("/api/reference-doctors",{branchId:n.value.branchId,name:x,referenceCenterId:n.value.referenceCenterId});return l.value.push(f.data),f.data};return q(()=>n.value.branchId,()=>{v()}),(x,f)=>(p(),m("div",ye,[xe,e("div",Ve,[Ie,I(r(R),{modelValue:r(n).labId,"onUpdate:modelValue":f[0]||(f[0]=D=>r(n).labId=D),options:o.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(a)("Lab.create"),"on-create":z,class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("labId")}])},null,8,["modelValue","options","create-option","class"]),s.errors.hasOwnProperty("labId")?(p(),m("p",we,_(s.errors.labId[0]),1)):y("",!0)]),e("div",$e,[_e,I(r(R),{modelValue:r(n).referenceCenterId,"onUpdate:modelValue":f[1]||(f[1]=D=>r(n).referenceCenterId=D),options:t.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(a)("ReferenceCenter.create"),"on-create":P,class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("referenceCenterId")}])},null,8,["modelValue","options","create-option","class"]),s.errors.hasOwnProperty("referenceCenterId")?(p(),m("p",Ce,_(s.errors.referenceCenterId[0]),1)):y("",!0)]),e("div",ke,[Me,I(r(R),{modelValue:r(n).referenceDoctorId,"onUpdate:modelValue":f[2]||(f[2]=D=>r(n).referenceDoctorId=D),options:l.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":r(a)("ReferenceDoctor.create"),"on-create":F,class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("referenceDoctorId")}])},null,8,["modelValue","options","create-option","class"]),s.errors.hasOwnProperty("referenceDoctorId")?(p(),m("p",Ue,_(s.errors.referenceDoctorId[0]),1)):y("",!0)]),e("div",Ne,[Pe,I(r(Z),{modelValue:r(n).isHomeVisit,"onUpdate:modelValue":f[3]||(f[3]=D=>r(n).isHomeVisit=D),"on-label":"Yes","off-label":"No",class:$(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("isHomeVisit")}])},null,8,["modelValue","class"]),s.errors.hasOwnProperty("isHomeVisit")?(p(),m("p",De,_(s.errors.isHomeVisit[0]),1)):y("",!0)]),r(n).isHomeVisit?(p(),m("div",Oe,[Fe,I(r(R),{modelValue:r(n).collectorId,"onUpdate:modelValue":f[4]||(f[4]=D=>r(n).collectorId=D),options:N.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name",class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.errors.hasOwnProperty("collectorId")}])},null,8,["modelValue","options","class"]),s.errors.hasOwnProperty("collectorId")?(p(),m("p",ze,_(s.errors.collectorId[0]),1)):y("",!0)])):y("",!0)]))}}),He={class:"grid grid-cols-12 gap-2"},Re=e("h1",{class:"col-span-12 font-bold underline text-lg"},"Patient Information",-1),Te={class:"col-span-4 flex flex-wrap items-start"},Ye=e("option",{value:"Mr."},"Mr.",-1),Be=e("option",{value:"Ms."},"Ms.",-1),Ee=[Ye,Be],Le={key:0,class:"w-full text-red-500 text-sm"},Ae={class:"col-span-3 flex flex-wrap items-start"},We=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Gender",-1),Ge=e("option",{value:"male"},"Male",-1),qe=e("option",{value:"female"},"Female",-1),je=[Ge,qe],Qe={class:"col-span-5 flex flex-wrap items-start"},Ze=e("span",{class:"p-1 bg-gray-100 border border-gray-300 border-r-0 rounded-l"},"Year",-1),Je=e("span",{class:"p-1 border-y border-gray-300 bg-gray-100"},"Month",-1),Ke=e("span",{class:"p-1 border-y border-gray-300 bg-gray-100"},"Day",-1),Xe={key:0,class:"w-full text-red-500 text-sm"},er={class:"col-span-4 flex flex-wrap items-start"},rr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Number",-1),ar={key:0,class:"w-full text-red-500 text-sm"},tr={class:"col-span-4 flex flex-wrap items-start"},sr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Email",-1),or={class:"col-span-4 flex flex-wrap items-start"},lr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Address",-1),nr=S({__name:"PatientInfo",props:{modelValue:null,branchId:null,errors:null,mode:null},emits:["update:modelValue"],setup(s,{emit:w}){const C=s,a=T({get:()=>C.modelValue,set:v=>w("update:modelValue",v)}),n=V({countryCode:"",nationalForm:""}),o=()=>{a.value.phoneNumber=n.value.countryCode+n.value.nationalForm},t=v=>{v==="Mr."&&(a.value.gender="male"),["Mrs.","Ms.","Miss"].includes(v)&&(a.value.gender="female")},l=v=>{v===L.Male?a.value.initials="Mr.":a.value.initials="Ms."},N=async v=>{a.value=v};return se(()=>{n.value.countryCode=a.value.phoneNumber?.slice(0,4),n.value.nationalForm=a.value.phoneNumber?.slice(4,14)}),(v,d)=>{const k=Q("maska");return p(),m("div",He,[Re,e("div",Te,[b(e("select",{"onUpdate:modelValue":d[0]||(d[0]=u=>r(a).initials=u),onChange:d[1]||(d[1]=u=>t(u.target.value)),class:"h-[34px] px-1 border border-r-0 border-gray-300 rounded-l bg-gray-100"},Ee,544),[[E,r(a).initials]]),I(fe,{disabled:s.mode===r(O).Edit,placeholder:"Patient's Name",size:"1","parent-classes":"flex-1",class:$(["w-full p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("patient.name")}]),onSelect:N,endpoint:`/api/patients/list?branchId=${C.branchId}&limit=5`,query:"name",label:"name",modelValue:r(a).name,"onUpdate:modelValue":d[2]||(d[2]=u=>r(a).name=u)},null,8,["disabled","class","endpoint","modelValue"]),s.errors.hasOwnProperty("patient.name")?(p(),m("p",Le,_(s.errors["patient.name"][0]),1)):y("",!0)]),e("div",Ae,[We,b(e("select",{"onUpdate:modelValue":d[3]||(d[3]=u=>r(a).gender=u),onChange:d[4]||(d[4]=u=>l(u.target.value)),class:"flex-1 h-[34px] px-1 border border-gray-300 rounded-r"},je,544),[[E,r(a).gender]])]),e("div",Qe,[Ze,b(e("input",{"onUpdate:modelValue":d[5]||(d[5]=u=>r(a).birthdateYear=u),"data-maska":"####",size:"1",class:$(["flex-1 p-1 border border-gray-300 focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("patient.birthdateYear")}])},null,2),[[g,r(a).birthdateYear],[k]]),Je,b(e("input",{"onUpdate:modelValue":d[6]||(d[6]=u=>r(a).birthdateMonth=u),"data-maska":"##",size:"1",class:"flex-1 p-1 border border-gray-300 focus:border-blue-500"},null,512),[[g,r(a).birthdateMonth],[k]]),Ke,b(e("input",{"onUpdate:modelValue":d[7]||(d[7]=u=>r(a).birthdateDay=u),"data-maska":"##",size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).birthdateDay],[k]]),s.errors.hasOwnProperty("patient.birthdateYear")?(p(),m("p",Xe,_(s.errors["patient.birthdateYear"][0]),1)):y("",!0)]),e("div",er,[rr,b(e("input",{"onUpdate:modelValue":d[8]||(d[8]=u=>n.value.countryCode=u),"data-maska":"+0","data-maska-tokens":"0:[0-9]:multiple",size:"1",tabindex:"-1",onFocusout:o,class:$(["w-12 p-1 border border-gray-300 border-r-0 focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("patient.phoneNumber")}])},null,34),[[g,n.value.countryCode],[k]]),b(e("input",{"onUpdate:modelValue":d[9]||(d[9]=u=>n.value.nationalForm=u),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",size:"1",onFocusout:o,class:$(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("patient.phoneNumber")}])},null,34),[[g,n.value.nationalForm],[k]]),s.errors.hasOwnProperty("patient.phoneNumber")?(p(),m("p",ar,_(s.errors["patient.phoneNumber"][0]),1)):y("",!0)]),e("div",tr,[sr,b(e("input",{"onUpdate:modelValue":d[10]||(d[10]=u=>r(a).email=u),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).email]])]),e("div",or,[lr,b(e("input",{"onUpdate:modelValue":d[11]||(d[11]=u=>r(a).address=u),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).address]])])])}}}),dr={class:"grid grid-cols-12 gap-2"},ir=e("h1",{class:"col-span-12 font-bold underline text-lg"},"Health Information",-1),ur={class:"col-span-3 flex flex-wrap items-start"},cr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Weight",-1),br={class:"col-span-3 flex flex-wrap items-start"},pr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Height",-1),mr={class:"col-span-6 flex flex-wrap items-start"},fr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Symptoms",-1),vr={class:"col-span-6 flex flex-wrap items-start"},hr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Diseases",-1),gr={class:"col-span-6 flex flex-wrap items-start"},yr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Therapy",-1),xr={key:0,class:"col-span-4 flex flex-wrap items-start"},Vr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Menses Duration",-1),Ir=e("option",{value:"before"},"Before",-1),wr=e("option",{value:"during"},"During",-1),$r=e("option",{value:"after"},"After",-1),_r=[Ir,wr,$r],Cr={key:0,class:"w-full text-red-500 text-sm"},kr={key:1,class:"col-span-2 flex flex-wrap items-start"},Mr=e("span",{class:"p-1 border border-gray-300 border-l-0 rounded-r bg-gray-100"},"Days",-1),Ur={key:0,class:"w-full text-red-500 text-sm"},Nr={class:"col-span-2 flex flex-wrap items-start"},Pr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Fasting",-1),Dr={key:0,class:"w-full text-red-500 text-sm"},Or={key:2,class:"col-span-2 flex flex-wrap items-start"},Fr=e("span",{class:"p-1 border border-gray-300 border-l-0 rounded-r bg-gray-100"},"Hours",-1),zr={key:0,class:"w-full text-red-500 text-sm"},Sr={class:"col-span-12"},Hr=e("p",{class:""},"Notes",-1),Rr=S({__name:"HealthInfo",props:{modelValue:null,patient:null,errors:null},emits:["update:modelValue"],setup(s,{emit:w}){const C=s,a=T({get:()=>C.modelValue,set:n=>w("update:modelValue",n)});return(n,o)=>{const t=Q("maska");return p(),m("div",dr,[ir,e("div",ur,[cr,b(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>r(a).weight=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).weight]])]),e("div",br,[pr,b(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>r(a).height=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).height]])]),e("div",mr,[fr,b(e("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>r(a).symptoms=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).symptoms]])]),e("div",vr,[hr,b(e("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>r(a).diseases=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).diseases]])]),e("div",gr,[yr,b(e("input",{"onUpdate:modelValue":o[4]||(o[4]=l=>r(a).therapy=l),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).therapy]])]),s.patient.gender===r(L).Female?(p(),m("div",xr,[Vr,b(e("select",{"onUpdate:modelValue":o[5]||(o[5]=l=>r(a).mensesDuration=l),class:$(["flex-1 px-1 h-[34px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("mensesDuration")}])},_r,2),[[E,r(a).mensesDuration]]),s.errors.hasOwnProperty("mensesDuration")?(p(),m("p",Cr,_(s.errors.mensesDuration[0]),1)):y("",!0)])):y("",!0),s.patient.gender===r(L).Female?(p(),m("div",kr,[b(e("input",{"onUpdate:modelValue":o[6]||(o[6]=l=>r(a).mesnesDays=l),size:"1","data-maska":"##",class:$(["flex-1 p-1 rounded-l border border-gray-300 focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("mensesDays")}])},null,2),[[g,r(a).mesnesDays],[t]]),Mr,s.errors.hasOwnProperty("mensesDays")?(p(),m("p",Ur,_(s.errors.mensesDays[0]),1)):y("",!0)])):y("",!0),e("div",Nr,[Pr,I(r(Z),{modelValue:r(a).isFasting,"onUpdate:modelValue":o[7]||(o[7]=l=>r(a).isFasting=l),"on-label":"Yes","off-label":"No",class:$(["flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("isFasting")}])},null,8,["modelValue","class"]),s.errors.hasOwnProperty("isFasting")?(p(),m("p",Dr,_(s.errors.isFasting[0]),1)):y("",!0)]),r(a).isFasting?(p(),m("div",Or,[b(e("input",{"onUpdate:modelValue":o[8]||(o[8]=l=>r(a).fastingHours=l),size:"1","data-maska":"##",class:$(["flex-1 p-1 border border-gray-300 rounded-l focus:border-blue-500",{"!border-red-500":s.errors.hasOwnProperty("mensesTo")}])},null,2),[[g,r(a).fastingHours],[t]]),Fr,s.errors.hasOwnProperty("fastingHours")?(p(),m("p",zr,_(s.errors.fastingHours[0]),1)):y("",!0)])):y("",!0),e("div",Sr,[Hr,b(e("textarea",{"onUpdate:modelValue":o[9]||(o[9]=l=>r(a).notes=l),class:"w-full border border-gray-300 rounded p-2 focus:border-blue-500"},null,512),[[g,r(a).notes]])])])}}}),Tr={class:"grid grid-cols-2 gap-2"},Yr=e("h1",{class:"col-span-2 font-bold underline text-lg"},"Other Information",-1),Br={class:"flex flex-wrap items-start"},Er=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"National ID Number",-1),Lr={class:"flex flex-wrap items-start"},Ar=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Passport Number",-1),Wr={class:"flex flex-wrap items-start"},Gr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Travel Certificate Number",-1),qr={class:"flex flex-wrap items-start"},jr=e("span",{class:"p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Lab Card Number",-1),Qr=S({__name:"OtherInfo",props:{modelValue:null},emits:["update:modelValue"],setup(s,{emit:w}){const C=s,a=T({get:()=>C.modelValue,set:n=>w("update:modelValue",n)});return(n,o)=>(p(),m("div",Tr,[Yr,e("div",Br,[Er,b(e("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>r(a).nationalIdNumber=t),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).nationalIdNumber]])]),e("div",Lr,[Ar,b(e("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>r(a).passportNumber=t),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).passportNumber]])]),e("div",Wr,[Gr,b(e("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>r(a).travelCertificateNumber=t),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).travelCertificateNumber]])]),e("div",qr,[jr,b(e("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>r(a).labCardNumber=t),size:"1",class:"flex-1 p-1 border border-gray-300 rounded-r focus:border-blue-500"},null,512),[[g,r(a).labCardNumber]])])]))}}),Zr=e("h1",{class:"col-span-2 font-bold underline text-lg"},"Contact Method",-1),Jr={class:"flex items-center"},Kr={class:"flex items-center mr-5"},Xr=e("span",{class:"ml-1"},"None",-1),ea={class:"flex items-center mr-5"},ra=e("span",{class:"ml-1"},"SMS",-1),aa={class:"flex items-center mr-5"},ta=e("span",{class:"ml-1"},"Whatsapp",-1),sa={class:"flex items-center mr-5"},oa=e("span",{class:"ml-1"},"Telegram",-1),la={class:"flex items-center mr-5"},na=e("span",{class:"ml-1"},"Viber",-1),da=S({__name:"ContactMethod",props:{modelValue:null},emits:["update:modelValue"],setup(s,{emit:w}){const C=s,a=T({get:()=>C.modelValue,set:n=>w("update:modelValue",n)});return(n,o)=>(p(),m("div",null,[Zr,e("div",Jr,[e("label",Kr,[b(e("input",{type:"radio",value:"none","onUpdate:modelValue":o[0]||(o[0]=t=>r(a).contactMethod=t)},null,512),[[H,r(a).contactMethod]]),Xr]),e("label",ea,[b(e("input",{type:"radio",value:"sms","onUpdate:modelValue":o[1]||(o[1]=t=>r(a).contactMethod=t)},null,512),[[H,r(a).contactMethod]]),ra]),e("label",aa,[b(e("input",{type:"radio",value:"whatsapp","onUpdate:modelValue":o[2]||(o[2]=t=>r(a).contactMethod=t)},null,512),[[H,r(a).contactMethod]]),ta]),e("label",sa,[b(e("input",{type:"radio",value:"telegram","onUpdate:modelValue":o[3]||(o[3]=t=>r(a).contactMethod=t)},null,512),[[H,r(a).contactMethod]]),oa]),e("label",la,[b(e("input",{type:"radio",value:"viber","onUpdate:modelValue":o[4]||(o[4]=t=>r(a).contactMethod=t)},null,512),[[H,r(a).contactMethod]]),na])])]))}}),ia={class:"h-[calc(100vh-8.6rem)] overflow-y-auto flex flex-col justify-between"},ua={class:"grid grid-cols-2 gap-2"},ca={key:0,class:"flex flex-wrap items-center mb-2"},ba=e("span",{class:"w-20 p-1 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),pa={key:0,class:"ml-20 w-full text-red-500 text-sm"},ma={class:"border-l-2 border-gray-200 pl-2"},fa=e("h1",{class:"font-bold underline text-lg"},"Orders",-1),va={class:"mt-3 border-t-2 border-gray-200"},ha={class:"flex items-center mt-3"},ga=["disabled"],za=S({__name:"VisitForm",setup(s){const w=oe(),C=ue(),a=ce(),{hasPermissionTo:n}=j(),o=V(null),t=V({}),l=V({initials:"Mr.",gender:"male",contactMethod:"none"}),N=V({}),v=V({discount:0,extraCharges:0,status:B.Closed}),d=V([]),k=V({amount:0,notes:""}),u=V({}),M=V({}),z=V(!1),P=V(O.Create),F=le().user.branches,x=he();ne(()=>{F.length===1&&(t.value.branchId=F[0].id,l.value.phoneNumber=w.data.general?.find(c=>c.branchId===F[0].id).patientPhoneNumber),C.path.endsWith("/edit")&&(P.value=O.Edit,D(C.params.id))});const f=async()=>{const{data:c}=await U.get(`/api/get-eligible-price-list?branchId=${t.value.branchId}&labId=${t.value.labId??""}&referenceCenterId=${t.value.referenceCenterId??""}&referenceDoctorId=${t.value.referenceDoctorId??""}`);u.value=c.data},D=async c=>{const{data:i}=await U.get(`/api/visits/${c}`);t.value=i.data,l.value=i.data.patient,N.value=i.data.healthInformation,v.value=i.data.invoice,d.value=i.data.invoice.items,k.value.amount=i.data.invoice.paidAmount,l.value.age=Math.floor(de().diff(l.value.birthdate,"years"))},J=async()=>{if(P.value==="edit"){const{isConfirmed:c}=await be.fire();if(!c)return}if(x.total(v.value,d.value)<0){pe.fire({icon:"error",title:"Invoice can't have negative total."});return}z.value=!0;try{const c=P.value===O.Create?await ee():await re();o.value.print(c),K(c)&&X(c),P.value===O.Edit&&await a.back()}catch(c){M.value=c.response.data.errors??{}}z.value=!1},K=c=>{const i=w.data.whatsapp?.find(h=>h.branchId===c.branchId);return n("Invoice.send")&&P.value===O.Create&&i?.enabled&&(i?.sendInvoice||i?.sendWelcomeMessage)&&c.patient.contactMethod==="whatsapp"},X=async c=>{await U.post(`/api/visits/${c.id}/send-welcome-message`)},ee=async()=>{const{data:c}=await U.post("/api/visits",{visit:t.value,patient:l.value,healthInformation:N.value,invoice:v.value,invoiceItems:d.value,payment:k.value});return G.fire(),te(),c.data},re=async()=>{const{data:c}=await U.patch(`/api/visits/${t.value.id}`,{visit:t.value,patient:l.value,healthInformation:N.value,invoice:v.value,invoiceItems:d.value,payment:k.value});return G.fire(),c.data},ae=c=>{l.value.phoneNumber=w.data.general?.find(i=>i.branchId===c).patientPhoneNumber,t.value={branchId:c},v.value={discount:0,extraCharges:0,status:B.Closed},d.value=[]},te=()=>{const c=w.data.general?.find(i=>i.branchId===t.value.branchId).patientPhoneNumber;l.value={initials:"Mr.",gender:"male",phoneNumber:c,contactMethod:"none"},N.value={isFasting:!1},t.value={branchId:t.value.branchId,labId:t.value.labId},v.value={discount:0,extraCharges:0,status:B.Closed},d.value=[],M.value={}};return q(()=>[t.value.branchId,t.value.labId,t.value.referenceCenterId,t.value.referenceDoctorId],()=>{f()},{deep:!0}),(c,i)=>(p(),A(me,null,{header:Y(()=>[W(_(P.value===r(O).Create?"New Visit":"Edit Visit"),1)]),body:Y(()=>[e("div",ia,[e("div",ua,[e("div",null,[P.value===r(O).Create&&r(F).length>1?(p(),m("div",ca,[ba,I(r(R),{modelValue:t.value.branchId,"onUpdate:modelValue":i[0]||(i[0]=h=>t.value.branchId=h),options:r(F),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,onChange:ae,class:$(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":M.value.hasOwnProperty("visit.branchId")}])},null,8,["modelValue","options","class"]),M.value.hasOwnProperty("visit.branchId")?(p(),m("p",pa,_(M.value["visit.branchId"][0]),1)):y("",!0)])):y("",!0),I(nr,{errors:M.value,mode:P.value,modelValue:l.value,"onUpdate:modelValue":i[1]||(i[1]=h=>l.value=h),"branch-id":t.value.branchId},null,8,["errors","mode","modelValue","branch-id"]),I(Rr,{errors:M.value,patient:l.value,modelValue:N.value,"onUpdate:modelValue":i[2]||(i[2]=h=>N.value=h),class:"mt-2"},null,8,["errors","patient","modelValue"]),I(Se,{errors:M.value,modelValue:t.value,"onUpdate:modelValue":i[3]||(i[3]=h=>t.value=h),class:"mt-2"},null,8,["errors","modelValue"]),I(Qr,{errors:M.value,modelValue:l.value,"onUpdate:modelValue":i[4]||(i[4]=h=>l.value=h),class:"mt-2"},null,8,["errors","modelValue"]),I(da,{modelValue:l.value,"onUpdate:modelValue":i[5]||(i[5]=h=>l.value=h),class:"mt-2"},null,8,["modelValue"])]),e("div",ma,[fa,t.value.branchId?(p(),A(ve,{key:0,"price-list":u.value,"branch-id":t.value.branchId,invoice:v.value,"onUpdate:invoice":i[6]||(i[6]=h=>v.value=h),invoiceItems:d.value,"onUpdate:invoiceItems":i[7]||(i[7]=h=>d.value=h),payment:k.value,"onUpdate:payment":i[8]||(i[8]=h=>k.value=h),errors:M.value,mode:P.value},null,8,["price-list","branch-id","invoice","invoiceItems","payment","errors","mode"])):y("",!0)])]),e("footer",va,[e("div",ha,[e("button",{class:"btn-blue mr-auto",disabled:z.value,onClick:J},[I(ie,{"is-loading":z.value},{default:Y(()=>[W("Save")]),_:1},8,["is-loading"])],8,ga),I(ge,{"branch-id":t.value.branchId,ref_key:"printToggles",ref:o},null,8,["branch-id"])])])])]),_:1}))}});export{za as default};
