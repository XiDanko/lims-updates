import{d as E,e as d,u as F,y as M,x as U,Q as f,o as l,R as z,w as y,k as V,t as h,b as r,g as w,c as p,a as b,i as m,n as i,h as A,v as D,f as L,_ as Q,a4 as W,m as j,l as q,a8 as k,$ as G}from"./main-BgbWFIXK.js";import{_ as H}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-CacBtO8k.js";import{F as c}from"./formMode-Bz--3d4P.js";import{T as I}from"./transactionType-BTQWP0LV.js";import{s as J}from"./multiselect-DeMhawmc.js";import{_ as K}from"./BranchSelect.vue_vue_type_script_setup_true_lang-ChkyAztq.js";const X={class:"grid grid-cols-1 gap-4"},Y={key:0,class:"relative"},Z={key:1,class:"relative"},ee={key:0,class:"text-sm text-red-500"},ae={class:"relative"},te={key:0,class:"text-sm text-red-500"},se={class:"relative"},re={key:0,class:"w-full text-sm text-red-500"},oe=["disabled"],me=E({__name:"RegisterTransactionForm",emits:["close"],setup(ne,{emit:O}){const R=O,o=j(),$=q(),x=d([]),g=F().user.branches,e=d({}),u=d(c.Create),v=d(!1),a=d([]),C=M(()=>{let t;return u.value===c.Create?t="Add "+k.capitalize(o.params.transactionType):u.value===c.Edit&&(t="Edit "+k.capitalize(e.value.transactionType)),t});U(async()=>{u.value===c.Create&&(e.value.type=o.params.transactionType==="transfer"?I.TransferOut:o.params.transactionType),g.length===1&&(e.value.branchId=g[0].id,T()),o.path.endsWith("/edit")&&(u.value=c.Edit,await P())});const P=async()=>{const{data:t}=await f.get(`/api/registers/${o.params.registerId}/transactions/${o.params.transactionId}/show`);e.value=t.data},T=async()=>{if(e.value.type!==I.TransferOut)return;const{data:t}=await f.get(`/api/registers/list?branchId=${e.value.branchId}`);x.value=t.data},N=async()=>{v.value=!0;try{u.value===c.Create?await S():await B(),a.value={},G.fire()}catch(t){a.value=t.response.data.errors??{}}v.value=!1},S=async()=>{await f.post(`/api/registers/${o.params.registerId}/transactions`,e.value),_()},B=async()=>{await f.patch(`/api/registers/${o.params.registerId}/transactions/${o.params.transactionId}`,e.value),_()},_=()=>{R("close"),$.back()};return(t,s)=>(l(),z(W,null,{header:y(()=>[V(h(C.value),1)]),body:y(()=>[r("form",{id:"form",onSubmit:L(N,["prevent","stop"])},[r("div",X,[w(g).length>1?(l(),p("div",Y,[b(K,{modelValue:e.value.branchId,"onUpdate:modelValue":s[0]||(s[0]=n=>e.value.branchId=n),error:a.value.branchId,onSelect:T},null,8,["modelValue","error"])])):m("",!0),e.value.type===w(I).TransferOut?(l(),p("div",Z,[b(w(J),{modelValue:e.value.referenceRegisterId,"onUpdate:modelValue":s[1]||(s[1]=n=>e.value.referenceRegisterId=n),options:x.value,searchable:!0,"value-prop":"id","track-by":"userName",label:"userName","can-clear":!1,"can-deselect":!1,class:i(["input peer",{"border-red-500":a.value.hasOwnProperty("referenceRegisterId")}])},null,8,["modelValue","options","class"]),r("label",{class:i(["label",{"text-red-500":a.value.hasOwnProperty("referenceRegisterId")}])},"To Register",2),a.value.hasOwnProperty("referenceRegisterId")?(l(),p("p",ee,h(a.value.referenceRegisterId[0]),1)):m("",!0)])):m("",!0),r("div",ae,[b(H,{modelValue:e.value.amount,"onUpdate:modelValue":s[2]||(s[2]=n=>e.value.amount=n),class:i(["input peer",{"border-red-500":a.value.hasOwnProperty("amount")}])},null,8,["modelValue","class"]),r("label",{class:i(["label",{"text-red-500":a.value.hasOwnProperty("amount")}])},"Amount",2),a.value.hasOwnProperty("amount")?(l(),p("p",te,h(a.value.amount[0]),1)):m("",!0)]),r("div",se,[A(r("textarea",{"onUpdate:modelValue":s[3]||(s[3]=n=>e.value.notes=n),rows:"4",class:i(["input peer",{"border-red-500":a.value.hasOwnProperty("notes")}])},null,2),[[D,e.value.notes]]),r("label",{class:i(["label",{"text-red-500":a.value.hasOwnProperty("notes")}])},"Notes",2),a.value.hasOwnProperty("notes")?(l(),p("p",re,h(a.value.notes[0]),1)):m("",!0)])])],32)]),footer:y(()=>[r("button",{class:"me-2 btn-blue",disabled:v.value,form:"form"},[b(Q,{"is-loading":v.value},{default:y(()=>[V("Save")]),_:1},8,["is-loading"])],8,oe),r("button",{onClick:_,class:"btn-gray"},"Cancel")]),_:1}))}});export{me as default};
