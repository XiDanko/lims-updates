import{d as E,u as M,e as d,x as R,Q as m,o as p,R as D,w as v,k,t as i,g as u,b as s,c as I,a as h,i as _,n as c,f as z,_ as L,a4 as Q,m as W,l as q,$ as G}from"./main-BgbWFIXK.js";import{s as S}from"./multiselect-DeMhawmc.js";import{_ as H}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-CacBtO8k.js";import{F as o}from"./formMode-Bz--3d4P.js";import{_ as J}from"./BranchSelect.vue_vue_type_script_setup_true_lang-ChkyAztq.js";const K={key:0,class:"relative"},X={class:"relative"},Y={key:0,class:"text-sm text-red-500"},Z={class:"relative"},ee={class:"flex w-full items-center justify-between"},ae={class:"rounded bg-teal-500 px-2 text-sm text-white"},te={key:0,class:"text-sm text-red-500"},se={class:"relative"},re={key:0,class:"text-sm text-red-500"},le=["disabled"],me=E({__name:"ItemShareForm",emits:["close"],setup(oe,{emit:P}){const $=P,g=W(),O=q(),y=M().user.branches,V=d([]),w=d([]),e=d({}),n=d(o.Create),b=d(!1),a=d({});R(()=>{y.length===1&&(e.value.branchId=y[0].id,x(),f()),g.path.endsWith("/edit")&&(n.value=o.Edit,B(g.params.id))});const x=async()=>{const{data:l}=await m.get(`/api/partners/list?branchId=${e.value.branchId}`);V.value=l.data},f=async()=>{const{data:l}=await m.get(`/api/items/list?branchId=${e.value.branchId}`);w.value=l.data},B=async l=>{const{data:t}=await m.get(`/api/item-shares/${l}`);e.value=t.data,x(),f()},N=()=>{e.value.partnerId=null,e.value.itemId=null},F=l=>{n.value!==o.Create&&(e.value.itemType=w.value.find(t=>t.id===l).type)},T=async()=>{b.value=!0;try{n.value===o.Create?await U():await j(),a.value={},G.fire()}catch(l){a.value=l.response.data.errors??{}}b.value=!1},U=async()=>{await m.post("/api/item-shares",e.value),A()},j=async()=>{await m.patch(`/api/item-shares/${e.value.id}`,e.value),C()},A=()=>{e.value={branchId:e.value.branchId,partnerId:e.value.partnerId,amount:0},f(),a.value=[]},C=()=>{$("close"),O.back()};return(l,t)=>(p(),D(Q,null,{header:v(()=>[k(i(n.value===u(o).Create?"Create New Item Share":"Edit Item Share"),1)]),body:v(()=>[s("form",{id:"form",onSubmit:z(T,["prevent","stop"]),class:"grid grid-cols-1 gap-4"},[u(y).length>1?(p(),I("div",K,[h(J,{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=r=>e.value.branchId=r),error:a.value.branchId,onSelect:t[1]||(t[1]=r=>{x(),f()}),onChange:N},null,8,["modelValue","error"])])):_("",!0),s("div",X,[h(u(S),{modelValue:e.value.partnerId,"onUpdate:modelValue":t[2]||(t[2]=r=>e.value.partnerId=r),mode:n.value===u(o).Create?"tags":"single",options:V.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:c(["px-0 input peer",{"border-red-500":a.value.hasOwnProperty("partnerId")}])},null,8,["modelValue","mode","options","class"]),s("label",{class:c(["label",{"text-red-500":a.value.hasOwnProperty("partnerId")}])},"Partner",2),a.value.hasOwnProperty("partnerId")?(p(),I("p",Y,i(a.value.partnerId[0]),1)):_("",!0)]),s("div",Z,[h(u(S),{modelValue:e.value.itemId,"onUpdate:modelValue":t[3]||(t[3]=r=>e.value.itemId=r),mode:n.value===u(o).Create?"tags":"single",options:w.value,searchable:!0,object:n.value===u(o).Create,onSelect:F,"value-prop":"id","track-by":"searchableForm",label:"label",class:c(["px-0 input peer",{"border-red-500":a.value.hasOwnProperty("itemId")}])},{option:v(({option:r})=>[s("div",ee,[s("span",null,i(r.label),1),s("span",ae,i(r.type),1)])]),_:1},8,["modelValue","mode","options","object","class"]),s("label",{class:c(["label",{"text-red-500":a.value.hasOwnProperty("itemId")}])},"Item",2),a.value.hasOwnProperty("itemId")?(p(),I("p",te,i(a.value.itemId[0]),1)):_("",!0)]),s("div",se,[h(H,{modelValue:e.value.amount,"onUpdate:modelValue":t[4]||(t[4]=r=>e.value.amount=r),class:c(["input peer",{"border-red-500":a.value.hasOwnProperty("amount")}])},null,8,["modelValue","class"]),s("label",{class:c(["label",{"text-red-500":a.value.hasOwnProperty("amount")}])},"Amount",2),a.value.hasOwnProperty("amount")?(p(),I("p",re,i(a.value.amount[0]),1)):_("",!0)])],32)]),footer:v(()=>[s("button",{class:"me-2 btn-blue",disabled:b.value,form:"form"},[h(L,{"is-loading":b.value},{default:v(()=>[k("Save")]),_:1},8,["is-loading"])],8,le),s("button",{onClick:C,class:"btn-gray"},"Cancel")]),_:1}))}});export{me as default};
