import{d as E,u as M,e as u,x as z,Q as b,o as d,R,w as v,k as T,t as i,g as o,b as t,c as n,a as p,n as m,i as c,h as A,a0 as W,f as Q,_ as Z,a9 as j,m as q,l as G,Z as H}from"./main-6e47ceb6.js";import{s as x}from"./multiselect-27b4da8b.js";import{_ as C}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-1a19a39b.js";import{F as I}from"./formMode-f60a729f.js";import{I as P}from"./itemType-8f96b3f7.js";const J=["onSubmit"],K={class:"grid grid-cols-1 gap-3"},X={key:0,class:"flex flex-wrap"},Y=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),ee={key:0,class:"ml-28 w-full text-red-500 text-sm"},ae={class:"flex flex-wrap"},se=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Price List",-1),te={key:0,class:"ml-28 w-full text-red-500 text-sm"},re={class:"flex flex-wrap"},oe=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Type",-1),le=["value"],de=["value"],ie=["value"],ne={key:0,class:"ml-28 w-full text-red-500 text-sm"},ce={class:"flex flex-wrap"},ue=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Item",-1),pe={class:"truncate"},me={key:0,class:"ml-28 w-full text-red-500 text-sm"},be={class:"flex flex-wrap"},ve=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Price",-1),he={key:0,class:"ml-28 w-full text-red-500 text-sm"},fe={class:"flex flex-wrap"},ye=t("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Discount",-1),_e={key:0,class:"ml-28 w-full text-red-500 text-sm"},Ie=["disabled"],ke=E({__name:"PriceListItemForm",emits:["close"],setup(ge,{emit:O}){const L=q(),S=G(),h=M().user.branches,e=u({discount:0}),f=u([]),g=u(I.Create),y=u(!1),s=u({}),V=u([]);z(()=>{h.length===1&&(e.value.branchId=h[0].id,w()),L.path.endsWith("/edit")&&(g.value=I.Edit,$(L.params.id))});const w=async()=>{const{data:l}=await b.get(`/api/price-lists/list?branchId=${e.value.branchId}`);V.value=l.data},_=async()=>{if(f.value=[],!e.value.itemType||!e.value.priceListId)return;const{data:l}=await b.get(`/api/${e.value.itemType}s/list?branchId=${e.value.branchId}&withPriceListItemsForPriceListId=${e.value.priceListId}`),r=l.data.filter(a=>a.priceListItems.length===0||a.id===e.value.itemId);r.forEach(a=>a.label=a.shortForm??a.name),f.value=r},$=async l=>{const{data:r}=await b.get(`/api/price-list-items/${l}`);e.value=r.data,w(),_()},F=()=>{e.value.priceListId=null,e.value.itemId=null,f.value=[]},B=async()=>{y.value=!0;try{g.value===I.Create?await U():await N(),H.fire()}catch(l){s.value=l.response.data.errors??{}}y.value=!1},U=async()=>{await b.post("/api/price-list-items",e.value),D()},N=async()=>{await b.patch(`/api/price-list-items/${e.value.id}`,e.value),k()},D=()=>{e.value={branchId:e.value.branchId,priceListId:e.value.priceListId,itemType:e.value.itemType,discount:0},_(),s.value=[]},k=()=>{O("close"),S.back()};return(l,r)=>(d(),R(j,null,{header:v(()=>[T(i(g.value===o(I).Create?"Create New Item":"Edit Item"),1)]),body:v(()=>[t("form",{id:"form",onSubmit:Q(B,["prevent","stop"])},[t("div",K,[o(h).length>1?(d(),n("div",X,[Y,p(o(x),{modelValue:e.value.branchId,"onUpdate:modelValue":r[0]||(r[0]=a=>e.value.branchId=a),options:o(h),onSelect:w,onChange:F,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),s.value.hasOwnProperty("branchId")?(d(),n("p",ee,i(s.value.branchId[0]),1)):c("",!0)])):c("",!0),t("div",ae,[se,p(o(x),{modelValue:e.value.priceListId,"onUpdate:modelValue":r[1]||(r[1]=a=>e.value.priceListId=a),onSelect:_,options:V.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.value.hasOwnProperty("priceListId")}])},null,8,["modelValue","options","class"]),s.value.hasOwnProperty("priceListId")?(d(),n("p",te,i(s.value.priceListId[0]),1)):c("",!0)]),t("div",re,[oe,A(t("select",{"onUpdate:modelValue":r[2]||(r[2]=a=>e.value.itemType=a),onChange:r[3]||(r[3]=a=>{_(),e.value.itemId=null}),class:m(["flex-1 px-2 py-1 h-[42px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.value.hasOwnProperty("itemType")}])},[t("option",{value:o(P).Test},"Test",8,le),t("option",{value:o(P).Package},"Package",8,de),t("option",{value:o(P).Service},"Service",8,ie)],34),[[W,e.value.itemType]]),s.value.hasOwnProperty("itemType")?(d(),n("p",ne,i(s.value.itemType[0]),1)):c("",!0)]),t("div",ce,[ue,p(o(x),{modelValue:e.value.itemId,"onUpdate:modelValue":r[4]||(r[4]=a=>e.value.itemId=a),options:f.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"label",class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":s.value.hasOwnProperty("itemId")}])},{option:v(({option:a})=>[t("span",pe,i(a.label),1)]),_:1},8,["modelValue","options","class"]),s.value.hasOwnProperty("itemId")?(d(),n("p",me,i(s.value.itemId[0]),1)):c("",!0)]),t("div",be,[ve,p(C,{modelValue:e.value.price,"onUpdate:modelValue":r[5]||(r[5]=a=>e.value.price=a),size:"1",class:m(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.value.hasOwnProperty("price")}])},null,8,["modelValue","class"]),s.value.hasOwnProperty("price")?(d(),n("p",he,i(s.value.price[0]),1)):c("",!0)]),t("div",fe,[ye,p(C,{modelValue:e.value.discount,"onUpdate:modelValue":r[6]||(r[6]=a=>e.value.discount=a),size:"1",class:m(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":s.value.hasOwnProperty("discount")}])},null,8,["modelValue","class"]),s.value.hasOwnProperty("discount")?(d(),n("p",_e,i(s.value.discount[0]),1)):c("",!0)])])],40,J)]),footer:v(()=>[t("button",{class:"btn-blue mr-2",disabled:y.value,form:"form"},[p(Z,{"is-loading":y.value},{default:v(()=>[T("Save")]),_:1},8,["is-loading"])],8,Ie),t("button",{onClick:k,class:"btn-gray"},"Cancel")]),_:1}))}});export{ke as default};
