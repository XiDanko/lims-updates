import{d as E,u as M,e as u,x as z,A as v,o as d,C as A,w as m,k as T,t as i,g as o,b as s,c,a as p,n as b,i as n,h as R,J,f as W,_ as j,V as q,m as G,l as H,S as K}from"./main-c1f62c61.js";import{s as x}from"./multiselect-ffe70d49.js";import{_ as C}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-0c3f56bb.js";import{F as h}from"./formMode-f60a729f.js";import{I as V}from"./itemType-8f96b3f7.js";const Q=["onSubmit"],X={class:"grid grid-cols-1 gap-3"},Y={key:0,class:"flex flex-wrap"},Z=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),ee={key:0,class:"ml-28 w-full text-red-500 text-sm"},ae={class:"flex flex-wrap"},re=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Price List",-1),se={key:0,class:"ml-28 w-full text-red-500 text-sm"},te={class:"flex flex-wrap"},le=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Type",-1),oe=["value"],de=["value"],ie=["value"],ce={key:0,class:"ml-28 w-full text-red-500 text-sm"},ne={class:"flex flex-wrap"},ue=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Item",-1),pe={class:"truncate"},be={key:0,class:"ml-28 w-full text-red-500 text-sm"},ve={class:"flex flex-wrap"},me=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Price",-1),he={key:0,class:"ml-28 w-full text-red-500 text-sm"},fe={class:"flex flex-wrap"},ye=s("span",{class:"w-28 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Discount",-1),_e={key:0,class:"ml-28 w-full text-red-500 text-sm"},ge=["disabled"],Le=E({__name:"PriceListItemForm",emits:["close"],setup(we,{emit:O}){const P=G(),S=H(),f=M().user.branches,e=u({discount:0}),y=u([]),_=u(h.Create),g=u(!1),r=u({}),k=u([]);z(()=>{f.length===1&&(e.value.branchId=f[0].id,I()),P.path.endsWith("/edit")&&(_.value=h.Edit,$(P.params.id))});const I=async()=>{const{data:l}=await v.get(`/api/price-lists/list?branchId=${e.value.branchId}`);k.value=l.data},w=async()=>{if(_.value===h.Create&&(e.value.priceableId=null),y.value=[],!e.value.priceableType||!e.value.priceListId)return;const{data:l}=await v.get(`/api/${e.value.priceableType}s/list?branchId=${e.value.branchId}&withPriceListItemsForPriceListId=${e.value.priceListId}`);l.data.filter(a=>a.priceListItems.length===0||a.id===e.value.priceableId).forEach(a=>a.label=a.shortForm??a.name),y.value=l.data},$=async l=>{const{data:a}=await v.get(`/api/price-list-items/${l}`);e.value=a.data,I(),w()},F=()=>{e.value.priceListId=null,e.value.priceableId=null,y.value=[]},B=async()=>{g.value=!0;try{_.value===h.Create?await U():await N(),K.fire()}catch(l){r.value=l.response.data.errors??{}}g.value=!1},U=async()=>{await v.post("/api/price-list-items",e.value),D()},N=async()=>{await v.patch(`/api/price-list-items/${e.value.id}`,e.value),L()},D=()=>{e.value={branchId:e.value.branchId,priceListId:e.value.priceListId,priceableType:e.value.priceableType,discount:0},w(),r.value=[]},L=()=>{O("close"),S.back()};return(l,a)=>(d(),A(q,null,{header:m(()=>[T(i(_.value===o(h).Create?"Create New Item":"Edit Item"),1)]),body:m(()=>[s("form",{id:"form",onSubmit:W(B,["prevent","stop"])},[s("div",X,[o(f).length>1?(d(),c("div",Y,[Z,p(o(x),{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.branchId=t),options:o(f),onSelect:I,onChange:F,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:b(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":r.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),r.value.hasOwnProperty("branchId")?(d(),c("p",ee,i(r.value.branchId[0]),1)):n("",!0)])):n("",!0),s("div",ae,[re,p(o(x),{modelValue:e.value.priceListId,"onUpdate:modelValue":a[1]||(a[1]=t=>e.value.priceListId=t),onSelect:w,options:k.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:b(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":r.value.hasOwnProperty("priceListId")}])},null,8,["modelValue","options","class"]),r.value.hasOwnProperty("priceListId")?(d(),c("p",se,i(r.value.priceListId[0]),1)):n("",!0)]),s("div",te,[le,R(s("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.priceableType=t),onChange:w,class:b(["flex-1 px-2 py-1 h-[42px] border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":r.value.hasOwnProperty("priceableType")}])},[s("option",{value:o(V).Test},"Test",8,oe),s("option",{value:o(V).Package},"Package",8,de),s("option",{value:o(V).Service},"Service",8,ie)],34),[[J,e.value.priceableType]]),r.value.hasOwnProperty("priceableType")?(d(),c("p",ce,i(r.value.priceableType[0]),1)):n("",!0)]),s("div",ne,[ue,p(o(x),{modelValue:e.value.priceableId,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.priceableId=t),options:y.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"label",class:b(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":r.value.hasOwnProperty("priceableId")}])},{option:m(({option:t})=>[s("span",pe,i(t.label),1)]),_:1},8,["modelValue","options","class"]),r.value.hasOwnProperty("priceableId")?(d(),c("p",be,i(r.value.priceableId[0]),1)):n("",!0)]),s("div",ve,[me,p(C,{modelValue:e.value.price,"onUpdate:modelValue":a[4]||(a[4]=t=>e.value.price=t),size:"1",class:b(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":r.value.hasOwnProperty("price")}])},null,8,["modelValue","class"]),r.value.hasOwnProperty("price")?(d(),c("p",he,i(r.value.price[0]),1)):n("",!0)]),s("div",fe,[ye,p(C,{modelValue:e.value.discount,"onUpdate:modelValue":a[5]||(a[5]=t=>e.value.discount=t),size:"1",class:b(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":r.value.hasOwnProperty("discount")}])},null,8,["modelValue","class"]),r.value.hasOwnProperty("discount")?(d(),c("p",_e,i(r.value.discount[0]),1)):n("",!0)])])],40,Q)]),footer:m(()=>[s("button",{class:"btn-blue mr-2",disabled:g.value,form:"form"},[p(j,{"is-loading":g.value},{default:m(()=>[T("Save")]),_:1},8,["is-loading"])],8,ge),s("button",{onClick:L,class:"btn-gray"},"Cancel")]),_:1}))}});export{Le as default};
