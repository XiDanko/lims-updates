import{d as R,f as U,e as A,g as u,u as D,x as W,Q as c,Y as z,o as i,R as k,w as b,m as C,t as h,i as d,b as s,c as f,a as y,n as I,k as m,j,v as H,h as L,_ as Q,a5 as Y,a0 as q}from"./main-5548143a.js";import{b as G}from"./toggle-af3738b3.js";import{s as S}from"./multiselect-30de6652.js";import{F as o}from"./formMode-f60a729f.js";import{_ as J}from"./Tinymce.vue_vue_type_script_setup_true_lang-47a6a3c9.js";const K=["onSubmit"],X={key:0,class:"mb-3 flex flex-wrap items-center"},Z=s("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Branch",-1),ee={key:0,class:"ml-24 w-full text-sm text-red-500"},ae={class:"mb-3 flex flex-wrap items-center"},te=s("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Name",-1),se={key:0,class:"ml-24 w-full text-sm text-red-500"},re={class:"mb-3 flex flex-wrap items-center"},le=s("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Parameter",-1),oe={key:0,class:"ml-24 w-full text-sm text-red-500"},ne={class:"flex flex-wrap items-center"},de=["disabled"],be=R({__name:"ResultTemplateForm",emits:["close"],setup(ue,{emit:P}){const w=U(),$=A(),e=u({}),p=D().user.branches,V=u([]),r=u(o.Create),v=u(!1),a=u({}),_=u({});W(()=>{p.length===1&&(e.value.branchId=p[0].id,g()),w.path.endsWith("/edit")&&(r.value=o.Edit),w.path.endsWith("/clone")&&(r.value=o.Clone),r.value!==o.Create&&O(w.params.id)});const O=async n=>{const{data:t}=await c.get(`/api/result-templates/${n}`);e.value=t.data,g()},g=async()=>{T(),_.value=z().data.general?.find(n=>n.branchId===e.value.branchId)},T=async()=>{const{data:n}=await c.get(`/api/parameters/list?branchId=${e.value.branchId}`);V.value=n.data},B=async()=>{v.value=!0;try{r.value===o.Create?await E():r.value===o.Clone?await F():r.value===o.Edit&&await M(),a.value={},q.fire()}catch(n){a.value=n.response.data.errors??{}}v.value=!1},E=async()=>{await c.post("/api/result-templates",e.value),N()},F=async()=>{await c.post("/api/result-templates",e.value),x()},M=async()=>{await c.patch(`/api/result-templates/${e.value.id}`,e.value),x()},N=()=>{e.value={branchId:e.value.branchId,content:""},a.value=[]},x=()=>{P("close"),$.back()};return(n,t)=>(i(),k(Y,{"modal-class":"!w-[56rem]"},{header:b(()=>[C(h(`${r.value.capitalize()} ${r.value===d(o).Create?"New":""} Result Template`),1)]),body:b(()=>[s("form",{id:"form",onSubmit:L(B,["prevent","stop"])},[d(p).length>1?(i(),f("div",X,[Z,y(d(S),{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.branchId=l),onSelect:g,options:d(p),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:I(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("branchId")?(i(),f("p",ee,h(a.value.branchId[0]),1)):m("",!0)])):m("",!0),s("div",ae,[te,j(s("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.name=l),class:I(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("name")}])},null,2),[[H,e.value.name]]),a.value.hasOwnProperty("name")?(i(),f("p",se,h(a.value.name[0]),1)):m("",!0)]),s("div",re,[le,y(d(S),{modelValue:e.value.parameterId,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.parameterId=l),options:V.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm",class:I(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("parameterId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("parameterId")?(i(),f("p",oe,h(a.value.parameterId[0]),1)):m("",!0)]),s("div",ne,[y(J,{modelValue:e.value.content,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.content=l),"limit-width":_.value?.resultEditorMaxWidth,"limit-height":_.value?.resultEditorMaxHeight},null,8,["modelValue","limit-width","limit-height"])])],40,K)]),footer:b(()=>[s("button",{class:"mr-2 btn-blue",disabled:v.value,form:"form"},[y(Q,{"is-loading":v.value},{default:b(()=>[C("Save")]),_:1},8,["is-loading"])],8,de),s("button",{onClick:x,class:"btn-gray"},"Cancel"),r.value===d(o).Edit?(i(),k(d(G),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.isActive=l),class:"toggle:off:red ml-auto"},null,8,["modelValue"])):m("",!0)]),_:1}))}});export{be as default};
