import{d as Y,e as x,x as K,y as q,o as i,c as d,b as e,a as y,h as R,v as T,T as W,a0 as X,g as r,w as $,F as U,s as Z,Q as M,V as G,k as N,f as F,_ as L,i as h,W as j,a3 as ee,Z as P,aa as te,ab as se,n as z,t as _,X as oe,Y as ae,U as re}from"./main-6e47ceb6.js";import{M as le}from"./Master-c2e1e299.js";import{_ as ne}from"./Paginator.vue_vue_type_script_setup_true_lang-161ff6db.js";import{u as ie}from"./urlQueryManager-757a21bf.js";import{i as de}from"./index.es-2384e375.js";import{d as ce}from"./datepickerPresets-82697600.js";import{_ as ue}from"./BarcodeScanner.vue_vue_type_script_setup_true_lang-d25da639.js";import{_ as pe}from"./BranchFilter.vue_vue_type_script_setup_true_lang-d104a2b1.js";import{O as A}from"./orderStatus-e3a3f9a7.js";import{u as fe,P as O,p as Q}from"./websocketPrint-f72594c6.js";import{u as be}from"./ordersBulkSelection-4fe472f7.js";import{A as ye}from"./ActivityLogSidebar-44a5ec42.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./multiselect-27b4da8b.js";const ve={class:"flex gap-2 items-center ml-auto"},me=["onKeyup"],ge=e("option",{value:""},"Select status",-1),he=["value"],_e=["value"],xe=Y({__name:"SamplesAccessionFilter",emits:["change","scan"],setup(E,{emit:w}){const m=new URLSearchParams(location.search),k=x(""),c=x(""),p=x(""),l=x(""),u=x([null,null]);K(()=>f());const B=q(()=>u.value[0]===null||u.value[1]===null?"":`${u.value[0]}~${u.value[1]}`),D=async v=>{V(),p.value=v,C("scan")},f=()=>{k.value=m.get("branchId")??"",p.value=m.get("barcode")??"",c.value=m.get("visitNumber")??"",l.value=m.get("status")??"",m.get("dateRange")&&(u.value=m.get("dateRange").split("~"))},S=()=>{const v=c.value;V(),c.value=v,C()},g=()=>{const v=p.value;V(),p.value=v,C()},C=(v="change")=>{let o=`branchId=${k.value}&barcode=${p.value}&visitNumber=${c.value}&status=${l.value}&dateRange=${B.value}&page=1`;w(v,o)},V=()=>{k.value="",c.value="",p.value="",l.value="",u.value=[null,null]};return(v,o)=>(i(),d(U,null,[e("div",ve,[y(pe,{modelValue:k.value,"onUpdate:modelValue":o[0]||(o[0]=n=>k.value=n),onChange:C},null,8,["modelValue"]),R(e("input",{"onUpdate:modelValue":o[1]||(o[1]=n=>c.value=n),onKeyup:W(S,["enter"]),type:"text",placeholder:"Registration number",class:"w-56 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,me),[[T,c.value]]),R(e("input",{"onUpdate:modelValue":o[2]||(o[2]=n=>p.value=n),onKeyup:o[3]||(o[3]=W(n=>g(),["enter"])),type:"text",placeholder:"Barcode",class:"w-56 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,544),[[T,p.value]]),R(e("select",{"onUpdate:modelValue":o[4]||(o[4]=n=>l.value=n),onChange:o[5]||(o[5]=n=>C()),class:"px-2 h-[38px] border border-gray-300 !rounded"},[ge,e("option",{value:r(A).Collected},"Collected",8,he),e("option",{value:r(A).Accepted},"Rejected",8,_e)],544),[[X,l.value]]),y(r(de),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:r(ce),placeholder:"Select date range",value:u.value,"onUpdate:value":o[6]||(o[6]=n=>u.value=n),onChange:o[7]||(o[7]=n=>C()),class:"!w-56","input-class":"w-full p-1.5 border border-gray-300 rounded focus:border-blue-500"},{"icon-calendar":$(()=>[]),_:1},8,["shortcuts","value"])]),y(ue,{onScan:D})],64))}}),we={class:"flex flex-wrap items-center gap-2 mb-5"},Ce={key:0,class:"flex gap-2 items-start"},ke=["disabled"],Se=["disabled"],$e=["disabled"],Be=["disabled"],Ae={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},Ve={class:"w-full"},Me={class:"sticky top-0 z-10 text-left"},Ne={class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},Ie={class:"flex items-center justify-center"},Le=["checked"],Re=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Name",-1),Ue=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Tests",-1),De=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Department",-1),Fe=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr whitespace-nowrap"},"Sample Type",-1),Te=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Barcode",-1),We=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Status",-1),je=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Notes",-1),Pe=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Date",-1),ze=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Branch",-1),Oe={key:0,class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},Qe={class:"flex items-center justify-center"},Ye=["checked","onChange"],Ke={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},qe={class:"py-1 px-2 border border-gray-200"},Ee={class:"flex flex-wrap items-center gap-1 max-w-[30rem]"},He={class:"rounded px-1 text-xs bg-teal-500 text-white group-hover:bg-white group-hover:text-gray-600"},Je={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},Xe={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},Ze={class:"py-1 px-2 border border-gray-200"},Ge={class:"py-1 px-2 border border-gray-200"},et={class:"py-1 px-2 border border-gray-200"},tt={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},st={class:"py-1 px-2 border border-gray-200"},ot={key:0,class:"py-1 px-2 border border-gray-200 text-center"},at={class:"flex justify-center gap-3"},rt=["onClick"],lt=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"w-5 h-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),nt=[lt],wt=Y({__name:"SamplesAccession",setup(E){const w=x([]),m=x({}),{updateUrlQuery:k}=ie(),{hasPermissionTo:c,hasAnyPermission:p}=re(),l=x(!1),u=x(!1),B=fe(),D=setInterval(()=>g(location.search),15e3),f=be(),S=q(()=>w.value.filter(a=>f.selectedOrdersIds.value.has(a.id)));K(()=>g(location.search)),Z(()=>clearInterval(D));const g=async a=>{const t=await k(a),{data:b}=await M.get(`/api/samples-accession?${t}`);w.value=b.data,m.value=b.meta},C=async a=>{await g(a),f.toggleAll(w.value,!0)},V=async()=>{const{isConfirmed:a}=await ee.fire();a&&(u.value=!0,await M.post("/api/samples/accept",{samples:S.value}),P.fire(),u.value=!1,g(location.search),f.clear())},v=async()=>{const{isConfirmed:a}=await te.fire({title:"Notes",input:"textarea",preConfirm:async t=>{try{await M.post("/api/samples/reject",{samples:S.value,notes:t}),P.fire()}catch(b){se.showValidationMessage(b.response.data.message)}}});a&&(g(location.search),f.clear())},o=async(a,t=!1)=>{l.value=!0;const{data:b}=await M.post("/api/samples/print",{type:a,orders:S.value});B.isConnected&&!t?B.submit({type:O.Barcodes,url:"barcode.pdf",file_content:b}):Q({printable:b,type:"pdf",base64:!0}),l.value=!1},n=async(a=!1)=>{l.value=!0;const{data:t}=await M.post("/api/visits/print-barcode",{visitId:S.value.flatMap(b=>b.visitId)});B.isConnected&&!a?B.submit({type:O.Barcodes,url:"barcode.pdf",file_content:t}):Q({printable:t,type:"pdf",base64:!0}),l.value=!1},H=a=>{if(a===A.Collected)return"border-l-yellow-400";if(a===A.Accepted)return"border-l-orange-500"},J=a=>{if(a===A.Collected)return"hover:bg-yellow-400 hover:text-black";if(a===A.Accepted)return"hover:bg-orange-500 hover:text-white"};return(a,t)=>{const b=G("tip");return i(),d(U,null,[y(le,null,{header:$(()=>[N("Samples Accession")]),body:$(()=>[e("div",we,[r(S).length>0?(i(),d("div",Ce,[r(c)("Visit.printBarcode")?(i(),d("button",{key:0,onClick:t[0]||(t[0]=s=>n(!1)),onContextmenu:t[1]||(t[1]=F(s=>n(!0),["prevent"])),class:"btn-blue",disabled:l.value},[y(L,{"is-loading":l.value},{default:$(()=>[N("Visit Barcode")]),_:1},8,["is-loading"])],40,ke)):h("",!0),r(c)("Sample.print")?(i(),d("button",{key:1,onClick:t[2]||(t[2]=s=>o("sampleWise")),onContextmenu:t[3]||(t[3]=F(s=>o("sampleWise",!0),["prevent"])),class:"btn-blue",disabled:l.value},[y(L,{"is-loading":l.value},{default:$(()=>[N("Barcodes S.W.")]),_:1},8,["is-loading"])],40,Se)):h("",!0),r(c)("Sample.print")?(i(),d("button",{key:2,onClick:t[4]||(t[4]=s=>o("departmentWise")),onContextmenu:t[5]||(t[5]=F(s=>o("departmentWise",!0),["prevent"])),class:"btn-blue",disabled:l.value},[y(L,{"is-loading":l.value},{default:$(()=>[N("Barcodes D.W.")]),_:1},8,["is-loading"])],40,$e)):h("",!0),r(c)("Sample.accept")?(i(),d("button",{key:3,onClick:V,class:"btn-teal",disabled:u.value},[y(L,{"is-loading":u.value},{default:$(()=>[N("Accept")]),_:1},8,["is-loading"])],8,Be)):h("",!0),r(c)("Sample.reject")?(i(),d("button",{key:4,onClick:v,class:"btn-red"},"Reject")):h("",!0),e("button",{onClick:t[6]||(t[6]=s=>r(f).clear()),class:"btn-gray"},"Clear")])):h("",!0),y(xe,{onChange:g,onScan:C})]),e("section",Ae,[e("table",Ve,[e("thead",null,[e("tr",Me,[e("th",Ne,[e("label",Ie,[e("input",{type:"checkbox",checked:r(f).isAllSelected(w.value),onChange:t[7]||(t[7]=s=>r(f).toggleAll(w.value,s.target.checked)),class:"w-4 h-4 rounded checked:accent-blue-500"},null,40,Le)])]),Re,Ue,De,Fe,Te,We,je,Pe,ze,r(p)("ActivityLog.list")?(i(),d("th",Oe)):h("",!0)])]),e("tbody",null,[(i(!0),d(U,null,j(w.value,s=>(i(),d("tr",{class:z(["transition even:bg-gray-100 group",J(s.status)])},[e("td",{class:z(["py-1 px-2 border border-l-[5px] border-gray-200",H(s.status)])},[e("label",Qe,[e("input",{type:"checkbox",checked:r(f).isSelected(s),onChange:I=>r(f).toggle(s,I.target.checked),class:"w-4 h-4 rounded checked:accent-blue-500"},null,40,Ye)])],2),e("td",Ke,_(s.patient.name),1),e("td",qe,[e("div",Ee,[(i(!0),d(U,null,j(s.tests,I=>(i(),d("span",He,_(I.shortForm),1))),256))])]),e("td",Je,_(s.test.department.name),1),e("td",Xe,_(s.test.sampleType.name),1),e("td",Ze,_(s.barcode),1),e("td",Ge,_(s.status.capitalize()),1),e("td",et,_(s.notes),1),e("td",tt,_(s.date),1),e("td",st,_(s.branch.name),1),r(p)("ActivityLog.list")?(i(),d("td",ot,[e("div",at,[r(c)("ActivityLog.list")?R((i(),d("button",{key:0,onClick:I=>r(oe).emit(r(ae).Show,s.id),class:"text-gray-600 group-hover:text-white cursor-pointer"},nt,8,rt)),[[b,"View Activities"]]):h("",!0)])])):h("",!0)],2))),256))])])])]),_:1}),y(ne,{data:m.value,onChange:t[8]||(t[8]=s=>g(`page=${s}`)),class:"mt-3"},null,8,["data"]),y(ye)],64)}}});export{wt as default};
