import{d as D,y as S,g as $,A as W,o as m,c as v,b as e,a as w,i as f,n as V,t as x,k as h,Q as C,T as G,U as te,V as j,j as b,W as B,v as y,X as F,Y as le,f as ne,e as de,u as ie,x as ue,q as pe,R,w as T,m as A,_ as ce,Z as be,$ as me,a0 as L}from"./main-cee2eb24.js";import{M as ve}from"./Master-e24133cb.js";import{s as z}from"./multiselect-97a39018.js";import{b as q}from"./toggle-afba85dd.js";import{P as O}from"./partnerType-65f9f978.js";import{_ as fe}from"./Autocomplete.vue_vue_type_script_setup_true_lang-69df8f9b.js";import{F as U}from"./formMode-f60a729f.js";import{G as E}from"./gender-fe0bd233.js";import{_ as he,u as ge}from"./Invoice.vue_vue_type_script_setup_true_lang-58160e80.js";import{I as Y}from"./invoiceStatus-af715b0d.js";import{_ as ye}from"./VisitPrintToggles.vue_vue_type_script_setup_true_lang-d4a19b28.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./CurrencyInput.vue_vue_type_script_setup_true_lang-8eeeffea.js";import"./itemType-8f96b3f7.js";import"./orderStatus-e3a3f9a7.js";import"./printTemplateManager-b9018cee.js";import"./websocketPrint-f541b6bb.js";const _e={class:"grid grid-cols-3 gap-2"},Ve=e("h1",{class:"col-span-3 text-lg font-bold underline"},"Reference Information",-1),xe={class:"flex flex-wrap items-start"},we=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Center",-1),$e={key:0,class:"w-full text-sm text-red-500"},Ie={class:"flex flex-wrap items-start"},Pe=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Lab",-1),ke={key:0,class:"w-full text-sm text-red-500"},Me={class:"flex flex-wrap items-start"},Ue=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Doctor",-1),Ce={key:0,class:"w-full text-sm text-red-500"},Ne={class:"flex flex-wrap items-start"},Oe=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Home Visit",-1),De={key:0,class:"w-full text-sm text-red-500"},Fe={key:0,class:"flex flex-wrap items-start"},ze=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Collector",-1),Se={key:0,class:"w-full text-sm text-red-500"},He=D({__name:"ReferenceInfo",props:{modelValue:{},errors:{}},emits:["update:modelValue"],setup(P,{emit:_}){const I=P,{hasPermissionTo:r}=G(),o=S({get:()=>I.modelValue,set:i=>_("update:modelValue",i)}),a=$([]),s=$([]),t=()=>{k(),n()},k=async()=>{const{data:i}=await C.get(`/api/partners/list?branchId=${o.value.branchId}`);a.value=i.data},n=async()=>{const{data:i}=await C.get(`/api/users/list?branchId=${o.value.branchId}`);s.value=i.data},d=async(i,l)=>{const{data:u}=await C.post("/api/partners",{branchId:o.value.branchId,name:i,type:l});return a.value.push(u.data),u.data};return W(()=>o.value.branchId,()=>{t()}),(i,l)=>(m(),v("div",_e,[Ve,e("div",xe,[we,w(f(z),{modelValue:o.value.centerId,"onUpdate:modelValue":l[0]||(l[0]=u=>o.value.centerId=u),options:a.value.filter(u=>u.type===f(O).Center),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":f(r)("Partner.createViaSelect"),"on-create":({name:u})=>d(u,f(O).Center),class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":i.errors.hasOwnProperty("centerId")}])},null,8,["modelValue","options","create-option","on-create","class"]),i.errors.hasOwnProperty("centerId")?(m(),v("p",$e,x(i.errors.centerId[0]),1)):h("",!0)]),e("div",Ie,[Pe,w(f(z),{modelValue:o.value.labId,"onUpdate:modelValue":l[1]||(l[1]=u=>o.value.labId=u),options:a.value.filter(u=>u.type===f(O).Lab),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":f(r)("Partner.createViaSelect"),"on-create":({name:u})=>d(u,f(O).Lab),class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":i.errors.hasOwnProperty("labId")}])},null,8,["modelValue","options","create-option","on-create","class"]),i.errors.hasOwnProperty("labId")?(m(),v("p",ke,x(i.errors.labId[0]),1)):h("",!0)]),e("div",Me,[Ue,w(f(z),{modelValue:o.value.doctorId,"onUpdate:modelValue":l[2]||(l[2]=u=>o.value.doctorId=u),options:a.value.filter(u=>u.type===f(O).Doctor),searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":f(r)("Partner.createViaSelect"),"on-create":({name:u})=>d(u,f(O).Doctor),class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":i.errors.hasOwnProperty("doctorId")}])},null,8,["modelValue","options","create-option","on-create","class"]),i.errors.hasOwnProperty("doctorId")?(m(),v("p",Ce,x(i.errors.doctorId[0]),1)):h("",!0)]),e("div",Ne,[Oe,w(f(q),{modelValue:o.value.isHomeVisit,"onUpdate:modelValue":l[3]||(l[3]=u=>o.value.isHomeVisit=u),"on-label":"Yes","off-label":"No",class:V(["flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":i.errors.hasOwnProperty("isHomeVisit")}])},null,8,["modelValue","class"]),i.errors.hasOwnProperty("isHomeVisit")?(m(),v("p",De,x(i.errors.isHomeVisit[0]),1)):h("",!0)]),o.value.isHomeVisit?(m(),v("div",Fe,[ze,w(f(z),{modelValue:o.value.collectorId,"onUpdate:modelValue":l[4]||(l[4]=u=>o.value.collectorId=u),options:s.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name",class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":i.errors.hasOwnProperty("collectorId")}])},null,8,["modelValue","options","class"]),i.errors.hasOwnProperty("collectorId")?(m(),v("p",Se,x(i.errors.collectorId[0]),1)):h("",!0)])):h("",!0)]))}}),Te={class:"grid grid-cols-12 gap-2"},Ye=e("h1",{class:"col-span-12 text-lg font-bold underline"},"Patient Information",-1),Be={class:"col-span-4 flex flex-wrap items-start"},Ee=e("option",{value:"Mr."},"Mr.",-1),Re=e("option",{value:"Ms."},"Ms.",-1),Ae=[Ee,Re],Le={key:0,class:"w-full text-sm text-red-500"},We={key:1,class:"w-full text-sm text-red-500"},Ge={class:"col-span-3 flex flex-wrap items-start"},je=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Gender",-1),qe=e("option",{value:"male"},"Male",-1),Qe=e("option",{value:"female"},"Female",-1),Xe=[qe,Qe],Ze={key:0,class:"w-full text-sm text-red-500"},Je={class:"col-span-5 flex flex-wrap items-start"},Ke=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Year",-1),er=e("span",{class:"border-y border-gray-300 bg-gray-100 p-1"},"Month",-1),rr=e("span",{class:"border-y border-gray-300 bg-gray-100 p-1"},"Day",-1),ar={key:0,class:"w-full text-sm text-red-500"},sr={class:"col-span-4 flex flex-wrap items-start"},or=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Number",-1),tr={key:0,class:"w-full text-sm text-red-500"},lr={class:"col-span-4 flex flex-wrap items-start"},nr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Email",-1),dr={class:"col-span-4 flex flex-wrap items-start"},ir=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Address",-1),ur=D({__name:"PatientInfo",props:{modelValue:{},branchId:{},errors:{},mode:{}},emits:["update:modelValue"],setup(P,{emit:_}){const I=P,r=S({get:()=>I.modelValue,set:n=>_("update:modelValue",n)}),o=$({countryCode:"",nationalForm:""}),a=()=>{r.value.phoneNumber=o.value.countryCode+o.value.nationalForm},s=n=>{n==="Mr."&&(r.value.gender="male"),["Mrs.","Ms.","Miss"].includes(n)&&(r.value.gender="female")},t=n=>{n===E.Male?r.value.initials="Mr.":r.value.initials="Ms."},k=async n=>{r.value=n};return te(()=>{o.value.countryCode=r.value.phoneNumber?.slice(0,4),o.value.nationalForm=r.value.phoneNumber?.slice(4,14)}),(n,d)=>{const i=j("maska");return m(),v("div",Te,[Ye,e("div",Be,[b(e("select",{"onUpdate:modelValue":d[0]||(d[0]=l=>r.value.initials=l),onChange:d[1]||(d[1]=l=>s(l.target.value)),class:V(["rounded-l border border-r-0 border-gray-300 bg-gray-100 px-1 h-[34px]",{"!border border-red-500":n.errors.hasOwnProperty("patient.initials")}])},Ae,34),[[B,r.value.initials]]),w(fe,{disabled:n.mode===f(U).Edit,placeholder:"Patient's Name",size:"1","parent-classes":"flex-1",class:V(["w-full rounded-r border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":n.errors.hasOwnProperty("patient.name")}]),onSelect:k,endpoint:`/api/patients/list?branchId=${I.branchId}&limit=5`,query:"name",label:"name",modelValue:r.value.name,"onUpdate:modelValue":d[2]||(d[2]=l=>r.value.name=l)},null,8,["disabled","class","endpoint","modelValue"]),n.errors.hasOwnProperty("patient.initials")?(m(),v("p",Le,x(n.errors["patient.initials"][0]),1)):h("",!0),n.errors.hasOwnProperty("patient.name")?(m(),v("p",We,x(n.errors["patient.name"][0]),1)):h("",!0)]),e("div",Ge,[je,b(e("select",{"onUpdate:modelValue":d[3]||(d[3]=l=>r.value.gender=l),onChange:d[4]||(d[4]=l=>t(l.target.value)),class:V(["flex-1 rounded-r border border-gray-300 px-1 h-[34px]",{"!border border-red-500":n.errors.hasOwnProperty("patient.initials")}])},Xe,34),[[B,r.value.gender]]),n.errors.hasOwnProperty("patient.gender")?(m(),v("p",Ze,x(n.errors["patient.gender"][0]),1)):h("",!0)]),e("div",Je,[Ke,b(e("input",{"onUpdate:modelValue":d[5]||(d[5]=l=>r.value.birthdateYear=l),"data-maska":"####",size:"1",class:V(["flex-1 border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":n.errors.hasOwnProperty("patient.birthdateYear")}])},null,2),[[y,r.value.birthdateYear],[i]]),er,b(e("input",{"onUpdate:modelValue":d[6]||(d[6]=l=>r.value.birthdateMonth=l),"data-maska":"##",size:"1",class:"flex-1 border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.birthdateMonth],[i]]),rr,b(e("input",{"onUpdate:modelValue":d[7]||(d[7]=l=>r.value.birthdateDay=l),"data-maska":"##",size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.birthdateDay],[i]]),n.errors.hasOwnProperty("patient.birthdateYear")?(m(),v("p",ar,x(n.errors["patient.birthdateYear"][0]),1)):h("",!0)]),e("div",sr,[or,b(e("input",{"onUpdate:modelValue":d[8]||(d[8]=l=>o.value.countryCode=l),"data-maska":"+0","data-maska-tokens":"0:[0-9]:multiple",size:"1",tabindex:"-1",onFocusout:a,class:V(["w-12 border border-r-0 border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":n.errors.hasOwnProperty("patient.phoneNumber")}])},null,34),[[y,o.value.countryCode],[i]]),b(e("input",{"onUpdate:modelValue":d[9]||(d[9]=l=>o.value.nationalForm=l),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",size:"1",onFocusout:a,class:V(["flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":n.errors.hasOwnProperty("patient.phoneNumber")}])},null,34),[[y,o.value.nationalForm],[i]]),n.errors.hasOwnProperty("patient.phoneNumber")?(m(),v("p",tr,x(n.errors["patient.phoneNumber"][0]),1)):h("",!0)]),e("div",lr,[nr,b(e("input",{"onUpdate:modelValue":d[10]||(d[10]=l=>r.value.email=l),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.email]])]),e("div",dr,[ir,b(e("input",{"onUpdate:modelValue":d[11]||(d[11]=l=>r.value.address=l),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.address]])])])}}}),pr={class:"grid grid-cols-12 gap-2"},cr=e("h1",{class:"col-span-12 text-lg font-bold underline"},"Health Information",-1),br={class:"col-span-3 flex flex-wrap items-start"},mr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Weight",-1),vr={class:"col-span-3 flex flex-wrap items-start"},fr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Height",-1),hr={class:"col-span-6 flex flex-wrap items-start"},gr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Symptoms",-1),yr={class:"col-span-6 flex flex-wrap items-start"},_r=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Diseases",-1),Vr={class:"col-span-6 flex flex-wrap items-start"},xr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Therapy",-1),wr={key:0,class:"col-span-4 flex flex-wrap items-start"},$r=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Menses Duration",-1),Ir=e("option",{value:"before"},"Before",-1),Pr=e("option",{value:"during"},"During",-1),kr=e("option",{value:"after"},"After",-1),Mr=[Ir,Pr,kr],Ur={key:0,class:"w-full text-sm text-red-500"},Cr={key:1,class:"col-span-2 flex flex-wrap items-start"},Nr=e("span",{class:"rounded-r border border-l-0 border-gray-300 bg-gray-100 p-1"},"Days",-1),Or={key:0,class:"w-full text-sm text-red-500"},Dr={class:"col-span-2 flex flex-wrap items-start"},Fr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Fasting",-1),zr={key:0,class:"w-full text-sm text-red-500"},Sr={key:2,class:"col-span-2 flex flex-wrap items-start"},Hr=e("span",{class:"rounded-r border border-l-0 border-gray-300 bg-gray-100 p-1"},"Hours",-1),Tr={key:0,class:"w-full text-sm text-red-500"},Yr={class:"col-span-12"},Br=e("p",{class:""},"Notes",-1),Er=D({__name:"HealthInfo",props:{modelValue:{},patient:{},errors:{}},emits:["update:modelValue"],setup(P,{emit:_}){const I=P,r=S({get:()=>I.modelValue,set:o=>_("update:modelValue",o)});return(o,a)=>{const s=j("maska");return m(),v("div",pr,[cr,e("div",br,[mr,b(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>r.value.weight=t),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.weight]])]),e("div",vr,[fr,b(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>r.value.height=t),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.height]])]),e("div",hr,[gr,b(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>r.value.symptoms=t),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.symptoms]])]),e("div",yr,[_r,b(e("input",{"onUpdate:modelValue":a[3]||(a[3]=t=>r.value.diseases=t),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.diseases]])]),e("div",Vr,[xr,b(e("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>r.value.therapy=t),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.therapy]])]),o.patient.gender===f(E).Female?(m(),v("div",wr,[$r,b(e("select",{"onUpdate:modelValue":a[5]||(a[5]=t=>r.value.mensesDuration=t),class:V(["flex-1 rounded-r border border-gray-300 px-1 h-[34px] focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("mensesDuration")}])},Mr,2),[[B,r.value.mensesDuration]]),o.errors.hasOwnProperty("mensesDuration")?(m(),v("p",Ur,x(o.errors.mensesDuration[0]),1)):h("",!0)])):h("",!0),o.patient.gender===f(E).Female?(m(),v("div",Cr,[b(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>r.value.mesnesDays=t),size:"1","data-maska":"##",class:V(["flex-1 rounded-l border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("mensesDays")}])},null,2),[[y,r.value.mesnesDays],[s]]),Nr,o.errors.hasOwnProperty("mensesDays")?(m(),v("p",Or,x(o.errors.mensesDays[0]),1)):h("",!0)])):h("",!0),e("div",Dr,[Fr,w(f(q),{modelValue:r.value.isFasting,"onUpdate:modelValue":a[7]||(a[7]=t=>r.value.isFasting=t),"on-label":"Yes","off-label":"No",class:V(["flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("isFasting")}])},null,8,["modelValue","class"]),o.errors.hasOwnProperty("isFasting")?(m(),v("p",zr,x(o.errors.isFasting[0]),1)):h("",!0)]),r.value.isFasting?(m(),v("div",Sr,[b(e("input",{"onUpdate:modelValue":a[8]||(a[8]=t=>r.value.fastingHours=t),size:"1","data-maska":"##",class:V(["flex-1 rounded-l border border-gray-300 p-1 focus:border-blue-500",{"!border-red-500":o.errors.hasOwnProperty("mensesTo")}])},null,2),[[y,r.value.fastingHours],[s]]),Hr,o.errors.hasOwnProperty("fastingHours")?(m(),v("p",Tr,x(o.errors.fastingHours[0]),1)):h("",!0)])):h("",!0),e("div",Yr,[Br,b(e("textarea",{"onUpdate:modelValue":a[9]||(a[9]=t=>r.value.notes=t),class:"w-full rounded border border-gray-300 p-2 focus:border-blue-500"},null,512),[[y,r.value.notes]])])])}}}),Rr={class:"grid grid-cols-2 gap-2"},Ar=e("h1",{class:"col-span-2 text-lg font-bold underline"},"Other Information",-1),Lr={class:"flex flex-wrap items-start"},Wr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"National ID Number",-1),Gr={class:"flex flex-wrap items-start"},jr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Passport Number",-1),qr={class:"flex flex-wrap items-start"},Qr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Travel Certificate Number",-1),Xr={class:"flex flex-wrap items-start"},Zr=e("span",{class:"rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Lab Card Number",-1),Jr=D({__name:"OtherInfo",props:{modelValue:{}},emits:["update:modelValue"],setup(P,{emit:_}){const I=P,r=S({get:()=>I.modelValue,set:o=>_("update:modelValue",o)});return(o,a)=>(m(),v("div",Rr,[Ar,e("div",Lr,[Wr,b(e("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>r.value.nationalIdNumber=s),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.nationalIdNumber]])]),e("div",Gr,[jr,b(e("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>r.value.passportNumber=s),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.passportNumber]])]),e("div",qr,[Qr,b(e("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>r.value.travelCertificateNumber=s),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.travelCertificateNumber]])]),e("div",Xr,[Zr,b(e("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>r.value.labCardNumber=s),size:"1",class:"flex-1 rounded-r border border-gray-300 p-1 focus:border-blue-500"},null,512),[[y,r.value.labCardNumber]])])]))}}),Kr=e("h1",{class:"col-span-2 text-lg font-bold underline"},"Contact Method",-1),ea={class:"flex items-center"},ra={class:"mr-5 flex items-center"},aa=e("span",{class:"ml-1"},"None",-1),sa={class:"mr-5 flex items-center"},oa=e("span",{class:"ml-1"},"SMS",-1),ta={class:"mr-5 flex items-center"},la=e("span",{class:"ml-1"},"Whatsapp",-1),na={class:"mr-5 flex items-center"},da=e("span",{class:"ml-1"},"Telegram",-1),ia={class:"mr-5 flex items-center"},ua=e("span",{class:"ml-1"},"Viber",-1),pa=D({__name:"ContactMethod",props:{modelValue:{}},emits:["update:modelValue"],setup(P,{emit:_}){const I=P,r=S({get:()=>I.modelValue,set:o=>_("update:modelValue",o)});return(o,a)=>(m(),v("div",null,[Kr,e("div",ea,[e("label",ra,[b(e("input",{type:"radio",value:"none","onUpdate:modelValue":a[0]||(a[0]=s=>r.value.contactMethod=s)},null,512),[[F,r.value.contactMethod]]),aa]),e("label",sa,[b(e("input",{type:"radio",value:"sms","onUpdate:modelValue":a[1]||(a[1]=s=>r.value.contactMethod=s)},null,512),[[F,r.value.contactMethod]]),oa]),e("label",ta,[b(e("input",{type:"radio",value:"whatsapp","onUpdate:modelValue":a[2]||(a[2]=s=>r.value.contactMethod=s)},null,512),[[F,r.value.contactMethod]]),la]),e("label",na,[b(e("input",{type:"radio",value:"telegram","onUpdate:modelValue":a[3]||(a[3]=s=>r.value.contactMethod=s)},null,512),[[F,r.value.contactMethod]]),da]),e("label",ia,[b(e("input",{type:"radio",value:"viber","onUpdate:modelValue":a[4]||(a[4]=s=>r.value.contactMethod=s)},null,512),[[F,r.value.contactMethod]]),ua])])]))}}),ca={class:"h-[calc(100vh-8.6rem)] overflow-y-auto flex flex-col justify-between"},ba={class:"grid grid-cols-2 gap-2"},ma={key:0,class:"mb-2 flex flex-wrap items-center"},va=e("span",{class:"w-20 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-1"},"Branch",-1),fa={key:0,class:"ml-20 w-full text-sm text-red-500"},ha={class:"border-l-2 border-gray-200 pl-2"},ga=e("h1",{class:"text-lg font-bold underline"},"Orders",-1),ya={class:"mt-3 border-t-2 border-gray-200"},_a={class:"mt-3 flex items-center"},Va=["disabled"],Ya=D({__name:"VisitForm",setup(P){const _=le(),I=ne(),r=de(),{hasPermissionTo:o}=G(),a=$(null),s=$({}),t=$({contactMethod:"none"}),k=$({}),n=$({discount:0,extraCharges:0,status:Y.Closed}),d=$([]),i=$({amount:0,notes:""}),l=$({}),u=$({}),H=$(!1),M=$(U.Create),N=ie().user.branches,Q=ge();ue(()=>{N.length===1&&(s.value.branchId=N[0].id,t.value.phoneNumber=_.data.general?.find(c=>c.branchId===N[0].id).patientPhoneNumber,t.value.contactMethod=_.data.general?.find(c=>c.branchId===N[0].id).patientContactMethod),I.path.endsWith("/edit")&&(M.value=U.Edit,Z(I.params.id))});const X=async()=>{const{data:c}=await C.get(`/api/price-lists/eligible?branchId=${s.value.branchId}&centerId=${s.value.centerId??""}&labId=${s.value.labId??""}&doctorId=${s.value.doctorId??""}`);l.value=c.data},Z=async c=>{const{data:p}=await C.get(`/api/visits/${c}`);s.value=p.data,t.value=p.data.patient,k.value=p.data.healthInformation,n.value=p.data.invoice,d.value=p.data.invoice.invoiceItems,i.value.amount=p.data.invoice.paidAmount,t.value.age=Math.floor(pe().diff(t.value.birthdate,"years"))},J=async()=>{if(M.value==="edit"){const{isConfirmed:c}=await be.fire();if(!c)return}if(Q.total(n.value,d.value)<0){me.fire({icon:"error",title:"Invoice can't have negative total."});return}H.value=!0;try{const c=M.value===U.Create?await re():await ae();a.value.print(c),K(c)&&ee(c),M.value===U.Edit&&await r.back()}catch(c){u.value=c.response.data.errors??{}}H.value=!1},K=c=>{const p=_.data.whatsapp?.find(g=>g.branchId===c.branchId);return o("Invoice.send")&&M.value===U.Create&&p?.enabled&&(p?.sendInvoice||p?.sendWelcomeMessage)&&c.patient.contactMethod==="whatsapp"},ee=async c=>{await C.post(`/api/visits/${c.id}/send-welcome-message`)},re=async()=>{const{data:c}=await C.post("/api/visits",{visit:s.value,patient:t.value,healthInformation:k.value,invoice:n.value,invoiceItems:d.value,payment:i.value});return L.fire(),oe(),c.data},ae=async()=>{const{data:c}=await C.patch(`/api/visits/${s.value.id}`,{visit:s.value,patient:t.value,healthInformation:k.value,invoice:n.value,invoiceItems:d.value,payment:i.value});return L.fire(),c.data},se=c=>{t.value.phoneNumber=_.data.general?.find(p=>p.branchId===c).patientPhoneNumber,t.value.contactMethod=_.data.general?.find(p=>p.branchId===c).patientContactMethod,s.value={branchId:c},n.value={discount:0,extraCharges:0,status:Y.Closed},d.value=[]},oe=()=>{const c=_.data.general?.find(p=>p.branchId===s.value.branchId).patientPhoneNumber;t.value={phoneNumber:c,contactMethod:"none"},k.value={isFasting:!1},s.value={branchId:s.value.branchId,labId:s.value.labId},n.value={discount:0,extraCharges:0,status:Y.Closed},d.value=[],u.value={}};return W(()=>[s.value.branchId,s.value.centerId,s.value.labId,s.value.doctorId],()=>{X()},{deep:!0}),(c,p)=>(m(),R(ve,null,{header:T(()=>[A(x(M.value===f(U).Create?"New Visit":"Edit Visit"),1)]),body:T(()=>[e("div",ca,[e("div",ba,[e("div",null,[M.value===f(U).Create&&f(N).length>1?(m(),v("div",ma,[va,w(f(z),{modelValue:s.value.branchId,"onUpdate:modelValue":p[0]||(p[0]=g=>s.value.branchId=g),options:f(N),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,onChange:se,class:V(["min-h-[34px] flex-1 border border-gray-300 !rounded-r",{"!border-red-500":u.value.hasOwnProperty("visit.branchId")}])},null,8,["modelValue","options","class"]),u.value.hasOwnProperty("visit.branchId")?(m(),v("p",fa,x(u.value["visit.branchId"][0]),1)):h("",!0)])):h("",!0),w(ur,{errors:u.value,mode:M.value,modelValue:t.value,"onUpdate:modelValue":p[1]||(p[1]=g=>t.value=g),"branch-id":s.value.branchId},null,8,["errors","mode","modelValue","branch-id"]),w(Er,{errors:u.value,patient:t.value,modelValue:k.value,"onUpdate:modelValue":p[2]||(p[2]=g=>k.value=g),class:"mt-2"},null,8,["errors","patient","modelValue"]),w(He,{errors:u.value,modelValue:s.value,"onUpdate:modelValue":p[3]||(p[3]=g=>s.value=g),class:"mt-2"},null,8,["errors","modelValue"]),w(Jr,{errors:u.value,modelValue:t.value,"onUpdate:modelValue":p[4]||(p[4]=g=>t.value=g),class:"mt-2"},null,8,["errors","modelValue"]),w(pa,{modelValue:t.value,"onUpdate:modelValue":p[5]||(p[5]=g=>t.value=g),class:"mt-2"},null,8,["modelValue"])]),e("div",ha,[ga,s.value.branchId?(m(),R(he,{key:0,"price-list":l.value,"branch-id":s.value.branchId,invoice:n.value,"onUpdate:invoice":p[6]||(p[6]=g=>n.value=g),invoiceItems:d.value,"onUpdate:invoiceItems":p[7]||(p[7]=g=>d.value=g),payment:i.value,"onUpdate:payment":p[8]||(p[8]=g=>i.value=g),errors:u.value,mode:M.value},null,8,["price-list","branch-id","invoice","invoiceItems","payment","errors","mode"])):h("",!0)])]),e("footer",ya,[e("div",_a,[e("button",{class:"mr-auto btn-blue",disabled:H.value,onClick:J},[w(ce,{"is-loading":H.value},{default:T(()=>[A("Save")]),_:1},8,["is-loading"])],8,Va),w(ye,{"branch-id":s.value.branchId,ref_key:"printToggles",ref:a},null,8,["branch-id"])])])])]),_:1}))}});export{Ya as default};
