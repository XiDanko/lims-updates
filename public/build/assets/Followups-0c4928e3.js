import{d as Z,e as h,x as ee,y as se,A as E,o,c as a,b as e,a as k,h as g,v as K,z as Y,g as r,C as F,i as w,J as O,w as L,F as M,H as te,r as Q,B as ae,k as T,D as U,t as l,n as q,E as W,G as re,L as ne,M as le,Y as de}from"./main-c1f62c61.js";import{M as ce}from"./Master-77a73046.js";import{_ as ie}from"./Paginator.vue_vue_type_script_setup_true_lang-ba67665d.js";import{u as ue}from"./urlQueryManager-3fafa3c6.js";import{i as pe}from"./index.es-2fd2791b.js";import{d as he}from"./datepickerPresets-7a436e47.js";import{s as G}from"./multiselect-ffe70d49.js";import{_ as be}from"./BarcodeScanner.vue_vue_type_script_setup_true_lang-03633394.js";import{_ as ge}from"./BranchFilter.vue_vue_type_script_setup_true_lang-16fdce62.js";import{P as N}from"./patientCallStatus-cce91589.js";import{O as J}from"./orderStatus-e3a3f9a7.js";import{_ as _e,R as X}from"./ResultsReleaseModal.vue_vue_type_script_setup_true_lang-24898842.js";import{A as me}from"./ActivityLogSidebar-b98cd311.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./websocketPrint-85d5f8b4.js";import"./printTemplateManager-4195074d.js";var V=(P=>(P.Pending="pending",P.Sent="sent",P.Failed="failed",P))(V||{});const ye={class:"flex flex-wrap gap-2 items-center ml-auto"},fe=["onKeyup"],ve=["onKeyup"],we=e("option",{value:""},"Message status",-1),xe=["value"],ke=["value"],Ce=["value"],Se=e("option",{value:""},"Call status",-1),$e=["value"],Re=["value"],Be=["value"],Me=Z({__name:"FollowupsFilter",emits:["change"],setup(P,{emit:A}){const d=new URLSearchParams(location.search),{hasPermissionTo:$}=te(),x=h(""),i=h(""),_=h(""),m=h([null,null]),y=h(""),R=h(""),B=h(""),C=h(""),z=h([]),I=h([]);ee(()=>{n(),j()});const j=()=>{f(),t()},H=se(()=>m.value[0]===null||m.value[1]===null?"":`${m.value[0]}~${m.value[1]}`),t=async()=>{if(!$("ReferenceDoctor.list"))return;const{data:u}=await E.get(`/api/reference-doctors/list?branchId=${x.value}`);z.value=u.data},f=async()=>{if(!$("Lab.list"))return;const{data:u}=await E.get(`/api/labs/list?branchId=${x.value}`);I.value=u.data},S=u=>{y.value=u??"",c()},D=u=>{R.value=u??"",c()},v=u=>{_.value=u,c()},n=()=>{x.value=d.get("branchId")??"",i.value=d.get("q")??"",_.value=d.get("visitNumber")??"",d.get("dateRange")&&(m.value=d.get("dateRange").split("~")),y.value=d.get("labId")??"",R.value=d.get("referenceDoctorId")??"",B.value=d.get("callStatus")??"",C.value=d.get("messageStatus")??""},s=()=>{const u=_.value;oe(),_.value=u,c()},c=()=>{let u=`branchId=${x.value}&visitNumber=${_.value}&q=${i.value}&referenceDoctorId=${R.value}&labId=${y.value}&messageStatus=${C.value}&callStatus=${B.value}&dateRange=${H.value}&page=1`;A("change",u)},oe=()=>{x.value="",i.value="",_.value="",m.value=[null,null],y.value="",R.value="",B.value="",C.value=""};return(u,p)=>(o(),a(M,null,[e("div",ye,[k(ge,{modelValue:x.value,"onUpdate:modelValue":p[0]||(p[0]=b=>x.value=b),onChange:p[1]||(p[1]=b=>{c(),j()})},null,8,["modelValue"]),g(e("input",{"onUpdate:modelValue":p[2]||(p[2]=b=>_.value=b),onKeyup:Y(s,["enter"]),type:"text",placeholder:"Registration number",class:"w-40 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,fe),[[K,_.value]]),g(e("input",{"onUpdate:modelValue":p[3]||(p[3]=b=>i.value=b),onKeyup:Y(c,["enter"]),type:"text",placeholder:"Name or phone number",class:"w-48 p-1.5 border border-gray-300 rounded focus:border-blue-500"},null,40,ve),[[K,i.value]]),r($)("ReferenceDoctor.list")?(o(),F(r(G),{key:0,"model-value":R.value,options:z.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,placeholder:"Select reference doctor",onChange:D,class:"w-56 min-h-[38px] border border-gray-300 !rounded"},null,8,["model-value","options"])):w("",!0),r($)("Lab.list")?(o(),F(r(G),{key:1,"model-value":y.value,options:I.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,placeholder:"Select lab",onChange:S,class:"w-48 min-h-[38px] border border-gray-300 !rounded"},null,8,["model-value","options"])):w("",!0),g(e("select",{"onUpdate:modelValue":p[4]||(p[4]=b=>C.value=b),onChange:c,class:"px-2 h-[38px] border border-gray-300 !rounded"},[we,e("option",{value:r(V).Pending},"Pending",8,xe),e("option",{value:r(V).Sent},"Sent",8,ke),e("option",{value:r(V).Failed},"Failed",8,Ce)],544),[[O,C.value]]),g(e("select",{"onUpdate:modelValue":p[5]||(p[5]=b=>B.value=b),onChange:c,class:"px-2 h-[38px] border border-gray-300 !rounded"},[Se,e("option",{value:r(N).Pending},"Pending",8,$e),e("option",{value:r(N).Answered},"Answered",8,Re),e("option",{value:r(N).NoAnswer},"No Answer",8,Be)],544),[[O,B.value]]),k(r(pe),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:r(he),placeholder:"Select date range",value:m.value,"onUpdate:value":p[6]||(p[6]=b=>m.value=b),onChange:c,class:"!w-56 mr-2","input-class":"w-full p-1.5 border border-gray-300 rounded focus:border-blue-500"},{"icon-calendar":L(()=>[]),_:1},8,["shortcuts","value"])]),k(be,{onScan:v})],64))}}),Ve={class:"flex items-center mb-5"},Pe={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},Le={class:"w-full"},Ne={class:"sticky top-0 z-10 text-left"},De=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},null,-1),Fe=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr whitespace-nowrap"},"Phone Number",-1),Ae=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Names",-1),ze=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Visits",-1),Ie=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr text-center"},"Status",-1),je=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Notes",-1),Ue=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Date",-1),He=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr whitespace-nowrap"},"Previous Followup",-1),Te=e("th",{class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},"Branch",-1),qe={key:0,class:"p-2 bg-gray-600 text-white font-semibold first-of-type:rounded-tl last-of-type:rounded-tr"},Ee={class:"transition hover:bg-gray-100"},Ke=["onClick"],Ye={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-6 h-6 mx-auto"},Oe=e("path",{"fill-rule":"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z","clip-rule":"evenodd"},null,-1),Qe=[Oe],We={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",class:"w-6 h-6 mx-auto"},Ge=e("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z","clip-rule":"evenodd"},null,-1),Je=[Ge],Xe={class:"py-1 px-2 border border-gray-200"},Ze={class:"py-1 px-2 border border-gray-200"},et={class:"flex flex-wrap items-center gap-1"},tt={class:"p-1 bg-teal-500 text-xs text-white font-bold rounded"},ot={class:"py-1 px-2 border border-gray-200 text-center"},st={class:"py-1 px-2 border border-gray-200 text-center"},at={class:"py-1 px-2 border border-gray-200 max-w-[10rem] text-sm"},rt={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},nt={class:"py-1 px-2 border border-gray-200 whitespace-nowrap"},lt={class:"py-1 px-2 border border-gray-200"},dt={class:"py-1 px-2 border border-gray-200 text-center"},ct={key:0,class:"flex justify-center gap-3"},it={class:"w-6 h-6 text-blue-500 cursor-pointer",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},ut=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"},null,-1),pt=[ut],ht=["onClick"],bt=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"w-5 h-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),gt=[bt],_t={key:0},mt={colspan:"100%",class:"border border-gray-200 p-2"},yt={class:"w-full"},ft=e("thead",null,[e("tr",{class:"sticky top-[39px] z-10 text-left"},[e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"No."),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"name"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Gender"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Age"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Phone Number"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold whitespace-nowrap"},"Contact Method"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Lab"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold whitespace-nowrap"},"Due Balance"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold whitespace-nowrap"},"Message Status"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"},"Date"),e("th",{class:"p-2 bg-gray-200 border border-gray-200 font-semibold"})])],-1),vt={class:"transition hover:bg-gray-50"},wt={class:"p-1 border border-gray-200"},xt={class:"p-1 border border-gray-200 whitespace-nowrap"},kt={class:"p-1 border border-gray-200"},Ct={class:"p-1 border border-gray-200 whitespace-nowrap"},St={class:"p-1 border border-gray-200"},$t={class:"p-1 border border-gray-200 whitespace-nowrap"},Rt={class:"p-1 border border-gray-200 whitespace-nowrap"},Bt={key:1},Mt={class:"p-1 border border-gray-200"},Vt={class:"flex flex-wrap items-center gap-1 max-w-[15rem]"},Pt={class:"p-1 border border-gray-200 whitespace-nowrap"},Lt={class:"p-1 border border-gray-200 text-center"},Nt={class:"flex justify-center gap-1"},Dt={class:"w-6 h-6 text-blue-500 cursor-pointer",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Ft=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"},null,-1),At=[Ft],zt=["onClick"],It=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"},null,-1),jt=[It],Ut=["onClick"],Ht=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1),Tt=[Ht],qt=["href"],Et={class:"w-6 h-6 text-blue-500 cursor-pointer",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Kt=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1),Yt=[Kt],io=Z({__name:"Followups",setup(P){const A=h([]),d=h(new Set),$=h({}),{updateUrlQuery:x}=ue(),{hasPermissionTo:i,hasAnyPermission:_}=te();ee(()=>y(location.search));const m=t=>ne().data.whatsapp?.find(f=>f.branchId===t),y=async t=>{const f=await x(t),{data:S}=await E.get(`/api/followups?${f}`);A.value=S.data,$.value=S.meta},R=t=>!(!i("Result.print")||t.invoice.dueBalance>0&&!i("Result.printDue")),B=t=>!(t.patient.contactMethod!=="whatsapp"||!i("Result.send")||t.invoice.dueBalance>0&&!i("Result.sendDue")),C=async(t,f)=>{if(t.invoice.dueBalance>0){const{isConfirmed:S}=await le.fire({html:`Patient has due balance of ${t.invoice.dueBalance.toLocaleString()}`});if(!S)return}W.emit(de.Show,{visit:t,orders:t.orders,releaseType:f})},z=t=>`https://api.whatsapp.com/send?phone=${t.patient.phoneNumber.replace("+","")}&text=${m(t.branchId)?.welcomeMessage??""}`,I=t=>{if(t.status===J.Rejected)return"bg-orange-500 text-white";if(t.test.bypass&&!t.selectedResult)return"bg-blue-500 text-white";if(t.selectedResult.messageStatus===V.Sent)return"bg-emerald-500 text-white";if(t.selectedResult.messageStatus===V.Pending)return"bg-gray-300 text-black";if(t.selectedResult.messageStatus===V.Failed)return"bg-red-500 text-white"},j=t=>t.status===J.Rejected?"rejected":t.test.bypass&&!t.selectedResult?"bypass":t.selectedResult.messageStatus,H=t=>{if(t===N.Pending)return"bg-gray-300 text-black";if(t===N.Answered)return"bg-emerald-500 text-white";if(t===N.NoAnswer)return"bg-red-500 text-white"};return(t,f)=>{const S=Q("router-view"),D=Q("router-link"),v=ae("tip");return o(),a(M,null,[k(S,{onClose:y}),k(ce,null,{header:L(()=>[T("Patients Followup")]),body:L(()=>[e("div",Ve,[k(Me,{onChange:y})]),e("section",Pe,[e("table",Le,[e("thead",null,[e("tr",Ne,[De,Fe,Ae,ze,Ie,je,Ue,He,Te,r(_)("Followup.update","ActivityLog.list")?(o(),a("th",qe)):w("",!0)])]),(o(!0),a(M,null,U(A.value,n=>(o(),a("tbody",null,[e("tr",Ee,[e("td",{class:"py-1 w-12 border border-gray-200 cursor-pointer",onClick:s=>d.value.has(n.id)?d.value.delete(n.id):d.value.add(n.id)},[d.value.has(n.id)?(o(),a("svg",We,Je)):(o(),a("svg",Ye,Qe))],8,Ke),e("td",Xe,l(n.phoneNumber),1),e("td",Ze,[e("div",et,[(o(!0),a(M,null,U(n.patients,s=>(o(),a("span",tt,l(s.name),1))),256))])]),e("td",ot,l(n.visits.length),1),e("td",st,[e("span",{class:q(["px-1 rounded text-xs whitespace-nowrap",H(n.callStatus)])},l(n.callStatus.startCase()),3)]),e("td",at,l(n.callNotes),1),e("td",rt,l(n.date),1),e("td",nt,l(n.previousDate),1),e("td",lt,l(n.branch.name),1),e("td",dt,[r(_)("Followup.update","ActivityLog.list")?(o(),a("div",ct,[r(i)("Followup.update")?(o(),F(D,{key:0,to:`/followups/${n.id}`},{default:L(()=>[g((o(),a("svg",it,pt)),[[v,"Call"]])]),_:2},1032,["to"])):w("",!0),r(i)("ActivityLog.list")?g((o(),a("button",{key:1,onClick:s=>r(W).emit(r(re).Show,n.id),class:"text-gray-600 cursor-pointer"},gt,8,ht)),[[v,"View Activities"]]):w("",!0)])):w("",!0)])]),d.value.has(n.id)?(o(),a("tr",_t,[e("td",mt,[e("table",yt,[ft,e("tbody",null,[(o(!0),a(M,null,U(n.visits,s=>(o(),a("tr",vt,[e("td",wt,l(s.number),1),e("td",xt,l(s.patient.name),1),e("td",kt,l(s.patient.gender.capitalize()),1),e("td",Ct,l(s.patient.age),1),e("td",St,l(s.patient.phoneNumber),1),e("td",$t,l(s.patient.contactMethod),1),e("td",Rt,l(s.lab?.name??"local"),1),e("td",{class:q(["p-1 border border-gray-200",{"font-semibold text-red-500":s.invoice.dueBalance>0}])},[r(i)("Transaction.create")&&s.invoice.dueBalance>0?g((o(),F(D,{key:0,class:"underline",to:`/invoices/${s.invoice.id}/transactions/payment/create`},{default:L(()=>[T(l(s.invoice.dueBalance.toLocaleString()),1)]),_:2},1032,["to"])),[[v,"Create Payment"]]):(o(),a("span",Bt,l(s.invoice.dueBalance.toLocaleString()),1))],2),e("td",Mt,[e("div",Vt,[(o(!0),a(M,null,U(s.orders,c=>g((o(),a("span",{class:q(["px-1 rounded text-xs cursor-pointer",I(c)])},[T(l(c.test.shortForm),1)],2)),[[v,j(c).capitalize()]])),256))])]),e("td",Pt,l(s.date),1),e("td",Lt,[e("div",Nt,[r(i)("ResultEntry.show")?(o(),F(D,{key:0,to:`/results-entry?visitId=${s.id}`},{default:L(()=>[g((o(),a("svg",Dt,At)),[[v,"View Results"]])]),_:2},1032,["to"])):w("",!0),R(s)?g((o(),a("svg",{key:1,class:"w-6 h-6 text-blue-500 cursor-pointer",onClick:c=>C(s,r(X).Print),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},jt,8,zt)),[[v,"Print"]]):w("",!0),B(s)?(o(),a(M,{key:2},[m(s.branchId)?.enabled?g((o(),a("svg",{key:0,class:"w-6 h-6 text-blue-500 cursor-pointer",onClick:c=>C(s,r(X).Send),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},Tt,8,Ut)),[[v,"Send"]]):(o(),a("a",{key:1,href:z(s),target:"_blank"},[g((o(),a("svg",Et,Yt)),[[v,"Send"]])],8,qt))],64)):w("",!0)])])]))),256))])])])])):w("",!0)]))),256))])])]),_:1}),k(ie,{data:$.value,onChange:f[0]||(f[0]=n=>y(`page=${n}`)),class:"mt-3"},null,8,["data"]),k(_e,{onClose:y}),k(me)],64)}}});export{io as default};
