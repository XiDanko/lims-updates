import{u as x}from"./printTemplateManager-7d6de79b.js";import{d as U,ah as N,g as A,A as $,o as l,c as d,i as o,b as p,t as u,a as m,k as b,Q as y,p as f,T as z}from"./main-5548143a.js";import{u as E,P as B,p as I}from"./websocketPrint-65a486cc.js";import{b as g}from"./toggle-af3738b3.js";const J={class:"flex items-center gap-2"},L={key:0,class:"inline-flex items-center"},M={class:"rtl:rounded-r ltr:rounded-l border ltr:border-r-0 rtl:border-l-0 border-gray-300 bg-gray-100 p-1.5"},O={key:1,class:"inline-flex items-center"},Q={class:"rtl:rounded-r ltr:rounded-l border ltr:border-r-0 rtl:border-l-0 border-gray-300 bg-gray-100 p-1.5"},j={key:2,class:"inline-flex items-center"},q={class:"rtl:rounded-r ltr:rounded-l border ltr:border-r-0 rtl:border-l-0 border-gray-300 bg-gray-100 p-1.5"},F={key:3,class:"inline-flex items-center"},G={class:"rtl:rounded-r ltr:rounded-l border ltr:border-r-0 rtl:border-l-0 border-gray-300 bg-gray-100 p-1.5"},Y=U({__name:"VisitPrintToggles",props:{branchId:{}},setup(P,{expose:w}){const c=P,n=E(),{hasPermissionTo:i}=z(),{hasDefaultDepWiseBarcodeTemplate:V,hasDefaultSampleWiseBarcodeTemplate:W,hasDefaultInvoiceTemplate:S,hasDefaultVisitBarcodeTemplate:_}=x(),e=N({visitBarcode:localStorage.getItem("autoPrintVisitBarcode")==="yes",sampleWiseBarcodes:localStorage.getItem("autoPrintSampleWiseBarcodes")==="yes",departmentWiseBarcodes:localStorage.getItem("autoPrintDepartmentWiseBarcodes")==="yes",invoice:localStorage.getItem("autoPrintInvoice")==="yes"}),s=A(!1),h=()=>{localStorage.setItem("autoPrintVisitBarcode",e.visitBarcode?"yes":"no"),localStorage.setItem("autoPrintSampleWiseBarcodes",e.sampleWiseBarcodes?"yes":"no"),localStorage.setItem("autoPrintDepartmentWiseBarcodes",e.departmentWiseBarcodes?"yes":"no"),localStorage.setItem("autoPrintInvoice",e.invoice?"yes":"no")},T=async a=>{i("Visit.printBarcode")&&e.visitBarcode&&await C(a),i("Sample.print")&&(e.sampleWiseBarcodes||e.departmentWiseBarcodes)&&await D(a),i("Invoice.print")&&e.invoice&&await k(a)},D=async a=>{const t=e.departmentWiseBarcodes?"departmentWise":"sampleTypeWise",{data:r}=await y.post("/api/samples/print",{type:t,visitId:a.id});if(n.isConnected)n.submit({type:B.Barcodes,url:"barcode.pdf",file_content:r}),await new Promise(v=>setTimeout(v,2e3));else{for(;s.value;)await new Promise(v=>setTimeout(v,500));s.value=!0,I({printable:r,type:"pdf",base64:!0,onPrintDialogClose:()=>s.value=!1})}},C=async a=>{const{data:t}=await y.post("/api/visits/print-barcode",{visitId:a.id});if(n.isConnected)n.submit({type:B.Barcodes,url:"barcode.pdf",file_content:t}),await new Promise(r=>setTimeout(r,2e3));else{for(;s.value;)await new Promise(r=>setTimeout(r,500));s.value=!0,I({printable:t,type:"pdf",base64:!0,onPrintDialogClose:()=>s.value=!1})}},k=async a=>{const{data:t}=await y.post("/api/invoices/print",{invoiceId:a.invoice.id});if(n.isConnected)n.submit({type:B.Invoices,url:"invoice.pdf",file_content:t}),await new Promise(r=>setTimeout(r,2e3));else{for(;s.value;)await new Promise(r=>setTimeout(r,500));s.value=!0,I({printable:t,type:"pdf",base64:!0,onPrintDialogClose:()=>s.value=!1})}};return $(()=>e,()=>{h()},{deep:!0}),w({print:T}),(a,t)=>(l(),d("div",J,[o(i)("Visit.printBarcode")&&o(_)(c.branchId)?(l(),d("div",L,[p("span",M,u(o(f)("Visit barcode")),1),m(o(g),{modelValue:e.visitBarcode,"onUpdate:modelValue":t[0]||(t[0]=r=>e.visitBarcode=r),class:"ltr:rounded-r rtl:rounded-l border border-gray-300 p-1.5 focus:border-blue-500"},null,8,["modelValue"])])):b("",!0),o(i)("Sample.print")&&o(W)(c.branchId)?(l(),d("div",O,[p("span",Q,u(o(f)("Sample wise")),1),m(o(g),{modelValue:e.sampleWiseBarcodes,"onUpdate:modelValue":t[1]||(t[1]=r=>e.sampleWiseBarcodes=r),onChange:t[2]||(t[2]=r=>e.departmentWiseBarcodes=!1),class:"ltr:rounded-r rtl:rounded-l border border-gray-300 p-1.5 focus:border-blue-500"},null,8,["modelValue"])])):b("",!0),o(i)("Sample.print")&&o(V)(c.branchId)?(l(),d("div",j,[p("span",q,u(o(f)("Department Wise")),1),m(o(g),{modelValue:e.departmentWiseBarcodes,"onUpdate:modelValue":t[3]||(t[3]=r=>e.departmentWiseBarcodes=r),onChange:t[4]||(t[4]=r=>e.sampleWiseBarcodes=!1),class:"ltr:rounded-r rtl:rounded-l border border-gray-300 p-1.5 focus:border-blue-500"},null,8,["modelValue"])])):b("",!0),o(i)("Invoice.print")&&o(S)(c.branchId)?(l(),d("div",F,[p("span",G,u(o(f)("Invoice")),1),m(o(g),{modelValue:e.invoice,"onUpdate:modelValue":t[5]||(t[5]=r=>e.invoice=r),class:"ltr:rounded-r rtl:rounded-l border border-gray-300 p-1.5 focus:border-blue-500"},null,8,["modelValue"])])):b("",!0)]))}});export{Y as _};
