import{d as z,u as L,e as d,x as Q,Q as u,o as i,R as W,w as I,k as C,t as m,g as n,b as s,c as v,a as c,i as h,n as r,h as j,v as G,f as H,_ as J,a4 as K,m as X,l as Y,$ as Z}from"./main-DmoZ1fz4.js";import{s as V}from"./multiselect-DAhRltj6.js";import{b as F}from"./toggle-DyRQkDOQ.js";import{F as f}from"./formMode-Bz--3d4P.js";import{_ as ee}from"./BranchSelect.vue_vue_type_script_setup_true_lang-D_pdW9WT.js";const ae={key:0,class:"relative col-span-2"},te={class:"relative"},se={key:0,class:"text-sm text-red-500"},le={class:"relative"},oe={key:0,class:"text-sm text-red-500"},re={class:"relative"},de={key:0,class:"text-sm text-red-500"},ne={class:"relative"},ce={key:0,class:"text-sm text-red-500"},ue={class:"relative"},ie=s("label",{class:"label"},"Send",-1),pe={class:"relative"},me=s("label",{class:"label"},"Receive",-1),ve=["disabled"],we=z({__name:"MapcodeForm",emits:["close"],setup(he,{emit:M}){const $=M,p=X(),S=Y(),y=L().user.branches,e=d({send:!0,receive:!0}),x=d([]),g=d([]),k=d([]),_=d(f.Create),b=d(!1),a=d({});Q(()=>{U(),y.length===1&&(e.value.branchId=y[0].id,w()),p.path.endsWith("/edit")&&(_.value=f.Edit,N(p.params.id))});const U=()=>{e.value.branchId=p.query.branchId,e.value.machineId=p.query.machineId,e.value.code=p.query.code},w=()=>{T(),D()},B=()=>{e.value.machineId=null,e.value.testId=null,e.value.parameterId=null},N=async o=>{const{data:t}=await u.get(`/api/mapcodes/${o}`);e.value=t.data,w(),P(t.data.testId)},T=async()=>{const{data:o}=await u.get(`/api/machines/list?branchId=${e.value.branchId}`);x.value=o.data},D=async()=>{const{data:o}=await u.get(`/api/tests/list?branchId=${e.value.branchId}`);g.value=o.data},P=async o=>{const{data:t}=await u.get(`/api/parameters/list?testId=${o}`);k.value=t.data},R=async()=>{b.value=!0;try{_.value===f.Create?await q():await E(),a.value={},Z.fire()}catch(o){a.value=o.response.data.errors??{}}b.value=!1},q=async()=>{await u.post("/api/mapcodes",e.value),A()},E=async()=>{await u.patch(`/api/mapcodes/${e.value.id}`,e.value),O()},A=()=>{e.value={branchId:e.value.branchId,machineId:e.value.machineId,testId:e.value.testId,send:!0,receive:!0},a.value=[]},O=()=>{$("close"),S.back()};return(o,t)=>(i(),W(K,null,{header:I(()=>[C(m(_.value===n(f).Create?"Create New Mapcode":"Edit Mapcode"),1)]),body:I(()=>[s("form",{id:"form",onSubmit:H(R,["prevent","stop"]),class:"grid grid-cols-2 gap-4"},[n(y).length>1?(i(),v("div",ae,[c(ee,{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.branchId=l),error:a.value.branchId,onSelect:w,onChange:B},null,8,["modelValue","error"])])):h("",!0),s("div",te,[c(n(V),{modelValue:e.value.machineId,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.machineId=l),options:x.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-clear":!1,"can-deselect":!1,class:r(["input peer",{"border-red-500":a.value.hasOwnProperty("machineId")}])},null,8,["modelValue","options","class"]),s("label",{class:r(["label",{"text-red-500":a.value.hasOwnProperty("machineId")}])},"Machine",2),a.value.hasOwnProperty("machineId")?(i(),v("p",se,m(a.value.machineId[0]),1)):h("",!0)]),s("div",le,[c(n(V),{modelValue:e.value.testId,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.testId=l),options:g.value,onSelect:P,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm","can-clear":!1,"can-deselect":!1,class:r(["input peer",{"border-red-500":a.value.hasOwnProperty("testId")}])},null,8,["modelValue","options","class"]),s("label",{class:r(["label",{"text-red-500":a.value.hasOwnProperty("testId")}])},"Test",2),a.value.hasOwnProperty("testId")?(i(),v("p",oe,m(a.value.testId[0]),1)):h("",!0)]),s("div",re,[c(n(V),{modelValue:e.value.parameterId,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.parameterId=l),options:k.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm",class:r(["input peer",{"border-red-500":a.value.hasOwnProperty("parameterId")}])},null,8,["modelValue","options","class"]),s("label",{class:r(["label",{"text-red-500":a.value.hasOwnProperty("parameterId")}])},"Parameter",2),a.value.hasOwnProperty("parameterId")?(i(),v("p",de,m(a.value.parameterId[0]),1)):h("",!0)]),s("div",ne,[j(s("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.code=l),class:r(["input peer",{"border-red-500":a.value.hasOwnProperty("code")}])},null,2),[[G,e.value.code]]),s("label",{class:r(["label",{"text-red-500":a.value.hasOwnProperty("code")}])},"Code",2),a.value.hasOwnProperty("code")?(i(),v("p",ce,m(a.value.code[0]),1)):h("",!0)]),s("div",ue,[c(n(F),{modelValue:e.value.send,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.send=l),class:"input peer pt-2.5"},null,8,["modelValue"]),ie]),s("div",pe,[c(n(F),{modelValue:e.value.receive,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.receive=l),class:"input peer pt-2.5"},null,8,["modelValue"]),me])],32)]),footer:I(()=>[s("button",{class:"me-2 btn-blue",disabled:b.value,form:"form"},[c(J,{"is-loading":b.value},{default:I(()=>[C("Save")]),_:1},8,["is-loading"])],8,ve),s("button",{onClick:O,class:"btn-gray"},"Cancel")]),_:1}))}});export{we as default};
