import{d as O,f as F,e as M,g as i,u as D,x as E,Q as p,o as l,R as x,w as v,m as g,t as b,i as f,b as s,c as h,a as k,n as C,k as d,j as U,v as z,h as W,_ as j,a5 as A,a0 as L}from"./main-bf2af1c2.js";import{u as Q,_ as q}from"./permissionsTree-2377db7a.js";import{s as G}from"./multiselect-4f06085e.js";import{F as r}from"./formMode-f60a729f.js";const H=["onSubmit"],J={key:0,class:"mb-3 flex flex-wrap items-center"},K=s("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Branch",-1),X={key:0,class:"ml-24 w-full text-sm text-red-500"},Y={class:"mb-3 flex flex-wrap items-center"},Z=s("span",{class:"w-24 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Name",-1),ee={key:0,class:"ml-24 w-full text-sm text-red-500"},ae=s("p",{class:"mb-1 pr-2"},"Permissions",-1),se={key:0,class:"mb-1 text-sm text-red-500"},oe=["disabled"],de=O({__name:"RoleForm",emits:["close"],setup(te,{emit:N}){const y=F(),V=M(),e=i({}),{getPermissionsTree:P}=Q(),o=i(r.Create),u=i(!1),a=i({}),_=i(null),c=D().user.branches;E(async()=>{c.length===1&&(e.value.branchId=c[0].id),y.path.endsWith("/edit")&&(o.value=r.Edit),y.path.endsWith("/clone")&&(o.value=r.Clone),o.value!==r.Create&&await I(y.params.id),_.value=await P()});const I=async m=>{const{data:t}=await p.get(`/api/roles/${m}`);e.value=t.data},$=async()=>{u.value=!0;try{o.value===r.Create?await R():o.value===r.Clone?await S():o.value===r.Edit&&await T(),a.value={},L.fire()}catch(m){a.value=m.response.data.errors??{}}u.value=!1},R=async()=>{await p.post("/api/roles",e.value),B()},S=async()=>{await p.post("/api/roles",e.value),w()},T=async()=>{await p.patch(`/api/roles/${e.value.id}`,e.value),w()},B=()=>{e.value={},a.value=[]},w=()=>{N("close"),V.back()};return(m,t)=>(l(),x(A,null,{header:v(()=>[g(b(`${o.value.capitalize()} ${o.value===f(r).Create?"New":""} Role`),1)]),body:v(()=>[s("form",{id:"form",onSubmit:W($,["prevent","stop"])},[f(c).length>1?(l(),h("div",J,[K,k(f(G),{modelValue:e.value.branchId,"onUpdate:modelValue":t[0]||(t[0]=n=>e.value.branchId=n),options:f(c),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:C(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":a.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),a.value.hasOwnProperty("branchId")?(l(),h("p",X,b(a.value.branchId[0]),1)):d("",!0)])):d("",!0),s("div",Y,[Z,U(s("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.value.displayName=n),class:C(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":a.value.hasOwnProperty("displayName")}])},null,2),[[z,e.value.displayName]]),a.value.hasOwnProperty("displayName")?(l(),h("p",ee,b(a.value.displayName[0]),1)):d("",!0)]),s("div",null,[ae,a.value.hasOwnProperty("permissions")?(l(),h("p",se,b(a.value.permissions[0]),1)):d("",!0),_.value?(l(),x(q,{key:1,options:_.value,modelValue:e.value.permissions,"onUpdate:modelValue":t[2]||(t[2]=n=>e.value.permissions=n),class:"overflow-y-auto rounded border border-gray-300 py-2 max-h-[250px]"},null,8,["options","modelValue"])):d("",!0)])],40,H)]),footer:v(()=>[s("button",{class:"mr-2 btn-blue",disabled:u.value,form:"form"},[k(j,{"is-loading":u.value},{default:v(()=>[g("Save")]),_:1},8,["is-loading"])],8,oe),s("button",{onClick:w,class:"btn-gray"},"Cancel")]),_:1}))}});export{de as default};
