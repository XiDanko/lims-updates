import{d as E,g as m,x as K,y as Y,o as d,c,b as e,a as u,j as D,v as G,a1 as X,W as ee,i as l,w as k,F as R,s as te,Q as L,Z as j,a0 as F,V as se,m as V,h as M,_ as P,k as h,a2 as U,n as z,t as f,a3 as oe,a4 as ae,T as re}from"./main-bf2af1c2.js";import{M as le}from"./Master-fd48b992.js";import{_ as ne}from"./Paginator.vue_vue_type_script_setup_true_lang-ae9d2a51.js";import{u as ie}from"./urlQueryManager-97734f58.js";import{i as de}from"./index.es-d69483ac.js";import{d as ce}from"./datepickerPresets-09eddff9.js";import{_ as ue}from"./BarcodeScanner.vue_vue_type_script_setup_true_lang-0568214d.js";import{_ as pe}from"./BranchFilter.vue_vue_type_script_setup_true_lang-7984eace.js";import{O as g}from"./orderStatus-e3a3f9a7.js";import{u as fe,P as O,p as Q}from"./websocketPrint-798d7766.js";import{u as ve}from"./ordersBulkSelection-e65833d5.js";import{A as be}from"./ActivityLogSidebar-27791482.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./multiselect-4f06085e.js";const ye={class:"ml-auto flex items-center gap-2"},he=["onKeyup"],ge=e("option",{value:""},"Select status",-1),me=["value"],_e=["value"],xe=["value"],we=E({__name:"SamplesCollectionFilter",emits:["change","scan"],setup(q,{emit:_}){const x=new URLSearchParams(location.search),w=m(""),n=m(""),v=m(""),r=m([null,null]);K(()=>B());const S=Y(()=>r.value[0]===null||r.value[1]===null?"":`${r.value[0]}~${r.value[1]}`),$=async b=>{n.value=b,w.value="",r.value=[null,null],v.value="",i("scan")},B=()=>{w.value=x.get("branchId")??"",n.value=x.get("visitNumber")??"",v.value=x.get("status")??"",x.get("dateRange")&&(r.value=x.get("dateRange").split("~"))},I=()=>{const b=n.value;C(),n.value=b,i()},i=(b="change")=>{let a=`branchId=${w.value}&visitNumber=${n.value}&status=${v.value}&dateRange=${S.value}&page=1`;_(b,a)},C=()=>{w.value="",n.value="",v.value="",r.value=[null,null]};return(b,a)=>(d(),c(R,null,[e("div",ye,[u(pe,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=p=>w.value=p),onChange:i},null,8,["modelValue"]),D(e("input",{"onUpdate:modelValue":a[1]||(a[1]=p=>n.value=p),onKeyup:X(I,["enter"]),type:"text",placeholder:"Registration number",class:"w-56 rounded border border-gray-300 p-1.5 focus:border-blue-500"},null,40,he),[[G,n.value]]),D(e("select",{"onUpdate:modelValue":a[2]||(a[2]=p=>v.value=p),onChange:a[3]||(a[3]=p=>i()),class:"px-2 h-[38px] border border-gray-300 !rounded"},[ge,e("option",{value:l(g).Pending},"Pending",8,me),e("option",{value:l(g).Collected},"Collected",8,_e),e("option",{value:l(g).Rejected},"Rejected",8,xe)],544),[[ee,v.value]]),u(l(de),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:l(ce),placeholder:"Select date range",value:r.value,"onUpdate:value":a[4]||(a[4]=p=>r.value=p),onChange:a[5]||(a[5]=p=>i()),class:"!w-56","input-class":"w-full rounded border border-gray-300 p-1.5 focus:border-blue-500"},{"icon-calendar":k(()=>[]),_:1},8,["shortcuts","value"])]),u(ue,{onScan:$})],64))}}),Ce={class:"mb-5 flex flex-wrap items-center gap-2"},ke={key:0,class:"flex items-start gap-2"},Se=["disabled"],$e=["disabled"],Be=["disabled"],Ve=["disabled"],Ae=["disabled"],Le={class:"pr-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},Pe={class:"w-full"},Ne={class:"sticky top-0 z-10 text-left"},Re={class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},Ie={class:"flex items-center justify-center"},Me=["checked"],De=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"No.",-1),We=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Name",-1),Te=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Tests",-1),je=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Department",-1),Fe=e("th",{class:"whitespace-nowrap first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Sample Type",-1),Ue=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Barcode",-1),ze=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Status",-1),Oe=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Notes",-1),Qe=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Date",-1),Ee=e("th",{class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},"Branch",-1),Ke={key:0,class:"first-of-type:rounded-tl last-of-type:rounded-tr bg-gray-600 p-2 font-semibold text-white"},Ye={class:"flex items-center justify-center"},qe=["checked","onChange"],He={class:"border border-gray-200 px-2 py-1"},Je={class:"whitespace-nowrap border border-gray-200 px-2 py-1"},Ze={class:"border border-gray-200 px-2 py-1"},Ge={class:"flex flex-wrap items-center gap-1 max-w-[30rem]"},Xe={class:"rounded bg-teal-500 px-1 text-xs text-white group-hover:bg-white group-hover:text-gray-600"},et={class:"whitespace-nowrap border border-gray-200 px-2 py-1"},tt={class:"whitespace-nowrap border border-gray-200 px-2 py-1"},st={class:"border border-gray-200 px-2 py-1"},ot={class:"border border-gray-200 px-2 py-1"},at={class:"border border-gray-200 px-2 py-1"},rt={class:"whitespace-nowrap border border-gray-200 px-2 py-1"},lt={class:"border border-gray-200 px-2 py-1"},nt={key:0,class:"border border-gray-200 px-2 py-1 text-center"},it={class:"flex justify-center gap-3"},dt=["onClick"],ct=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"})],-1),ut=[ct],$t=E({__name:"SamplesCollection",setup(q){const _=m([]),x=m({}),{updateUrlQuery:w}=ie(),{hasPermissionTo:n,hasAnyPermission:v}=re(),r=m(!1),S=m(!1),$=m(!1),B=fe(),I=setInterval(()=>a(location.search),15e3),i=ve(),C=Y(()=>_.value.filter(o=>i.selectedOrdersIds.value.has(o.id)));K(()=>{a(location.search),document.addEventListener("keyup",b)}),te(()=>{document.removeEventListener("keyup",b),clearInterval(I)});const b=async o=>{o.keyCode===13&&C.value.length>0&&(await A("departmentWise"),await W(!1))},a=async o=>{const t=await w(o),{data:y}=await L.get(`/api/samples-collection?${t}`);_.value=y.data,x.value=y.meta},p=async o=>{await a(o),i.toggleAll(_.value,!0)},W=async(o=!0)=>{if(o){const{isConfirmed:t}=await j.fire();if(!t)return}S.value=!0,await L.post("/api/samples/collect",{samples:C.value}),F.fire(),S.value=!1,await a(location.search),i.clear()},H=async()=>{const{isConfirmed:o}=await j.fire();o&&($.value=!0,await L.post("/api/samples/accept",{samples:C.value}),F.fire(),$.value=!1,await a(location.search),i.clear())},A=async(o,t=!1)=>{r.value=!0;const{data:y}=await L.post("/api/samples/print",{type:o,orders:C.value});B.isConnected&&!t?B.submit({type:O.Barcodes,url:"barcode.pdf",file_content:y}):Q({printable:y,type:"pdf",base64:!0}),r.value=!1},T=async(o=!1)=>{r.value=!0;const{data:t}=await L.post("/api/visits/print-barcode",{visitId:C.value.flatMap(y=>y.visitId)});B.isConnected&&!o?B.submit({type:O.Barcodes,url:"barcode.pdf",file_content:t}):Q({printable:t,type:"pdf",base64:!0}),r.value=!1},J=o=>{if(o===g.Pending)return"border-l-gray-300";if(o===g.Collected)return"border-l-yellow-400";if(o===g.Rejected)return"border-l-red-500"},Z=o=>{if(o===g.Pending)return"hover:bg-gray-300 hover:text-black";if(o===g.Collected)return"hover:bg-yellow-400 hover:text-black";if(o===g.Rejected)return"hover:bg-red-500 hover:text-white"};return(o,t)=>{const y=se("tip");return d(),c(R,null,[u(le,null,{header:k(()=>[V("Samples Collection")]),body:k(()=>[e("div",Ce,[C.value.length>0?(d(),c("div",ke,[l(n)("Visit.printBarcode")?(d(),c("button",{key:0,onClick:t[0]||(t[0]=s=>T(!1)),onContextmenu:t[1]||(t[1]=M(s=>T(!0),["prevent"])),class:"btn-blue",disabled:r.value},[u(P,{"is-loading":r.value},{default:k(()=>[V("Visit Barcode")]),_:1},8,["is-loading"])],40,Se)):h("",!0),l(n)("Sample.print")?(d(),c("button",{key:1,onClick:t[2]||(t[2]=s=>A("sampleWise")),onContextmenu:t[3]||(t[3]=M(s=>A("sampleWise",!0),["prevent"])),class:"btn-blue",disabled:r.value},[u(P,{"is-loading":r.value},{default:k(()=>[V("Barcodes S.W.")]),_:1},8,["is-loading"])],40,$e)):h("",!0),l(n)("Sample.print")?(d(),c("button",{key:2,onClick:t[4]||(t[4]=s=>A("departmentWise")),onContextmenu:t[5]||(t[5]=M(s=>A("departmentWise",!0),["prevent"])),class:"btn-blue",disabled:r.value},[u(P,{"is-loading":r.value},{default:k(()=>[V("Barcodes D.W.")]),_:1},8,["is-loading"])],40,Be)):h("",!0),l(n)("Sample.collect")?(d(),c("button",{key:3,onClick:W,class:"btn-teal",disabled:S.value},[u(P,{"is-loading":S.value},{default:k(()=>[V("Collect")]),_:1},8,["is-loading"])],8,Ve)):h("",!0),l(n)("Sample.accept")?(d(),c("button",{key:4,onClick:H,class:"btn-teal",disabled:$.value},[u(P,{"is-loading":$.value},{default:k(()=>[V("Accept")]),_:1},8,["is-loading"])],8,Ae)):h("",!0),e("button",{onClick:t[6]||(t[6]=s=>l(i).clear()),class:"btn-gray"},"Clear")])):h("",!0),u(we,{onChange:a,onScan:p})]),e("section",Le,[e("table",Pe,[e("thead",null,[e("tr",Ne,[e("th",Re,[e("label",Ie,[e("input",{type:"checkbox",checked:l(i).isAllSelected(_.value),onChange:t[7]||(t[7]=s=>l(i).toggleAll(_.value,s.target.checked)),class:"h-4 w-4 rounded checked:accent-blue-500"},null,40,Me)])]),De,We,Te,je,Fe,Ue,ze,Oe,Qe,Ee,l(v)("ActivityLog.list")?(d(),c("th",Ke)):h("",!0)])]),e("tbody",null,[(d(!0),c(R,null,U(_.value,s=>(d(),c("tr",{class:z(["transition group even:bg-gray-100",Z(s.status)])},[e("td",{class:z(["border border-gray-200 px-2 py-1 border-l-[5px]",J(s.status)])},[e("label",Ye,[e("input",{type:"checkbox",checked:l(i).isSelected(s),onChange:N=>l(i).toggle(s,N.target.checked),class:"h-4 w-4 rounded checked:accent-blue-500"},null,40,qe)])],2),e("td",He,f(s.visit.number),1),e("td",Je,f(s.patient.name),1),e("td",Ze,[e("div",Ge,[(d(!0),c(R,null,U(s.tests,N=>(d(),c("span",Xe,f(N.shortForm),1))),256))])]),e("td",et,f(s.test.department.name),1),e("td",tt,f(s.test.sampleType.name),1),e("td",st,f(s.barcode),1),e("td",ot,f(s.status.capitalize()),1),e("td",at,f(s.notes),1),e("td",rt,f(s.date),1),e("td",lt,f(s.branch.name),1),l(v)("ActivityLog.list")?(d(),c("td",nt,[e("div",it,[l(n)("ActivityLog.list")?D((d(),c("button",{key:0,onClick:N=>l(oe).emit(l(ae).Show,s.id),class:"cursor-pointer text-gray-600 group-hover:text-white"},ut,8,dt)),[[y,"View Activities"]]):h("",!0)])])):h("",!0)],2))),256))])])])]),_:1}),u(ne,{data:x.value,onChange:t[8]||(t[8]=s=>a(`page=${s}`)),class:"mt-3"},null,8,["data"]),u(be)],64)}}});export{$t as default};
