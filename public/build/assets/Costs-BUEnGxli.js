import{d as k,e as u,x as $,y as M,o as r,c as n,a as m,b as e,w as b,g as p,Q as w,r as R,U as B,t as i,i as x,F as C,a1 as F,R as L,k as N,h as S,T,Y as U,$ as A}from"./main-DNdNUUJ7.js";import{M as I}from"./Master-b_S4sXaO.js";import{_ as Q}from"./Paginator.vue_vue_type_script_setup_true_lang-ByzTMpQ9.js";import{u as Y}from"./urlQueryManager-rKHuCRUp.js";import{i as P}from"./index.es-CdvJf4Rl.js";import{d as j}from"./datepickerPresets-BpsxgrFD.js";import{_ as q}from"./BranchFilter.vue_vue_type_script_setup_true_lang-CgUfq7jM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./multiselect-K4eUN8Nz.js";const z={class:"flex flex-wrap items-center gap-2 ms-auto"},E={class:"relative flex-1 min-w-[14rem]"},H=e("label",{class:"label"},"Date",-1),O=k({__name:"CostsFilter",emits:["change"],setup(D,{emit:h}){const f=h,d=new URLSearchParams(location.search),c=u(""),o=u([null,null]);$(()=>{g()});const y=M(()=>o.value[0]===null||o.value[1]===null?"":`${o.value[0]}~${o.value[1]}`),g=()=>{c.value=d.get("branchId")??"",d.get("dateRange")&&(o.value=d.get("dateRange").split("~"))},l=()=>{let v=`branchId=${c.value}&dateRange=${y.value}&page=1`;f("change",v)};return(v,a)=>(r(),n("div",z,[m(q,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=s=>c.value=s),onChange:l},null,8,["modelValue"]),e("div",E,[m(p(P),{range:"",lang:{formatLocale:{firstDayOfWeek:6}},type:"date","value-type":"format",format:"YYYY-MM-DD",shortcuts:p(j),value:o.value,"onUpdate:value":a[1]||(a[1]=s=>o.value=s),onChange:l,class:"w-full peer","input-class":"input-sm pt-0.5"},{"icon-calendar":b(()=>[]),_:1},8,["shortcuts","value"]),H])]))}}),W={class:"flex justify-between"},G=e("h1",null,"Costs",-1),J={class:"mb-5 flex items-center gap-5"},K={class:"pe-1 h-[calc(100vh-15.7rem)] overflow-y-auto"},X={class:"w-full"},Z={class:"sticky top-0 z-10 text-left"},ee=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Reg. No.",-1),te=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Test",-1),se=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Amount",-1),oe=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Date",-1),ae=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Branch",-1),re={key:0,class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},ne={class:"transition even:bg-gray-100"},le={class:"border border-gray-200 px-2 py-1"},ie={key:1},de={class:"border border-gray-200 px-2 py-1"},ce={class:"border border-gray-200 px-2 py-1"},ue={class:"border border-gray-200 px-2 py-1"},pe={class:"border border-gray-200 px-2 py-1"},_e={key:0,class:"border border-gray-200 px-2 py-1 text-center"},me={class:"flex justify-center gap-3"},he=["onClick"],fe=e("svg",{class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),ye=[fe],Me=k({__name:"Costs",setup(D){const h=u([]),f=u({}),d=u(),c=u(!1),{updateUrlQuery:o}=Y(),{hasPermissionTo:y,hasAnyPermission:g}=T();$(()=>l(location.search));const l=async a=>{const s=await o(a),{data:_}=await w.get(`/api/costs?${s}`);h.value=_.data,f.value=_.meta,d.value=_.total,c.value=!1},v=async a=>{const{isConfirmed:s}=await U.fire();s&&(await w.delete(`/api/costs/${a}`),A.fire(),await l(location.search))};return(a,s)=>{const _=R("router-link"),V=B("tip");return r(),n(C,null,[m(I,null,{header:b(()=>[e("div",W,[G,e("p",null,"Total: "+i(d.value?.toLocaleString()),1)])]),body:b(()=>[e("div",J,[m(O,{onChange:l})]),e("section",K,[e("table",X,[e("thead",null,[e("tr",Z,[ee,te,se,oe,ae,p(g)("Cost.delete")?(r(),n("th",re)):x("",!0)])]),e("tbody",null,[(r(!0),n(C,null,F(h.value,t=>(r(),n("tr",ne,[e("td",le,[p(y)("Visit.view")?(r(),L(_,{key:0,class:"text-blue-500 underline",to:`/visits?branchId=${t.branchId}&visitNumber=${t.visit.number}`},{default:b(()=>[N(i(t.visit.number),1)]),_:2},1032,["to"])):(r(),n("p",ie,i(t.visit.number),1))]),e("td",de,i(t.order.test.shortForm),1),e("td",ce,i(t.amount?.toLocaleString()),1),e("td",ue,i(t.date),1),e("td",pe,i(t.branch.name),1),p(g)("Cost.delete")?(r(),n("td",_e,[e("div",me,[p(y)("Cost.delete")?S((r(),n("button",{key:0,onClick:ge=>v(t.id),class:"cursor-pointer text-red-500"},ye,8,he)),[[V,"Delete"]]):x("",!0)])])):x("",!0)]))),256))])])])]),_:1}),m(Q,{data:f.value,onChange:s[0]||(s[0]=t=>l(`page=${t}`)),class:"mt-3"},null,8,["data"])],64)}}});export{Me as default};
