import{d as K,f as X,e as Y,g as v,u as Z,ah as ee,x as ae,Q as p,V as re,o as u,R as M,w as S,m as q,t as c,i as o,b as r,c as b,a as d,n as m,k as i,j as f,v as g,W as se,h as te,_ as le,a5 as oe,a0 as de}from"./main-5548143a.js";import{b as y}from"./toggle-af3738b3.js";import{s as w}from"./multiselect-30de6652.js";import{F as x}from"./formMode-f60a729f.js";import{_ as ne}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-3ebc070d.js";const ue=["onSubmit"],ie={class:"grid grid-cols-2 gap-3"},pe={key:0,class:"col-span-2 flex flex-wrap items-start"},ce=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Branch",-1),be={key:0,class:"ml-40 w-full text-sm text-red-500"},me={class:"flex flex-wrap items-start"},ve=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Department",-1),fe={key:0,class:"ml-40 w-full text-sm text-red-500"},ye={class:"flex flex-wrap items-start"},ge=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Machine",-1),he={key:0,class:"ml-40 w-full text-sm text-red-500"},we={class:"flex flex-wrap items-start"},xe=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Seq. No.",-1),_e={key:0,class:"ml-40 w-full text-sm text-red-500"},Ve={class:"flex flex-wrap items-start"},Ie=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Code",-1),Se={key:0,class:"ml-40 w-full text-sm text-red-500"},ke={class:"flex flex-wrap items-start"},Ce=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Name",-1),Pe={key:0,class:"ml-40 w-full text-sm text-red-500"},Te={class:"flex flex-wrap items-start"},Ue=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Short Form",-1),Oe={key:0,class:"ml-40 w-full text-sm text-red-500"},Fe={class:"flex flex-wrap items-start"},Ne=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Sample Content",-1),Be={key:0,class:"ml-40 w-full text-sm text-red-500"},Me={class:"flex flex-wrap items-start"},qe=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Sample Type",-1),$e={key:0,class:"ml-40 w-full text-sm text-red-500"},De={class:"flex flex-wrap items-start"},ze=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Affected By Fasting",-1),Ae={class:"flex flex-wrap items-start"},Ee=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Affected By Menses",-1),Re={class:"flex flex-wrap items-start"},We=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Bypass",-1),je={class:"flex flex-wrap items-start"},He=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Single Test",-1),Le={class:"flex flex-wrap items-start"},Qe=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Printable",-1),Ge={class:"flex flex-wrap items-start"},Je=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Print Separately",-1),Ke={class:"flex flex-wrap items-start"},Xe=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Turnaround Time",-1),Ye=r("option",{value:null},"Select",-1),Ze=r("option",{value:"minutes"},"Minutes",-1),ea=r("option",{value:"hours"},"Hours",-1),aa=r("option",{value:"days"},"Days",-1),ra=[Ye,Ze,ea,aa],sa={class:"flex flex-wrap items-start"},ta=r("span",{class:"w-40 rounded-l border border-r-0 border-gray-300 bg-gray-100 p-2"},"Cost",-1),la={class:"col-span-2 flex flex-wrap items-start"},oa=r("span",{class:"w-full"},"Notes",-1),da=["disabled"],ma=K({__name:"TestForm",emits:["close"],setup(na,{emit:$}){const T=X(),D=Y(),e=v({isPrintable:!0}),k=v([]),_=Z().user.branches,U=v([]),C=v([]),O=v([]),V=v(x.Create),I=v(!1),t=v({}),n=ee({value:null,unit:null});ae(()=>{_.length===1&&(e.value.branchId=_[0].id,P()),T.path.endsWith("/edit")&&(V.value=x.Edit,H(T.params.id))});const z=async()=>{const{data:l}=await p.get(`/api/suggestions/list?branchId=${e.value.branchId}&type=sampleContent`);C.value=l.data},A=async({content:l})=>{const{data:a}=await p.post("/api/suggestions",{branchId:e.value.branchId,type:"sampleContent",content:l});return C.value.push(a.data),a.data},F=async l=>{const{data:a}=await p.get(`/api/machines/list?departmentId=${l}`);O.value=a.data},E=async()=>{const{data:l}=await p.get(`/api/departments/list?branchId=${e.value.branchId}`);U.value=l.data},R=async()=>{const{data:l}=await p.get(`/api/sample-types/list?branchId=${e.value.branchId}`);k.value=l.data},W=async({name:l})=>{const{data:a}=await p.post("/api/sample-types",{branchId:e.value.branchId,name:l});return k.value.push(a.data),a.data},P=()=>{E(),R(),z()},j=()=>{e.value.departmentId=null,e.value.machineId=null,e.value.sampleContent=null,e.value.sampleTypeId=null,e.value.sequenceNumber=null},N=async()=>{const{data:l}=await p.post("/api/tests/generate-sequence",{branchId:e.value.branchId,departmentId:e.value.departmentId});e.value.sequenceNumber=l},H=async l=>{const{data:a}=await p.get(`/api/tests/${l}`);if(e.value=a.data,P(),F(a.data.departmentId),e.value.turnaroundTime){const h=e.value.turnaroundTime.split(" ");n.value=h[0],n.unit=h[1]}},L=async()=>{I.value=!0,n.unit&&n.value&&(e.value.turnaroundTime=n.value+" "+n.unit);try{V.value===x.Create?await Q():await G(),t.value={},de.fire()}catch(l){t.value=l.response.data.errors??{}}I.value=!1},Q=async()=>{await p.post("/api/tests",e.value),J(),await N()},G=async()=>{await p.patch(`/api/tests/${e.value.id}`,e.value),B()},J=()=>{e.value={branchId:e.value.branchId,departmentId:e.value.departmentId,machineId:e.value.machineId,isPrintable:!0},n.unit=null,n.value=null,t.value=[]},B=()=>{$("close"),D.back()};return(l,a)=>{const h=re("maska");return u(),M(oe,{"modal-class":"!w-[60rem]"},{header:S(()=>[q(c(V.value===o(x).Create?"Create New Test":"Edit Test"),1)]),body:S(()=>[r("form",{id:"form",onSubmit:te(L,["prevent","stop"])},[r("div",ie,[o(_).length>1?(u(),b("div",pe,[ce,d(o(w),{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value.branchId=s),options:o(_),onSelect:P,onChange:j,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("branchId")?(u(),b("p",be,c(t.value.branchId[0]),1)):i("",!0)])):i("",!0),r("div",me,[ve,d(o(w),{modelValue:e.value.departmentId,"onUpdate:modelValue":a[1]||(a[1]=s=>e.value.departmentId=s),options:U.value,onSelect:a[2]||(a[2]=s=>{N(),F(s)}),onChange:a[3]||(a[3]=s=>e.value.machineId=null),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("departmentId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("departmentId")?(u(),b("p",fe,c(t.value.departmentId[0]),1)):i("",!0)]),r("div",ye,[ge,d(o(w),{modelValue:e.value.machineId,"onUpdate:modelValue":a[4]||(a[4]=s=>e.value.machineId=s),options:O.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("machineId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("machineId")?(u(),b("p",he,c(t.value.machineId[0]),1)):i("",!0)]),r("div",we,[xe,f(r("input",{"onUpdate:modelValue":a[5]||(a[5]=s=>e.value.sequenceNumber=s),"data-maska":"###",size:"1",class:m(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("sequenceNumber")}])},null,2),[[g,e.value.sequenceNumber],[h]]),t.value.hasOwnProperty("sequenceNumber")?(u(),b("p",_e,c(t.value.sequenceNumber[0]),1)):i("",!0)]),r("div",Ve,[Ie,f(r("input",{"onUpdate:modelValue":a[6]||(a[6]=s=>e.value.code=s),size:"1",class:m(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("code")}])},null,2),[[g,e.value.code]]),t.value.hasOwnProperty("code")?(u(),b("p",Se,c(t.value.code[0]),1)):i("",!0)]),r("div",ke,[Ce,f(r("input",{"onUpdate:modelValue":a[7]||(a[7]=s=>e.value.name=s),size:"1",class:m(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("name")}])},null,2),[[g,e.value.name]]),t.value.hasOwnProperty("name")?(u(),b("p",Pe,c(t.value.name[0]),1)):i("",!0)]),r("div",Te,[Ue,f(r("input",{"onUpdate:modelValue":a[8]||(a[8]=s=>e.value.shortForm=s),size:"1",class:m(["flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("shortForm")}])},null,2),[[g,e.value.shortForm]]),t.value.hasOwnProperty("shortForm")?(u(),b("p",Oe,c(t.value.shortForm[0]),1)):i("",!0)]),r("div",Fe,[Ne,d(o(w),{modelValue:e.value.sampleContent,"onUpdate:modelValue":a[9]||(a[9]=s=>e.value.sampleContent=s),options:C.value,"value-prop":"content","track-by":"content",label:"content",searchable:!0,"create-option":!0,"on-create":A,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("sampleContent")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("sampleContent")?(u(),b("p",Be,c(t.value.sampleContent[0]),1)):i("",!0)]),r("div",Me,[qe,d(o(w),{modelValue:e.value.sampleTypeId,"onUpdate:modelValue":a[10]||(a[10]=s=>e.value.sampleTypeId=s),options:k.value,"value-prop":"id","track-by":"name",label:"name",searchable:!0,"create-option":!0,"on-create":W,class:m(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("sampleTypeId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("sampleTypeId")?(u(),b("p",$e,c(t.value.sampleTypeId[0]),1)):i("",!0)]),r("div",De,[ze,d(o(y),{modelValue:e.value.affectedByFasting,"onUpdate:modelValue":a[11]||(a[11]=s=>e.value.affectedByFasting=s),class:"flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,8,["modelValue"])]),r("div",Ae,[Ee,d(o(y),{modelValue:e.value.affectedByMenses,"onUpdate:modelValue":a[12]||(a[12]=s=>e.value.affectedByMenses=s),class:"flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,8,["modelValue"])]),r("div",Re,[We,d(o(y),{modelValue:e.value.bypass,"onUpdate:modelValue":a[13]||(a[13]=s=>e.value.bypass=s),class:"flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,8,["modelValue"])]),r("div",je,[He,d(o(y),{modelValue:e.value.isSingle,"onUpdate:modelValue":a[14]||(a[14]=s=>e.value.isSingle=s),class:"flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,8,["modelValue"])]),r("div",Le,[Qe,d(o(y),{modelValue:e.value.isPrintable,"onUpdate:modelValue":a[15]||(a[15]=s=>e.value.isPrintable=s),class:"flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,8,["modelValue"])]),r("div",Ge,[Je,d(o(y),{modelValue:e.value.printSeparately,"onUpdate:modelValue":a[16]||(a[16]=s=>e.value.printSeparately=s),class:"flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,8,["modelValue"])]),r("div",Ke,[Xe,f(r("input",{"onUpdate:modelValue":a[17]||(a[17]=s=>n.value=s),size:"1","data-maska":"##",class:"flex-1 border border-gray-300 p-2 focus:border-blue-500"},null,512),[[g,n.value],[h]]),f(r("select",{"onUpdate:modelValue":a[18]||(a[18]=s=>n.unit=s),class:"rounded-r border border-l-0 border-gray-300 px-2 py-1 h-[42px]"},ra,512),[[se,n.unit]])]),r("div",sa,[ta,d(ne,{modelValue:e.value.cost,"onUpdate:modelValue":a[19]||(a[19]=s=>e.value.cost=s),size:"1",class:"flex-1 rounded-r border border-gray-300 p-2 focus:border-blue-500"},null,8,["modelValue"])]),r("div",la,[oa,f(r("textarea",{"onUpdate:modelValue":a[20]||(a[20]=s=>e.value.notes=s),rows:"4",class:"flex-1 rounded border border-gray-300 p-2 focus:border-blue-500"},null,512),[[g,e.value.notes]])])])],40,ue)]),footer:S(()=>[r("button",{class:"mr-2 btn-blue",disabled:I.value,form:"form"},[d(le,{"is-loading":I.value},{default:S(()=>[q("Save")]),_:1},8,["is-loading"])],8,da),r("button",{onClick:B,class:"btn-gray"},"Cancel"),V.value===o(x).Edit?(u(),M(o(y),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":a[21]||(a[21]=s=>e.value.isActive=s),class:"toggle:off:red ml-auto"},null,8,["modelValue"])):i("",!0)]),_:1})}}});export{ma as default};
