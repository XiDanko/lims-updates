import{d as E,u as F,e as n,x as M,Q as i,U as Q,o as u,R as V,w as c,k as C,t as m,g as v,b as o,c as k,a as w,i as y,n as _,h as R,v as j,f as z,_ as H,a4 as L,m as W,l as G,$ as J}from"./main-DmoZ1fz4.js";import{s as K}from"./multiselect-DAhRltj6.js";import{F as r}from"./formMode-Bz--3d4P.js";import{b as X}from"./toggle-DyRQkDOQ.js";import{_ as Y}from"./BranchSelect.vue_vue_type_script_setup_true_lang-D_pdW9WT.js";const Z={key:0,class:"relative"},ee={class:"relative"},ae={class:"flex w-full items-center justify-between"},te={class:"rounded bg-teal-500 px-2 text-sm text-white"},se={key:0,class:"text-sm text-red-500"},le={class:"relative"},oe={key:0,class:"text-sm text-red-500"},re=["disabled"],ve=E({__name:"QuickAddItemForm",emits:["close"],setup(de,{emit:O}){const $=O,g=W(),A=G(),p=F().user.branches,e=n({}),b=n([]),d=n(r.Create),h=n(!1),t=n({});M(()=>{p.length===1&&(e.value.branchId=p[0].id,f()),g.path.endsWith("/edit")&&(d.value=r.Edit,S(g.params.id)),d.value===r.Create&&p.length===1&&I()});const f=async()=>{let s=`/api/items/list?branchId=${e.value.branchId}`;d.value===r.Create&&(s+="&doesntHaveQuickAdd=true");const{data:a}=await i.get(s);b.value=a.data},S=async s=>{const{data:a}=await i.get(`/api/quick-add-items/${s}`);e.value=a.data,f()},I=async()=>{const{data:s}=await i.post("/api/quick-add-items/generate-order",{branchId:e.value.branchId});e.value.order=s},P=()=>{e.value.itemId=null,e.value.itemType=null,b.value=[]},T=s=>{e.value.itemType=b.value.find(a=>a.id===s).type},q=async()=>{h.value=!0;try{d.value===r.Create?await B():await N(),t.value={},J.fire()}catch(s){t.value=s.response.data.errors??{}}h.value=!1},B=async()=>{await i.post("/api/quick-add-items",e.value),U()},N=async()=>{await i.patch(`/api/quick-add-items/${e.value.id}`,e.value),x()},U=()=>{e.value={branchId:e.value.branchId},f(),I(),t.value=[]},x=()=>{$("close"),A.back()};return(s,a)=>{const D=Q("maska");return u(),V(L,null,{header:c(()=>[C(m(d.value===v(r).Create?"Create New Item":"Edit Item"),1)]),body:c(()=>[o("form",{id:"form",onSubmit:z(q,["prevent","stop"]),class:"grid grid-cols-1 gap-4"},[v(p).length>1?(u(),k("div",Z,[w(Y,{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=l=>e.value.branchId=l),error:t.value.branchId,onSelect:a[1]||(a[1]=l=>{I(),f()}),onChange:P},null,8,["modelValue","error"])])):y("",!0),o("div",ee,[w(v(K),{modelValue:e.value.itemId,"onUpdate:modelValue":a[2]||(a[2]=l=>e.value.itemId=l),options:b.value,onSelect:T,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"label",class:_(["input peer",{"border-red-500":t.value.hasOwnProperty("itemId")}])},{option:c(({option:l})=>[o("div",ae,[o("span",null,m(l.label),1),o("span",te,m(l.type),1)])]),_:1},8,["modelValue","options","class"]),o("label",{class:_(["label",{"text-red-500":t.value.hasOwnProperty("itemId")}])},"Item",2),t.value.hasOwnProperty("itemId")?(u(),k("p",se,m(t.value.itemId[0]),1)):y("",!0)]),o("div",le,[R(o("input",{"onUpdate:modelValue":a[3]||(a[3]=l=>e.value.order=l),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",class:_(["input peer",{"border-red-500":t.value.hasOwnProperty("order")}])},null,2),[[j,e.value.order],[D]]),o("label",{class:_(["label",{"text-red-500":t.value.hasOwnProperty("order")}])},"Order",2),t.value.hasOwnProperty("order")?(u(),k("p",oe,m(t.value.order[0]),1)):y("",!0)])],32)]),footer:c(()=>[o("button",{class:"me-2 btn-blue",disabled:h.value,form:"form"},[w(H,{"is-loading":h.value},{default:c(()=>[C("Save")]),_:1},8,["is-loading"])],8,re),o("button",{onClick:x,class:"btn-gray"},"Cancel"),d.value===v(r).Edit?(u(),V(v(X),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":a[4]||(a[4]=l=>e.value.isActive=l),class:"toggle:off:red ms-auto"},null,8,["modelValue"])):y("",!0)]),_:1})}}});export{ve as default};
