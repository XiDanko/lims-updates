import{d as R,e as n,u as $,x as U,A as b,L as A,o as d,C as k,w as v,k as C,t as h,g as o,b as r,c as f,a as y,n as w,i as u,h as D,v as L,f as W,_ as z,V as H,m as j,l as q,S as G}from"./main-c1f62c61.js";import{b as J}from"./toggle-b89396fa.js";import{s as S}from"./multiselect-ffe70d49.js";import{F as i}from"./formMode-f60a729f.js";import{_ as K}from"./Tinymce.vue_vue_type_script_setup_true_lang-a7834caa.js";const Q=["onSubmit"],X={key:0,class:"flex flex-wrap items-center mb-3"},Y=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Branch",-1),Z={key:0,class:"ml-24 w-full text-red-500 text-sm"},ee={class:"flex flex-wrap items-center mb-3"},ae=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Name",-1),te={key:0,class:"w-full ml-24 text-red-500 text-sm"},re={class:"flex flex-wrap items-center mb-3"},se=r("span",{class:"w-24 p-2 border border-gray-300 border-r-0 rounded-l bg-gray-100"},"Parameter",-1),le={key:0,class:"ml-24 w-full text-red-500 text-sm"},oe={class:"flex flex-wrap items-center"},ne=["disabled"],be=R({__name:"ResultTemplateForm",emits:["close"],setup(de,{emit:P}){const x=j(),T=q(),e=n({}),c=$().user.branches,I=n([]),m=n(i.Create),p=n(!1),t=n([]),_=n({});U(()=>{c.length===1&&(e.value.branchId=c[0].id,g()),x.path.endsWith("/edit")&&(m.value=i.Edit,O(x.params.id))});const O=async l=>{const{data:a}=await b.get(`/api/result-templates/${l}`);e.value=a.data,g()},g=async()=>{B(),_.value=A().data.general?.find(l=>l.branchId===e.value.branchId)},B=async()=>{const{data:l}=await b.get(`/api/parameters/list?branchId=${e.value.branchId}`);I.value=l.data},E=async()=>{p.value=!0;try{m.value===i.Create?await F():await M(),G.fire()}catch(l){t.value=l.response.data.errors??{}}p.value=!1},F=async()=>{await b.post("/api/result-templates",e.value),N()},M=async()=>{await b.patch(`/api/result-templates/${e.value.id}`,e.value),V()},N=()=>{e.value={branchId:e.value.branchId,content:""},t.value=[]},V=()=>{P("close"),T.back()};return(l,a)=>(d(),k(H,{"modal-class":"!w-[56rem]"},{header:v(()=>[C(h(m.value===o(i).Create?"Create New Result Template":"Edit Result Template"),1)]),body:v(()=>[r("form",{id:"form",onSubmit:W(E,["prevent","stop"])},[o(c).length>1?(d(),f("div",X,[Y,y(o(S),{modelValue:e.value.branchId,"onUpdate:modelValue":a[0]||(a[0]=s=>e.value.branchId=s),onSelect:g,options:o(c),searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name","can-deselect":!1,"can-clear":!1,class:w(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("branchId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("branchId")?(d(),f("p",Z,h(t.value.branchId[0]),1)):u("",!0)])):u("",!0),r("div",ee,[ae,D(r("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>e.value.name=s),class:w(["flex-1 p-2 border border-gray-300 rounded-r focus:border-blue-500",{"!border-red-500":t.value.hasOwnProperty("name")}])},null,2),[[L,e.value.name]]),t.value.hasOwnProperty("name")?(d(),f("p",te,h(t.value.name[0]),1)):u("",!0)]),r("div",re,[se,y(o(S),{modelValue:e.value.parameterId,"onUpdate:modelValue":a[2]||(a[2]=s=>e.value.parameterId=s),options:I.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm",class:w(["flex-1 border border-gray-300 !rounded-r",{"!border-red-500":t.value.hasOwnProperty("parameterId")}])},null,8,["modelValue","options","class"]),t.value.hasOwnProperty("parameterId")?(d(),f("p",le,h(t.value.parameterId[0]),1)):u("",!0)]),r("div",oe,[y(K,{modelValue:e.value.content,"onUpdate:modelValue":a[3]||(a[3]=s=>e.value.content=s),"limit-width":_.value?.resultEditorMaxWidth,"limit-height":_.value?.resultEditorMaxHeight},null,8,["modelValue","limit-width","limit-height"])])],40,Q)]),footer:v(()=>[r("button",{class:"btn-blue mr-2",disabled:p.value,form:"form"},[y(z,{"is-loading":p.value},{default:v(()=>[C("Save")]),_:1},8,["is-loading"])],8,ne),r("button",{onClick:V,class:"btn-gray"},"Cancel"),m.value===o(i).Edit?(d(),k(o(J),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":a[4]||(a[4]=s=>e.value.isActive=s),class:"ml-auto toggle:off:red"},null,8,["modelValue"])):u("",!0)]),_:1}))}});export{be as default};
