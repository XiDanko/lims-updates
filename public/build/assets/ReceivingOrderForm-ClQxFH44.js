import{d as ee,u as te,e as u,x as se,Q as p,U as B,o as n,R as ae,w as U,k as D,t as S,g as m,b as e,c as d,a as _,n as i,i as C,h as c,v as b,a1 as M,F as q,f as oe,_ as re,a4 as le,m as ne,l as de,V as ie,T as ce,$ as ue,a8 as pe}from"./main-DNdNUUJ7.js";import{s as z}from"./multiselect-K4eUN8Nz.js";import{F as k}from"./formMode-Bz--3d4P.js";import{_ as he}from"./BranchSelect.vue_vue_type_script_setup_true_lang-BebEpNal.js";import{_ as ve}from"./InventorySelect.vue_vue_type_script_setup_true_lang-CTdDV_El.js";import{_ as me}from"./CurrencyInput.vue_vue_type_script_setup_true_lang-B7NMAXDI.js";const _e={class:"relative"},be={key:0,class:"text-sm text-red-500"},ye={class:"relative"},fe=e("label",{class:"label"},"Notes",-1),ge={class:"max-h-[calc(100vh-25rem)] col-span-2"},we={key:0,class:"text-sm text-red-500"},Ie={class:"w-full"},xe={class:"z-10 text-left"},Ve=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Product",-1),Ue=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Quantity",-1),ke=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Price",-1),Oe=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Batch No.",-1),$e=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Expiry Date",-1),Se=e("th",{class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},"Notes",-1),Ce={class:"bg-gray-600 p-2 font-semibold text-white first-of-type:rounded-ss last-of-type:rounded-se"},Pe=e("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z","clip-rule":"evenodd"},null,-1),Re=[Pe],Ne={class:"transition even:bg-gray-100"},Be={class:"w-96 border border-gray-200 px-2 py-1"},De={class:"w-80 border border-gray-200 px-2 py-1"},Me={class:"flex"},qe=["onUpdate:modelValue"],ze=["onUpdate:modelValue"],Ee=["value"],Fe={class:"w-32 border border-gray-200 px-2 py-1"},Le={class:"w-32 border border-gray-200 px-2 py-1"},Te=["onUpdate:modelValue"],Ae={class:"w-32 border border-gray-200 px-2 py-1"},He=["onUpdate:modelValue"],Qe={class:"border border-gray-200 px-2 py-1"},je=["onUpdate:modelValue"],We={class:"border border-gray-200 px-2 py-1 text-center"},Ge={class:"flex items-center justify-center gap-3"},Je=["onClick"],Ke=e("path",{"fill-rule":"evenodd",d:"M2.515 10.674a1.875 1.875 0 000 2.652L8.89 19.7c.352.351.829.549 1.326.549H19.5a3 3 0 003-3V6.75a3 3 0 00-3-3h-9.284c-.497 0-.974.198-1.326.55l-6.375 6.374zM12.53 9.22a.75.75 0 10-1.06 1.06L13.19 12l-1.72 1.72a.75.75 0 101.06 1.06l1.72-1.72 1.72 1.72a.75.75 0 101.06-1.06L15.31 12l1.72-1.72a.75.75 0 10-1.06-1.06l-1.72 1.72-1.72-1.72z","clip-rule":"evenodd"},null,-1),Xe=[Ke],Ye=["disabled"],lt=ee({__name:"ReceivingOrderForm",emits:["close"],setup(Ze,{emit:E}){const F=E,{hasPermissionTo:L}=ce(),y=ne(),T=de(),f=te().user.branches,A=u([]),g=u([]),O=u([]),t=u({receivingOrderItems:[]}),$=u(k.Create),w=u(!1),l=u({});se(()=>{y.query.hasOwnProperty("purchaseOrderId")?Q(y.query.purchaseOrderId):y.path.endsWith("/edit")?($.value=k.Edit,H(y.params.id)):(f.length===1&&(t.value.branchId=f[0].id,x(),I()),V())});const H=async a=>{const{data:o}=await p.get(`/api/receiving-orders/${a}`);t.value=o.data,x(),I()},Q=async a=>{const{data:o}=await p.get(`/api/purchase-orders/${a}`);t.value={branchId:o.data.branchId,inventoryId:o.data.inventoryId,purchaseOrderId:a,receivingOrderItems:[]},o.data.purchaseOrderItems.forEach(h=>{t.value.receivingOrderItems.push({productId:h.productId,quantity:h.quantity,productUnitId:h.productUnitId})}),x(),I()},I=async()=>{const{data:a}=await p.get(`/api/suppliers/list?branchId=${t.value.branchId}`);O.value=a.data},j=async a=>{const{data:o}=await p.post("/api/suppliers",{branchId:t.value.branchId,name:a});return O.value.push(o.data),o.data},x=async()=>{const{data:a}=await p.get(`/api/products/list?branchId=${t.value.branchId}`);g.value=a.data},W=()=>{t.value.inventoryId=null,t.value.supplierId=null,V(),I(),x()},G=a=>{a.productUnitId=g.value.find(o=>o.id===a.productId).units.find(o=>o.quantity===1).id},V=()=>{t.value.receivingOrderItems=[];for(let a=0;a<=10;a++)P()},P=()=>t.value.receivingOrderItems.push({}),J=a=>t.value.receivingOrderItems.splice(a,1),K=async()=>{w.value=!0;try{$.value===k.Create?await X():await Y(),l.value={},ue.fire()}catch(a){l.value=a.response.data.errors??{}}w.value=!1},X=async()=>{const a=pe.cloneDeep(t.value);a.receivingOrderItems=a.receivingOrderItems.filter(o=>o.productId),await p.post("/api/receiving-orders",a),Z()},Y=async()=>{await p.patch(`/api/receiving-orders/${t.value.id}`,t.value),R()},Z=()=>{t.value={branchId:t.value.branchId,inventoryId:t.value.inventoryId},l.value=[],V()},R=()=>{F("close"),T.back()};return(a,o)=>{const h=B("tip"),N=B("maska");return n(),ae(le,{"modal-class":"!w-[90rem]"},{header:U(()=>[D(S($.value===m(k).Create?"Create New Receiving Order":"Edit Receiving Order"),1)]),body:U(()=>[e("form",{id:"form",onSubmit:oe(K,["prevent","stop"]),class:"grid grid-cols-2 gap-4"},[m(f).length>1?(n(),d("div",{key:0,class:i(["relative",{"col-span-2":A.value.length===1}])},[_(he,{modelValue:t.value.branchId,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.branchId=s),error:l.value.branchId,onSelect:W},null,8,["modelValue","error"])],2)):C("",!0),e("div",{class:i(["relative",{"col-span-2":m(f).length===1}])},[_(ve,{modelValue:t.value.inventoryId,"onUpdate:modelValue":o[1]||(o[1]=s=>t.value.inventoryId=s),branchId:t.value.branchId,error:l.value.inventoryId},null,8,["modelValue","branchId","error"])],2),e("div",_e,[_(m(z),{modelValue:t.value.supplierId,"onUpdate:modelValue":o[2]||(o[2]=s=>t.value.supplierId=s),options:O.value,searchable:!0,"value-prop":"id","track-by":"name",label:"name","create-option":m(L)("Supplier.createViaSelect"),"on-create":({name:s})=>j(s),class:i(["input peer",{"border-red-500":l.value.hasOwnProperty("supplierId")}])},null,8,["modelValue","options","create-option","on-create","class"]),e("label",{class:i(["label",{"text-red-500":l.value.hasOwnProperty("supplierId")}])},"Supplier",2),l.value.hasOwnProperty("supplierId")?(n(),d("p",be,S(l.value.supplierId[0]),1)):C("",!0)]),e("div",ye,[c(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>t.value.notes=s),class:"input peer"},null,512),[[b,t.value.notes]]),fe]),e("section",ge,[l.value.hasOwnProperty("receivingOrderItems")?(n(),d("p",we,"Select at least one product to continue.")):C("",!0),e("table",Ie,[e("thead",null,[e("tr",xe,[Ve,Ue,ke,Oe,$e,Se,e("th",Ce,[c((n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"mx-auto h-6 w-6 cursor-pointer text-white",onClick:P},Re)),[[h,"Add Row"]])])])]),e("tbody",null,[(n(!0),d(q,null,M(t.value.receivingOrderItems,(s,v)=>(n(),d("tr",Ne,[e("td",Be,[_(m(z),{modelValue:s.productId,"onUpdate:modelValue":r=>s.productId=r,options:g.value,onSelect:r=>G(s),searchable:!0,"value-prop":"id","track-by":"name",label:"name","can-clear":!1,"can-deselect":!1,class:"input-sm"},null,8,["modelValue","onUpdate:modelValue","options","onSelect"])]),e("td",De,[e("div",Me,[c(e("input",{"data-maska":"0.0","data-maska-tokens":"0:[0-9]:multiple","onUpdate:modelValue":r=>s.quantity=r,class:i(["input-sm !rounded-e-none",{"border-red-500":l.value.hasOwnProperty(`receivingOrderItems.${v}.quantity`)}])},null,10,qe),[[N],[b,s.quantity]]),c(e("select",{"onUpdate:modelValue":r=>s.productUnitId=r,class:i(["input-sm w-40 border-s-0 !rounded-s-none focus:!border-s-2",{"border-red-500":l.value.hasOwnProperty(`receivingOrderItems.${v}.productUnitId`)}])},[(n(!0),d(q,null,M(g.value.find(r=>r.id===s.productId)?.units,r=>(n(),d("option",{value:r.id},S(r.name),9,Ee))),256))],10,ze),[[ie,s.productUnitId]])])]),e("td",Fe,[_(me,{modelValue:s.price,"onUpdate:modelValue":r=>s.price=r,class:i(["input-sm",{"border-red-500":l.value.hasOwnProperty(`receivingOrderItems.${v}.price`)}])},null,8,["modelValue","onUpdate:modelValue","class"])]),e("td",Le,[c(e("input",{"onUpdate:modelValue":r=>s.batchNumber=r,class:i(["input-sm",{"border-red-500":l.value.hasOwnProperty(`receivingOrderItems.${v}.batchNumber`)}])},null,10,Te),[[b,s.batchNumber]])]),e("td",Ae,[c(e("input",{"onUpdate:modelValue":r=>s.expiryDate=r,"data-maska":"####-##-##",class:i(["input-sm peer",{"border-red-500":l.value.hasOwnProperty(`receivingOrderItems.${v}.expiryDate`)}])},null,10,He),[[b,s.expiryDate],[N]])]),e("td",Qe,[c(e("input",{"onUpdate:modelValue":r=>s.notes=r,class:"input-sm"},null,8,je),[[b,s.notes]])]),e("td",We,[e("div",Ge,[c((n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-6 w-6 cursor-pointer text-red-500",onClick:r=>J(v)},Xe,8,Je)),[[h,"Remove"]])])])]))),256))])])])],32)]),footer:U(()=>[e("button",{class:"me-2 btn-blue",disabled:w.value,form:"form"},[_(re,{"is-loading":w.value},{default:U(()=>[D("Save")]),_:1},8,["is-loading"])],8,Ye),e("button",{onClick:R,class:"btn-gray"},"Cancel")]),_:1})}}});export{lt as default};
