import{d as Y,e as r,y as Z,x as ee,a2 as U,a5 as B,a8 as V,s as te,o as i,R as se,w as y,k as N,t as o,g as n,b as a,h as I,V as ae,n as P,c,a1 as M,F as T,i as x,a as z,f as h,_ as le,a4 as oe,p as u,j as A,Q as ne,$ as ie}from"./main-BgbWFIXK.js";import{u as re}from"./printTemplateManager-qiRkbBE7.js";import{O as F}from"./orderStatus-Cdywi7Or.js";import{b as ce}from"./toggle-CP_W0i88.js";import{u as de,P as O}from"./printService-BW6jBw-w.js";var L=(f=>(f.Print="print",f.Send="send",f))(L||{});const ue={class:"mb-3 grid grid-cols-4 gap-3"},pe={class:"relative col-span-3"},me=["value"],ve={key:0,class:"text-sm text-red-500"},he={class:"relative"},fe={class:"label"},be=a("hr",{class:"mt-2"},null,-1),_e={class:"overflow-auto py-1 max-h-[30rem]"},ge={class:"select-none"},Se={class:"flex items-center text-xl font-bold"},ye=["onUpdate:modelValue","onChange"],xe={class:"ms-1"},ke={class:"border-gray-200 border-s-2 ps-5"},we=["onUpdate:modelValue","disabled"],Ce={class:"ms-1"},De={key:0,class:"inline-block ms-2"},Ve={key:0,class:"mt-3 rounded border-red-500 bg-red-50 p-2 text-red-500 border-s-4"},Ie=["disabled"],$e=Y({__name:"ResultsReleaseModal",emits:["close"],setup(f,{emit:W}){const j=W,b=r(!1),k=r(!1),w=r(localStorage.getItem("printWithDesign")!=="no"),_=r(),p=r({}),m=r([]),g=r([]),q=Z(()=>m.value.filter(e=>e.isSelected)),{resultsTemplates:Q,defaultResultTemplate:G}=re(),S=r(null),d=r({}),H=de();ee(()=>{U.on(B.Show,({visit:e,orders:t,releaseType:s})=>{k.value=!0,_.value=s,p.value=V.cloneDeep(e),m.value=V.cloneDeep(t),g.value=V.uniqBy(m.value.flatMap(l=>l.test.department),"id"),S.value=G(p.value.branchId)?.id,$(),E()})}),te(()=>U.off(B.Show));const v=e=>[F.Authorized,F.Released].includes(e.status)&&e.test.isPrintable,C=e=>m.value.filter(t=>t.test.department.id===e.id),J=e=>{e.isSelected?C(e).filter(t=>v(t)).forEach(t=>t.isSelected=!0):C(e).forEach(t=>t.isSelected=!1)},E=()=>{g.value.forEach(e=>e.isSelected=!0),m.value.filter(e=>v(e)).forEach(e=>e.isSelected=!0)},$=()=>{g.value.forEach(e=>e.isSelected=!1),m.value.forEach(e=>e.isSelected=!1)},K=e=>{localStorage.setItem("printWithDesign",e?"yes":"no")},D=async e=>{b.value=!0;const t=q.value.map(l=>l.id),s={visitId:p.value.id,ordersIds:t,templateId:S.value,withDesign:w.value};try{_.value===L.Print?await H.results(s,e,`${p.value.patient.name}-results`):await ne.post("/api/results/send",s),ie.fire(),d.value={},R()}catch(l){d.value=l.response.data.errors??{}}b.value=!1},R=()=>{k.value=!1,d.value={},j("close")};return(e,t)=>k.value?(i(),se(oe,{key:0},{header:y(()=>[N(o(n(u)(":releaseType Results of :patientName",{releaseType:n(u)(_.value),patientName:p.value.patient.name})),1)]),body:y(()=>[a("form",{id:"form",onSubmit:t[2]||(t[2]=h(s=>D(n(O).Direct),["prevent","stop"]))},[a("div",ue,[a("div",pe,[I(a("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>S.value=s),class:P(["input peer",{"border-red-500":d.value.hasOwnProperty("templateId")}])},[(i(!0),c(T,null,M(n(Q)(p.value.branchId),s=>(i(),c("option",{value:s.id},o(s.name),9,me))),256))],2),[[ae,S.value]]),a("label",{class:P(["label",{"text-red-500":d.value.hasOwnProperty("templateId")}])},o(n(u)("Template")),3),d.value.hasOwnProperty("templateId")?(i(),c("p",ve,o(d.value.templateId[0]),1)):x("",!0)]),a("div",he,[z(n(ce),{modelValue:w.value,"onUpdate:modelValue":t[1]||(t[1]=s=>w.value=s),onChange:K,class:"input peer pt-2.5"},null,8,["modelValue"]),a("label",fe,o(n(u)("With Design")),1)])]),a("div",null,[a("button",{class:"text-sm me-2 btn-blue",onClick:h(E,["prevent"])},o(n(u)("Select All")),1),a("button",{class:"text-sm btn-gray",onClick:h($,["prevent"])},o(n(u)("Clear")),1)]),be,a("div",_e,[(i(!0),c(T,null,M(g.value,s=>(i(),c("div",ge,[a("label",Se,[I(a("input",{type:"checkbox","onUpdate:modelValue":l=>s.isSelected=l,onChange:l=>J(s),class:"h-4 w-4 rounded checked:accent-blue-500"},null,40,ye),[[A,s.isSelected]]),a("span",xe,o(s.name),1)]),a("div",ke,[(i(!0),c(T,null,M(C(s),l=>(i(),c("label",{class:P(["flex items-center",{"text-gray-400":!v(l)}])},[I(a("input",{type:"checkbox","onUpdate:modelValue":X=>l.isSelected=X,disabled:!v(l),class:"h-4 w-4 rounded checked:accent-blue-500"},null,8,we),[[A,l.isSelected]]),a("span",Ce,o(l.test.shortForm),1),v(l)?x("",!0):(i(),c("span",De," ("+o(l.status.capitalize())+" "+o(l.test.bypass?"-bypass":"")+" "+o(l.test.isPrintable?"":"-disabled")+") ",1))],2))),256))])]))),256))]),d.value.hasOwnProperty("orders")?(i(),c("p",Ve,"Select at least one order to continue.")):x("",!0)],32)]),footer:y(()=>[a("button",{class:"me-2 btn-blue",disabled:b.value,form:"form",onClick:[t[3]||(t[3]=h(s=>D(n(O).Modal),["ctrl"])),t[4]||(t[4]=h(s=>D(n(O).Download),["shift"]))]},[z(le,{"is-loading":b.value},{default:y(()=>[N(o(n(u)(_.value.capitalize())),1)]),_:1},8,["is-loading"])],8,Ie),a("button",{onClick:R,class:"btn-gray"},o(n(u)("Cancel")),1)]),_:1})):x("",!0)}});export{L as R,$e as _};
