import{d as L,e as p,u as Q,x as W,Q as b,U as q,o as u,R as M,w as k,k as N,t as c,g as i,b as a,c as m,a as v,n as r,i as d,h,v as y,f as G,_ as H,a4 as J,m as K,l as X,$ as Y}from"./main-DmoZ1fz4.js";import{s as D}from"./multiselect-DAhRltj6.js";import{b as R}from"./toggle-DyRQkDOQ.js";import{F as w}from"./formMode-Bz--3d4P.js";const Z={key:0,class:"relative col-span-2"},ee={key:0,class:"text-sm text-red-500"},ae={class:"relative"},se={key:0,class:"text-sm text-red-500"},te={class:"relative"},le={key:0,class:"text-sm text-red-500"},re={class:"relative"},oe={key:0,class:"text-sm text-red-500"},ne={class:"relative"},ue={key:0,class:"text-sm text-red-500"},ie={class:"relative"},de=a("label",{class:"label"},"Partner",-1),ce={class:"relative"},me=a("label",{class:"label"},"Signature",-1),pe={class:"relative"},ve=a("label",{class:"label"},"View Dep.",-1),be={class:"relative"},he=a("label",{class:"label"},"Auth Dep.",-1),ye={class:"relative"},we={class:"flex"},_e=a("span",{class:"border-2 border-gray-300 bg-gray-100 px-5 py-2 rounded-e border-s-0"},"%",-1),xe={key:0,class:"text-sm text-red-500"},fe={class:"relative"},Pe={class:"flex"},ge=a("span",{class:"border-2 border-gray-300 bg-gray-100 px-5 py-2 rounded-e border-s-0"},"%",-1),Ve={key:0,class:"text-sm text-red-500"},ke=["disabled"],Me=L({__name:"UserForm",emits:["close"],setup(De,{emit:$}){const S=$,U=K(),j=X(),e=p({}),O=p([]),_=Q().user.branches,x=p([]),f=p(w.Create),P=p(!1),t=p({});W(async()=>{_.length===1&&(e.value={branches:[_[0]]},g(),V()),U.path.endsWith("/edit")&&(f.value=w.Edit,await A(U.params.id))});const A=async o=>{const{data:s}=await b.get(`/api/users/${o}`);e.value=s.data,g(),V()},g=async()=>{const o=e.value.branches.flatMap(n=>n.id),{data:s}=await b.get(`/api/roles/list?branchId=${o.join(",")}`);O.value=s.data},V=async()=>{const o=e.value.branches.flatMap(n=>n.id),{data:s}=await b.get(`/api/departments/list?branchId=${o.join(",")}`);x.value=s.data},C=async()=>{O.value=[],x.value=[],e.value.roles=[],e.value.viewableDepartments=[],e.value.authorizableDepartments=[],V(),g()},I=o=>{const s=o.target.files[0],n=new FileReader;n.readAsDataURL(s),n.onload=()=>e.value.signature=n.result},B=async()=>{P.value=!0;try{f.value===w.Create?await z():await E(),t.value={},Y.fire()}catch(o){t.value=o.response.data.errors??{}}P.value=!1},z=async()=>{await b.post("/api/users",e.value),T()},E=async()=>{await b.patch(`/api/users/${e.value.id}`,e.value),F()},T=()=>{e.value={branches:e.value.branches},t.value=[]},F=()=>{S("close"),j.back()};return(o,s)=>{const n=q("maska");return u(),M(J,{"modal-class":"!w-[60rem]"},{header:k(()=>[N(c(f.value===i(w).Create?"Create New User":"Edit User"),1)]),body:k(()=>[a("form",{id:"form",onSubmit:G(B,["prevent","stop"]),class:"grid grid-cols-2 gap-4"},[i(_).length>1?(u(),m("div",Z,[v(i(D),{modelValue:e.value.branches,"onUpdate:modelValue":s[0]||(s[0]=l=>e.value.branches=l),mode:"tags",options:i(_),searchable:!0,object:!0,"value-prop":"id","track-by":"searchableForm",label:"name",onSelect:s[1]||(s[1]=l=>{g(),V()}),onDeselect:C,onClear:C,class:r(["px-0 input peer",{"border-red-500":t.value.hasOwnProperty("branches")}])},null,8,["modelValue","options","class"]),a("label",{class:r(["label",{"text-red-500":t.value.hasOwnProperty("branches")}])},"Branches",2),t.value.hasOwnProperty("branches")?(u(),m("p",ee,c(t.value.branches[0]),1)):d("",!0)])):d("",!0),a("div",ae,[h(a("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>e.value.name=l),class:r(["input peer",{"border-red-500":t.value.hasOwnProperty("name")}])},null,2),[[y,e.value.name]]),a("label",{class:r(["label",{"text-red-500":t.value.hasOwnProperty("name")}])},"Name",2),t.value.hasOwnProperty("name")?(u(),m("p",se,c(t.value.name[0]),1)):d("",!0)]),a("div",te,[h(a("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>e.value.username=l),class:r(["input peer",{"border-red-500":t.value.hasOwnProperty("username")}])},null,2),[[y,e.value.username]]),a("label",{class:r(["label",{"text-red-500":t.value.hasOwnProperty("username")}])},"Username",2),t.value.hasOwnProperty("username")?(u(),m("p",le,c(t.value.username[0]),1)):d("",!0)]),a("div",re,[h(a("input",{type:"password","onUpdate:modelValue":s[4]||(s[4]=l=>e.value.password=l),class:r(["input peer",{"border-red-500":t.value.hasOwnProperty("password")}])},null,2),[[y,e.value.password]]),a("label",{class:r(["label",{"text-red-500":t.value.hasOwnProperty("password")}])},"Password",2),t.value.hasOwnProperty("password")?(u(),m("p",oe,c(t.value.password[0]),1)):d("",!0)]),a("div",ne,[v(i(D),{modelValue:e.value.roles,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value.roles=l),mode:"tags",options:O.value,searchable:!0,object:!0,"value-prop":"name",label:"displayName","track-by":"displayName",class:r(["px-0 input peer",{"border-red-500":t.value.hasOwnProperty("roles")}])},null,8,["modelValue","options","class"]),a("label",{class:r(["label",{"text-red-500":t.value.hasOwnProperty("roles")}])},"Roles",2),t.value.hasOwnProperty("roles")?(u(),m("p",ue,c(t.value.roles[0]),1)):d("",!0)]),a("div",ie,[v(i(R),{modelValue:e.value.isPartner,"onUpdate:modelValue":s[6]||(s[6]=l=>e.value.isPartner=l),class:"input peer pt-2.5"},null,8,["modelValue"]),de]),a("div",ce,[a("input",{type:"file",onChange:I,accept:"image/*",class:"file peer"},null,32),me]),a("div",pe,[v(i(D),{modelValue:e.value.viewableDepartments,"onUpdate:modelValue":s[7]||(s[7]=l=>e.value.viewableDepartments=l),mode:"tags",options:x.value,searchable:!0,object:!0,"value-prop":"id","track-by":"searchableForm",label:"name",class:"px-0 input peer"},null,8,["modelValue","options"]),ve]),a("div",be,[v(i(D),{modelValue:e.value.authorizableDepartments,"onUpdate:modelValue":s[8]||(s[8]=l=>e.value.authorizableDepartments=l),mode:"tags",options:x.value,searchable:!0,object:!0,"value-prop":"id","track-by":"searchableForm",label:"name",class:"px-0 input peer"},null,8,["modelValue","options"]),he]),a("div",ye,[a("div",we,[h(a("input",{"onUpdate:modelValue":s[9]||(s[9]=l=>e.value.minimumPayment=l),"data-maska":"###",class:r(["input peer !rounded-e-none",{"border-red-500":t.value.hasOwnProperty("minimumPayment")}])},null,2),[[y,e.value.minimumPayment],[n]]),a("label",{class:r(["label",{"text-red-500":t.value.hasOwnProperty("minimumPayment")}])},"Min Payment",2),_e]),t.value.hasOwnProperty("minimumPayment")?(u(),m("p",xe,c(t.value.minimumPayment[0]),1)):d("",!0)]),a("div",fe,[a("div",Pe,[h(a("input",{"onUpdate:modelValue":s[10]||(s[10]=l=>e.value.maximumDiscount=l),"data-maska":"###",class:r(["input peer !rounded-e-none",{"border-red-500":t.value.hasOwnProperty("maximumDiscount")}])},null,2),[[y,e.value.maximumDiscount],[n]]),a("label",{class:r(["label",{"text-red-500":t.value.hasOwnProperty("maximumDiscount")}])},"Max Discount",2),ge]),t.value.hasOwnProperty("maximumDiscount")?(u(),m("p",Ve,c(t.value.maximumDiscount[0]),1)):d("",!0)])],32)]),footer:k(()=>[a("button",{class:"me-2 btn-blue",disabled:P.value,form:"form"},[v(H,{"is-loading":P.value},{default:k(()=>[N("Save")]),_:1},8,["is-loading"])],8,ke),a("button",{onClick:F,class:"btn-gray"},"Cancel"),f.value===i(w).Edit?(u(),M(i(R),{key:0,modelValue:e.value.isActive,"onUpdate:modelValue":s[11]||(s[11]=l=>e.value.isActive=l),class:"toggle:off:red ms-auto"},null,8,["modelValue"])):d("",!0)]),_:1})}}});export{Me as default};
