import{aI as C,aq as T,aJ as D,e as P,Q as w}from"./main-DNdNUUJ7.js";const B=()=>{const h=C();return{getDefaultTemplate:(d,n)=>h.data.find(r=>r.branchId===n&&r.type===d&&r.isDefault),getPrintTemplates:(d,n)=>h.data.filter(r=>r.branchId===n&&r.type===d)}};var j=(h=>(h.Direct="direct",h.Modal="modal",h.Download="download",h))(j||{}),S={exports:{}};(function(h,v){(function(d,n){h.exports=n()})(window,function(){return function(m){var d={};function n(r){if(d[r])return d[r].exports;var c=d[r]={i:r,l:!1,exports:{}};return m[r].call(c.exports,c,c.exports,n),c.l=!0,c.exports}return n.m=m,n.c=d,n.d=function(r,c,f){n.o(r,c)||Object.defineProperty(r,c,{enumerable:!0,get:f})},n.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n.t=function(r,c){if(c&1&&(r=n(r)),c&8||c&4&&typeof r=="object"&&r&&r.__esModule)return r;var f=Object.create(null);if(n.r(f),Object.defineProperty(f,"default",{enumerable:!0,value:r}),c&2&&typeof r!="string")for(var y in r)n.d(f,y,function(l){return r[l]}.bind(null,y));return f},n.n=function(r){var c=r&&r.__esModule?function(){return r.default}:function(){return r};return n.d(c,"a",c),c},n.o=function(r,c){return Object.prototype.hasOwnProperty.call(r,c)},n.p="",n(n.s=0)}({"./src/index.js":function(m,d,n){n.r(d),n("./src/sass/index.scss");var r=n("./src/js/init.js"),c=r.default.init;typeof window<"u"&&(window.printJS=c),d.default=c},"./src/js/browser.js":function(m,d,n){n.r(d);var r={isFirefox:function(){return typeof InstallTrigger<"u"},isIE:function(){return navigator.userAgent.indexOf("MSIE")!==-1||!!document.documentMode},isEdge:function(){return!r.isIE()&&!!window.StyleMedia},isChrome:function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window;return!!f.chrome},isSafari:function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0||navigator.userAgent.toLowerCase().indexOf("safari")!==-1},isIOSChrome:function(){return navigator.userAgent.toLowerCase().indexOf("crios")!==-1}};d.default=r},"./src/js/functions.js":function(m,d,n){n.r(d),n.d(d,"addWrapper",function(){return y}),n.d(d,"capitalizePrint",function(){return l}),n.d(d,"collectStyles",function(){return a}),n.d(d,"addHeader",function(){return e}),n.d(d,"cleanUp",function(){return p}),n.d(d,"isRawHTML",function(){return s});var r=n("./src/js/modal.js"),c=n("./src/js/browser.js");function f(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f=function(u){return typeof u}:f=function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},f(t)}function y(t,o){var u="font-family:"+o.font+" !important; font-size: "+o.font_size+" !important; width:100%;";return'<div style="'+u+'">'+t+"</div>"}function l(t){return t.charAt(0).toUpperCase()+t.slice(1)}function a(t,o){for(var u=document.defaultView||window,E="",b=u.getComputedStyle(t,""),g=0;g<b.length;g++)(o.targetStyles.indexOf("*")!==-1||o.targetStyle.indexOf(b[g])!==-1||i(o.targetStyles,b[g]))&&b.getPropertyValue(b[g])&&(E+=b[g]+":"+b.getPropertyValue(b[g])+";");return E+="max-width: "+o.maxWidth+"px !important; font-size: "+o.font_size+" !important;",E}function i(t,o){for(var u=0;u<t.length;u++)if(f(o)==="object"&&o.indexOf(t[u])!==-1)return!0;return!1}function e(t,o){var u=document.createElement("div");if(s(o.header))u.innerHTML=o.header;else{var E=document.createElement("h1"),b=document.createTextNode(o.header);E.appendChild(b),E.setAttribute("style",o.headerStyle),u.appendChild(E)}t.insertBefore(u,t.childNodes[0])}function p(t){t.showModal&&r.default.close(),t.onLoadingEnd&&t.onLoadingEnd(),(t.showModal||t.onLoadingStart)&&window.URL.revokeObjectURL(t.printable);var o="mouseover";(c.default.isChrome()||c.default.isFirefox())&&(o="focus");var u=function E(){window.removeEventListener(o,E),t.onPrintDialogClose();var b=document.getElementById(t.frameId);b&&b.remove()};window.addEventListener(o,u)}function s(t){var o=new RegExp("<([A-Za-z][A-Za-z0-9]*)\\b[^>]*>(.*?)</\\1>");return o.test(t)}},"./src/js/html.js":function(m,d,n){n.r(d);var r=n("./src/js/functions.js"),c=n("./src/js/print.js");function f(a){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f=function(e){return typeof e}:f=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(a)}d.default={print:function(i,e){var p=l(i.printable)?i.printable:document.getElementById(i.printable);if(!p){window.console.error("Invalid HTML element id: "+i.printable);return}i.printableElement=y(p,i),i.header&&Object(r.addHeader)(i.printableElement,i),c.default.send(i,e)}};function y(a,i){for(var e=a.cloneNode(),p=Array.prototype.slice.call(a.childNodes),s=0;s<p.length;s++)if(i.ignoreElements.indexOf(p[s].id)===-1){var t=y(p[s],i);e.appendChild(t)}switch(i.scanStyles&&a.nodeType===1&&e.setAttribute("style",Object(r.collectStyles)(a,i)),a.tagName){case"SELECT":e.value=a.value;break;case"CANVAS":e.getContext("2d").drawImage(a,0,0);break}return e}function l(a){return f(a)==="object"&&a&&(a instanceof HTMLElement||a.nodeType===1)}},"./src/js/image.js":function(m,d,n){n.r(d);var r=n("./src/js/functions.js"),c=n("./src/js/print.js"),f=n("./src/js/browser.js");d.default={print:function(l,a){l.printable.constructor!==Array&&(l.printable=[l.printable]),l.printableElement=document.createElement("div"),l.printable.forEach(function(i){var e=document.createElement("img");if(e.setAttribute("style",l.imageStyle),e.src=i,f.default.isFirefox()){var p=e.src;e.src=p}var s=document.createElement("div");s.appendChild(e),l.printableElement.appendChild(s)}),l.header&&Object(r.addHeader)(l.printableElement,l),c.default.send(l,a)}}},"./src/js/init.js":function(m,d,n){n.r(d);var r=n("./src/js/browser.js"),c=n("./src/js/modal.js"),f=n("./src/js/pdf.js"),y=n("./src/js/html.js"),l=n("./src/js/raw-html.js"),a=n("./src/js/image.js"),i=n("./src/js/json.js");function e(s){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?e=function(o){return typeof o}:e=function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},e(s)}var p=["pdf","html","image","json","raw-html"];d.default={init:function(){var t={printable:null,fallbackPrintable:null,type:"pdf",header:null,headerStyle:"font-weight: 300;",maxWidth:800,properties:null,gridHeaderStyle:"font-weight: bold; padding: 5px; border: 1px solid #dddddd;",gridStyle:"border: 1px solid lightgray; margin-bottom: -1px;",showModal:!1,onError:function(O){throw O},onLoadingStart:null,onLoadingEnd:null,onPrintDialogClose:function(){},onIncompatibleBrowser:function(){},modalMessage:"Retrieving Document...",frameId:"printJS",printableElement:null,documentTitle:"Document",targetStyle:["clear","display","width","min-width","height","min-height","max-height"],targetStyles:["border","box","break","text-decoration"],ignoreElements:[],repeatTableHeader:!0,css:null,style:null,scanStyles:!0,base64:!1,onPdfOpen:null,font:"TimesNewRoman",font_size:"12pt",honorMarginPadding:!0,honorColor:!1,imageStyle:"max-width: 100%;"},o=arguments[0];if(o===void 0)throw new Error("printJS expects at least 1 attribute.");switch(e(o)){case"string":t.printable=encodeURI(o),t.fallbackPrintable=t.printable,t.type=arguments[1]||t.type;break;case"object":t.printable=o.printable,t.fallbackPrintable=typeof o.fallbackPrintable<"u"?o.fallbackPrintable:t.printable,t.fallbackPrintable=t.base64?"data:application/pdf;base64,".concat(t.fallbackPrintable):t.fallbackPrintable;for(var u in t)u==="printable"||u==="fallbackPrintable"||(t[u]=typeof o[u]<"u"?o[u]:t[u]);break;default:throw new Error('Unexpected argument type! Expected "string" or "object", got '+e(o))}if(!t.printable)throw new Error("Missing printable information.");if(!t.type||typeof t.type!="string"||p.indexOf(t.type.toLowerCase())===-1)throw new Error("Invalid print type. Available types are: pdf, html, image and json.");t.showModal&&c.default.show(t),t.onLoadingStart&&t.onLoadingStart();var E=document.getElementById(t.frameId);E&&E.parentNode.removeChild(E);var b=document.createElement("iframe");switch(r.default.isFirefox()?b.setAttribute("style","width: 1px; height: 100px; position: fixed; left: 0; top: 0; opacity: 0; border-width: 0; margin: 0; padding: 0"):b.setAttribute("style","visibility: hidden; height: 0; width: 0; position: absolute; border: 0"),b.setAttribute("id",t.frameId),t.type!=="pdf"&&(b.srcdoc="<html><head><title>"+t.documentTitle+"</title>",t.css&&(Array.isArray(t.css)||(t.css=[t.css]),t.css.forEach(function(M){b.srcdoc+='<link rel="stylesheet" href="'+M+'">'})),b.srcdoc+="</head><body></body></html>"),t.type){case"pdf":if(r.default.isIE())try{console.info("Print.js doesn't support PDF printing in Internet Explorer.");var g=window.open(t.fallbackPrintable,"_blank");g.focus(),t.onIncompatibleBrowser()}catch(M){t.onError(M)}finally{t.showModal&&c.default.close(),t.onLoadingEnd&&t.onLoadingEnd()}else f.default.print(t,b);break;case"image":a.default.print(t,b);break;case"html":y.default.print(t,b);break;case"raw-html":l.default.print(t,b);break;case"json":i.default.print(t,b);break}}}},"./src/js/json.js":function(m,d,n){n.r(d);var r=n("./src/js/functions.js"),c=n("./src/js/print.js");function f(l){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?f=function(i){return typeof i}:f=function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},f(l)}d.default={print:function(a,i){if(f(a.printable)!=="object")throw new Error("Invalid javascript data object (JSON).");if(typeof a.repeatTableHeader!="boolean")throw new Error("Invalid value for repeatTableHeader attribute (JSON).");if(!a.properties||!Array.isArray(a.properties))throw new Error("Invalid properties array for your JSON data.");a.properties=a.properties.map(function(e){return{field:f(e)==="object"?e.field:e,displayName:f(e)==="object"?e.displayName:e,columnSize:f(e)==="object"&&e.columnSize?e.columnSize+";":100/a.properties.length+"%;"}}),a.printableElement=document.createElement("div"),a.header&&Object(r.addHeader)(a.printableElement,a),a.printableElement.innerHTML+=y(a),c.default.send(a,i)}};function y(l){var a=l.printable,i=l.properties,e='<table style="border-collapse: collapse; width: 100%;">';l.repeatTableHeader&&(e+="<thead>"),e+="<tr>";for(var p=0;p<i.length;p++)e+='<th style="width:'+i[p].columnSize+";"+l.gridHeaderStyle+'">'+Object(r.capitalizePrint)(i[p].displayName)+"</th>";e+="</tr>",l.repeatTableHeader&&(e+="</thead>"),e+="<tbody>";for(var s=0;s<a.length;s++){e+="<tr>";for(var t=0;t<i.length;t++){var o=a[s],u=i[t].field.split(".");if(u.length>1)for(var E=0;E<u.length;E++)o=o[u[E]];else o=o[i[t].field];e+='<td style="width:'+i[t].columnSize+l.gridStyle+'">'+o+"</td>"}e+="</tr>"}return e+="</tbody></table>",e}},"./src/js/modal.js":function(m,d,n){n.r(d);var r={show:function(f){var y="font-family:sans-serif; display:table; text-align:center; font-weight:300; font-size:30px; left:0; top:0;position:fixed; z-index: 9990;color: #0460B5; width: 100%; height: 100%; background-color:rgba(255,255,255,.9);transition: opacity .3s ease;",l=document.createElement("div");l.setAttribute("style",y),l.setAttribute("id","printJS-Modal");var a=document.createElement("div");a.setAttribute("style","display:table-cell; vertical-align:middle; padding-bottom:100px;");var i=document.createElement("div");i.setAttribute("class","printClose"),i.setAttribute("id","printClose"),a.appendChild(i);var e=document.createElement("span");e.setAttribute("class","printSpinner"),a.appendChild(e);var p=document.createTextNode(f.modalMessage);a.appendChild(p),l.appendChild(a),document.getElementsByTagName("body")[0].appendChild(l),document.getElementById("printClose").addEventListener("click",function(){r.close()})},close:function(){var f=document.getElementById("printJS-Modal");f&&f.parentNode.removeChild(f)}};d.default=r},"./src/js/pdf.js":function(m,d,n){n.r(d);var r=n("./src/js/print.js"),c=n("./src/js/functions.js");d.default={print:function(l,a){if(l.base64){var i=Uint8Array.from(atob(l.printable),function(p){return p.charCodeAt(0)});f(l,a,i);return}l.printable=/^(blob|http|\/\/)/i.test(l.printable)?l.printable:window.location.origin+(l.printable.charAt(0)!=="/"?"/"+l.printable:l.printable);var e=new window.XMLHttpRequest;e.responseType="arraybuffer",e.addEventListener("error",function(){Object(c.cleanUp)(l),l.onError(e.statusText,e)}),e.addEventListener("load",function(){if([200,201].indexOf(e.status)===-1){Object(c.cleanUp)(l),l.onError(e.statusText,e);return}f(l,a,e.response)}),e.open("GET",l.printable,!0),e.send()}};function f(y,l,a){var i=new window.Blob([a],{type:"application/pdf"});i=window.URL.createObjectURL(i),l.setAttribute("src",i),r.default.send(y,l)}},"./src/js/print.js":function(m,d,n){n.r(d);var r=n("./src/js/browser.js"),c=n("./src/js/functions.js"),f={send:function(e,p){document.getElementsByTagName("body")[0].appendChild(p);var s=document.getElementById(e.frameId);s.onload=function(){if(e.type==="pdf"){r.default.isFirefox()?setTimeout(function(){return y(s,e)},1e3):y(s,e);return}var t=s.contentWindow||s.contentDocument;if(t.document&&(t=t.document),t.body.appendChild(e.printableElement),e.type!=="pdf"&&e.style){var o=document.createElement("style");o.innerHTML=e.style,t.head.appendChild(o)}var u=t.getElementsByTagName("img");u.length>0?l(Array.from(u)).then(function(){return y(s,e)}):y(s,e)}}};function y(i,e){try{if(i.focus(),r.default.isEdge()||r.default.isIE())try{i.contentWindow.document.execCommand("print",!1,null)}catch{i.contentWindow.print()}else i.contentWindow.print()}catch(p){e.onError(p)}finally{r.default.isFirefox()&&(i.style.visibility="hidden",i.style.left="-1px"),Object(c.cleanUp)(e)}}function l(i){var e=i.map(function(p){if(p.src&&p.src!==window.location.href)return a(p)});return Promise.all(e)}function a(i){return new Promise(function(e){var p=function s(){!i||typeof i.naturalWidth>"u"||i.naturalWidth===0||!i.complete?setTimeout(s,500):e()};p()})}d.default=f},"./src/js/raw-html.js":function(m,d,n){n.r(d);var r=n("./src/js/print.js");d.default={print:function(f,y){f.printableElement=document.createElement("div"),f.printableElement.setAttribute("style","width:100%"),f.printableElement.innerHTML=f.printable,r.default.send(f,y)}}},"./src/sass/index.scss":function(m,d,n){},0:function(m,d,n){m.exports=n("./src/index.js")}}).default})})(S);var A=S.exports;const I=T(A),L=D("websocketPrint",()=>{const h=P(),v=P(!1),m=P(1),d=l=>{},n=()=>{v.value=!0,m.value=1},r=()=>{v.value=!1,m.value&&f()},c=()=>{h.value=new WebSocket("ws://127.0.0.1:12212/printer"),h.value.onopen=n,h.value.onclose=r,h.value.onmessage=d},f=()=>{m.value-=1,c()},y=l=>{Array.isArray(l)?l.forEach(function(a){h.value.send(JSON.stringify(a))}):h.value.send(JSON.stringify(l))};return c(),{isConnected:v,submit:y}}),R=()=>{const h=L(),v=P(!1),m={printMode:j.Modal,printer:"general",fileName:"general.pdf"},d=s=>s.ctrlKey?j.Modal:s.shiftKey?j.Download:j.Direct,n=async(s,t)=>{const{data:o}=await w.post("/api/visits/print-barcode",{visitId:s});e(o,t)},r=async(s,t,o)=>{const u={type:t};Array.isArray(s)?u.ordersIds=s:u.visitId=s;const{data:E}=await w.post("/api/samples/print",u);e(E,o)},c=async(s,t)=>{const{data:o}=await w.post("/api/invoices/print",{invoiceId:s});e(o,t)},f=async(s,t)=>{const{data:o}=await w.post("/api/results/print",s);e(o,t)},y=async(s,t)=>{const{data:o}=await w.post(`/api/premarital/results/${s}/print`);e(o,t)},l=async(s,t)=>{const{data:o}=await w.post(`/api/premarital/referrals/${s}/print`);e(o,t)},a=async(s,t)=>{const{data:o}=await w.post("/api/purchase-orders/print",{purchaseOrderId:s});e(o,t)},i=async(s,t)=>{const{data:o}=await w.post("/api/receiving-orders/print",{receivingOrderId:s});e(o,t)},e=async(s,t=m)=>{if(h.isConnected&&t.printMode===j.Direct)h.submit({type:t.printer,url:`${t.fileName}.pdf`,file_content:s});else if(t.printMode===j.Download)p(s,t.fileName);else{for(;v.value;)await new Promise(o=>setTimeout(o,500));v.value=!0,I({printable:s,type:"pdf",base64:!0,onPrintDialogClose:()=>v.value=!1})}},p=(s,t)=>{const o=`data:application/pdf;base64,${s}`,u=document.createElement("a");u.href=o,u.download=t,u.click()};return{detectPrintMode:d,visitBarcode:n,sampleBarcodes:r,invoice:c,results:f,premaritalResult:y,premaritalReferral:l,purchaseOrder:a,receivingOrder:i}};export{j as P,R as a,B as u};
