import{d as Z,e as w,x as ee,a2 as Y,cq as L,s as me,o as n,R as he,w as V,b as e,a as y,a4 as ae,i as c,u as _e,y as S,Q as P,U as be,c as u,k as J,t as p,g as r,n as l,h,V as k,v as I,F as K,a1 as fe,f as ge,_ as ye,m as we,l as xe,$ as Ve}from"./main-DmoZ1fz4.js";import{b as X}from"./toggle-DyRQkDOQ.js";import{s as A}from"./multiselect-DAhRltj6.js";import{F as _}from"./formMode-Bz--3d4P.js";import{G as E}from"./gender-2EqFEEKX.js";import{R as G}from"./rangeType-TTxc8whQ.js";import{_ as Pe}from"./Tinymce.vue_vue_type_script_setup_true_lang-DGYN-s2o.js";import{_ as Ie}from"./BranchSelect.vue_vue_type_script_setup_true_lang-D_pdW9WT.js";var b=(v=>(v.Days="days",v.Months="months",v.Yeas="years",v))(b||{}),R=(v=>(v.Before="before",v.After="after",v.During="during",v))(R||{}),U=(v=>(v.GT=">",v.LT="<",v.EQ="=",v.Range="<>",v))(U||{});const ke=e("h1",null,"Range Notes",-1),Oe={id:"form"},Fe=Z({__name:"ReferenceRangeNotesModal",setup(v){const O=w(!1),F=w({});ee(()=>{Y.on(L.Show,async({range:D})=>{F.value=D,O.value=!0})}),me(()=>Y.off(L.Show));const $=()=>{O.value=!1};return(D,t)=>O.value?(n(),he(ae,{key:0,"modal-class":"!w-[56rem]"},{header:V(()=>[ke]),body:V(()=>[e("form",Oe,[y(Pe,{modelValue:F.value.notes,"onUpdate:modelValue":t[0]||(t[0]=T=>F.value.notes=T),class:"h-[400px]"},null,8,["modelValue"])])]),footer:V(()=>[e("button",{onClick:$,class:"btn-gray"},"Close")]),_:1})):c("",!0)}}),$e={class:"mb-4 grid grid-cols-4 gap-4"},Te={key:0,class:"relative"},Ce={class:"relative"},Ue={class:"truncate"},De={key:0,class:"text-sm text-red-500"},Me={class:"relative"},Re={class:"truncate"},Ne={key:0,class:"text-sm text-red-500"},Be={class:"relative"},Se={key:0,class:"text-sm text-red-500"},Ae={class:"relative"},Ee=["value"],Ge=["value"],Ye={key:0,value:"both"},Le={key:0,class:"text-sm text-red-500"},He={class:"relative"},ze={class:"flex"},Qe=["value"],qe=["value"],We=["value"],je={key:0,class:"text-sm text-red-500"},Je={class:"relative"},Ke={class:"flex"},Xe=["value"],Ze=["value"],ea=["value"],aa={key:0,class:"text-sm text-red-500"},ta={class:"relative"},sa={key:0,class:"text-sm text-red-500"},oa={key:1,class:"relative"},la=e("label",{class:"label"},"Fasting",-1),ra={key:0,class:"mb-3 grid grid-cols-3 gap-4"},na={class:"relative"},ua=["value"],da=["value"],ia=["value"],ca={key:0,class:"ml-36 w-full text-sm text-red-500"},va={class:"relative"},pa={class:"flex"},ma=e("span",{class:"border-2 border-gray-300 bg-gray-100 p-2 rounded-e border-s-0"},"Days",-1),ha={key:0,class:"ml-36 w-full text-sm text-red-500"},_a={class:"relative"},ba={class:"flex"},fa=e("span",{class:"border-2 border-gray-300 bg-gray-100 p-2 border-s-0 rounded-e"},"Days",-1),ga={key:0,class:"ml-36 w-full text-sm text-red-500"},ya=e("hr",null,null,-1),wa=e("h2",{class:"mt-2 mb-3 text-center text-2xl font-bold"},"Ranges",-1),xa={class:"mb-3 grid grid-cols-12 gap-4"},Va={class:"relative col-span-2"},Pa=["onUpdate:modelValue"],Ia=["value"],ka=["value"],Oa=["value"],Fa=["value"],$a={key:0,class:"text-sm text-red-500"},Ta={class:"relative col-span-2"},Ca=["onUpdate:modelValue"],Ua={key:0,class:"text-sm text-red-500"},Da={class:"relative col-span-2"},Ma=["onUpdate:modelValue"],Ra=["value"],Na=["value"],Ba=["value"],Sa={key:0,class:"text-sm text-red-500"},Aa={class:"relative col-span-2"},Ea=["onUpdate:modelValue"],Ga={key:0,class:"text-sm text-red-500"},Ya={class:"relative col-span-3"},La={class:"flex items-center input peer"},Ha=["onClick"],za=e("label",{class:"label"},"Notes",-1),Qa={class:"mt-2"},qa={class:"flex items-center gap-2"},Wa=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M432 256c0 17.69-14.33 32.01-32 32.01H256v144c0 17.69-14.33 31.99-32 31.99s-32-14.3-32-31.99v-144H48c-17.67 0-32-14.32-32-32.01s14.33-31.99 32-31.99H192v-144c0-17.69 14.33-32.01 32-32.01s32 14.32 32 32.01v144h144C417.7 224 432 238.3 432 256z"})],-1),ja=[Wa],Ja=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",fill:"currentColor",class:"h-5 w-5"},[e("path",{d:"M400 288h-352c-17.69 0-32-14.32-32-32.01s14.31-31.99 32-31.99h352c17.69 0 32 14.3 32 31.99S417.7 288 400 288z"})],-1),Ka=[Ja],Xa=["disabled"],nt=Z({__name:"ReferenceRangeForm",emits:["close"],setup(v,{emit:O}){const F=O,$=we(),D=xe(),t=w({ranges:[{isNotesVisible:!0}]}),T=_e().user.branches,H=w([]),C=w([]),z=w([]),d=w({from:{unit:b.Days},to:{unit:b.Days}}),f=w(_.Create),M=w(!1),a=w({});ee(()=>{T.length===1&&(t.value.branchId=T[0].id,N()),$.path.endsWith("/edit")&&(f.value=_.Edit),$.path.endsWith("/clone")&&(f.value=_.Clone),f.value!==_.Create&&se($.params.id)});const te=S(()=>{if(f.value===_.Create)return"Create New Reference Range";if(f.value===_.Clone)return"Clone Reference Range";if(f.value===_.Edit)return"Update Reference Range"}),se=async i=>{const{data:o}=await P.get(`/api/reference-ranges/${i}`);t.value=o.data,N(),q(o.data.testId),Q(o.data.test.departmentId);const x=t.value.ageFrom.split(" "),s=t.value.ageTo.split(" ");d.value.from.value=x[0],d.value.from.unit=x[1],d.value.to.value=s[0],d.value.to.unit=s[1]},Q=async i=>{const{data:o}=await P.get(`/api/machines/list?departmentId=${i}`);z.value=o.data},N=async()=>{const{data:i}=await P.get(`/api/tests/list?branchId=${t.value.branchId}`);C.value=i.data},q=async i=>{const{data:o}=await P.get(`/api/parameters/list?testId=${i}`);H.value=o.data},oe=i=>{const o=C.value.find(x=>x.id===i).departmentId;q(i),Q(o)},W=()=>{t.value.parameterId=null,t.value.machineId=null},le=()=>{t.value.testId=null,W()},re=S(()=>{const i=C.value.find(o=>o.id===t.value.testId);return i?i.affectedByMenses&&t.value.gender===E.Female:!1}),ne=S(()=>{const i=C.value.find(o=>o.id===t.value.testId);return i?i.affectedByFasting:!1}),ue=()=>{d.value.from.value&&(t.value.ageFrom=`${d.value.from.value} ${d.value.from.unit}`),d.value.to.value&&(t.value.ageTo=`${d.value.to.value} ${d.value.to.unit}`)},de=async()=>{M.value=!0,ue();try{f.value===_.Create?await ie():f.value===_.Clone?await ce():f.value===_.Edit&&await ve(),a.value={},Ve.fire()}catch(i){a.value=i.response.data.errors??{}}M.value=!1},ie=async()=>{await P.post("/api/reference-ranges",t.value),pe()},ce=async()=>{await P.post("/api/reference-ranges",t.value),B()},ve=async()=>{await P.patch(`/api/reference-ranges/${t.value.id}`,t.value),B()},j=()=>{t.value.mensesDuration=null,t.value.mensesFrom=null,t.value.mensesTo=null},pe=()=>{t.value={branchId:t.value.branchId,testId:t.value.testId,parameterId:t.value.parameterId,machineId:t.value.machineId,unit:t.value.unit,ranges:t.value.ranges},d.value={from:{unit:b.Days},to:{unit:b.Days}},a.value=[]},B=()=>{F("close"),D.back()};return(i,o)=>{const x=be("maska");return n(),u(K,null,[y(ae,{"modal-class":"!w-[90rem]"},{header:V(()=>[J(p(te.value),1)]),body:V(()=>[e("form",{id:"form",onSubmit:ge(de,["prevent","stop"])},[e("div",$e,[r(T).length>1?(n(),u("div",Te,[y(Ie,{modelValue:t.value.branchId,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.branchId=s),error:a.value.branchId,onSelect:N,onChange:le},null,8,["modelValue","error"])])):c("",!0),e("div",Ce,[y(r(A),{modelValue:t.value.testId,"onUpdate:modelValue":o[1]||(o[1]=s=>t.value.testId=s),onSelect:oe,onChange:W,options:C.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm",class:l(["input peer",{"border-red-500":a.value.hasOwnProperty("testId")}])},{option:V(({option:s})=>[e("label",Ue,p(s.shortForm),1)]),_:1},8,["modelValue","options","class"]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("testId")}])},"Test",2),a.value.hasOwnProperty("testId")?(n(),u("p",De,p(a.value.testId[0]),1)):c("",!0)]),e("div",Me,[y(r(A),{modelValue:t.value.parameterId,"onUpdate:modelValue":o[2]||(o[2]=s=>t.value.parameterId=s),options:H.value,onChange:j,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"shortForm",class:l(["input peer",{"border-red-500":a.value.hasOwnProperty("parameterId")}])},{option:V(({option:s})=>[e("label",Re,p(s.shortForm),1)]),_:1},8,["modelValue","options","class"]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("parameterId")}])},"Parameter",2),a.value.hasOwnProperty("parameterId")?(n(),u("p",Ne,p(a.value.parameterId[0]),1)):c("",!0)]),e("div",Be,[y(r(A),{modelValue:t.value.machineId,"onUpdate:modelValue":o[3]||(o[3]=s=>t.value.machineId=s),options:z.value,searchable:!0,"value-prop":"id","track-by":"searchableForm",label:"name",class:l(["input peer",{"border-red-500":a.value.hasOwnProperty("machineId")}])},null,8,["modelValue","options","class"]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("machineId")}])},"Machine",2),a.value.hasOwnProperty("machineId")?(n(),u("p",Se,p(a.value.machineId[0]),1)):c("",!0)]),e("div",Ae,[h(e("select",{"onUpdate:modelValue":o[4]||(o[4]=s=>t.value.gender=s),onChange:j,class:l(["input h-[2.75rem] peer",{"border-red-500":a.value.hasOwnProperty("gender")}])},[e("option",{value:r(E).Male},"Male",8,Ee),e("option",{value:r(E).Female},"Female",8,Ge),f.value===r(_).Create?(n(),u("option",Ye,"Both")):c("",!0)],34),[[k,t.value.gender]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("gender")}])},"Gender",2),a.value.hasOwnProperty("gender")?(n(),u("p",Le,p(a.value.gender[0]),1)):c("",!0)]),e("div",He,[e("div",ze,[h(e("input",{"onUpdate:modelValue":o[5]||(o[5]=s=>d.value.from.value=s),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",class:l(["input peer !rounded-e-none",{"border-red-500":a.value.hasOwnProperty("ageFrom")}])},null,2),[[I,d.value.from.value],[x]]),h(e("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>d.value.from.unit=s),class:"input w-auto border-s-0 !rounded-s-none focus:!border-s-2"},[e("option",{value:r(b).Days},"Days",8,Qe),e("option",{value:r(b).Months},"Months",8,qe),e("option",{value:r(b).Yeas},"Years",8,We)],512),[[k,d.value.from.unit]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("ageFrom")}])},"Age From",2)]),a.value.hasOwnProperty("ageFrom")?(n(),u("p",je,p(a.value.ageFrom[0]),1)):c("",!0)]),e("div",Je,[e("div",Ke,[h(e("input",{"onUpdate:modelValue":o[7]||(o[7]=s=>d.value.to.value=s),"data-maska":"0","data-maska-tokens":"0:[0-9]:multiple",class:l(["input peer !rounded-e-none",{"border-red-500":a.value.hasOwnProperty("ageTo")}])},null,2),[[I,d.value.to.value],[x]]),h(e("select",{"onUpdate:modelValue":o[8]||(o[8]=s=>d.value.to.unit=s),class:"input w-auto border-s-0 !rounded-s-none focus:!border-s-2"},[e("option",{value:r(b).Days},"Days",8,Xe),e("option",{value:r(b).Months},"Months",8,Ze),e("option",{value:r(b).Yeas},"Years",8,ea)],512),[[k,d.value.to.unit]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("ageTo")}])},"Age To",2)]),a.value.hasOwnProperty("ageFrom")?(n(),u("p",aa,p(a.value.ageTo[0]),1)):c("",!0)]),e("div",ta,[h(e("input",{"onUpdate:modelValue":o[9]||(o[9]=s=>t.value.unit=s),class:l(["input peer",{"border-red-500":a.value.hasOwnProperty("unit")}])},null,2),[[I,t.value.unit]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("unit")}])},"Unit",2),a.value.hasOwnProperty("unit")?(n(),u("p",sa,p(a.value.unit[0]),1)):c("",!0)]),ne.value?(n(),u("div",oa,[y(r(X),{modelValue:t.value.isFasting,"onUpdate:modelValue":o[10]||(o[10]=s=>t.value.isFasting=s),"on-label":"Yes","off-label":"No",class:"input peer pt-2.5"},null,8,["modelValue"]),la])):c("",!0)]),re.value?(n(),u("div",ra,[e("div",na,[h(e("select",{"onUpdate:modelValue":o[11]||(o[11]=s=>t.value.mensesDuration=s),class:l(["input h-[2.75rem] peer",{"border-red-500":a.value.hasOwnProperty("mensesDuration")}])},[e("option",{value:r(R).Before},"Before",8,ua),e("option",{value:r(R).During},"During",8,da),e("option",{value:r(R).After},"After",8,ia)],2),[[k,t.value.mensesDuration]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("mensesDuration")}])},"Menses Duration",2),a.value.hasOwnProperty("mensesDuration")?(n(),u("p",ca,p(a.value.mensesDuration[0]),1)):c("",!0)]),e("div",va,[e("div",pa,[h(e("input",{"onUpdate:modelValue":o[12]||(o[12]=s=>t.value.mensesFrom=s),"data-maska":"##",class:l(["input peer !rounded-e-none",{"border-red-500":a.value.hasOwnProperty("mensesFrom")}])},null,2),[[I,t.value.mensesFrom],[x]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("mensesFrom")}])},"Menses From",2),ma]),a.value.hasOwnProperty("mensesFrom")?(n(),u("p",ha,p(a.value.mensesFrom[0]),1)):c("",!0)]),e("div",_a,[e("div",ba,[h(e("input",{"onUpdate:modelValue":o[13]||(o[13]=s=>t.value.mensesTo=s),"data-maska":"##",class:l(["input peer !rounded-e-none",{"border-red-500":a.value.hasOwnProperty("mensesTo")}])},null,2),[[I,t.value.mensesTo],[x]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty("mensesTo")}])},"Menses To",2),fa]),a.value.hasOwnProperty("mensesTo")?(n(),u("p",ga,p(a.value.mensesTo[0]),1)):c("",!0)])])):c("",!0),ya,wa,(n(!0),u(K,null,fe(t.value.ranges,(s,m)=>(n(),u("div",xa,[e("div",Va,[h(e("select",{"onUpdate:modelValue":g=>s.operator=g,class:l(["input h-[2.75rem] peer",{"border-red-500":a.value.hasOwnProperty(`ranges.${m}.operator`)}])},[e("option",{value:r(U).GT},"Greater Than",8,Ia),e("option",{value:r(U).LT},"Less Than",8,ka),e("option",{value:r(U).EQ},"Equal",8,Oa),e("option",{value:r(U).Range},"Between",8,Fa)],10,Pa),[[k,s.operator]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty(`ranges.${m}.operator`)}])},"Operator",2),a.value.hasOwnProperty(`ranges.${m}.operator`)?(n(),u("p",$a,p(a.value[`ranges.${m}.operator`][0]),1)):c("",!0)]),e("div",Ta,[h(e("input",{"onUpdate:modelValue":g=>s.value=g,class:l(["input peer",{"border-red-500":a.value.hasOwnProperty(`ranges.${m}.value`)}])},null,10,Ca),[[I,s.value]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty(`ranges.${m}.value`)}])},"Value",2),a.value.hasOwnProperty(`ranges.${m}.value`)?(n(),u("p",Ua,p(a.value[`ranges.${m}.value`][0]),1)):c("",!0)]),e("div",Da,[h(e("select",{"onUpdate:modelValue":g=>s.type=g,class:l(["input h-[2.75rem] peer",{"border-red-500":a.value.hasOwnProperty(`ranges.${m}.type`)}])},[e("option",{value:r(G).Normal},"Normal",8,Ra),e("option",{value:r(G).Abnormal},"Abnormal",8,Na),e("option",{value:r(G).Critical},"Critical",8,Ba)],10,Ma),[[k,s.type]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty(`ranges.${m}.type`)}])},"Type",2),a.value.hasOwnProperty(`ranges.${m}.type`)?(n(),u("p",Sa,p(a.value[`ranges.${m}.type`][0]),1)):c("",!0)]),e("div",Aa,[h(e("input",{"onUpdate:modelValue":g=>s.interpretation=g,class:l(["input peer",{"border-red-500":a.value.hasOwnProperty(`ranges.${m}.interpretation`)}])},null,10,Ea),[[I,s.interpretation]]),e("label",{class:l(["label",{"text-red-500":a.value.hasOwnProperty(`ranges.${m}.interpretation`)}])},"INTPN",2),a.value.hasOwnProperty(`ranges.${m}.interpretation`)?(n(),u("p",Ga,p(a.value[`ranges.${m}.interpretation`][0]),1)):c("",!0)]),e("div",Ya,[e("div",La,[e("span",{onClick:g=>r(Y).emit(r(L).Show,{range:s}),class:"cursor-pointer rounded bg-teal-500 p-1 text-xs text-white transition hover:bg-teal-600"},"Open Editor",8,Ha)]),za]),e("div",Qa,[y(r(X),{modelValue:s.isNotesVisible,"onUpdate:modelValue":g=>s.isNotesVisible=g,class:"toggle:w-4","on-label":"Visible","off-label":"Hidden"},null,8,["modelValue","onUpdate:modelValue"])])]))),256)),e("div",qa,[e("span",{class:"rounded bg-emerald-500 p-1 text-white transition hover:bg-emerald-600 hover:shadow",onClick:o[14]||(o[14]=s=>t.value.ranges.push({isNotesVisible:!0}))},ja),e("span",{class:"rounded bg-red-500 p-1 text-white transition hover:bg-red-600 hover:shadow",onClick:o[15]||(o[15]=s=>t.value.ranges.pop())},Ka)])],32)]),footer:V(()=>[e("button",{class:"me-2 btn-blue",disabled:M.value,form:"form"},[y(ye,{"is-loading":M.value},{default:V(()=>[J("Save")]),_:1},8,["is-loading"])],8,Xa),e("button",{onClick:B,class:"btn-gray"},"Cancel")]),_:1}),y(Fe)],64)}}});export{nt as default};
