import{d as M,e as o,x as y,o as h,c as r,h as v,ai as w,b as i,i as x,f as m,g as u,F as C,p as _}from"./main-BgbWFIXK.js";class L{constructor(e,t="user",s=null,a=null){this._webcamElement=e,this._webcamElement.width=this._webcamElement.width||640,this._webcamElement.height=this._webcamElement.height||360,this._facingMode=t,this._webcamList=[],this._streamList=[],this._selectedDeviceId="",this._canvasElement=s,this._snapSoundElement=a}get facingMode(){return this._facingMode}set facingMode(e){this._facingMode=e}get webcamList(){return this._webcamList}get webcamCount(){return this._webcamList.length}get selectedDeviceId(){return this._selectedDeviceId}getVideoInputs(e){return this._webcamList=[],e.forEach(t=>{t.kind==="videoinput"&&this._webcamList.push(t)}),this._webcamList.length==1&&(this._facingMode="user"),this._webcamList}getMediaConstraints(){var e={};this._selectedDeviceId==""?e.facingMode=this._facingMode:e.deviceId={exact:this._selectedDeviceId},e.width={exact:this._webcamElement.width},e.height={exact:this._webcamElement.height};var t={video:e,audio:!1};return t}selectCamera(){for(let e of this._webcamList)if(this._facingMode=="user"&&e.label.toLowerCase().includes("front")||this._facingMode=="enviroment"&&e.label.toLowerCase().includes("back")){this._selectedDeviceId=e.deviceId;break}}flip(){this._facingMode=this._facingMode=="user"?"enviroment":"user",this._webcamElement.style.transform="",this.selectCamera()}async start(e=!0){return new Promise((t,s)=>{this.stop(),navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then(a=>{this._streamList.push(a),this.info().then(l=>{this.selectCamera(),e?this.stream().then(c=>{t(this._facingMode)}).catch(c=>{s(c)}):t(this._selectedDeviceId)}).catch(l=>{s(l)})}).catch(a=>{s(a)})})}async info(){return new Promise((e,t)=>{navigator.mediaDevices.enumerateDevices().then(s=>{this.getVideoInputs(s),e(this._webcamList)}).catch(s=>{t(s)})})}async stream(){return new Promise((e,t)=>{navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then(s=>{this._streamList.push(s),this._webcamElement.srcObject=s,this._webcamElement.play(),e(this._facingMode)}).catch(s=>{console.log(s),t(s)})})}stop(){this._streamList.forEach(e=>{e.getTracks().forEach(t=>{t.stop()})})}snap(){if(this._canvasElement!=null){this._snapSoundElement!=null&&this._snapSoundElement.play(),this._canvasElement.height=this._webcamElement.scrollHeight,this._canvasElement.width=this._webcamElement.scrollWidth;let e=this._canvasElement.getContext("2d");return e.clearRect(0,0,this._canvasElement.width,this._canvasElement.height),e.drawImage(this._webcamElement,0,0,this._canvasElement.width,this._canvasElement.height),this._canvasElement.toDataURL("image/png")}else throw"canvas element is missing"}}const k={class:"fixed inset-0 flex flex-col items-center justify-center bg-black/80 z-[100]"},D=["src"],I={class:"mt-5 flex items-center justify-center gap-5"},z=["title"],V=i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-10 w-10 text-gray-900"},[i("path",{d:"M12 9a3.75 3.75 0 100 7.5A3.75 3.75 0 0012 9z"}),i("path",{"fill-rule":"evenodd",d:"M9.344 3.071a49.52 49.52 0 015.312 0c.967.052 1.83.585 2.332 1.39l.821 1.317c.24.383.645.643 1.11.71.386.054.77.113 1.152.177 1.432.239 2.429 1.493 2.429 2.909V18a3 3 0 01-3 3h-15a3 3 0 01-3-3V9.574c0-1.416.997-2.67 2.429-2.909.382-.064.766-.123 1.151-.178a1.56 1.56 0 001.11-.71l.822-1.315a2.942 2.942 0 012.332-1.39zM6.75 12.75a5.25 5.25 0 1110.5 0 5.25 5.25 0 01-10.5 0zm12-1.5a.75.75 0 100-1.5.75.75 0 000 1.5z","clip-rule":"evenodd"})],-1),B=[V],j=["title"],S=i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-10 w-10 text-gray-900"},[i("path",{"fill-rule":"evenodd",d:"M4.755 10.059a7.5 7.5 0 0112.548-3.364l1.903 1.903h-3.183a.75.75 0 100 1.5h4.992a.75.75 0 00.75-.75V4.356a.75.75 0 00-1.5 0v3.18l-1.9-1.9A9 9 0 003.306 9.67a.75.75 0 101.45.388zm15.408 3.352a.75.75 0 00-.919.53 7.5 7.5 0 01-12.548 3.364l-1.902-1.903h3.183a.75.75 0 000-1.5H2.984a.75.75 0 00-.75.75v4.992a.75.75 0 001.5 0v-3.18l1.9 1.9a9 9 0 0015.059-4.035.75.75 0 00-.53-.918z","clip-rule":"evenodd"})],-1),A=[S],P=["title"],R=i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"h-10 w-10 text-gray-900"},[i("path",{"fill-rule":"evenodd",d:"M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 01-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z","clip-rule":"evenodd"})],-1),U=[R],N=M({__name:"WebcamModal",emits:["capture"],setup(g,{expose:e,emit:t}){const s=t;let a=null;const l=o(null),c=o(null),n=o(null),d=o(!1);y(()=>{a=new L(l.value,"enviroment",c.value)});const f=async()=>{await a.start(),d.value=!0},p=()=>{n.value=a.snap(),s("capture",n.value),a.stop()},b=()=>{n.value=null,a.start()},E=()=>{a.stop(),n.value=null,d.value=!1};return e({open:f}),(W,F)=>(h(),r(C,null,[v(i("div",k,[v(i("video",{autoplay:"",playsinline:"",ref_key:"webcamElement",ref:l,width:"640",height:"480",class:"rounded-lg"},null,512),[[w,n.value===null]]),n.value?(h(),r("img",{key:0,src:n.value,alt:"",width:"640",height:"480",class:"rounded-lg"},null,8,D)):x("",!0),i("div",I,[n.value===null?(h(),r("button",{key:0,class:"flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 shadow",onClick:m(p,["prevent"]),title:u(_)("Capture")},B,8,z)):(h(),r("button",{key:1,class:"flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 shadow",onClick:m(b,["prevent"]),title:u(_)("Retry")},A,8,j)),i("button",{class:"flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 shadow",onClick:m(E,["prevent"]),title:u(_)("Close")},U,8,P)])],512),[[w,d.value]]),i("canvas",{ref_key:"canvasElement",ref:c,class:"hidden"},null,512)],64))}});export{N as _};
