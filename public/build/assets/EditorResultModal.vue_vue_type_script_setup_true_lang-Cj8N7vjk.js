import{d as S,e as g,x as F,a2 as N,a9 as b,X as y,s as E,Q as C,o as h,R as T,w as R,b as f,c as _,F as $,a1 as k,i as w,a as I,a4 as B,T as M,t as U}from"./main-DNdNUUJ7.js";import{_ as A}from"./Tinymce.vue_vue_type_script_setup_true_lang-CKA9BU0O.js";const j=()=>{const p=l=>l.results.find(t=>t.isSelected),d=(l,t)=>l.test.referenceRanges.find(a=>a.machineId===p(l).machineId&&a.parameterId===t.id),v=(l,t,a)=>{const s=d(l,t);if(!s)return null;const r=s.ranges.filter(e=>e.type===a);if(r.length===0)return null;let n="";return r.forEach((e,i)=>{i>0&&(n+=" , "),e.operator==="<>"?n+=`${e.value} ${e.interpretation}`:n+=`${e.operator} ${e.value} ${e.interpretation}`}),n},o=(l,t,a)=>{const s=d(l,t);return s?s.ranges.find(r=>r.type===a):null};return{getReferenceRange:d,getReferenceRangeUnit:(l,t)=>{const a=d(l,t);return a?a.unit:"undefined"},getFormattedRanges:v,getRange:o,getResultAsToNormalRange:(l,t,a)=>{const s=o(l,t,"normal");if(!a||!s)return null;if(s.operator==="<>"){let[r,n]=s.value.split("-");r=parseFloat(r),n=parseFloat(n);const e=parseFloat(a);return isNaN(e)||isNaN(r)||isNaN(n)?"invalid":e<r?"low":e>n?"high":"normal"}else{if(s.operator==="=")return a==s.value?"normal":"abnormal";if(s.operator===">"){const r=parseFloat(s.value),n=parseFloat(a);return isNaN(r)||isNaN(n)?"invalid":n>r?"normal":"low"}else if(s.operator==="<"){const r=parseFloat(s.value),n=parseFloat(a);return isNaN(r)||isNaN(n)?"invalid":n<r?"normal":"high"}else return null}}}},q=()=>{const p=o=>o.results.find(u=>u.isSelected);return{getSelectedResult:p,getEntry:(o,u)=>p(o).entries.find(m=>m.parameterId===u.id),getResultColor:o=>o==="normal"?"bg-emerald-500 text-white":["low","high","abnormal"].includes(o)?"bg-orange-500 text-white":o==="invalid"?"bg-red-500 text-white":""}},V=f("h1",null,"Result",-1),z={id:"form"},D={class:"grid grid-cols-1 gap-4"},H={key:0,class:"relative"},L=f("option",{value:""},"Select template",-1),P=["value"],Q=f("label",{class:"label"},"Template",-1),G=S({__name:"EditorResultModal",emits:["resultTemplateSelected"],setup(p,{emit:d}){const{hasPermissionTo:v}=M(),o=g({}),u=g(!1),m=g(!1),l=g([]),t=g({}),a=d;F(()=>{N.on(b.Show,async({result:e,branchId:i,readonly:c})=>{t.value=e,m.value=c,u.value=!0,o.value=y().data.general?.find(x=>x.branchId===i),s()})}),E(()=>N.off(b.Show));const s=async()=>{if(!v("ResultTemplate.list"))return;const{data:e}=await C.get(`/api/result-templates/list?parameterId=${t.value.parameterId}`);l.value=e.data},r=e=>{e&&(t.value.value=l.value.find(i=>i.id===e).content,a("resultTemplateSelected"))},n=()=>{u.value=!1};return(e,i)=>u.value?(h(),T(B,{key:0,"modal-class":"!w-[56rem]"},{header:R(()=>[V]),body:R(()=>[f("form",z,[f("div",D,[m.value?w("",!0):(h(),_("div",H,[f("select",{onChange:i[0]||(i[0]=c=>r(c.target.value)),class:"input peer"},[L,(h(!0),_($,null,k(l.value,c=>(h(),_("option",{value:c.id},U(c.name),9,P))),256))],32),Q])),I(A,{modelValue:t.value.value,"onUpdate:modelValue":i[1]||(i[1]=c=>t.value.value=c),disabled:m.value,"limit-width":o.value?.resultEditorMaxWidth,"limit-height":o.value?.resultEditorMaxHeight,class:"h-[400px]"},null,8,["modelValue","disabled","limit-width","limit-height"])])])]),footer:R(()=>[f("button",{onClick:n,class:"btn-gray"},"Close")]),_:1})):w("",!0)}});export{G as _,q as a,j as u};
