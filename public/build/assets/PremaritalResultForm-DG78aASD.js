import{d as le,e as m,x as ie,a2 as E,al as Q,s as _e,Q as A,o as n,R as de,w as y,k as C,t as a,g as t,b as o,a as x,n as I,c as r,i as f,f as pe,_ as O,a4 as me,p as l,T as ue,$ as D,y as ge,S as ve,F as V,a1 as se,h as ye,v as Re,m as xe,l as we,Y as W,af as B,a9 as ae}from"./main-BgbWFIXK.js";import{M as ke}from"./Master-Bb3753-s.js";import{_ as Ce,a as Ie,u as Ae}from"./EditorResultModal.vue_vue_type_script_setup_true_lang-DtTzk1Jx.js";import{R as b}from"./rangeType-TTxc8whQ.js";import{O as oe}from"./orderStatus-Cdywi7Or.js";import{s as Fe}from"./multiselect-DeMhawmc.js";import{P as F}from"./premaritalReferralStatus-CQMWPAtf.js";import{A as ne}from"./attachmentType-BPw9qDR8.js";import{R as re}from"./resultType-V5I8keIQ.js";import{b as Pe}from"./toggle-CP_W0i88.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Tinymce.vue_vue_type_script_setup_true_lang-CdoC0Yf5.js";const Se={class:"relative"},Te={key:0,class:"text-sm text-red-500"},Ne=["disabled"],$e=le({__name:"PremaritalReferralModal",emits:["close"],setup(ce,{emit:L}){const z=L,{hasPermissionTo:w}=ue(),g=m(!1),P=m(!1),q=m({}),U=m({}),M=m({}),v=m({}),S=m([]),i=m({});ie(()=>{E.on(Q.Show,({premaritalVisit:_,personalInformation:p,order:R})=>{q.value=_,U.value=p,M.value=R,v.value={branchId:_.branchId,premaritalVisitId:_.id,premaritalPersonalInformationId:p.id,orderId:R.id},H(),P.value=!0})}),_e(()=>E.off(Q.Show));const H=async()=>{const{data:_}=await A.get(`/api/suggestions/list?branchId=${v.value.branchId}&type=referralHospital`);S.value=_.data},T=async({content:_})=>{const{data:p}=await A.post("/api/suggestions",{branchId:v.value.branchId,type:"referralHospital",content:_});return S.value.push(p.data),p.data},N=async()=>{g.value=!0;try{await A.post("/api/premarital/referrals",v.value),i.value={},D.fire(),$()}catch(_){i.value=_.response.data.errors??{}}g.value=!1},$=()=>{P.value=!1,v.value={},i.value={},z("close")};return(_,p)=>P.value?(n(),de(me,{key:0},{header:y(()=>[C(a(t(l)("Test Referral (:testName) For (:patientName)",{testName:M.value.test.name,patientName:U.value.name})),1)]),body:y(()=>[o("form",{id:"form",onSubmit:pe(N,["prevent","stop"]),class:"grid grid-cols-1 gap-4"},[o("div",Se,[x(t(Fe),{modelValue:v.value.hospital,"onUpdate:modelValue":p[0]||(p[0]=R=>v.value.hospital=R),options:S.value,"value-prop":"content","track-by":"content",label:"content",searchable:!0,"create-option":t(w)("Suggestion.create"),"on-create":T,class:I(["input peer",{"border-red-500":i.value.hasOwnProperty("hospital")}])},null,8,["modelValue","options","create-option","class"]),o("label",{class:I(["label",{"text-red-500":i.value.hasOwnProperty("hospital")}])},a(t(l)("Hospital")),3),i.value.hasOwnProperty("hospital")?(n(),r("p",Te,a(i.value.hospital[0]),1)):f("",!0)])],32)]),footer:y(()=>[o("button",{class:"me-2 btn-blue",disabled:g.value,form:"form"},[x(O,{"is-loading":g.value},{default:y(()=>[C(a(t(l)("Save")),1)]),_:1},8,["is-loading"])],8,Ne),o("button",{onClick:$,class:"btn-gray"},a(t(l)("Cancel")),1)]),_:1})):f("",!0)}}),Ve={class:"h-[calc(100vh-12.5rem)] overflow-y-auto flex flex-col justify-between pe-2"},Oe={class:"flex items-center justify-around"},Ee={class:"text-lg font-bold"},ze={class:"text-lg font-bold"},Ue={class:"text-lg font-bold"},Me={class:"mt-5 w-full"},He={class:"bg-gray-600 p-2 font-semibold text-white rounded-ss"},Be={class:"bg-gray-600 p-2 font-semibold text-white"},De={class:"bg-gray-600 p-2 font-semibold text-white"},Le={class:"bg-gray-600 p-2 font-semibold text-white"},Ye={class:"bg-gray-600 p-2 font-semibold text-white"},je={class:"bg-gray-600 p-2 font-semibold text-white"},We={class:"bg-gray-600 p-2 font-semibold text-white rounded-se"},Qe={class:"bg-gray-200"},qe={colspan:"3",class:"border border-gray-200 px-2 py-1"},Ge={key:0,class:"flex items-center justify-center gap-3"},Je=["onClick","disabled"],Ke=["onClick"],Xe={key:2,class:"p-1 text-sm btn-gray",disabled:""},Ze=["href"],et={class:"border border-gray-200 px-2 py-1 text-center text-lg font-semibold"},tt={colspan:"3",class:"border border-gray-200 px-2 py-1"},st={key:0,class:"flex items-center justify-center gap-3"},at=["onClick","disabled"],ot=["onClick"],nt={key:2,class:"p-1 text-sm btn-gray",disabled:""},rt=["href"],lt={class:"w-24 border border-gray-300 px-2 py-1 text-center"},it={class:"w-72 border border-gray-300 px-2 py-1 text-center"},dt={key:0},ut={key:1,dir:"ltr"},ct={key:0,class:"text-emerald-500"},ft={key:1,class:"mx-2 last-of-type:hidden"},ht={key:2,class:"text-orange-500"},bt={key:3,class:"mx-2 last-of-type:hidden"},_t={key:4,class:"text-red-500"},pt={class:"px-2"},mt={key:0,class:"flex items-center px-2"},gt=["onClick"],vt={key:1,class:"absolute top-1 end-2"},yt={key:1,colspan:"3",class:"border border-gray-300 px-2 py-1 text-center"},Rt={class:"border border-gray-300 px-2 py-1 text-center"},xt={class:"absolute h-full end-2"},wt={key:0,class:"flex items-center px-2"},kt=["onClick"],Ct={key:1,class:"px-2"},It={class:"w-72 border border-gray-300 px-2 py-1 text-center"},At={key:0},Ft={key:1,dir:"ltr"},Pt={key:0,class:"text-emerald-500"},St={key:1,class:"mx-2 last-of-type:hidden"},Tt={key:2,class:"text-orange-500"},Nt={key:3,class:"mx-2 last-of-type:hidden"},$t={key:4,class:"text-red-500"},Vt={class:"w-24 border border-gray-300 px-2 py-1 text-center"},Ot={key:3,colspan:"3",class:"border border-gray-300 px-2 py-1 text-center"},Et={class:"mt-5 flex items-center gap-2"},zt={class:"relative flex-1"},Ut=["disabled"],Mt={class:"label"},Ht={class:"relative w-40"},Bt={class:"mt-3 border-t-2 border-gray-200"},Dt={class:"mt-3 flex items-center gap-3"},Lt=["disabled"],Yt=["disabled"],as=le({__name:"PremaritalResultForm",setup(ce){const L=xe(),z=we(),{hasPermissionTo:w}=ue(),{getEntry:g,getResultColor:P,getSelectedResult:q}=Ie(),{getReferenceRange:U,getFormattedRanges:M,getResultAsToNormalRange:v,getReferenceRangeUnit:S}=Ae(),i=m({}),H=m([]),T=m({}),N=m({}),$=m(!1),_=m(!1),p=m([]);ie(()=>R());const R=async()=>{const{data:d}=await A.get(`/api/premarital/results/${L.params.id}`);i.value=d.premaritalVisit,H.value=d.premaritalTests,T.value=d.husbandOrders,N.value=d.wifeOrders},u=(d,c)=>d==="husband"?T.value.find(e=>e.testId===c):N.value.find(e=>e.testId===c),G=(d,c,e)=>{const s=u(d,c);return P(v(s,e,g(s,e).value))},J=(d,c,e)=>{const s=u(d,c);return v(s,e,g(s,e).value)?.capitalize()},K=(d,c,e)=>{const s=u(d,c);return g(s,e).value},X=(d,c,e)=>{const s=u(d,c);return U(s,e)},Z=(d,c,e)=>{const s=u(d,c);return S(s,e)},h=(d,c,e,s)=>{const j=u(d,c);return M(j,e,s)},k=d=>d?.selectedResult&&[oe.Authorized,oe.Released].includes(d.status),fe=()=>{const d=T.value.find(e=>!k(e)||e.premaritalReferral?.status===F.Pending),c=N.value.find(e=>!k(e)||e.premaritalReferral?.status===F.Pending);return!(d||c)},ee=async d=>{const{isConfirmed:c}=await W.fire();c&&(p.value[d.id]=!0,await A.post(`/api/premarital/results/${i.value.id}/rerun`,{orderId:d.id}),p.value[d.id]=!1,D.fire(),R())},te=async(d,c)=>{E.emit(Q.Show,{premaritalVisit:i.value,personalInformation:c,order:d})},he=async()=>{const{isConfirmed:d}=await W.fire();d&&(_.value=!0,await A.post(`/api/premarital/results/${i.value.id}/rerun-all`),_.value=!1,D.fire(),R())},Y=ge(()=>w("PremaritalResult.authorize")&&fe()&&i.value.status===B.Tested),be=async()=>{const{isConfirmed:d}=await W.fire();d&&(await A.post(`/api/premarital/results/${i.value.id}/authorize`,{isRiskFree:i.value.isRiskFree,notes:i.value.notes}),D.fire(),z.back())};return(d,c)=>(n(),r(V,null,[x(ke,null,ve({header:y(()=>[C(a(t(l)("Results")),1)]),_:2},[i.value.husbandInformation?{name:"body",fn:y(()=>[o("div",Ve,[o("main",null,[o("section",Oe,[o("span",Ee,a(t(l)(":name (:age Years)",{name:i.value.husbandInformation.name,age:i.value.husbandInformation.age})),1),o("span",ze,a(t(l)("Relation Degree: :relationDegree",{relationDegree:t(l)(i.value.relationDegree.startCase())})),1),o("span",Ue,a(t(l)(":name (:age Years)",{name:i.value.wifeInformation.name,age:i.value.wifeInformation.age})),1)]),o("section",null,[o("table",Me,[o("thead",null,[o("tr",null,[o("th",He,a(t(l)("Unit")),1),o("th",Be,a(t(l)("Reference Range")),1),o("th",De,a(t(l)("Result")),1),o("th",Le,a(t(l)("Test Name")),1),o("th",Ye,a(t(l)("Result")),1),o("th",je,a(t(l)("Reference Range")),1),o("th",We,a(t(l)("Unit")),1)])]),(n(!0),r(V,null,se(H.value,e=>(n(),r("tbody",null,[o("tr",Qe,[o("td",qe,[i.value.status===t(B).Tested?(n(),r("div",Ge,[t(w)("PremaritalResult.rerun")&&k(u("husband",e.id))?(n(),r("button",{key:0,class:"p-1 text-sm btn-red",onClick:s=>ee(u("husband",e.id)),disabled:p.value[u("husband",e.id)]},[x(O,{"is-loading":p.value[u("wife",e.id)]??!1},{default:y(()=>[C(a(t(l)("Rerun")),1)]),_:2},1032,["is-loading"])],8,Je)):f("",!0),t(w)("PremaritalReferral.create")&&k(u("husband",e.id))&&!u("husband",e.id).premaritalReferral?(n(),r("button",{key:1,class:"p-1 text-sm btn-gray",onClick:s=>te(u("husband",e.id),i.value.husbandInformation)},a(t(l)("Refer")),9,Ke)):f("",!0),u("husband",e.id).premaritalReferral?.status===t(F).Pending?(n(),r("button",Xe,a(t(l)("Awaiting Referral Result")),1)):f("",!0),u("husband",e.id).premaritalReferral?.status===t(F).Received?(n(),r("a",{key:3,class:"p-1 text-sm btn-blue",href:u("husband",e.id).premaritalReferral.attachments.find(s=>s.type===t(ne).ReferralResult).path,target:"_blank"},a(t(l)("Show Referral Result")),9,Ze)):f("",!0)])):f("",!0)]),o("td",et,a(e.name),1),o("td",tt,[i.value.status===t(B).Tested?(n(),r("div",st,[t(w)("PremaritalResult.rerun")&&k(u("wife",e.id))?(n(),r("button",{key:0,class:"p-1 text-sm btn-red",onClick:s=>ee(u("wife",e.id)),disabled:p.value[u("wife",e.id)]},[x(O,{"is-loading":p.value[u("wife",e.id)]??!1},{default:y(()=>[C(a(t(l)("Rerun")),1)]),_:2},1032,["is-loading"])],8,at)):f("",!0),t(w)("PremaritalReferral.create")&&k(u("wife",e.id))&&!u("wife",e.id).premaritalReferral?(n(),r("button",{key:1,class:"p-1 text-sm btn-gray",onClick:s=>te(u("wife",e.id),i.value.wifeInformation)},a(t(l)("Refer")),9,ot)):f("",!0),u("wife",e.id).premaritalReferral?.status===t(F).Pending?(n(),r("button",nt,a(t(l)("Awaiting Referral Result")),1)):f("",!0),u("wife",e.id).premaritalReferral?.status===t(F).Received?(n(),r("a",{key:3,class:"p-1 text-sm btn-blue",href:u("wife",e.id).premaritalReferral.attachments.find(s=>s.type===t(ne).ReferralResult).path,target:"_blank"},a(t(l)("Show Referral Result")),9,rt)):f("",!0)])):f("",!0)])]),(n(!0),r(V,null,se(e.parameters,s=>(n(),r("tr",null,[k(u("husband",e.id))?(n(),r(V,{key:0},[o("td",lt,a(Z("husband",e.id,s)),1),o("td",it,[X("husband",e.id,s)?(n(),r("div",ut,[h("husband",e.id,s,t(b).Normal)?(n(),r("span",ct,a(h("husband",e.id,s,t(b).Normal)),1)):f("",!0),h("husband",e.id,s,t(b).Normal)?(n(),r("span",ft,"||")):f("",!0),h("husband",e.id,s,t(b).Abnormal)?(n(),r("span",ht,a(h("husband",e.id,s,t(b).Abnormal)),1)):f("",!0),h("husband",e.id,s,t(b).Abnormal)?(n(),r("span",bt,"||")):f("",!0),h("husband",e.id,s,t(b).Critical)?(n(),r("span",_t,a(h("husband",e.id,s,t(b).Critical)),1)):f("",!0)])):(n(),r("span",dt,a(t(l)("undefined")),1))]),o("td",{class:I(["relative w-60 border border-gray-300",G("husband",e.id,s)])},[o("span",pt,a(t(l)(J("husband",e.id,s))),1),s.resultType===t(re).Editor?(n(),r("div",mt,[o("button",{onClick:j=>t(E).emit(t(ae).Show,{branchId:s.branchId,result:t(g)(u("husband",e.id),s),readonly:!0}),class:"absolute end-2 top-1 rounded bg-teal-500 p-1 text-xs text-white transition hover:bg-teal-600"},"Open Editor",8,gt)])):(n(),r("p",vt,a(K("husband",e.id,s)),1))],2)],64)):(n(),r("td",yt,a(t(l)("Waiting for result...")),1)),o("td",Rt,a(s.name),1),k(u("wife",e.id))?(n(),r(V,{key:2},[o("td",{class:I(["relative w-60 border border-gray-300",G("wife",e.id,s)])},[o("span",xt,a(t(l)(J("wife",e.id,s))),1),s.resultType===t(re).Editor?(n(),r("div",wt,[o("button",{onClick:j=>t(E).emit(t(ae).Show,{branchId:s.branchId,result:t(g)(u("wife",e.id),s),readonly:!0}),class:"rounded bg-teal-500 p-1 text-xs text-white transition hover:bg-teal-600"},"Open Editor",8,kt)])):(n(),r("p",Ct,a(K("wife",e.id,s)),1))],2),o("td",It,[X("wife",e.id,s)?(n(),r("div",Ft,[h("wife",e.id,s,t(b).Normal)?(n(),r("span",Pt,a(h("wife",e.id,s,t(b).Normal)),1)):f("",!0),h("wife",e.id,s,t(b).Normal)?(n(),r("span",St,"||")):f("",!0),h("wife",e.id,s,t(b).Abnormal)?(n(),r("span",Tt,a(h("wife",e.id,s,t(b).Abnormal)),1)):f("",!0),h("wife",e.id,s,t(b).Abnormal)?(n(),r("span",Nt,"||")):f("",!0),h("wife",e.id,s,t(b).Critical)?(n(),r("span",$t,a(h("wife",e.id,s,t(b).Critical)),1)):f("",!0)])):(n(),r("span",At,a(t(l)("undefined")),1))]),o("td",Vt,a(Z("wife",e.id,s)),1)],64)):(n(),r("td",Ot,a(t(l)("Waiting for result...")),1))]))),256))]))),256))]),o("div",Et,[o("div",zt,[ye(o("input",{type:"text","onUpdate:modelValue":c[0]||(c[0]=e=>i.value.notes=e),class:"input peer",disabled:!Y.value},null,8,Ut),[[Re,i.value.notes]]),o("label",Mt,a(t(l)("Notes")),1)]),o("div",Ht,[Y.value?(n(),de(t(Pe),{key:0,modelValue:i.value.isRiskFree,"onUpdate:modelValue":c[1]||(c[1]=e=>i.value.isRiskFree=e),"on-label":t(l)("Yes"),"off-label":t(l)("No"),class:I(["input peer pt-2.5 toggle:off:red",{"border-red-500":!i.value.isRiskFree}])},null,8,["modelValue","on-label","off-label","class"])):(n(),r("p",{key:1,class:I(["input pt-2.5",{"border-red-500 text-red-500 font-semibold":!i.value.isRiskFree}])},a(i.value.isRiskFree?t(l)("Yes"):t(l)("No")),3)),o("label",{class:I(["label",{"text-red-500":!i.value.isRiskFree}])},a(t(l)("Risk Free")),3)])])])])]),o("footer",Bt,[o("div",Dt,[Y.value?(n(),r("button",{key:0,class:"btn-blue",disabled:$.value,onClick:be},[x(O,{"is-loading":$.value},{default:y(()=>[C(a(t(l)("Authorize")),1)]),_:1},8,["is-loading"])],8,Lt)):f("",!0),o("button",{class:"btn-gray me-auto",onClick:c[2]||(c[2]=e=>t(z).back())},a(t(l)("Cancel")),1),t(w)("PremaritalResult.rerunAll")&&i.value.status===t(B).Tested?(n(),r("button",{key:1,class:"btn-red",disabled:_.value,onClick:he},[x(O,{"is-loading":_.value},{default:y(()=>[C(a(t(l)("Rerun All")),1)]),_:1},8,["is-loading"])],8,Yt)):f("",!0)])])]),key:"0"}:void 0]),1024),x($e,{onClose:R}),x(Ce)],64))}});export{as as default};
